<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="二进制漏洞与利用——堆利用">
<title>PWN-3</title>

<link rel='canonical' href='https://expl0rer.top/p/pwn-3/'>

<link rel="stylesheet" href="/scss/style.min.84f4364fa3a5758ecded3430d054d555b355a8e9efd1baf1e03c18d73802579f.css"><meta property='og:title' content="PWN-3">
<meta property='og:description' content="二进制漏洞与利用——堆利用">
<meta property='og:url' content='https://expl0rer.top/p/pwn-3/'>
<meta property='og:site_name' content='Expl0rer.Ct'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-09-07T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-10-08T16:19:55&#43;00:00'/><meta property='og:image' content='https://expl0rer.top/p/pwn-3/PWN3.png' />
<meta name="twitter:title" content="PWN-3">
<meta name="twitter:description" content="二进制漏洞与利用——堆利用"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://expl0rer.top/p/pwn-3/PWN3.png' />
    <link rel="shortcut icon" href="/favicon.ico" />
<div class="loading">
     
    <div id="ghost">
        <div id="red">
            <div id="pupil"></div>
            <div id="pupil1"></div>
            <div id="eye"></div>
            <div id="eye1"></div>
            <div id="top0"></div>
            <div id="top1"></div>
            <div id="top2"></div>
            <div id="top3"></div>
            <div id="top4"></div>
            <div id="st0"></div>
            <div id="st1"></div>
            <div id="st2"></div>
            <div id="st3"></div>
            <div id="st4"></div>
            <div id="st5"></div>
            <div id="an1"></div>
            <div id="an2"></div>
            <div id="an3"></div>
            <div id="an4"></div>
            <div id="an5"></div>
            <div id="an6"></div>
            <div id="an7"></div>
            <div id="an8"></div>
            <div id="an9"></div>
            <div id="an10"></div>
            <div id="an11"></div>
            <div id="an12"></div>
            <div id="an13"></div>
            <div id="an14"></div>
            <div id="an15"></div>
            <div id="an16"></div>
            <div id="an17"></div>
            <div id="an18"></div>
        </div>
        <div id="shadow"></div>
    </div>
</div>

<style>
    .loading {
        position: fixed;
        display: flex;
        justify-content: center;
        align-items: center;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 99;
        background-color: #f5f5fa;
        transition: opacity 0.5s ease;
    }
	
      
#ghost {
  position: relative;
  scale: 0.8;
}

#red {
  animation: upNDown infinite 1s;
  position: relative;
  width: 140px;
  height: 140px;
  display: grid;
  grid-template-columns: repeat(14, 1fr);
  grid-template-rows: repeat(14, 1fr);
  grid-column-gap: 0px;
  grid-row-gap: 0px;
  grid-template-areas:
    "a1  a2  a3  a4  a5  top0  top0  top0  top0  a10 a11 a12 a13 a14"
    "b1  b2  b3  top1 top1 top1 top1 top1 top1 top1 top1 b12 b13 b14"
    "c1 c2 top2 top2 top2 top2 top2 top2 top2 top2 top2 top2 c13 c14"
    "d1 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 d14"
    "e1 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 e14"
    "f1 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 top3 f14"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4 top4"
    "st0 st0 an4 st1 an7 st2 an10 an10 st3 an13 st4 an16 st5 st5"
    "an1 an2 an3 an5 an6 an8 an9 an9 an11 an12 an14 an15 an17 an18";
}

@keyframes upNDown {
  0%,
  49% {
    transform: translateY(0px);
  }
  50%,
  100% {
    transform: translateY(-10px);
  }
}

#top0,
#top1,
#top2,
#top3,
#top4,
#st0,
#st1,
#st2,
#st3,
#st4,
#st5 {
  background-color: red;
}

#top0 {
  grid-area: top0;
}

#top1 {
  grid-area: top1;
}

#top2 {
  grid-area: top2;
}

#top3 {
  grid-area: top3;
}

#top4 {
  grid-area: top4;
}

#st0 {
  grid-area: st0;
}

#st1 {
  grid-area: st1;
}

#st2 {
  grid-area: st2;
}

#st3 {
  grid-area: st3;
}

#st4 {
  grid-area: st4;
}

#st5 {
  grid-area: st5;
}

#an1 {
  grid-area: an1;
  animation: flicker0 infinite 1s;
}

#an18 {
  grid-area: an18;
  animation: flicker0 infinite 1s;
}

#an2 {
  grid-area: an2;
  animation: flicker1 infinite 1s;
}

#an17 {
  grid-area: an17;
  animation: flicker1 infinite 1s;
}

#an3 {
  grid-area: an3;
  animation: flicker1 infinite 1s;
}

#an16 {
  grid-area: an16;
  animation: flicker1 infinite 1s;
}

#an4 {
  grid-area: an4;
  animation: flicker1 infinite 1s;
}

#an15 {
  grid-area: an15;
  animation: flicker1 infinite 1s;
}

#an6 {
  grid-area: an6;
  animation: flicker0 infinite 1s;
}

#an12 {
  grid-area: an12;
  animation: flicker0 infinite 1s;
}

#an7 {
  grid-area: an7;
  animation: flicker0 infinite 1s;
}

#an13 {
  grid-area: an13;
  animation: flicker0 infinite 1s;
}

#an9 {
  grid-area: an9;
  animation: flicker1 infinite 1s;
}

#an10 {
  grid-area: an10;
  animation: flicker1 infinite 1s;
}

#an8 {
  grid-area: an8;
  animation: flicker0 infinite 1s;
}

#an11 {
  grid-area: an11;
  animation: flicker0 infinite 1s;
}

@keyframes flicker0 {
  0%,
  49% {
    background-color: red;
  }
  50%,
  100% {
    background-color: transparent;
  }
}

@keyframes flicker1 {
  0%,
  49% {
    background-color: transparent;
  }
  50%,
  100% {
    background-color: red;
  }
}

#eye {
  width: 40px;
  height: 50px;
  position: absolute;
  top: 30px;
  left: 10px;
}

#eye::before {
  content: "";
  background-color: white;
  width: 20px;
  height: 50px;
  transform: translateX(10px);
  display: block;
  position: absolute;
}

#eye::after {
  content: "";
  background-color: white;
  width: 40px;
  height: 30px;
  transform: translateY(10px);
  display: block;
  position: absolute;
}

#eye1 {
  width: 40px;
  height: 50px;
  position: absolute;
  top: 30px;
  right: 30px;
}

#eye1::before {
  content: "";
  background-color: white;
  width: 20px;
  height: 50px;
  transform: translateX(10px);
  display: block;
  position: absolute;
}

#eye1::after {
  content: "";
  background-color: white;
  width: 40px;
  height: 30px;
  transform: translateY(10px);
  display: block;
  position: absolute;
}

#pupil {
  width: 20px;
  height: 20px;
  background-color: blue;
  position: absolute;
  top: 50px;
  left: 10px;
  z-index: 1;
  animation: eyesMovement infinite 6s;
}

#pupil1 {
  width: 20px;
  height: 20px;
  background-color: blue;
  position: absolute;
  top: 50px;
  right: 50px;
  z-index: 1;
  animation: eyesMovement infinite 6s;
}

@keyframes eyesMovement {
  0%,
  49% {
    transform: translateX(0px);
  }
  50%,
  99% {
    transform: translateX(10px);
  }
  100% {
    transform: translateX(0px);
  }
}

#shadow {
  background-color: black;
  width: 140px;
  height: 140px;
  position: absolute;
  border-radius: 50%;
  transform: rotateX(80deg);
  filter: blur(20px);
  top: 80%;
  animation: shadowMovement infinite 1s;
}

@keyframes shadowMovement {
  0%,
  49% {
    opacity: 0.5;
  }
  50%,
  100% {
    opacity: 0.2;
  }
}

</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>

<script>	
    function initLoading() {
        let loading = document.querySelector(".loading");
        document.addEventListener('DOMContentLoaded', function() {
            
            setTimeout(() => {
                loading.style.opacity = "0";
                
                setTimeout(() => {
                    loading.style.display = "none";
                }, 500);
            }, 500); 
        });
    }

    initLoading();
</script>


<link
  rel="stylesheet"
  href="https://cdn-font.hyperos.mi.com/font/css?family=MiSans:400:Chinese_Simplify,Latin&display=swap"
/>



<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaigbscreen.css" />

<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaigbscreenr.css" />

<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaiscreen.css" />

<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/lxgwwenkaiscreenr.css" />


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_1a3c99934e119e1b.png" width="300"
                            height="268" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🫡</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Expl0rer.Ct</a></h1>
            <h2 class="site-description">吾将上下而求索</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/695179979?spm_id_from=333.40138.0.0'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/Expl0rer-Ct'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页 | Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E-about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于 | About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档 | Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索 | Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E6%8A%80%E6%9C%AF%E9%93%BE%E6%8E%A5-links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>技术链接 | Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <!--
tags: [temperature, hot, wheater, thermometer, forecast]
category: Weather
version: "1.73"
unicode: "f236"
-->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="32"
  height="32"
  viewBox="0 0 24 24"
  fill="none"
  stroke="#ff9500"
  stroke-width="1"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="icon-tabler-sun-high"
>
  <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z" />
  <path d="M6.343 17.657l-1.414 1.414" />
  <path d="M6.343 6.343l-1.414 -1.414" />
  <path d="M17.657 6.343l1.414 -1.414" />
  <path d="M17.657 17.657l1.414 1.414" />
  <path d="M4 12h-2" />
  <path d="M12 4v-2" />
  <path d="M20 12h2" />
  <path d="M12 20v2" />
</svg>

                        <!--
tags: [night, dark mode]
category: Weather
version: "1.21"
unicode: "ece7"
-->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="32"
  height="32"
  viewBox="0 0 24 24"
  fill="none"
  stroke="#8d6e63"
  stroke-width="1"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="icon-tabler-moon-stars"
>
  <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
  <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2" />
  <path d="M19 11h2m-1 -1v2" />
</svg>

                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#linux动态内存管理机制">Linux动态内存管理机制</a>
      <ol>
        <li><a href="#堆的内存管理机制">堆的内存管理机制</a>
          <ol>
            <li><a href="#堆块介绍">堆块介绍</a></li>
          </ol>
        </li>
        <li><a href="#堆块的管理">堆块的管理</a></li>
        <li><a href="#堆块的合并操作">堆块的合并操作</a></li>
        <li><a href="#结构体">结构体</a></li>
        <li><a href="#各种内存块介绍">各种内存块介绍</a>
          <ol>
            <li><a href="#fastbin">Fastbin</a></li>
            <li><a href="#unsortedbin">Unsortedbin</a></li>
            <li><a href="#smallbin">Smallbin</a></li>
            <li><a href="#largebin">Largebin</a></li>
          </ol>
        </li>
        <li><a href="#malloc运行流程">Malloc运行流程</a></li>
        <li><a href="#堆动态保护机制的小总结">堆动态保护机制的小总结</a></li>
      </ol>
    </li>
    <li><a href="#堆的调试方法">堆的调试方法</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/pwn-3/">
                <img src="/p/pwn-3/PWN3_hu_817e5a93f218a6e2.png"
                        srcset="/p/pwn-3/PWN3_hu_817e5a93f218a6e2.png 800w, /p/pwn-3/PWN3_hu_22548379e62858b4.png 1600w"
                        width="800" 
                        height="450" 
                        loading="lazy"
                        alt="Featured image of post PWN-3" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/pwn%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/" style="background-color: #2a9d8f; color: #fff;">
                PWN前置知识
            </a>
        
            <a href="/categories/ctfpwn/" style="background-color: #2a9d8f; color: #fff;">
                CTFpwn
            </a>
        
            <a href="/categories/ctf%E5%85%A5%E9%97%A8/" >
                CTF入门
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/pwn-3/">PWN-3</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            二进制漏洞与利用——堆利用
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-09-07</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>[TOC]</p>
<p><strong>前文：以下是我入门PWN的记录，欢迎各位前来观看，小弟领教！</strong></p>
<p>在前面的章节中，我们已经粗略的了解了栈相关的知识点：
ROP、shellcode、栈转移等。</p>
<p>内存中还有一块区域叫做堆（heap）。</p>
<p>接下来的一整章的内容，我们就来讲堆。</p>
<blockquote class="alert alert-tip">
    <blockquote>
<p>堆章节比较抽象，我还刻意加了很多图，但依旧比栈章节要更加抽象&hellip;，以至于作者也学的迷迷糊糊，看不懂的欢迎来评论区讨论。</p></blockquote></blockquote>
<h2 id="linux动态内存管理机制">Linux动态内存管理机制
</h2><p>什么是堆？+</p>
<p>堆是程序用于分配动态内存的一段内存区域。
他独立的存在于内存中，介于程序内存 基地址和libc地址之间，<strong>从低地址向高地址生长</strong>，与用户打交道最多。</p>
<p>带你举个例子理解动态分配内存：</p>
<p>开一个统计表格，每人最多输入的最大内存长度是4096个字节，按照以往惯性思维去分配的话，你是不是应该每人都在之前填表时就已经分好了内存给他们了，但不是每个人都能用完这4096个字节的，有些人只输入一个字节，那就意味着就有4095个字节的内存区域被浪费，如果每个人都这样做或输入少于最大字节长度的内存的数据，是不是浪费更多？</p>
<p>对于这种现象的下一步应该是回收，怎么回收？</p>
<p>那么，有没有一种方法，能让程序根据用户所需要的内存长度大小来分配内存呢？并且不需要我们管理内存呢？有的，在libc中，我们可以通过<code>malloc(size)</code>来给用户分配一段长度为size的内存，通过<code>free(ptr)</code>来释放这段内存区域。
这些数据，被统一的存放在了堆中，维护这些数据的运行机制在glibc中，称之为<code>ptmalloc</code>。</p>
<h3 id="堆的内存管理机制">堆的内存管理机制
</h3><p>堆是真无敌恶心&hellip;.堆的管理机制相比于栈十分复杂，可以算是对我这样0基础的萌新杀手。</p>
<p>但是堆的漏洞比栈有更多的形式和利用方式，而且堆漏洞所需要的条件比栈更
少。
一般情况下栈溢出起码需要16个字节，也就是至少溢出到返回地址才能利用，但是堆的话只需要一个字节就可完成利用，甚至这个字节可以是个\x00,也就是空字节，nullbyte。</p>
<blockquote class="alert alert-tip">
    <blockquote>
<p>栈的话基本都会关闭一两个保护机制，堆的话一般全开。</p>
<p>CTFpwn的主流是堆利用。</p></blockquote></blockquote>
<h4 id="堆块介绍">堆块介绍
</h4><h5 id="chunk">chunk
</h5><p>在了解ptmalloc的内存管理机制前，我们先了解一下堆块在内存中的存储形式。在内存中，堆是以一个个堆块构成的,这些堆块称之为chunk。</p>
<p>在64位系统中，堆块的大小是8字节对齐的,也就是说，我们申请一个15字节长度的堆块，实际到我们手中的用户可控的数据区域大小为16字节。</p>
<p>但是在管理中，一个堆块除了用户数据区外，还有头部字段，头部字段的长度为16字节。同时在64位系统中，一个堆块最小长度为32字节（包括头部），也就是说，我们分配一个1字节的堆块，他的实际长度是32字节。</p>
<p><img src="/p/pwn-3/1.png"
	width="600"
	height="699"
	srcset="/p/pwn-3/1_hu_c6a945343d5e6bd0.png 480w, /p/pwn-3/1_hu_edfe0fe933bf2d3e.png 1024w"
	loading="lazy"
	
		alt="堆块结构图"
	
	
		class="gallery-image" 
		data-flex-grow="85"
		data-flex-basis="206px"
	
></p>
<p>prev_size和size字段分别代表一个chunk对的大小，大小都是8字节，两个一共16字节，称之为chunk的头部字段。后面的user data区域是用户可以输入数据的地方。</p>
<p>chunk的大小8字节对齐，所以说对于分配器来说，0x80、0x81、0x82大小的堆块都是一样的，都为0x80大小。</p>
<blockquote>
<p>可能你举得有点懵，但这是一种简化表述，核心是<strong>堆块大小必须满足 8 字节对齐</strong>，所以分配器会把不满足的大小调整到最近的 8 字节对齐的大小，这样就会出现多个请求大小对应同一个实际分配大小的情况。</p></blockquote>
<p>为了节省空间，将size的最低三个bit设置为三个标志位。</p>
<blockquote class="alert alert-note">
    <blockquote>
<p>从高到低分别为<code>non_main_arena</code>、<code>is_mmap</code>、<code>prev_inuse</code>，这里分别解释一下：</p>
<p>non_main_arena用来记录当前chunk是否不属于主线程,1表示不属于，0表示属于。</p>
<p>is_mmap表示当前chunk是否由mmap分配的，1表示属于，0表示不属于。</p>
<p>prev_inuse用来表示前面紧邻的那个chunk是否正在使用，0表示前面的chunk已经被释放，1表示正在被用户使用。</p></blockquote></blockquote>
<p><img src="/p/pwn-3/1.png"
	width="600"
	height="699"
	srcset="/p/pwn-3/1_hu_c6a945343d5e6bd0.png 480w, /p/pwn-3/1_hu_edfe0fe933bf2d3e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="85"
		data-flex-basis="206px"
	
></p>
<p>prevsize记录前面一个chunk的大小。这里注意，<strong>prevsize只有在前面的chunk被free掉的时候才生效</strong>，也就是说，只有在prev_inuse为0的时候，系统才把prev_size字段当作prevsize。</p>
<p>那么其他时候这个字段有用吗？没用的话不就浪费了八个字节？</p>
<p>有用的！如果chunk正在被使用，那么他会把下一个chunk的prevsize字段当作userdata。充分利用空间。</p>
<p>也就是说，如果我们申请一个0x80长度大小的区域，系统实际给我们0×90大小（0x10头部），如果我们申请0x88大小的区域，系统同样也会给我们0x90大小的区域（算头部），剩下的8字节，使用nextchunk的prevsize区域。因为，只有当一个chunk被释放的时候，nextchunk的prevsize才真正代表前一个chunk的大小，所以就这么设计了。</p>
<hr>
<h5 id="topchunk">topchunk
</h5><p>topchunk是一个特殊的chunk，类似于bss字段未被分配的内存一样，比较原始的。</p>
<p>最开始时，程序的堆还未被使用，整个的堆区域属于一个很大的堆块叫做topchunk。当已经被使用的空间不够时，程序就会从topchunk中分割一块出来个程序使用。</p>
<h3 id="堆块的管理">堆块的管理
</h3><p>为了保证程序的快速运行，而且方便系统内存管理，所以ptmalloc将释放后的堆块根据其大小分成不同的bin。</p>
<p>fastbin：大小范围从0x20-0×80</p>
<p>smallbin：大小范围：0×90-0x400</p>
<p>Large bin：大小范围：0x410以上</p>
<p>unsortedbin：未被归类的bin，临时存储用，存放的堆块大小不一定多大，后续详细介绍。</p>
<p>chunk被free之后如图：</p>
<p><img src="/p/pwn-3/2.png"
	width="608"
	height="706"
	srcset="/p/pwn-3/2_hu_9e37b4c47dc91d38.png 480w, /p/pwn-3/2_hu_3d5602cb30b1dc73.png 1024w"
	loading="lazy"
	
		alt="堆释放示意图"
	
	
		class="gallery-image" 
		data-flex-grow="86"
		data-flex-basis="206px"
	
></p>
<p>由于chunk被free了，所以按常理说用户不应该能够访问到这个chunk。于是乎在userdata区域存放一些用于管理内存的指针信息。</p>
<p>fastbin：单链表结构，只会用到fd这个指针；</p>
<p>small &amp;unsortedbin：双向链表结构，fd和bk都用；</p>
<p>largebin：双向链表，fd、bk都用，同时还会用fd nextsize和bk nextsize。</p>
<h3 id="堆块的合并操作">堆块的合并操作
</h3><p>如果我们free掉一个堆块，（可能）会触发向前合并和向后合并。</p>
<p><img src="/p/pwn-3/2.png"
	width="608"
	height="706"
	srcset="/p/pwn-3/2_hu_9e37b4c47dc91d38.png 480w, /p/pwn-3/2_hu_3d5602cb30b1dc73.png 1024w"
	loading="lazy"
	
		alt="堆"
	
	
		class="gallery-image" 
		data-flex-grow="86"
		data-flex-basis="206px"
	
></p>
<p>向前合并：检查当前chunk的prev inuse位，如果为0，则根据当前chunk的prev size找到prev chunk的头，两个堆块合并；</p>
<p>向后合并：检查当前chunk的next next chunk的prev inuse位（因为一个堆块的状态由他后面chunk的prev inuse位决定，所以确定next chunk的状态需要检查next next chunk的prev inuse位，怎么找? size就行），然后根据next chunk的状态决定是否合并。</p>
<p>变化示意图：</p>
<p><img src="/p/pwn-3/3.png"
	width="549"
	height="690"
	srcset="/p/pwn-3/3_hu_3e940d845dbc5926.png 480w, /p/pwn-3/3_hu_312b3e9f07d6e5d2.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="79"
		data-flex-basis="190px"
	
></p>
<hr>
<p><img src="/p/pwn-3/4.png"
	width="514"
	height="700"
	srcset="/p/pwn-3/4_hu_4c5c79d1e71a5cc8.png 480w, /p/pwn-3/4_hu_394cc2401ee65f45.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="73"
		data-flex-basis="176px"
	
></p>
<hr>
<p><img src="/p/pwn-3/5.png"
	width="435"
	height="701"
	srcset="/p/pwn-3/5_hu_6f7258d5a1b19d23.png 480w, /p/pwn-3/5_hu_4f4b1d7c5324c890.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="62"
		data-flex-basis="148px"
	
></p>
<hr>
<p>这四张图看得有点懵？说人话就是prev_inuse=0说明前面chunk被释放了，呃身体都没了你要头有什么用？我的话过重了&hellip;身体（chunk）被释放free没了应该头也跟着一起灰飞烟灭！！一起消失掉，和其它堆合并。（<strong>先向前合并再考虑向后合并</strong>）</p>
<blockquote class="alert alert-note">
    <blockquote>
<p>“合并” 的关系</p>
<p>向前合并（关键关联 <code>prev_inuse = 0</code>）</p>
<p>若当前堆块的 <code>prev_inuse = 0</code> 时，说明<strong>前一个堆块是空闲的</strong>。此时，当前堆块可以：</p>
<p>1、读取前一个堆块的头部信息（通过当前堆块的 <code>prev_size</code> 字段，获取前一个堆块的大小）。</p>
<p>2、将 “当前堆块” 与 “前一个空闲堆块” 合并，形成一个更大的空闲堆块，减少内存碎片。</p>
<p>向后合并（与 <code>prev_inuse</code> 无直接关联）</p>
<p>1、“向后合并” 是指<strong>当前空闲堆块</strong>与<strong>后一个相邻的空闲堆块</strong>合并，其判断条件是：<strong>后一个堆块是否为空闲</strong>（通过检查后一个堆块的 <code>prev_inuse</code> 标志）。</p>
<p>For instace，当前堆块是空闲的，若后一个堆块的 <code>prev_inuse = 0</code>（说明后一个堆块认为 “前一个堆块（即当前堆块）是空闲的”），则可以进行向后合并。</p>
<p>2、可见，“向后合并” 的核心是<strong>后一个堆块的 <code>prev_inuse</code> 标志</strong>，而非当前堆块的 <code>prev_inuse</code>。</p>
<p><strong>考虑到相对关系，简单来说对于当前你要讨论的堆头部来说，它的prev_inuse=0时，它本身就应该和前面的chunk合并。</strong></p>
<p>而“向后合并” 的触发条件是后一个堆块的 prev_inuse = 0（表示后一个堆块允许与前一个堆块 —— 即当前堆块 —— 合并）。</p></blockquote></blockquote>
<h3 id="结构体">结构体
</h3><p><code>aren</code></p>
<p>是一块结构体，用于管理bins。主线程创建的arena称之为main_arena,其他的叫threadarena。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">malloc</span> <span class="n">state</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="cm">/* Serialize access.*/</span>
</span></span><span class="line"><span class="cl">	<span class="kt">mutex_t</span> <span class="n">mutex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/*Fastbins*/</span>
</span></span><span class="line"><span class="cl">	<span class="n">mfastbinptr</span> <span class="n">fastbinsY</span><span class="p">[</span><span class="n">NFASTBINS</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="cm">/* Base of the topmost chunk -- not otherwise kept in a bin*/</span>
</span></span><span class="line"><span class="cl">	<span class="n">mchunkptr</span> <span class="n">top</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="cm">/* The remainder from the most recent split of a small request */</span>
</span></span><span class="line"><span class="cl">	<span class="n">mchunkptr</span> <span class="n">last</span> <span class="n">remainder</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/*Nromal bins packed as described above*/</span>
</span></span><span class="line"><span class="cl">	<span class="n">mchunkptr</span> <span class="n">bins</span><span class="p">[</span><span class="n">NBINS</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/*Bitmap of bins*/</span>
</span></span><span class="line"><span class="cl">	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">binmap</span><span class="p">[</span><span class="n">BINMAPSIZE</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/*Linked list*/</span>
</span></span><span class="line"><span class="cl">	<span class="k">struct</span> <span class="n">malloc</span> <span class="n">state</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/*Linked list for free arenas.*/</span>
</span></span><span class="line"><span class="cl">	<span class="k">struct</span> <span class="n">malloc</span> <span class="n">state</span> <span class="o">*</span><span class="n">next_free</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="cm">/* Memory allocated from the system in this arena.*/</span>
</span></span><span class="line"><span class="cl">	<span class="n">INTERNAL_SIZE_T_system_mem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">INTERNAL_SIZE_T_max_system_mem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="err">；</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="各种内存块介绍">各种内存块介绍
</h3><p>各种bins：</p>
<p><img src="/p/pwn-3/6.png"
	width="1170"
	height="530"
	srcset="/p/pwn-3/6_hu_356d3d1f41d3a343.png 480w, /p/pwn-3/6_hu_681cc24595ccc945.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="220"
		data-flex-basis="529px"
	
></p>
<h4 id="fastbin">Fastbin
</h4><p>管理fastbin free chunk，单链表结构，FILO（最后一个进入fastbin链表的，会被放在头部）总共有十个fastbin链表，每个链表中fastbin的size一样，<code>0x10</code>递增。</p>
<p>大小属于fastbin的chunk被free掉时，不会改变next chunk的prev inuse位，也就是说不会被合并。</p>
<img src="7.png" alt="Fastbin" style="zoom:175%;" />
<h4 id="unsortedbin">Unsortedbin
</h4><p><strong>管理unsorted chunk，只有一个双向链
表</strong>。所有大小大于fastbin的chunk都会先被暂
时放入unsortedbin中，链表中的chunk大小不一样。</p>
<p><img src="/p/pwn-3/8.png"
	width="505"
	height="680"
	srcset="/p/pwn-3/8_hu_ede4dba4e4677942.png 480w, /p/pwn-3/8_hu_77246d469abdf9c8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="74"
		data-flex-basis="178px"
	
></p>
<p>*<strong>注意：这里的指向箭头比较多</strong></p>
<h4 id="smallbin">Smallbin
</h4><p>管理small chunk，由62个双向链表组成，
每个链表中的chunk大小一样，大小以0x10递
增。长得和unsortedbin差不多的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">+-------------------+      +-------------------+      +-------------------+
</span></span><span class="line"><span class="cl">|     smallbin      | &lt;--&gt; |   free chunk 1    | &lt;--&gt; |   free chunk 2    | &lt;--&gt; ...
</span></span><span class="line"><span class="cl">|  (size = 0x20)    |      |                   |      |                   |
</span></span><span class="line"><span class="cl">+-------------------+      +-------------------+      +-------------------+
</span></span><span class="line"><span class="cl">         |
</span></span><span class="line"><span class="cl">         v
</span></span><span class="line"><span class="cl">+-------------------+      +-------------------+      +-------------------+
</span></span><span class="line"><span class="cl">|     smallbin      | &lt;--&gt; |   free chunk 1    | &lt;--&gt; |   free chunk 2    | &lt;--&gt; ...
</span></span><span class="line"><span class="cl">|  (size = 0x30)    |      |                   |      |                   |
</span></span><span class="line"><span class="cl">+-------------------+      +-------------------+      +-------------------+
</span></span><span class="line"><span class="cl">         |
</span></span><span class="line"><span class="cl">         v
</span></span><span class="line"><span class="cl">       ... (更多 smallbin，大小递增)
</span></span><span class="line"><span class="cl">         |
</span></span><span class="line"><span class="cl">         v
</span></span><span class="line"><span class="cl">+-------------------+      +-------------------+      +-------------------+
</span></span><span class="line"><span class="cl">|     smallbin      | &lt;--&gt; |   free chunk 1    | &lt;--&gt; |   free chunk 2    | &lt;--&gt; ...
</span></span><span class="line"><span class="cl">|  (size = 0x3F0)   |      |                   |      |                   |
</span></span><span class="line"><span class="cl">+-------------------+      +-------------------+      +-------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="largebin">Largebin
</h4><p>管理large chunk，63个双向链表，FIFO。同一个双线链表中chunk大小可以不一样，但是在一定范围内，bins大小从小到大排列。</p>
<blockquote>
<p>在此我们先不学习larbin attack的相关内容，所以看看就行，了解一下。比较少遇见Largebin的相关题。</p></blockquote>
<img src="9.png" style="zoom:150%;" />
<h3 id="malloc运行流程">Malloc运行流程
</h3><p>了解完各种bin之后，现在来看看这：</p>
<p>一、当我们调用malloc时，程序都干了些什么？</p>
<p>1、计算真正的堆块的大小（加上堆头部长度、对齐）：</p>
<p>判断是否在fastbin范围内：</p>
<ul>
<li>
<p>确定在，检查对应大小的bin链表中有无chunk。</p>
<ul>
<li>有，那就分配给用户，至此完成。</li>
</ul>
</li>
<li>
<p>如果不在fastbin范围内，或者没用chunk可用。（两者满足一个或者都满足的话）</p>
<ul>
<li>
<p>继续判断是否在smallbin范围内：</p>
<ul>
<li>在smallbin范围内，检查对应大小的bin链表中有无chunk。
<ul>
<li>有chunk，那就取出来给程序，至此完成。</li>
</ul>
</li>
<li>不在smallbin范围内，或者smallbin里面也没有chunk。这时候跳到unsortedbin的检查。</li>
</ul>
</li>
<li>
<p>unsortedbin中有无chunk？</p>
<ul>
<li>
<p>有，从尾部取出第一个chunk，看看大小是否满足需求。</p>
<ul>
<li>满足，切分后大小是否大于<strong>minsize</strong>？
<ul>
<li>大于，再切分块，返回给用户，剩下的块放进unsortedbin。</li>
<li>小于或等于minsize，直接返回给用户，完成。</li>
</ul>
</li>
<li>不满足大小需求，把这个块放入smallbin / largebin对应的链表中，继续遍历下一个块。</li>
</ul>
</li>
<li>
<p>没。unsortedbin的所有块都不满足，那此时就判断是否在largebin范围。</p>
<ul>
<li>是，检查对应的bin链表中有无符合的chunk。
<ul>
<li>有符合的，找到满足需求最小的chunk，切分块返回，剩下的放进unsortedbin中。</li>
</ul>
</li>
<li>不在，那就再次遍历smallbin / largebin找best fit的chunk。</li>
<li>我去？还是没用，那就从<code>topchunk</code>中切割。</li>
<li>？？搞什么鬼？？topchunk也不够？那就<code>mmap</code>系统调用</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>二、当我们调用了free时，程序都干了些什么？</p>
<p>free的chunk大小属于fastbin吗？</p>
<ul>
<li>
<p>是，放进fastbin，至此完成。</p>
</li>
<li>
<p>不属于，那就接着判断这个free的chunk是否是mmap分配的。</p>
<ul>
<li>
<p>是，那就调用munmap回收，完成。</p>
</li>
<li>
<p>不是，那就接着判断前一个chunk是否是空闲的。</p>
<ul>
<li>
<p>是，那就<strong>向前合并</strong></p>
</li>
<li>
<p>不是，接着判断：后一个chunk是topchunk吗？</p>
<ul>
<li>
<p>是，那就和topchunk合并，至此完成。</p>
</li>
<li>
<p>不是topchunk，那就判断：后一个chunk是free的吗？</p>
<ul>
<li>是，那就<strong>向后合并</strong>，然后放进unsortedbin，终于完成了。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="堆动态保护机制的小总结">堆动态保护机制的小总结
</h3><p>我的妈啊，难死我了，堆的内存管理机制比较复杂，多刷刷题吧，受不了了，刚开始就上强度了😫。</p>
<blockquote>
<p>我这里有一个发自内心的疑问：堆的本质是指针指来指去吗？O(∩_∩)O</p>
<p>堆的本质可以理解为<strong>通过指针操作管理动态内存的机制</strong>，但 “指针指来指去” 只是其表现形式之一，更深层的本质是<strong>内存块的分配、释放和复用规则</strong>，以及攻击者通过破坏规则实现漏洞利用的过程。理解堆的核心在于掌握内存块的组织结构、堆管理器的行为逻辑，而非单纯的指针操作。</p></blockquote>
<h2 id="堆的调试方法">堆的调试方法
</h2>
</section>


    <footer class="article-footer">
    

    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 2025-10-08
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/pwn-4/">
        
        
            <div class="article-image">
                <img src="/p/pwn-4/PWN4.3657bbeb84fdb7f3290e78d3c41b8d4c_hu_d9ba59500c5360b4.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post PWN-4"
                        
                        data-hash="md5-Nle764T9t/MpDnjTxBuNTA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PWN-4</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/pwn-2/">
        
        
            <div class="article-image">
                <img src="/p/pwn-2/PWN2.ec0b8de7542727a390b799ae24c64af8_hu_ed10e985448522e2.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post PWN-2"
                        
                        data-hash="md5-7AuN51QnJ6OQt5muJMZK&#43;A==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PWN-2</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/pwn-1/">
        
        
            <div class="article-image">
                <img src="/p/pwn-1/PWN.f98719505e350e475520e79f81d73a1d_hu_fb4f51a67c6d3b57.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post PWN-1"
                        
                        data-hash="md5-&#43;YcZUF41DkdVIOefgdc6HQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PWN-1</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/ida%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">
        
        
            <div class="article-image">
                <img src="/p/ida%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/IDA.24e86f15c02689113058084231ff68da_hu_6a8de3be4381c8e4.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post IDA使用指南"
                        
                        data-hash="md5-JOhvFcAmiREwWAhCMf9o2g==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">IDA使用指南</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/">
        
        
            <div class="article-image">
                <img src="/p/ctfshow-%E5%85%A5%E9%97%A8pwn-writeup/ctfshow.8c2a966268b078c807772be02e985309_hu_9b3814b0af84762b.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post CTFshow-入门PWN-writeup"
                        
                        data-hash="md5-jCqWYmiweMgHdyvgLphTCQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">CTFshow-入门PWN-writeup</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="Expl0rer-Ct/Expl0rer.Ct-s-Blog"
    data-repo-id="R_kgDOPd0X7g"
    data-category="Announcements"
    data-category-id="DIC_kwDOPd0X7s4CuMr6"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    data-loading=""
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark');
            }
        }
    })();
</script>

    

    
<script defer src="https://events.vercount.one/js"></script>
<footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 Expl0rer.Ct
    </section>
    
    <section class="powerby">
        



        





































        
<section class="wordcount">
  <div class="wordcount-row">
    <p>博主发布了14篇文章  ||</p>
    <p>总共195.82k 字</p>
  </div>
</section>
        
  


<a>总访客数: </a><span id='busuanzi_value_site_uv'>别急在加载中了...</span> <a> | </a> <a>总访问量: </a><span id='busuanzi_value_site_pv'>加载中...</span></br>



<div class="site-uptime-container">
  <span id="timeDate" class="site-uptime-text">载入天数...</span>
  <span id="times" class="site-uptime-text">载入时分秒...</span>
</div>

<script language="javascript"> 
    var now = new Date();
    function createtime(){
        now.setTime(now.getTime()+250); 
        var grt= new Date("2025/08/01 00:00:00"); 
        days = (now - grt ) / 1000 / 60 / 60 / 24;
        dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
        hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;}
        minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes);
        if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds);
        if(String(snum).length ==1 ){snum = "0" + snum;}

        document.getElementById("timeDate").innerHTML = "本站已稳定运行"+dnum+" 天 ";document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"
    }
    setInterval("createtime()",250); 
</script> 

<script>
    (function(u, c) {
      var d = document, t = 'script', o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function(e) { c(e); }); }
      s.parentNode.insertBefore(o, s);
    })('//cdn.bootcss.com/pangu/4.0.7/pangu.min.js', function() {
      pangu.spacingPage();
    });
</script>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdnjs.cloudflare.com/ajax/libs/node-vibrant/3.1.6/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script><script type="text/javascript" src="/ts/custom.89d9bb2c3c071ae8a261f67661c22b84ef67ba7b7a885dabd2bbd9ebef84ed40.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>


<head>
  
  <link rel="preconnect" href="https://fonts.font.im" crossorigin>
  <link 
    href="https://fonts.font.im/css?family=PT+Sans" 
    rel="stylesheet"
    media="print" 
    onload="this.media='all'"
    id="font-cn"
  >
  
  
  <link 
    href="https://fonts.googleapis.com/css2?family=PT+Sans" 
    rel="stylesheet"
    media="print" 
    onload="this.media='all'"
    id="font-en"
    disabled
  >
  
  <script>
    
    document.querySelector('#font-cn').addEventListener('load', function() {
      document.querySelector('#font-en').disabled = true;
    }).addEventListener('error', function() {
      document.querySelector('#font-en').disabled = false;
      document.querySelector('#font-en').media = 'all';
    });
  </script>
  
  <noscript>
    <link 
      href="https://fonts.font.im/css?family=PT+Sans" 
      rel="stylesheet"
    >
  </noscript>
</head>

<style>
    #TableOfContents > ul ul,
    #TableOfContents > ul ol,
    #TableOfContents > ol ul,
    #TableOfContents > ol ol {
        display: none;
    }
    #TableOfContents > ul .open,
    #TableOfContents > ol .open {
        display: block;
    }
</style>

<script>
    function initTocHide() {
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        window.addEventListener('scroll', function() {
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                const parent = ul.parentElement;
                ul = parent ? parent.parentElement : null;
            } while (ul && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>


<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url(https://expl0rer.top/icons/backTop.svg);
    }
</style>

<script>
    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        window.addEventListener('scroll', function() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        });
    }

    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>


<style>
    .highlight {
        max-height: 400px;
        overflow: hidden;
    }

    .code-show {
        max-height: none !important;
    }

    .code-more-box {
        width: 100%;
        padding-top: 78px;
        background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, 0)), to(#fff));
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
    }

    .code-more-btn {
        display: block;
        margin: auto;
        width: 44px;
        height: 22px;
        background: #f0f0f5;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        padding-top: 6px;
        cursor: pointer;
    }

    .code-more-img {
        cursor: pointer !important;
        display: block;
        margin: auto;
        width: 22px;
        height: 16px;
    }
</style>

<script>
  function initCodeMoreBox() {
    let codeBlocks = document.querySelectorAll(".highlight");
    if (!codeBlocks) {
      return;
    }
    codeBlocks.forEach(codeBlock => {
      if (codeBlock.scrollHeight <= codeBlock.clientHeight) {
        return;
      }
      let codeMoreBox = document.createElement('div');
      codeMoreBox.classList.add('code-more-box');
      let codeMoreBtn = document.createElement('span');
      codeMoreBtn.classList.add('code-more-btn');
      codeMoreBtn.addEventListener('click', () => {
        codeBlock.classList.add('code-show');
        codeMoreBox.style.display = 'none';
        window.dispatchEvent(new Event('resize'))
      })
      let img = document.createElement('img');
      img.classList.add('code-more-img');
      img.src = "https:\/\/expl0rer.top\/icons\/codeMore.png"
      codeMoreBtn.appendChild(img);
      codeMoreBox.appendChild(codeMoreBtn);
      codeBlock.appendChild(codeMoreBox)
    })
  }
  
  initCodeMoreBox();
</script>






<script>
    function showHideView() {
        let viewCounts = document.querySelectorAll("#viewCount");
        if (viewCounts) {
            let article =  document.querySelector(".article-page");
            if (!article) {
                viewCounts.forEach(ele => {
                    ele.style.display = 'none';
                });
            }
        }
    }
    
    showHideView();
</script>

<script src="https://npm.elemecdn.com/nprogress@0.2.0/nprogress.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://npm.elemecdn.com/nprogress@0.2.0/nprogress.css" crossorigin="anonymous" />
<script>
    NProgress.start();
    document.addEventListener("readystatechange", () => {
        if (document.readyState === "interactive") NProgress.inc(0.8);
        if (document.readyState === "complete") NProgress.done();
    });
</script>


<script>
    var pjax = new pjax({
        selectors: [
            ".main-container"
        ]
    })

</script>

<script>
    pjax._handleResponse = pjax.handleResponse;
    pjax.handleResponse = function(responseText, request, href, options) {
        if (request.responseText.match("<html")) {
            if (responseText) {
                let newDom = new DOMParser().parseFromString(responseText, 'text/html');
                let bodyClass = newDom.body.className;
                document.body.setAttribute("class", bodyClass)
            }
            pjax._handleResponse(responseText, request, href, options);
        } else {
        }
    }
</script>



<script>
    document.addEventListener('pjax:complete', () => {
        if (window.Stack && typeof window.Stack.init === 'function') {
            window.Stack.init();
        }
    })
</script>

<div id="particles-js"></div>

<script src="https://expl0rer.top/background/particles.min.js"></script>
<script>
  particlesJS.load('particles-js', "https:\/\/expl0rer.top\/background\/particlesjs-config.json", function() {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
  #particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: -1;
  }
</style>


<script src="https://expl0rer.top/background/sakura.js"></script>

    </body>
</html>
